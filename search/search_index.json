{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"ArtifactFlow","text":"<p>ArtifactFlow \u662f\u4e00\u4e2a\u57fa\u4e8e LangGraph \u6784\u5efa\u7684\u591a Agent \u534f\u4f5c\u6846\u67b6\uff0c\u91c7\u7528\u53cc Artifact \u67b6\u6784\u5b9e\u73b0\u590d\u6742\u4efb\u52a1\u7684\u89c4\u5212\u4e0e\u6267\u884c\u3002</p>"},{"location":"#_1","title":"\u8bbe\u8ba1\u7406\u5ff5","text":""},{"location":"#agent","title":"\u4e3a\u4ec0\u4e48\u9700\u8981\u591a Agent \u534f\u4f5c\uff1f","text":"<p>\u5355\u4e00 LLM \u5728\u5904\u7406\u590d\u6742\u4efb\u52a1\u65f6\u9762\u4e34\u51e0\u4e2a\u6838\u5fc3\u6311\u6218\uff1a</p> <ul> <li>\u4e0a\u4e0b\u6587\u7a97\u53e3\u9650\u5236\uff1a\u957f\u7a0b\u4efb\u52a1\u5bb9\u6613\u4e22\u5931\u5173\u952e\u4fe1\u606f</li> <li>\u80fd\u529b\u8fb9\u754c\u6a21\u7cca\uff1a\u4e00\u4e2a prompt \u96be\u4ee5\u8986\u76d6\u6240\u6709\u4e13\u4e1a\u9886\u57df</li> <li>\u6267\u884c\u8fc7\u7a0b\u4e0d\u900f\u660e\uff1a\u7528\u6237\u96be\u4ee5\u5e72\u9884\u548c\u8c03\u6574\u6267\u884c\u65b9\u5411</li> </ul> <p>ArtifactFlow \u901a\u8fc7\u4e13\u4e1a\u5316\u5206\u5de5 + \u7ed3\u6784\u5316\u534f\u4f5c\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\u3002</p>"},{"location":"#artifact","title":"\u53cc Artifact \u67b6\u6784","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    ArtifactFlow                         \u2502\n\u2502                                                         \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502   \u2502  Task Plan      \u2502       \u2502  Result         \u2502        \u2502\n\u2502   \u2502  Artifact       \u2502       \u2502  Artifact       \u2502        \u2502\n\u2502   \u2502                 \u2502       \u2502                 \u2502        \u2502\n\u2502   \u2502  - \u4efb\u52a1\u5206\u89e3      \u2502       \u2502  - \u6267\u884c\u4ea7\u51fa       \u2502        \u2502\n\u2502   \u2502  - \u8fdb\u5ea6\u8ffd\u8e2a      \u2502       \u2502  - \u7248\u672c\u5386\u53f2       \u2502        \u2502\n\u2502   \u2502  - \u4f9d\u8d56\u5173\u7cfb      \u2502       \u2502  - \u589e\u91cf\u66f4\u65b0       \u2502        \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502            \u2502                         \u25b2                  \u2502\n\u2502            \u2502    Lead Agent           \u2502                  \u2502\n\u2502            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                  \u2502\n\u2502                     \u2502                                   \u2502\n\u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                        \u2502\n\u2502         \u25bc                      \u25bc                        \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                   \u2502\n\u2502   \u2502 SubAgent \u2502          \u2502 SubAgent \u2502                   \u2502\n\u2502   \u2502 (Search) \u2502          \u2502 (Crawl)  \u2502                   \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                   \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Task Plan Artifact\uff1a\u8bb0\u5f55\u4efb\u52a1\u89c4\u5212\u3001\u5206\u89e3\u6b65\u9aa4\u3001\u5f53\u524d\u8fdb\u5ea6\uff0c\u786e\u4fdd\u957f\u7a0b\u4efb\u52a1\u4e0d\u4f1a\"\u8ff7\u8def\"</p> <p>Result Artifact\uff1a\u7d2f\u79ef\u6267\u884c\u4ea7\u51fa\uff0c\u652f\u6301\u7248\u672c\u8ffd\u6eaf\uff0c\u7528\u6237\u53ef\u968f\u65f6\u67e5\u770b\u4e2d\u95f4\u7ed3\u679c</p>"},{"location":"#_2","title":"\u6838\u5fc3\u4f18\u52bf","text":"\u7279\u6027 \u8bf4\u660e \u8ba1\u5212\u4e0e\u7ed3\u679c\u5206\u79bb \u4efb\u52a1\u89c4\u5212\u548c\u6267\u884c\u4ea7\u51fa\u72ec\u7acb\u7ba1\u7406\uff0c\u4e92\u4e0d\u5e72\u6270 \u53ef\u8ffd\u6eaf\u6027 Artifact \u7248\u672c\u5386\u53f2\u5b8c\u6574\u8bb0\u5f55\u6bcf\u6b21\u53d8\u66f4 \u4eba\u673a\u534f\u4f5c \u6743\u9650\u7cfb\u7edf\u652f\u6301\u5173\u952e\u64cd\u4f5c\u7684\u7528\u6237\u786e\u8ba4 \u6d41\u5f0f\u53cd\u9988 SSE \u5b9e\u65f6\u63a8\u9001\u6267\u884c\u72b6\u6001\uff0c\u524d\u7aef\u53ef\u5373\u65f6\u5c55\u793a \u53ef\u6269\u5c55 \u8f7b\u677e\u6dfb\u52a0\u65b0 Agent \u548c Tool \u5e94\u5bf9\u4e0d\u540c\u573a\u666f"},{"location":"#_3","title":"\u5e94\u7528\u573a\u666f","text":"<p>ArtifactFlow \u662f\u4e00\u4e2a\u901a\u7528\u6846\u67b6\uff0c\u53ef\u9002\u914d\u591a\u79cd\u590d\u6742\u4efb\u52a1\u573a\u666f\uff1a</p> <ul> <li>\u4fe1\u606f\u68c0\u7d22\u4e0e\u6574\u5408\uff1a\u591a\u6e90\u641c\u7d22\u3001\u5185\u5bb9\u805a\u5408\u3001\u62a5\u544a\u751f\u6210</li> <li>\u6587\u6863\u64b0\u5199\uff1a\u5927\u7eb2\u89c4\u5212\u3001\u5206\u7ae0\u8282\u64b0\u5199\u3001\u8fed\u4ee3\u4fee\u8ba2</li> <li>\u4ee3\u7801\u4efb\u52a1\uff1a\u4ee3\u7801\u5ba1\u67e5\u3001\u91cd\u6784\u89c4\u5212\u3001\u591a\u6587\u4ef6\u4fee\u6539</li> <li>\u6570\u636e\u5206\u6790\uff1a\u6570\u636e\u91c7\u96c6\u3001\u6e05\u6d17\u3001\u5206\u6790\u3001\u53ef\u89c6\u5316</li> <li>\u5de5\u4f5c\u6d41\u81ea\u52a8\u5316\uff1a\u591a\u6b65\u9aa4\u4efb\u52a1\u7f16\u6392\u3001\u6761\u4ef6\u5206\u652f\u5904\u7406</li> </ul>"},{"location":"#_4","title":"\u6280\u672f\u6808","text":"\u7ec4\u4ef6 \u6280\u672f \u7528\u9014 \u7f16\u6392\u5f15\u64ce LangGraph \u591a Agent \u5de5\u4f5c\u6d41\u3001\u72b6\u6001\u7ba1\u7406\u3001\u65ad\u70b9\u6062\u590d API \u670d\u52a1 FastAPI REST API\u3001SSE \u6d41\u5f0f\u63a8\u9001 \u6570\u636e\u5b58\u50a8 SQLAlchemy + aiosqlite \u5bf9\u8bdd\u5386\u53f2\u3001Artifact \u6301\u4e45\u5316 LLM \u63a5\u53e3 LiteLLM \u7edf\u4e00\u63a5\u53e3\u652f\u6301 100+ \u6a21\u578b\u63d0\u4f9b\u5546 \u5185\u5bb9\u91c7\u96c6 crawl4ai \u7f51\u9875\u5185\u5bb9\u6293\u53d6\u4e0e\u89e3\u6790"},{"location":"#_5","title":"\u5feb\u901f\u5f00\u59cb","text":"<pre><code># \u5b89\u88c5\u4f9d\u8d56\npip install -r requirements.txt\npip install -e .\n\n# \u521d\u59cb\u5316 crawl4ai\uff08\u9996\u6b21\u4f7f\u7528\u524d\u5fc5\u987b\uff09\ncrawl4ai-setup\n\n# \u542f\u52a8 API \u670d\u52a1\npython run_server.py\n\n# CLI \u4ea4\u4e92\npython run_cli.py chat\n</code></pre>"},{"location":"#_6","title":"\u6587\u6863\u5bfc\u822a","text":"<ul> <li>Request Lifecycle - \u7406\u89e3\u4e00\u4e2a\u8bf7\u6c42\u7684\u5b8c\u6574\u751f\u547d\u5468\u671f</li> <li>Architecture - \u6df1\u5165\u4e86\u89e3\u5404\u6a21\u5757\u5b9e\u73b0</li> <li>Streaming - \u6d41\u5f0f\u4e8b\u4ef6\u7cfb\u7edf\u8be6\u89e3</li> <li>Extension Guide - \u5982\u4f55\u6269\u5c55 Agent \u548c Tool</li> <li>API Reference - \u524d\u7aef\u96c6\u6210\u63a5\u53e3\u6587\u6863</li> <li>FAQ - \u5e38\u89c1\u95ee\u9898\u4e0e\u6392\u67e5</li> </ul>"},{"location":"api/","title":"API Reference","text":"<p>ArtifactFlow API \u6587\u6863\uff0c\u4f9b\u524d\u7aef\u96c6\u6210\u4f7f\u7528\u3002</p>"},{"location":"api/#_1","title":"\u57fa\u7840\u4fe1\u606f","text":"\u9879\u76ee \u503c Base URL <code>http://localhost:8000/api/v1</code> \u534f\u8bae HTTP/HTTPS \u6570\u636e\u683c\u5f0f JSON \u6d41\u5f0f\u63a8\u9001 Server-Sent Events (SSE)"},{"location":"api/#_2","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"api/#_3","title":"\u5178\u578b\u8c03\u7528\u6d41\u7a0b","text":"<pre><code>sequenceDiagram\n    participant Frontend\n    participant API\n\n    Frontend-&gt;&gt;API: POST /chat {content}\n    API-&gt;&gt;Frontend: {conversation_id, thread_id, message_id}\n\n    Frontend-&gt;&gt;API: GET /stream/{thread_id}\n    loop SSE Events\n        API-&gt;&gt;Frontend: event: llm_chunk\n        API-&gt;&gt;Frontend: event: tool_complete\n    end\n    API-&gt;&gt;Frontend: event: complete\n\n    Frontend-&gt;&gt;API: GET /chat/{conversation_id}\n    API-&gt;&gt;Frontend: \u5bf9\u8bdd\u8be6\u60c5</code></pre>"},{"location":"api/#chat-api","title":"Chat API","text":""},{"location":"api/#_4","title":"\u53d1\u9001\u6d88\u606f","text":"<pre><code>POST /chat\n</code></pre> <p>\u8bf7\u6c42\u4f53\uff1a</p> <pre><code>{\n  \"content\": \"\u5e2e\u6211\u5206\u6790\u4e00\u4e0b Python \u5f02\u6b65\u7f16\u7a0b\",\n  \"conversation_id\": null,\n  \"parent_message_id\": null\n}\n</code></pre> \u5b57\u6bb5 \u7c7b\u578b \u5fc5\u9700 \u8bf4\u660e <code>content</code> string \u662f \u7528\u6237\u6d88\u606f\u5185\u5bb9 <code>conversation_id</code> string \u5426 \u5bf9\u8bdd ID\uff0cnull \u5219\u521b\u5efa\u65b0\u5bf9\u8bdd <code>parent_message_id</code> string \u5426 \u7236\u6d88\u606f ID\uff0c\u7528\u4e8e\u5206\u652f\u5bf9\u8bdd <p>\u54cd\u5e94\uff1a</p> <pre><code>{\n  \"conversation_id\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"thread_id\": \"660e8400-e29b-41d4-a716-446655440001\",\n  \"message_id\": \"770e8400-e29b-41d4-a716-446655440002\"\n}\n</code></pre> <p>\u8bf4\u660e\uff1a \u8bf7\u6c42\u7acb\u5373\u8fd4\u56de\uff0c\u5b9e\u9645\u6267\u884c\u5728\u540e\u53f0\u8fdb\u884c\u3002\u4f7f\u7528 <code>thread_id</code> \u8fde\u63a5 SSE \u83b7\u53d6\u6267\u884c\u4e8b\u4ef6\u3002</p>"},{"location":"api/#_5","title":"\u83b7\u53d6\u5bf9\u8bdd\u5217\u8868","text":"<pre><code>GET /chat\n</code></pre> <p>\u67e5\u8be2\u53c2\u6570\uff1a</p> \u53c2\u6570 \u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e <code>limit</code> int 20 \u8fd4\u56de\u6570\u91cf <code>offset</code> int 0 \u504f\u79fb\u91cf <p>\u54cd\u5e94\uff1a</p> <pre><code>{\n  \"conversations\": [\n    {\n      \"id\": \"550e8400-e29b-41d4-a716-446655440000\",\n      \"title\": \"Python \u5f02\u6b65\u7f16\u7a0b\u5206\u6790\",\n      \"created_at\": \"2024-01-15T10:30:00Z\",\n      \"updated_at\": \"2024-01-15T11:00:00Z\",\n      \"message_count\": 5\n    }\n  ],\n  \"total\": 42\n}\n</code></pre>"},{"location":"api/#_6","title":"\u83b7\u53d6\u5bf9\u8bdd\u8be6\u60c5","text":"<pre><code>GET /chat/{conversation_id}\n</code></pre> <p>\u54cd\u5e94\uff1a</p> <pre><code>{\n  \"id\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"title\": \"Python \u5f02\u6b65\u7f16\u7a0b\u5206\u6790\",\n  \"created_at\": \"2024-01-15T10:30:00Z\",\n  \"messages\": [\n    {\n      \"id\": \"msg_001\",\n      \"parent_id\": null,\n      \"content\": \"\u5e2e\u6211\u5206\u6790\u4e00\u4e0b Python \u5f02\u6b65\u7f16\u7a0b\",\n      \"response\": \"\u597d\u7684\uff0c\u8ba9\u6211\u6765\u5206\u6790...\",\n      \"timestamp\": \"2024-01-15T10:30:00Z\"\n    },\n    {\n      \"id\": \"msg_002\",\n      \"parent_id\": \"msg_001\",\n      \"content\": \"\u80fd\u8be6\u7ec6\u8bf4\u8bf4 asyncio \u5417\uff1f\",\n      \"response\": \"asyncio \u662f...\",\n      \"timestamp\": \"2024-01-15T10:35:00Z\"\n    }\n  ]\n}\n</code></pre>"},{"location":"api/#_7","title":"\u5220\u9664\u5bf9\u8bdd","text":"<pre><code>DELETE /chat/{conversation_id}\n</code></pre> <p>\u54cd\u5e94\uff1a</p> <pre><code>{\n  \"success\": true\n}\n</code></pre>"},{"location":"api/#_8","title":"\u6062\u590d\u6743\u9650\u4e2d\u65ad","text":"<p>\u5f53\u5de5\u5177\u9700\u8981\u7528\u6237\u786e\u8ba4\u65f6\u4f7f\u7528\uff1a</p> <pre><code>POST /chat/{conversation_id}/resume\n</code></pre> <p>\u8bf7\u6c42\u4f53\uff1a</p> <pre><code>{\n  \"thread_id\": \"660e8400-e29b-41d4-a716-446655440001\",\n  \"approved\": true\n}\n</code></pre> \u5b57\u6bb5 \u7c7b\u578b \u5fc5\u9700 \u8bf4\u660e <code>thread_id</code> string \u662f \u4e2d\u65ad\u65f6\u7684 thread_id <code>approved</code> boolean \u662f \u662f\u5426\u6279\u51c6\u6267\u884c <p>\u54cd\u5e94\uff1a</p> <pre><code>{\n  \"thread_id\": \"660e8400-e29b-41d4-a716-446655440001\",\n  \"resumed\": true\n}\n</code></pre>"},{"location":"api/#stream-api","title":"Stream API","text":""},{"location":"api/#sse","title":"SSE \u4e8b\u4ef6\u6d41","text":"<pre><code>GET /stream/{thread_id}\n</code></pre> <p>\u8fde\u63a5\u65b9\u5f0f\uff1a</p> <pre><code>const eventSource = new EventSource('/api/v1/stream/{thread_id}');\n</code></pre> <p>\u4e8b\u4ef6\u7c7b\u578b\uff1a</p>"},{"location":"api/#metadata","title":"metadata","text":"<p>\u6267\u884c\u5f00\u59cb\uff0c\u8fd4\u56de\u5143\u6570\u636e\u3002</p> <pre><code>{\n  \"conversation_id\": \"xxx\",\n  \"thread_id\": \"yyy\",\n  \"message_id\": \"zzz\"\n}\n</code></pre>"},{"location":"api/#agent_start","title":"agent_start","text":"<p>Agent \u5f00\u59cb\u6267\u884c\u3002</p> <pre><code>{\n  \"agent\": \"lead\"\n}\n</code></pre>"},{"location":"api/#llm_chunk","title":"llm_chunk","text":"<p>LLM \u6d41\u5f0f\u8f93\u51fa\u7247\u6bb5\u3002</p> <pre><code>{\n  \"content\": \"\u8ba9\u6211\",\n  \"agent\": \"lead\"\n}\n</code></pre>"},{"location":"api/#llm_complete","title":"llm_complete","text":"<p>LLM \u8f93\u51fa\u5b8c\u6210\u3002</p> <pre><code>{\n  \"content\": \"\u5b8c\u6574\u7684\u8f93\u51fa\u5185\u5bb9...\",\n  \"agent\": \"lead\",\n  \"token_usage\": {\n    \"input_tokens\": 1000,\n    \"output_tokens\": 500\n  }\n}\n</code></pre>"},{"location":"api/#agent_complete","title":"agent_complete","text":"<p>Agent \u6267\u884c\u5b8c\u6210\u3002</p> <pre><code>{\n  \"agent\": \"lead\",\n  \"response\": \"Agent \u7684\u5b8c\u6574\u54cd\u5e94\"\n}\n</code></pre>"},{"location":"api/#tool_start","title":"tool_start","text":"<p>\u5de5\u5177\u5f00\u59cb\u6267\u884c\u3002</p> <pre><code>{\n  \"tool\": \"web_search\",\n  \"params\": {\n    \"query\": \"Python async programming\"\n  }\n}\n</code></pre>"},{"location":"api/#tool_complete","title":"tool_complete","text":"<p>\u5de5\u5177\u6267\u884c\u5b8c\u6210\u3002</p> <pre><code>{\n  \"tool\": \"web_search\",\n  \"success\": true,\n  \"data\": {\n    \"results\": [...]\n  }\n}\n</code></pre>"},{"location":"api/#permission_request","title":"permission_request","text":"<p>\u8bf7\u6c42\u7528\u6237\u786e\u8ba4\u6743\u9650\u3002</p> <pre><code>{\n  \"tool\": \"read_file\",\n  \"params\": {\n    \"path\": \"/etc/config\"\n  },\n  \"permission\": \"confirm\",\n  \"message\": \"\u5de5\u5177 read_file \u9700\u8981\u60a8\u7684\u786e\u8ba4\u624d\u80fd\u6267\u884c\"\n}\n</code></pre> <p>\u5904\u7406\u65b9\u5f0f\uff1a \u663e\u793a\u786e\u8ba4\u5bf9\u8bdd\u6846\uff0c\u7528\u6237\u786e\u8ba4\u540e\u8c03\u7528 <code>POST /chat/{id}/resume</code>\u3002</p>"},{"location":"api/#permission_result","title":"permission_result","text":"<p>\u6743\u9650\u786e\u8ba4\u7ed3\u679c\u3002</p> <pre><code>{\n  \"tool\": \"read_file\",\n  \"approved\": true\n}\n</code></pre>"},{"location":"api/#complete","title":"complete","text":"<p>\u6267\u884c\u5b8c\u6210\u3002</p> <pre><code>{\n  \"response\": \"\u6700\u7ec8\u54cd\u5e94\u5185\u5bb9\",\n  \"metrics\": {\n    \"total_duration_ms\": 5000,\n    \"agent_executions\": [...],\n    \"tool_calls\": [...]\n  }\n}\n</code></pre>"},{"location":"api/#error","title":"error","text":"<p>\u6267\u884c\u9519\u8bef\u3002</p> <pre><code>{\n  \"error\": \"\u9519\u8bef\u4fe1\u606f\",\n  \"traceback\": \"...\"\n}\n</code></pre>"},{"location":"api/#artifact-api","title":"Artifact API","text":""},{"location":"api/#artifact","title":"\u83b7\u53d6 Artifact \u5217\u8868","text":"<pre><code>GET /artifacts\n</code></pre> <p>\u67e5\u8be2\u53c2\u6570\uff1a</p> \u53c2\u6570 \u7c7b\u578b \u8bf4\u660e <code>session_id</code> string \u6309\u4f1a\u8bdd\u7b5b\u9009 <code>type</code> string \u6309\u7c7b\u578b\u7b5b\u9009 <p>\u54cd\u5e94\uff1a</p> <pre><code>{\n  \"artifacts\": [\n    {\n      \"id\": \"artifact_001\",\n      \"session_id\": \"session_001\",\n      \"type\": \"task_plan\",\n      \"title\": \"\u4efb\u52a1\u8ba1\u5212\",\n      \"version\": 3,\n      \"created_at\": \"2024-01-15T10:30:00Z\",\n      \"updated_at\": \"2024-01-15T11:00:00Z\"\n    }\n  ]\n}\n</code></pre>"},{"location":"api/#artifact_1","title":"\u83b7\u53d6 Artifact \u8be6\u60c5","text":"<pre><code>GET /artifacts/{artifact_id}\n</code></pre> <p>\u54cd\u5e94\uff1a</p> <pre><code>{\n  \"id\": \"artifact_001\",\n  \"session_id\": \"session_001\",\n  \"type\": \"task_plan\",\n  \"title\": \"\u4efb\u52a1\u8ba1\u5212\",\n  \"content\": \"# \u4efb\u52a1\u8ba1\u5212\\n\\n## \u6b65\u9aa4 1\\n...\",\n  \"version\": 3,\n  \"created_at\": \"2024-01-15T10:30:00Z\",\n  \"updated_at\": \"2024-01-15T11:00:00Z\"\n}\n</code></pre>"},{"location":"api/#_9","title":"\u83b7\u53d6\u7248\u672c\u5386\u53f2","text":"<pre><code>GET /artifacts/{artifact_id}/versions\n</code></pre> <p>\u54cd\u5e94\uff1a</p> <pre><code>{\n  \"versions\": [\n    {\n      \"version\": 3,\n      \"content\": \"\u6700\u65b0\u7248\u672c\u5185\u5bb9...\",\n      \"created_at\": \"2024-01-15T11:00:00Z\"\n    },\n    {\n      \"version\": 2,\n      \"content\": \"\u7b2c\u4e8c\u7248\u5185\u5bb9...\",\n      \"created_at\": \"2024-01-15T10:45:00Z\"\n    },\n    {\n      \"version\": 1,\n      \"content\": \"\u521d\u59cb\u7248\u672c...\",\n      \"created_at\": \"2024-01-15T10:30:00Z\"\n    }\n  ]\n}\n</code></pre>"},{"location":"api/#_10","title":"\u9519\u8bef\u5904\u7406","text":""},{"location":"api/#_11","title":"\u9519\u8bef\u54cd\u5e94\u683c\u5f0f","text":"<pre><code>{\n  \"error\": {\n    \"code\": \"CONVERSATION_NOT_FOUND\",\n    \"message\": \"\u5bf9\u8bdd\u4e0d\u5b58\u5728\",\n    \"details\": {\n      \"conversation_id\": \"xxx\"\n    }\n  }\n}\n</code></pre>"},{"location":"api/#_12","title":"\u9519\u8bef\u7801","text":"\u9519\u8bef\u7801 HTTP \u72b6\u6001 \u8bf4\u660e <code>VALIDATION_ERROR</code> 400 \u8bf7\u6c42\u53c2\u6570\u9a8c\u8bc1\u5931\u8d25 <code>CONVERSATION_NOT_FOUND</code> 404 \u5bf9\u8bdd\u4e0d\u5b58\u5728 <code>ARTIFACT_NOT_FOUND</code> 404 Artifact \u4e0d\u5b58\u5728 <code>THREAD_NOT_FOUND</code> 404 \u7ebf\u7a0b\u4e0d\u5b58\u5728\uff08SSE\uff09 <code>VERSION_CONFLICT</code> 409 Artifact \u7248\u672c\u51b2\u7a81 <code>INTERNAL_ERROR</code> 500 \u670d\u52a1\u5668\u5185\u90e8\u9519\u8bef"},{"location":"api/#_13","title":"\u524d\u7aef\u96c6\u6210\u793a\u4f8b","text":""},{"location":"api/#_14","title":"\u5b8c\u6574\u7684\u804a\u5929\u7ec4\u4ef6","text":"<pre><code>interface Message {\n  id: string;\n  role: 'user' | 'assistant';\n  content: string;\n  timestamp: Date;\n}\n\ninterface ChatState {\n  conversationId: string | null;\n  messages: Message[];\n  isStreaming: boolean;\n  currentContent: string;\n  pendingPermission: PermissionRequest | null;\n}\n\nasync function sendMessage(\n  state: ChatState,\n  content: string\n): Promise&lt;void&gt; {\n  // 1. \u53d1\u9001\u6d88\u606f\n  const res = await fetch('/api/v1/chat', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({\n      content,\n      conversation_id: state.conversationId\n    })\n  });\n\n  const { conversation_id, thread_id, message_id } = await res.json();\n  state.conversationId = conversation_id;\n  state.isStreaming = true;\n  state.currentContent = '';\n\n  // \u6dfb\u52a0\u7528\u6237\u6d88\u606f\n  state.messages.push({\n    id: message_id,\n    role: 'user',\n    content,\n    timestamp: new Date()\n  });\n\n  // 2. \u8fde\u63a5 SSE\n  const eventSource = new EventSource(`/api/v1/stream/${thread_id}`);\n\n  eventSource.addEventListener('llm_chunk', (e) =&gt; {\n    const { content } = JSON.parse(e.data);\n    state.currentContent += content;\n  });\n\n  eventSource.addEventListener('permission_request', (e) =&gt; {\n    const data = JSON.parse(e.data);\n    state.pendingPermission = {\n      threadId: thread_id,\n      ...data\n    };\n  });\n\n  eventSource.addEventListener('complete', (e) =&gt; {\n    const { response } = JSON.parse(e.data);\n    state.messages.push({\n      id: `${message_id}_response`,\n      role: 'assistant',\n      content: response,\n      timestamp: new Date()\n    });\n    state.currentContent = '';\n    state.isStreaming = false;\n    eventSource.close();\n  });\n\n  eventSource.addEventListener('error', (e) =&gt; {\n    console.error('SSE Error:', e);\n    state.isStreaming = false;\n    eventSource.close();\n  });\n}\n\nasync function handlePermission(\n  state: ChatState,\n  approved: boolean\n): Promise&lt;void&gt; {\n  if (!state.pendingPermission) return;\n\n  await fetch(`/api/v1/chat/${state.conversationId}/resume`, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({\n      thread_id: state.pendingPermission.threadId,\n      approved\n    })\n  });\n\n  state.pendingPermission = null;\n}\n</code></pre>"},{"location":"api/#artifact_2","title":"Artifact \u67e5\u770b\u7ec4\u4ef6","text":"<pre><code>async function loadArtifacts(sessionId: string): Promise&lt;Artifact[]&gt; {\n  const res = await fetch(`/api/v1/artifacts?session_id=${sessionId}`);\n  const { artifacts } = await res.json();\n  return artifacts;\n}\n\nasync function loadArtifactWithHistory(\n  artifactId: string\n): Promise&lt;{ artifact: Artifact; versions: Version[] }&gt; {\n  const [artifactRes, versionsRes] = await Promise.all([\n    fetch(`/api/v1/artifacts/${artifactId}`),\n    fetch(`/api/v1/artifacts/${artifactId}/versions`)\n  ]);\n\n  return {\n    artifact: await artifactRes.json(),\n    versions: (await versionsRes.json()).versions\n  };\n}\n</code></pre>"},{"location":"extension-guide/","title":"\u6269\u5c55\u6307\u5357","text":"<p>\u672c\u6307\u5357\u4ecb\u7ecd\u5982\u4f55\u6269\u5c55 ArtifactFlow\uff0c\u5305\u62ec\u6dfb\u52a0\u65b0\u7684 Agent \u548c Tool\u3002</p>"},{"location":"extension-guide/#\u6dfb\u52a0\u65b0-agent","title":"\u6dfb\u52a0\u65b0 Agent","text":""},{"location":"extension-guide/#_2","title":"\u6b65\u9aa4\u6982\u89c8","text":"<ol> <li>\u521b\u5efa Agent \u7c7b\uff08\u7ee7\u627f <code>BaseAgent</code>\uff09</li> <li>\u5b9a\u4e49\u914d\u7f6e\u548c\u6240\u9700\u5de5\u5177</li> <li>\u5b9e\u73b0\u7cfb\u7edf\u63d0\u793a\u8bcd</li> <li>\u6ce8\u518c\u5230 Graph</li> </ol>"},{"location":"extension-guide/#codeagent","title":"\u5b8c\u6574\u793a\u4f8b\uff1aCodeAgent","text":"<p>\u521b\u5efa\u4e00\u4e2a\u7528\u4e8e\u4ee3\u7801\u5206\u6790\u7684 Agent\uff1a</p> <pre><code># src/agents/code_agent.py\n\nfrom agents.base import BaseAgent, AgentConfig\n\nclass CodeAgent(BaseAgent):\n    \"\"\"\u4ee3\u7801\u5206\u6790 Agent\"\"\"\n\n    def __init__(self):\n        super().__init__(AgentConfig(\n            name=\"code\",\n            description=\"\u4ee3\u7801\u5206\u6790\u4e0e\u5ba1\u67e5\",\n            capabilities=[\n                \"\u4ee3\u7801\u7ed3\u6784\u5206\u6790\",\n                \"\u4ee3\u7801\u8d28\u91cf\u8bc4\u4f30\",\n                \"\u91cd\u6784\u5efa\u8bae\"\n            ],\n            required_tools=[\n                \"read_file\",      # \u9700\u8981\u5148\u521b\u5efa\u8fd9\u4e9b\u5de5\u5177\n                \"analyze_code\"\n            ],\n            model=\"qwen3-next-80b-instruct\",\n            temperature=0.3,  # \u4ee3\u7801\u5206\u6790\u9700\u8981\u7cbe\u786e\n            max_tool_rounds=5\n        ))\n\n    def build_system_prompt(self, toolkit) -&gt; str:\n        tool_docs = toolkit.generate_tool_docs()\n\n        return f\"\"\"# \u89d2\u8272\n\u4f60\u662f\u4e00\u4e2a\u4e13\u4e1a\u7684\u4ee3\u7801\u5206\u6790 Agent\uff0c\u8d1f\u8d23\u5206\u6790\u4ee3\u7801\u7ed3\u6784\u3001\u8bc4\u4f30\u4ee3\u7801\u8d28\u91cf\u3001\u63d0\u4f9b\u91cd\u6784\u5efa\u8bae\u3002\n\n# \u80fd\u529b\n- \u7406\u89e3\u591a\u79cd\u7f16\u7a0b\u8bed\u8a00\u7684\u4ee3\u7801\u7ed3\u6784\n- \u8bc6\u522b\u4ee3\u7801\u4e2d\u7684\u95ee\u9898\u548c\u6539\u8fdb\u70b9\n- \u63d0\u4f9b\u5177\u4f53\u7684\u91cd\u6784\u5efa\u8bae\n\n# \u53ef\u7528\u5de5\u5177\n{tool_docs}\n\n# \u5de5\u4f5c\u6d41\u7a0b\n1. \u63a5\u6536\u4ee3\u7801\u5206\u6790\u6307\u4ee4\n2. \u4f7f\u7528\u5de5\u5177\u8bfb\u53d6\u548c\u5206\u6790\u4ee3\u7801\n3. \u6574\u7406\u5206\u6790\u7ed3\u679c\n4. \u8fd4\u56de\u7ed3\u6784\u5316\u7684\u5206\u6790\u62a5\u544a\n\n# \u8f93\u51fa\u8981\u6c42\n- \u5206\u6790\u7ed3\u679c\u8981\u5177\u4f53\u3001\u53ef\u64cd\u4f5c\n- \u6307\u51fa\u95ee\u9898\u65f6\u7ed9\u51fa\u6539\u8fdb\u5efa\u8bae\n- \u4f7f\u7528\u4ee3\u7801\u793a\u4f8b\u8bf4\u660e\n\"\"\"\n\n    def format_final_response(self, content: str, state) -&gt; str:\n        \"\"\"\u683c\u5f0f\u5316\u6700\u7ec8\u54cd\u5e94\"\"\"\n        return f\"\"\"## \u4ee3\u7801\u5206\u6790\u62a5\u544a\n\n{content}\n\"\"\"\n</code></pre>"},{"location":"extension-guide/#graph","title":"\u6ce8\u518c\u5230 Graph","text":"<pre><code># src/core/graph.py\n\nfrom agents.code_agent import CodeAgent\n\ndef create_multi_agent_graph(tool_registry: ToolRegistry) -&gt; ExtendableGraph:\n    graph = ExtendableGraph()\n\n    # \u6ce8\u518c\u73b0\u6709 Agent\n    graph.register_agent(LeadAgent())\n    graph.register_agent(SearchAgent())\n    graph.register_agent(CrawlAgent())\n\n    # \u6ce8\u518c\u65b0 Agent\n    graph.register_agent(CodeAgent())  # \u6dfb\u52a0\u8fd9\u884c\n\n    # \u8bbe\u7f6e\u5de5\u5177\u6ce8\u518c\u4e2d\u5fc3\n    graph.set_tool_registry(tool_registry)\n\n    return graph\n</code></pre>"},{"location":"extension-guide/#lead-agent","title":"\u66f4\u65b0 Lead Agent \u63d0\u793a\u8bcd","text":"<p>\u8ba9 Lead Agent \u77e5\u9053\u53ef\u4ee5\u8c03\u7528\u65b0\u7684 Agent\uff1a</p> <pre><code># \u5728 Lead Agent \u7684\u7cfb\u7edf\u63d0\u793a\u8bcd\u4e2d\u6dfb\u52a0\n\"\"\"\n# \u53ef\u8c03\u7528\u7684 SubAgent\n\n- **search**: \u4fe1\u606f\u68c0\u7d22\uff0c\u7528\u4e8e\u641c\u7d22\u4e92\u8054\u7f51\n- **crawl**: \u5185\u5bb9\u91c7\u96c6\uff0c\u7528\u4e8e\u6293\u53d6\u7f51\u9875\u5185\u5bb9\n- **code**: \u4ee3\u7801\u5206\u6790\uff0c\u7528\u4e8e\u5206\u6790\u548c\u5ba1\u67e5\u4ee3\u7801  # \u65b0\u589e\n\"\"\"\n</code></pre>"},{"location":"extension-guide/#\u6dfb\u52a0\u65b0\u5de5\u5177","title":"\u6dfb\u52a0\u65b0\u5de5\u5177","text":""},{"location":"extension-guide/#_3","title":"\u6b65\u9aa4\u6982\u89c8","text":"<ol> <li>\u521b\u5efa\u5de5\u5177\u7c7b\uff08\u7ee7\u627f <code>BaseTool</code>\uff09</li> <li>\u5b9a\u4e49\u53c2\u6570\u548c\u6743\u9650</li> <li>\u5b9e\u73b0\u6267\u884c\u903b\u8f91</li> <li>\u6ce8\u518c\u5230 ToolRegistry</li> </ol>"},{"location":"extension-guide/#readfiletool","title":"\u5b8c\u6574\u793a\u4f8b\uff1aReadFileTool","text":"<pre><code># src/tools/implementations/file_ops.py\n\nfrom pathlib import Path\nfrom tools.base import BaseTool, ToolParameter, ToolResult, ToolPermission\n\nclass ReadFileTool(BaseTool):\n    \"\"\"\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\"\"\"\n\n    name = \"read_file\"\n    description = \"\u8bfb\u53d6\u6307\u5b9a\u8def\u5f84\u7684\u6587\u4ef6\u5185\u5bb9\"\n    permission = ToolPermission.CONFIRM  # \u9700\u8981\u7528\u6237\u786e\u8ba4\n\n    def get_parameters(self) -&gt; list[ToolParameter]:\n        return [\n            ToolParameter(\n                name=\"path\",\n                type=\"string\",\n                description=\"\u6587\u4ef6\u8def\u5f84\",\n                required=True\n            ),\n            ToolParameter(\n                name=\"encoding\",\n                type=\"string\",\n                description=\"\u6587\u4ef6\u7f16\u7801\",\n                required=False,\n                default=\"utf-8\"\n            ),\n            ToolParameter(\n                name=\"max_lines\",\n                type=\"integer\",\n                description=\"\u6700\u5927\u8bfb\u53d6\u884c\u6570\uff0c0 \u8868\u793a\u4e0d\u9650\u5236\",\n                required=False,\n                default=0\n            )\n        ]\n\n    async def execute(\n        self,\n        path: str,\n        encoding: str = \"utf-8\",\n        max_lines: int = 0\n    ) -&gt; ToolResult:\n        try:\n            file_path = Path(path)\n\n            # \u5b89\u5168\u68c0\u67e5\n            if not file_path.exists():\n                return ToolResult(\n                    success=False,\n                    error=f\"\u6587\u4ef6\u4e0d\u5b58\u5728: {path}\"\n                )\n\n            if not file_path.is_file():\n                return ToolResult(\n                    success=False,\n                    error=f\"\u8def\u5f84\u4e0d\u662f\u6587\u4ef6: {path}\"\n                )\n\n            # \u8bfb\u53d6\u6587\u4ef6\n            content = file_path.read_text(encoding=encoding)\n\n            # \u9650\u5236\u884c\u6570\n            if max_lines &gt; 0:\n                lines = content.split('\\n')\n                if len(lines) &gt; max_lines:\n                    content = '\\n'.join(lines[:max_lines])\n                    content += f\"\\n... (truncated, {len(lines) - max_lines} more lines)\"\n\n            return ToolResult(\n                success=True,\n                data={\n                    \"path\": str(file_path.absolute()),\n                    \"content\": content,\n                    \"size\": file_path.stat().st_size,\n                    \"lines\": content.count('\\n') + 1\n                },\n                metadata={\n                    \"encoding\": encoding,\n                    \"truncated\": max_lines &gt; 0 and len(content.split('\\n')) &gt;= max_lines\n                }\n            )\n\n        except UnicodeDecodeError:\n            return ToolResult(\n                success=False,\n                error=f\"\u65e0\u6cd5\u4ee5 {encoding} \u7f16\u7801\u8bfb\u53d6\u6587\u4ef6\"\n            )\n        except PermissionError:\n            return ToolResult(\n                success=False,\n                error=f\"\u6ca1\u6709\u8bfb\u53d6\u6743\u9650: {path}\"\n            )\n        except Exception as e:\n            return ToolResult(\n                success=False,\n                error=str(e)\n            )\n</code></pre>"},{"location":"extension-guide/#_4","title":"\u6ce8\u518c\u5de5\u5177","text":"<pre><code># src/tools/registry.py \u6216\u521d\u59cb\u5316\u4ee3\u7801\u4e2d\n\nfrom tools.implementations.file_ops import ReadFileTool\n\ndef create_tool_registry() -&gt; ToolRegistry:\n    registry = ToolRegistry()\n\n    # \u6ce8\u518c\u73b0\u6709\u5de5\u5177\n    registry.register_tool_to_library(WebSearchTool())\n    registry.register_tool_to_library(WebFetchTool())\n    # ...\n\n    # \u6ce8\u518c\u65b0\u5de5\u5177\n    registry.register_tool_to_library(ReadFileTool())\n\n    return registry\n</code></pre>"},{"location":"extension-guide/#agent","title":"\u4e3a Agent \u5206\u914d\u5de5\u5177","text":"<pre><code># \u5728 Agent \u914d\u7f6e\u4e2d\u6dfb\u52a0\u5de5\u5177\u540d\u79f0\nclass CodeAgent(BaseAgent):\n    def __init__(self):\n        super().__init__(AgentConfig(\n            # ...\n            required_tools=[\n                \"read_file\",      # \u65b0\u5de5\u5177\n                \"analyze_code\"\n            ]\n        ))\n</code></pre>"},{"location":"extension-guide/#_5","title":"\u6743\u9650\u7ea7\u522b\u9009\u62e9\u6307\u5357","text":"\u6743\u9650 \u9002\u7528\u573a\u666f \u793a\u4f8b <code>PUBLIC</code> \u53ea\u8bfb\u3001\u65e0\u526f\u4f5c\u7528\u7684\u64cd\u4f5c \u641c\u7d22\u3001\u67e5\u8be2 <code>NOTIFY</code> \u6709\u526f\u4f5c\u7528\u4f46\u4f4e\u98ce\u9669 \u4fdd\u5b58\u5230\u4e34\u65f6\u6587\u4ef6 <code>CONFIRM</code> \u8bbf\u95ee\u654f\u611f\u6570\u636e\u6216\u6709\u526f\u4f5c\u7528 \u8bfb\u53d6\u6587\u4ef6\u3001\u53d1\u9001\u8bf7\u6c42 <code>RESTRICTED</code> \u9ad8\u98ce\u9669\u64cd\u4f5c \u5220\u9664\u6587\u4ef6\u3001\u6267\u884c\u4ee3\u7801"},{"location":"extension-guide/#_6","title":"\u5de5\u5177\u53c2\u6570\u7c7b\u578b","text":"<p>\u652f\u6301\u7684\u53c2\u6570\u7c7b\u578b\uff1a</p> \u7c7b\u578b Python \u7c7b\u578b XML \u793a\u4f8b <code>string</code> <code>str</code> <code>&lt;param&gt;&lt;![CDATA[hello]]&gt;&lt;/param&gt;</code> <code>integer</code> <code>int</code> <code>&lt;param&gt;&lt;![CDATA[42]]&gt;&lt;/param&gt;</code> <code>number</code> <code>float</code> <code>&lt;param&gt;&lt;![CDATA[3.14]]&gt;&lt;/param&gt;</code> <code>boolean</code> <code>bool</code> <code>&lt;param&gt;&lt;![CDATA[true]]&gt;&lt;/param&gt;</code> <code>array</code> <code>list</code> <code>&lt;param&gt;&lt;![CDATA[[\"a\", \"b\"]]]&gt;&lt;/param&gt;</code> <code>object</code> <code>dict</code> <code>&lt;param&gt;&lt;![CDATA[{\"key\": \"value\"}]]&gt;&lt;/param&gt;</code>"},{"location":"extension-guide/#artifact","title":"\u6dfb\u52a0\u65b0 Artifact \u7c7b\u578b","text":"<p>Artifact \u7c7b\u578b\u901a\u8fc7 <code>type</code> \u5b57\u6bb5\u533a\u5206\uff0c\u53ef\u4ee5\u81ea\u7531\u6269\u5c55\uff1a</p> <pre><code># \u521b\u5efa\u81ea\u5b9a\u4e49\u7c7b\u578b\u7684 Artifact\nawait artifact_manager.create_artifact(\n    session_id=session_id,\n    artifact_type=\"code_review\",  # \u81ea\u5b9a\u4e49\u7c7b\u578b\n    title=\"Code Review Report\",\n    content=\"...\"\n)\n</code></pre>"},{"location":"extension-guide/#_7","title":"\u5efa\u8bae\u7684\u7c7b\u578b\u547d\u540d","text":"\u7c7b\u578b \u7528\u9014 <code>task_plan</code> \u4efb\u52a1\u8ba1\u5212\uff08\u7cfb\u7edf\u4fdd\u7559\uff09 <code>result</code> \u6267\u884c\u7ed3\u679c\uff08\u7cfb\u7edf\u4fdd\u7559\uff09 <code>code_review</code> \u4ee3\u7801\u5ba1\u67e5\u62a5\u544a <code>analysis</code> \u5206\u6790\u62a5\u544a <code>draft</code> \u8349\u7a3f\u6587\u6863 <code>data</code> \u6570\u636e\u96c6"},{"location":"extension-guide/#llm","title":"\u81ea\u5b9a\u4e49 LLM \u6a21\u578b","text":""},{"location":"extension-guide/#_8","title":"\u6dfb\u52a0\u65b0\u6a21\u578b\u914d\u7f6e","text":"<pre><code># src/models/llm.py\n\nMODEL_CONFIGS = {\n    # \u73b0\u6709\u914d\u7f6e...\n\n    # \u6dfb\u52a0\u65b0\u6a21\u578b\n    \"my-custom-model\": {\n        \"provider\": \"openai\",  # \u6216\u5176\u4ed6 LiteLLM \u652f\u6301\u7684 provider\n        \"model\": \"my-model-name\",\n        \"api_base\": \"https://my-api.example.com/v1\",\n        \"api_key_env\": \"MY_API_KEY\"\n    }\n}\n</code></pre>"},{"location":"extension-guide/#agent_1","title":"\u5728 Agent \u4e2d\u4f7f\u7528","text":"<pre><code>class MyAgent(BaseAgent):\n    def __init__(self):\n        super().__init__(AgentConfig(\n            # ...\n            model=\"my-custom-model\"\n        ))\n</code></pre>"},{"location":"extension-guide/#_9","title":"\u6d4b\u8bd5\u65b0\u7ec4\u4ef6","text":""},{"location":"extension-guide/#_10","title":"\u6d4b\u8bd5\u5de5\u5177","text":"<pre><code># tests/test_tools.py\n\nimport pytest\nfrom tools.implementations.file_ops import ReadFileTool\n\n@pytest.mark.asyncio\nasync def test_read_file_tool():\n    tool = ReadFileTool()\n\n    # \u6d4b\u8bd5\u6b63\u5e38\u8bfb\u53d6\n    result = await tool.execute(path=\"test.txt\")\n    assert result.success\n    assert \"content\" in result.data\n\n    # \u6d4b\u8bd5\u6587\u4ef6\u4e0d\u5b58\u5728\n    result = await tool.execute(path=\"nonexistent.txt\")\n    assert not result.success\n    assert \"\u4e0d\u5b58\u5728\" in result.error\n</code></pre>"},{"location":"extension-guide/#agent_2","title":"\u6d4b\u8bd5 Agent","text":"<pre><code># tests/test_agents.py\n\nimport pytest\nfrom agents.code_agent import CodeAgent\n\ndef test_code_agent_config():\n    agent = CodeAgent()\n    assert agent.name == \"code\"\n    assert \"read_file\" in agent.config.required_tools\n\ndef test_code_agent_system_prompt():\n    agent = CodeAgent()\n    # \u521b\u5efa mock toolkit\n    toolkit = MockToolkit([\"read_file\", \"analyze_code\"])\n    prompt = agent.build_system_prompt(toolkit)\n    assert \"\u4ee3\u7801\u5206\u6790\" in prompt\n</code></pre>"},{"location":"extension-guide/#_11","title":"\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"extension-guide/#agent_3","title":"Agent \u8bbe\u8ba1","text":"<ol> <li>\u5355\u4e00\u804c\u8d23\uff1a\u6bcf\u4e2a Agent \u4e13\u6ce8\u4e8e\u4e00\u7c7b\u4efb\u52a1</li> <li>\u660e\u786e\u8fb9\u754c\uff1a\u6e05\u6670\u5b9a\u4e49 Agent \u7684\u80fd\u529b\u8303\u56f4</li> <li>\u5408\u7406\u7684\u5de5\u5177\u96c6\uff1a\u53ea\u5206\u914d\u5fc5\u8981\u7684\u5de5\u5177</li> <li>\u8be6\u7ec6\u7684\u63d0\u793a\u8bcd\uff1a\u5305\u542b\u89d2\u8272\u3001\u80fd\u529b\u3001\u5de5\u4f5c\u6d41\u7a0b\u3001\u8f93\u51fa\u683c\u5f0f</li> </ol>"},{"location":"extension-guide/#tool","title":"Tool \u8bbe\u8ba1","text":"<ol> <li>\u539f\u5b50\u64cd\u4f5c\uff1a\u6bcf\u4e2a\u5de5\u5177\u505a\u4e00\u4ef6\u4e8b</li> <li>\u6e05\u6670\u7684\u53c2\u6570\uff1a\u53c2\u6570\u547d\u540d\u548c\u63cf\u8ff0\u8981\u660e\u786e</li> <li>\u5b8c\u5584\u7684\u9519\u8bef\u5904\u7406\uff1a\u8fd4\u56de\u6709\u610f\u4e49\u7684\u9519\u8bef\u4fe1\u606f</li> <li>\u5408\u9002\u7684\u6743\u9650\uff1a\u6839\u636e\u98ce\u9669\u9009\u62e9\u6743\u9650\u7ea7\u522b</li> </ol>"},{"location":"extension-guide/#_12","title":"\u6d4b\u8bd5","text":"<ol> <li>\u5355\u5143\u6d4b\u8bd5\uff1a\u6d4b\u8bd5\u5de5\u5177\u7684\u5404\u79cd\u8f93\u5165\u60c5\u51b5</li> <li>\u96c6\u6210\u6d4b\u8bd5\uff1a\u6d4b\u8bd5 Agent \u4e0e\u5de5\u5177\u7684\u534f\u4f5c</li> <li>\u7aef\u5230\u7aef\u6d4b\u8bd5\uff1a\u6d4b\u8bd5\u5b8c\u6574\u7684\u6267\u884c\u6d41\u7a0b</li> </ol>"},{"location":"faq/","title":"FAQ","text":"<p>\u5e38\u89c1\u95ee\u9898\u4e0e\u6392\u67e5\u6307\u5357\u3002</p>"},{"location":"faq/#_1","title":"\u73af\u5883\u4e0e\u5b89\u88c5","text":""},{"location":"faq/#python-311","title":"\u4e3a\u4ec0\u4e48\u9700\u8981 Python 3.11+\uff1f","text":"<p>LangGraph \u7684 <code>interrupt()</code> \u529f\u80fd\u4f9d\u8d56 Python 3.11 \u5f15\u5165\u7684\u5f02\u6b65\u7279\u6027\u3002\u4f4e\u7248\u672c Python \u4f1a\u5bfc\u81f4\uff1a</p> <ul> <li><code>interrupt()</code> \u65e0\u6cd5\u6b63\u786e\u6682\u505c\u6267\u884c</li> <li>\u6743\u9650\u786e\u8ba4\u6d41\u7a0b\u5931\u6548</li> <li>\u72b6\u6001\u6062\u590d\u5f02\u5e38</li> </ul> <p>\u68c0\u67e5\u7248\u672c\uff1a</p> <pre><code>python --version\n# \u9700\u8981 Python 3.11.0 \u6216\u66f4\u9ad8\n</code></pre>"},{"location":"faq/#crawl4ai-setup","title":"crawl4ai-setup \u5931\u8d25","text":"<p>\u5e38\u89c1\u9519\u8bef\uff1a</p> <pre><code>Error: Playwright browsers not installed\n</code></pre> <p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <pre><code># \u5b89\u88c5 playwright \u6d4f\u89c8\u5668\nplaywright install chromium\n\n# \u91cd\u65b0\u8fd0\u884c setup\ncrawl4ai-setup\n</code></pre> <p>\u5982\u679c\u4ecd\u7136\u5931\u8d25\uff0c\u5c1d\u8bd5\uff1a</p> <pre><code># \u5b8c\u6574\u5b89\u88c5\npip uninstall crawl4ai\npip install crawl4ai[all]\ncrawl4ai-setup\n</code></pre>"},{"location":"faq/#aiosqlite","title":"aiosqlite \u7248\u672c\u51b2\u7a81","text":"<p>\u9519\u8bef\u4fe1\u606f\uff1a</p> <pre><code>ERROR: pip's dependency resolver does not currently take into account all the packages...\n</code></pre> <p>\u539f\u56e0\uff1a LangGraph \u548c\u5176\u4ed6\u5305\u5bf9 aiosqlite \u7248\u672c\u8981\u6c42\u4e0d\u4e00\u81f4\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a</p> <pre><code># \u4f7f\u7528 requirements.txt \u4e2d\u9501\u5b9a\u7684\u7248\u672c\npip install -r requirements.txt --force-reinstall\n</code></pre>"},{"location":"faq/#_2","title":"\u8fd0\u884c\u95ee\u9898","text":""},{"location":"faq/#api","title":"API \u670d\u52a1\u542f\u52a8\u5931\u8d25","text":"<p>\u68c0\u67e5\u7aef\u53e3\u5360\u7528\uff1a</p> <pre><code>lsof -i :8000\n# \u5982\u679c\u6709\u8fdb\u7a0b\u5360\u7528\uff0ckill \u6216\u6362\u7aef\u53e3\npython run_server.py --port 8001\n</code></pre> <p>\u68c0\u67e5\u6570\u636e\u5e93\u76ee\u5f55\uff1a</p> <pre><code># \u786e\u4fdd data \u76ee\u5f55\u5b58\u5728\u4e14\u53ef\u5199\nmkdir -p data\nchmod 755 data\n</code></pre>"},{"location":"faq/#sse","title":"SSE \u8fde\u63a5\u7acb\u5373\u65ad\u5f00","text":"<p>\u53ef\u80fd\u539f\u56e0\uff1a</p> <ol> <li>thread_id \u4e0d\u5b58\u5728\uff1a\u68c0\u67e5 POST /chat \u8fd4\u56de\u7684 thread_id</li> <li>TTL \u8d85\u65f6\uff1aPOST \u540e\u8d85\u8fc7 30 \u79d2\u672a\u8fde\u63a5 SSE</li> <li>\u53cd\u5411\u4ee3\u7406\u7f13\u51b2\uff1aNginx \u7b49\u4ee3\u7406\u53ef\u80fd\u7f13\u51b2 SSE</li> </ol> <p>Nginx \u914d\u7f6e\uff1a</p> <pre><code>location /api/v1/stream/ {\n    proxy_pass http://backend;\n    proxy_buffering off;\n    proxy_cache off;\n    proxy_set_header Connection '';\n    proxy_http_version 1.1;\n    chunked_transfer_encoding off;\n}\n</code></pre>"},{"location":"faq/#agent","title":"Agent \u6267\u884c\u5361\u4f4f","text":"<p>\u542f\u7528\u8c03\u8bd5\u65e5\u5fd7\uff1a</p> <pre><code>from utils.logger import set_global_debug\nset_global_debug(True)\n</code></pre> <p>\u68c0\u67e5 LLM API\uff1a</p> <pre><code># \u6d4b\u8bd5 API \u8fde\u63a5\ncurl -X POST https://your-llm-api/v1/chat/completions \\\n  -H \"Authorization: Bearer $API_KEY\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"model\": \"your-model\", \"messages\": [{\"role\": \"user\", \"content\": \"test\"}]}'\n</code></pre> <p>\u68c0\u67e5\u73af\u5883\u53d8\u91cf\uff1a</p> <pre><code># \u786e\u4fdd API Key \u5df2\u8bbe\u7f6e\necho $OPENAI_API_KEY\necho $DASHSCOPE_API_KEY\n</code></pre>"},{"location":"faq/#_3","title":"\u6743\u9650\u4e2d\u65ad\u540e\u65e0\u6cd5\u6062\u590d","text":"<p>\u68c0\u67e5 Checkpointer \u72b6\u6001\uff1a</p> <pre><code># \u67e5\u770b LangGraph \u6570\u636e\u5e93\nsqlite3 data/langgraph.db \".tables\"\nsqlite3 data/langgraph.db \"SELECT thread_id FROM checkpoints LIMIT 5\"\n</code></pre> <p>\u786e\u4fdd thread_id \u4e00\u81f4\uff1a</p> <pre><code># \u6062\u590d\u65f6\u7684 thread_id \u5fc5\u987b\u4e0e\u4e2d\u65ad\u65f6\u76f8\u540c\nawait controller.resume(\n    conversation_id=conversation_id,\n    thread_id=original_thread_id,  # \u4f7f\u7528\u539f\u59cb thread_id\n    approved=True\n)\n</code></pre>"},{"location":"faq/#_4","title":"\u5de5\u5177\u95ee\u9898","text":""},{"location":"faq/#web_search","title":"web_search \u8fd4\u56de\u7a7a\u7ed3\u679c","text":"<p>\u68c0\u67e5\u641c\u7d22 API \u914d\u7f6e\uff1a</p> <pre><code># DuckDuckGo \u53ef\u80fd\u88ab\u9650\u6d41\uff0c\u68c0\u67e5\u65e5\u5fd7\ntail -f logs/app.log | grep \"web_search\"\n</code></pre> <p>\u5207\u6362\u641c\u7d22\u540e\u7aef\uff1a</p> <pre><code># \u5728\u5de5\u5177\u914d\u7f6e\u4e2d\u6307\u5b9a\nSEARCH_BACKEND = \"google\"  # \u6216 \"bing\"\n</code></pre>"},{"location":"faq/#web_fetch","title":"web_fetch \u8d85\u65f6","text":"<p>\u8c03\u6574\u8d85\u65f6\u65f6\u95f4\uff1a</p> <pre><code># \u5de5\u5177\u8c03\u7528\u65f6\u6307\u5b9a\nresult = await tool.execute(\n    url=\"https://example.com\",\n    timeout=60  # \u79d2\n)\n</code></pre> <p>\u68c0\u67e5\u76ee\u6807\u7f51\u7ad9\uff1a</p> <ul> <li>\u662f\u5426\u9700\u8981 JavaScript \u6e32\u67d3</li> <li>\u662f\u5426\u6709\u53cd\u722c\u866b\u673a\u5236</li> <li>\u662f\u5426\u9700\u8981\u4ee3\u7406</li> </ul>"},{"location":"faq/#artifact","title":"Artifact \u66f4\u65b0\u7248\u672c\u51b2\u7a81","text":"<p>\u9519\u8bef\u4fe1\u606f\uff1a</p> <pre><code>OptimisticLockError: Version mismatch: expected 2, got 3\n</code></pre> <p>\u539f\u56e0\uff1a \u591a\u4e2a Agent \u540c\u65f6\u66f4\u65b0\u540c\u4e00\u4e2a Artifact\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a Agent \u5e94\u8be5\uff1a</p> <ol> <li>\u91cd\u65b0\u8bfb\u53d6\u6700\u65b0\u7248\u672c</li> <li>\u5408\u5e76\u53d8\u66f4</li> <li>\u91cd\u8bd5\u66f4\u65b0</li> </ol> <p>\u8fd9\u662f\u6b63\u5e38\u7684\u5e76\u53d1\u63a7\u5236\u673a\u5236\uff0c\u4e0d\u662f bug\u3002</p>"},{"location":"faq/#_5","title":"\u6027\u80fd\u95ee\u9898","text":""},{"location":"faq/#llm","title":"LLM \u54cd\u5e94\u6162","text":"<p>\u4f7f\u7528\u6d41\u5f0f\u8f93\u51fa\uff1a \u786e\u4fdd\u524d\u7aef\u4f7f\u7528 SSE \u63a5\u6536 <code>llm_chunk</code> \u4e8b\u4ef6\uff0c\u800c\u4e0d\u662f\u7b49\u5f85\u5b8c\u6574\u54cd\u5e94\u3002</p> <p>\u8c03\u6574\u6a21\u578b\uff1a</p> <pre><code># \u5bf9\u4e8e\u7b80\u5355\u4efb\u52a1\uff0c\u4f7f\u7528\u66f4\u5feb\u7684\u6a21\u578b\nAgentConfig(\n    model=\"qwen-turbo\",  # \u6bd4 thinking \u6a21\u578b\u5feb\n    # ...\n)\n</code></pre>"},{"location":"faq/#_6","title":"\u5185\u5b58\u4f7f\u7528\u8fc7\u9ad8","text":"<p>\u68c0\u67e5 StreamManager \u961f\u5217\uff1a</p> <pre><code># \u6dfb\u52a0\u76d1\u63a7\nstream_manager.get_stats()\n# {\"active_streams\": 5, \"total_events\": 1000}\n</code></pre> <p>\u8c03\u6574 TTL\uff1a</p> <pre><code># \u51cf\u5c11\u672a\u6d88\u8d39\u961f\u5217\u7684\u5b58\u6d3b\u65f6\u95f4\nstream_manager = StreamManager(ttl_seconds=15)\n</code></pre>"},{"location":"faq/#_7","title":"\u6570\u636e\u5e93\u53d8\u6162","text":"<p>\u6e05\u7406\u5386\u53f2\u6570\u636e\uff1a</p> <pre><code>-- \u5220\u9664 30 \u5929\u524d\u7684\u5bf9\u8bdd\nDELETE FROM messages WHERE timestamp &lt; datetime('now', '-30 days');\nDELETE FROM conversations WHERE updated_at &lt; datetime('now', '-30 days');\n\n-- \u6e05\u7406 Artifact \u5386\u53f2\u7248\u672c\uff08\u4fdd\u7559\u6700\u8fd1 10 \u4e2a\uff09\nDELETE FROM artifact_versions\nWHERE id NOT IN (\n    SELECT id FROM artifact_versions\n    GROUP BY artifact_id\n    ORDER BY version DESC\n    LIMIT 10\n);\n\n-- \u91cd\u5efa\u7d22\u5f15\nVACUUM;\n</code></pre>"},{"location":"faq/#_8","title":"\u5f00\u53d1\u95ee\u9898","text":""},{"location":"faq/#agent_1","title":"\u5982\u4f55\u67e5\u770b\u5b8c\u6574\u7684 Agent \u63d0\u793a\u8bcd\uff1f","text":"<pre><code>from agents.lead_agent import LeadAgent\nfrom tools.registry import ToolRegistry\n\nagent = LeadAgent()\nregistry = ToolRegistry()\n# ... \u6ce8\u518c\u5de5\u5177\n\ntoolkit = registry.get_agent_toolkit(\"lead\")\nprompt = agent.build_system_prompt(toolkit)\nprint(prompt)\n</code></pre>"},{"location":"faq/#_9","title":"\u5982\u4f55\u8c03\u8bd5\u5de5\u5177\u6267\u884c\uff1f","text":"<pre><code># \u76f4\u63a5\u6d4b\u8bd5\u5de5\u5177\nfrom tools.implementations.web_search import WebSearchTool\n\ntool = WebSearchTool()\nresult = await tool.execute(query=\"test query\")\nprint(result)\n</code></pre>"},{"location":"faq/#graph","title":"\u5982\u4f55\u67e5\u770b Graph \u72b6\u6001\uff1f","text":"<pre><code># \u83b7\u53d6\u5f53\u524d\u72b6\u6001\u5feb\u7167\nfrom langgraph.checkpoint.sqlite.aio import AsyncSqliteSaver\n\ncheckpointer = AsyncSqliteSaver.from_conn_string(\"data/langgraph.db\")\nstate = await checkpointer.aget({\"configurable\": {\"thread_id\": \"your-thread-id\"}})\nprint(state)\n</code></pre>"},{"location":"faq/#_10","title":"\u83b7\u53d6\u5e2e\u52a9","text":"<p>\u5982\u679c\u4ee5\u4e0a\u90fd\u65e0\u6cd5\u89e3\u51b3\u95ee\u9898\uff1a</p> <ol> <li>\u68c0\u67e5\u65e5\u5fd7\uff1a<code>tail -f logs/app.log</code></li> <li>\u542f\u7528\u8c03\u8bd5\u6a21\u5f0f\uff1a<code>set_global_debug(True)</code></li> <li>\u63d0\u4ea4 Issue\uff1a\u9644\u4e0a\u9519\u8bef\u65e5\u5fd7\u548c\u590d\u73b0\u6b65\u9aa4</li> </ol>"},{"location":"request-lifecycle/","title":"Request Lifecycle","text":"<p>\u672c\u6587\u6863\u8be6\u7ec6\u63cf\u8ff0\u4e00\u4e2a\u8bf7\u6c42\u4ece\u8fdb\u5165 API \u5230\u8fd4\u56de\u7ed3\u679c\u7684\u5b8c\u6574\u751f\u547d\u5468\u671f\u3002</p>"},{"location":"request-lifecycle/#_1","title":"\u6574\u4f53\u6d41\u7a0b","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant FastAPI\n    participant Controller\n    participant Graph\n    participant Agent\n    participant Tool\n    participant DB\n\n    Client-&gt;&gt;FastAPI: POST /api/v1/chat\n    FastAPI-&gt;&gt;Controller: stream_execute()\n    Controller-&gt;&gt;DB: \u521b\u5efa/\u83b7\u53d6 Conversation\n    Controller-&gt;&gt;Graph: astream(initial_state)\n\n    loop Agent Execution\n        Graph-&gt;&gt;Agent: \u6267\u884c\u8282\u70b9\n        Agent-&gt;&gt;Agent: LLM \u8c03\u7528\n        Agent--&gt;&gt;Client: SSE: llm_chunk\n        Agent-&gt;&gt;Graph: AgentResponse\n\n        opt Tool Call\n            Graph-&gt;&gt;Tool: \u6267\u884c\u5de5\u5177\n            Tool--&gt;&gt;Client: SSE: tool_complete\n            Tool-&gt;&gt;Graph: ToolResult\n        end\n    end\n\n    Graph-&gt;&gt;Controller: \u6700\u7ec8\u72b6\u6001\n    Controller-&gt;&gt;DB: \u4fdd\u5b58\u54cd\u5e94\n    Controller--&gt;&gt;Client: SSE: complete</code></pre>"},{"location":"request-lifecycle/#phase-1","title":"Phase 1: \u8bf7\u6c42\u63a5\u6536\u4e0e\u521d\u59cb\u5316","text":""},{"location":"request-lifecycle/#api","title":"API \u5c42\u5904\u7406","text":"<pre><code># POST /api/v1/chat\n{\n    \"content\": \"\u5e2e\u6211\u5206\u6790\u4e00\u4e0b Python \u5f02\u6b65\u7f16\u7a0b\u7684\u6700\u4f73\u5b9e\u8df5\",\n    \"conversation_id\": null,  # null \u8868\u793a\u65b0\u5bf9\u8bdd\n    \"parent_message_id\": null\n}\n</code></pre> <p>\u4f9d\u8d56\u6ce8\u5165\u94fe\uff08<code>src/api/dependencies.py</code>\uff09\uff1a</p> <pre><code>HTTP Request\n    \u2502\n    \u251c\u2500\u25ba get_db_session()        \u2192 AsyncSession\uff08\u8bf7\u6c42\u7ea7\u522b\uff09\n    \u2502       \u2502\n    \u2502       \u251c\u2500\u25ba get_artifact_manager()\n    \u2502       \u251c\u2500\u25ba get_conversation_manager()\n    \u2502       \u2514\u2500\u25ba get_controller()\n    \u2502\n    \u251c\u2500\u25ba get_checkpointer()      \u2192 AsyncSqliteSaver\uff08\u5168\u5c40\u5355\u4f8b\uff09\n    \u2514\u2500\u25ba get_stream_manager()    \u2192 StreamManager\uff08\u5168\u5c40\u5355\u4f8b\uff09\n</code></pre>"},{"location":"request-lifecycle/#conversation","title":"Conversation \u521b\u5efa","text":"<p>\u5982\u679c <code>conversation_id</code> \u4e3a\u7a7a\uff0c\u7cfb\u7edf\u4f1a\uff1a</p> <ol> <li>\u751f\u6210\u65b0\u7684 <code>conversation_id</code>\uff08UUID\uff09</li> <li>\u5728\u6570\u636e\u5e93\u521b\u5efa <code>Conversation</code> \u8bb0\u5f55</li> <li>\u81ea\u52a8\u5173\u8054 <code>ArtifactSession</code></li> </ol> <pre><code># src/core/controller.py\nasync def _ensure_conversation(self, conversation_id: str | None) -&gt; str:\n    if not conversation_id:\n        conversation_id = str(uuid.uuid4())\n        await self.conversation_manager.start_conversation_async(conversation_id)\n    return conversation_id\n</code></pre>"},{"location":"request-lifecycle/#phase-2","title":"Phase 2: \u72b6\u6001\u51c6\u5907","text":""},{"location":"request-lifecycle/#_2","title":"\u5bf9\u8bdd\u5386\u53f2\u683c\u5f0f\u5316","text":"<p><code>ConversationManager</code> \u4ece\u6d88\u606f\u6811\u4e2d\u63d0\u53d6\u5f53\u524d\u5206\u652f\u7684\u5386\u53f2\uff1a</p> <pre><code># \u6811\u72b6\u7ed3\u6784\u793a\u4f8b\n#       msg_1 (root)\n#      /      \\\n#   msg_2    msg_3\n#     |\n#   msg_4 (current)\n\n# \u683c\u5f0f\u5316\u7ed3\u679c\uff08\u4ece root \u5230 current \u7684\u8def\u5f84\uff09\nconversation_history = \"\"\"\n[User]: \u7b2c\u4e00\u6761\u6d88\u606f\n[Assistant]: \u7b2c\u4e00\u6761\u56de\u590d\n[User]: \u7b2c\u4e8c\u6761\u6d88\u606f\n[Assistant]: \u7b2c\u4e8c\u6761\u56de\u590d\n\"\"\"\n</code></pre>"},{"location":"request-lifecycle/#_3","title":"\u521d\u59cb\u72b6\u6001\u6784\u5efa","text":"<pre><code># src/core/state.py\ninitial_state = {\n    \"current_task\": \"\u5e2e\u6211\u5206\u6790\u4e00\u4e0b Python \u5f02\u6b65\u7f16\u7a0b\u7684\u6700\u4f73\u5b9e\u8df5\",\n    \"session_id\": \"artifact-session-uuid\",\n    \"thread_id\": \"langgraph-thread-uuid\",\n    \"conversation_history\": \"...\",  # \u683c\u5f0f\u5316\u7684\u5386\u53f2\n    \"phase\": ExecutionPhase.LEAD_EXECUTING,\n    \"current_agent\": \"lead\",\n    \"agent_memories\": {},\n    \"execution_metrics\": ExecutionMetrics(),\n    # ...\n}\n</code></pre>"},{"location":"request-lifecycle/#phase-3-graph","title":"Phase 3: Graph \u6267\u884c","text":""},{"location":"request-lifecycle/#_4","title":"\u6267\u884c\u6a21\u5f0f","text":"<p>ArtifactFlow \u4f7f\u7528 LangGraph \u7684 <code>stream_mode=\"custom\"</code> \u5b9e\u73b0\u6d41\u5f0f\u8f93\u51fa\uff1a</p> <pre><code># src/core/controller.py\nasync for event in self.graph.astream(\n    initial_state,\n    config={\"configurable\": {\"thread_id\": thread_id}},\n    stream_mode=\"custom\"\n):\n    yield event  # StreamEvent\n</code></pre>"},{"location":"request-lifecycle/#agent","title":"Agent \u8282\u70b9\u6267\u884c","text":"<p>\u6bcf\u4e2a Agent \u8282\u70b9\u6267\u884c\u5355\u8f6e LLM \u8c03\u7528\uff1a</p> <pre><code>flowchart TD\n    A[\u51c6\u5907 Messages] --&gt; B[LLM \u8c03\u7528]\n    B --&gt; C{\u89e3\u6790\u54cd\u5e94}\n    C --&gt;|tool_call| D[\u8bbe\u7f6e TOOL_EXECUTING]\n    C --&gt;|call_subagent| E[\u8bbe\u7f6e SUBAGENT_EXECUTING]\n    C --&gt;|\u5b8c\u6210| F[\u8bbe\u7f6e COMPLETED]\n    D --&gt; G[\u66f4\u65b0\u72b6\u6001]\n    E --&gt; G\n    F --&gt; G</code></pre> <p>\u6d88\u606f\u6784\u5efa\uff08<code>src/core/context_manager.py</code>\uff09\uff1a</p> <pre><code>messages = [\n    {\"role\": \"system\", \"content\": system_prompt},\n    {\"role\": \"user\", \"content\": f\"\"\"\n## \u5bf9\u8bdd\u5386\u53f2\n{conversation_history}\n\n## \u5f53\u524d\u4efb\u52a1\n{current_task}\n\n## Agent \u8bb0\u5fc6\n{agent_memory}\n\"\"\"}\n]\n\n# \u5982\u679c\u6709\u5de5\u5177\u4ea4\u4e92\u5386\u53f2\uff0c\u8ffd\u52a0\u5230 messages\nif tool_interactions:\n    messages.extend(tool_interactions)\n</code></pre>"},{"location":"request-lifecycle/#_5","title":"\u72b6\u6001\u8def\u7531","text":"<p>\u8def\u7531\u57fa\u4e8e <code>ExecutionPhase</code> \u51b3\u5b9a\u4e0b\u4e00\u4e2a\u8282\u70b9\uff1a</p> <pre><code># src/core/graph.py\ndef _route_after_agent(state: AgentState) -&gt; str:\n    phase = state[\"phase\"]\n\n    if phase == ExecutionPhase.TOOL_EXECUTING:\n        return \"tool_execution\"\n    elif phase == ExecutionPhase.SUBAGENT_EXECUTING:\n        return state[\"subagent_pending\"][\"target\"]\n    elif phase == ExecutionPhase.COMPLETED:\n        return END\n    else:\n        return state[\"current_agent\"]\n</code></pre>"},{"location":"request-lifecycle/#_6","title":"\u5de5\u5177\u6267\u884c\u8282\u70b9","text":"<p>\u7edf\u4e00\u5904\u7406\u6240\u6709\u5de5\u5177\u8c03\u7528\uff0c\u5305\u62ec\u6743\u9650\u68c0\u67e5\uff1a</p> <pre><code>flowchart TD\n    A[\u83b7\u53d6 pending_tool_call] --&gt; B[\u67e5\u627e\u5de5\u5177]\n    B --&gt; C{\u68c0\u67e5\u6743\u9650}\n    C --&gt;|PUBLIC/NOTIFY| D[\u76f4\u63a5\u6267\u884c]\n    C --&gt;|CONFIRM/RESTRICTED| E[interrupt \u8bf7\u6c42\u786e\u8ba4]\n    E --&gt; F{\u7528\u6237\u54cd\u5e94}\n    F --&gt;|approved| D\n    F --&gt;|denied| G[\u8fd4\u56de\u62d2\u7edd\u7ed3\u679c]\n    D --&gt; H[\u8bb0\u5f55 metrics]\n    H --&gt; I[\u8fd4\u56de\u539f Agent]</code></pre>"},{"location":"request-lifecycle/#phase-4-sse","title":"Phase 4: \u4e8b\u4ef6\u6d41\u4e0e SSE","text":""},{"location":"request-lifecycle/#_7","title":"\u4e8b\u4ef6\u7c7b\u578b","text":"<pre><code># src/core/events.py\nclass StreamEventType(Enum):\n    # Controller \u5c42\n    METADATA = \"metadata\"\n    COMPLETE = \"complete\"\n    ERROR = \"error\"\n\n    # Agent \u5c42\n    AGENT_START = \"agent_start\"\n    LLM_CHUNK = \"llm_chunk\"\n    LLM_COMPLETE = \"llm_complete\"\n    AGENT_COMPLETE = \"agent_complete\"\n\n    # Graph \u5c42\n    TOOL_START = \"tool_start\"\n    TOOL_COMPLETE = \"tool_complete\"\n    PERMISSION_REQUEST = \"permission_request\"\n    PERMISSION_RESULT = \"permission_result\"\n</code></pre>"},{"location":"request-lifecycle/#_8","title":"\u4e8b\u4ef6\u7f13\u51b2","text":"<p>\u7531\u4e8e POST \u8bf7\u6c42\u7acb\u5373\u8fd4\u56de\uff0cSSE \u8fde\u63a5\u7a0d\u540e\u5efa\u7acb\uff0c\u9700\u8981\u7f13\u51b2\u4e2d\u95f4\u4e8b\u4ef6\uff1a</p> <pre><code>POST /chat \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\n    \u2502\n    \u2502  \u521b\u5efa StreamContext\n    \u2502  \u542f\u52a8 TTL \u8ba1\u65f6\u5668 (30s)\n    \u2502        \u2502\n    \u2502        \u25bc\n    \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502  \u2502 Event Queue \u2502 \u25c4\u2500\u2500 Graph \u6267\u884c\u4ea7\u751f\u4e8b\u4ef6\n    \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n    \u2502        \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\n             \u2502\nGET /stream \u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\n             \u2502\n             \u2514\u2500\u2500\u25ba \u6d88\u8d39\u961f\u5217 \u2500\u2500\u25ba SSE \u63a8\u9001 \u2500\u2500\u25ba \u5ba2\u6237\u7aef\n</code></pre>"},{"location":"request-lifecycle/#sse","title":"SSE \u683c\u5f0f","text":"<pre><code>event: metadata\ndata: {\"conversation_id\": \"xxx\", \"thread_id\": \"yyy\", \"message_id\": \"zzz\"}\n\nevent: agent_start\ndata: {\"agent\": \"lead\"}\n\nevent: llm_chunk\ndata: {\"content\": \"\u8ba9\u6211\", \"agent\": \"lead\"}\n\nevent: llm_chunk\ndata: {\"content\": \"\u6765\u5206\u6790\", \"agent\": \"lead\"}\n\nevent: tool_start\ndata: {\"tool\": \"web_search\", \"params\": {\"query\": \"Python async best practices\"}}\n\nevent: tool_complete\ndata: {\"tool\": \"web_search\", \"success\": true, \"data\": {...}}\n\nevent: complete\ndata: {\"response\": \"...\", \"metrics\": {...}}\n</code></pre>"},{"location":"request-lifecycle/#phase-5","title":"Phase 5: \u6743\u9650\u4e2d\u65ad\u4e0e\u6062\u590d","text":"<p>\u5f53\u5de5\u5177\u9700\u8981\u7528\u6237\u786e\u8ba4\u65f6\uff1a</p>"},{"location":"request-lifecycle/#_9","title":"\u4e2d\u65ad\u6d41\u7a0b","text":"<pre><code># src/core/graph.py - tool_execution_node\nif permission in [ToolPermission.CONFIRM, ToolPermission.RESTRICTED]:\n    # \u53d1\u9001\u6743\u9650\u8bf7\u6c42\u4e8b\u4ef6\n    writer(StreamEvent(\n        type=StreamEventType.PERMISSION_REQUEST,\n        data={\"tool\": tool_name, \"params\": params, \"permission\": permission}\n    ))\n\n    # \u6682\u505c\u6267\u884c\uff0c\u7b49\u5f85\u7528\u6237\u786e\u8ba4\n    result = interrupt({\n        \"tool\": tool_name,\n        \"params\": params,\n        \"requires_permission\": permission.value\n    })\n</code></pre>"},{"location":"request-lifecycle/#_10","title":"\u6062\u590d\u6d41\u7a0b","text":"<pre><code># POST /api/v1/chat/{conversation_id}/resume\n{\n    \"thread_id\": \"xxx\",\n    \"approved\": true\n}\n\n# Controller \u6062\u590d\u6267\u884c\nawait graph.ainvoke(\n    Command(resume=approved),\n    config={\"configurable\": {\"thread_id\": thread_id}}\n)\n</code></pre>"},{"location":"request-lifecycle/#phase-6","title":"Phase 6: \u7ed3\u679c\u6301\u4e45\u5316","text":"<p>\u6267\u884c\u5b8c\u6210\u540e\uff0cController \u4fdd\u5b58\u7ed3\u679c\uff1a</p> <pre><code># \u66f4\u65b0\u6d88\u606f\u7684 graph_response\nawait self.conversation_manager.update_response_async(\n    conversation_id=conversation_id,\n    message_id=message_id,\n    response=final_response\n)\n\n# Artifact \u53d8\u66f4\u5df2\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u901a\u8fc7\u5de5\u5177\u4fdd\u5b58\n# \u7248\u672c\u5386\u53f2\u81ea\u52a8\u8bb0\u5f55\n</code></pre>"},{"location":"request-lifecycle/#_11","title":"\u6570\u636e\u6d41\u603b\u7ed3","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         Request Flow                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                  \u2502\n\u2502  HTTP Request                                                    \u2502\n\u2502       \u2502                                                          \u2502\n\u2502       \u25bc                                                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                   \u2502\n\u2502  \u2502 FastAPI \u2502\u2500\u2500\u2500\u25ba\u2502 Controller \u2502\u2500\u2500\u2500\u25ba\u2502  Graph  \u2502                   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                   \u2502\n\u2502       \u2502               \u2502                \u2502                         \u2502\n\u2502       \u2502               \u2502                \u25bc                         \u2502\n\u2502       \u2502               \u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                  \u2502\n\u2502       \u2502               \u2502         \u2502   Agents    \u2502                  \u2502\n\u2502       \u2502               \u2502         \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502                  \u2502\n\u2502       \u2502               \u2502         \u2502 \u2502  Lead   \u2502 \u2502                  \u2502\n\u2502       \u2502               \u2502         \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502                  \u2502\n\u2502       \u2502               \u2502         \u2502 \u2502 Search  \u2502 \u2502                  \u2502\n\u2502       \u2502               \u2502         \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502                  \u2502\n\u2502       \u2502               \u2502         \u2502 \u2502  Crawl  \u2502 \u2502                  \u2502\n\u2502       \u2502               \u2502         \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502                  \u2502\n\u2502       \u2502               \u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                  \u2502\n\u2502       \u2502               \u2502                \u2502                         \u2502\n\u2502       \u2502               \u2502                \u25bc                         \u2502\n\u2502       \u2502               \u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                  \u2502\n\u2502       \u2502               \u2502         \u2502    Tools    \u2502                  \u2502\n\u2502       \u2502               \u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                  \u2502\n\u2502       \u2502               \u2502                \u2502                         \u2502\n\u2502       \u2502               \u25bc                \u25bc                         \u2502\n\u2502       \u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                    \u2502\n\u2502       \u2502         \u2502        Database          \u2502                    \u2502\n\u2502       \u2502         \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502                    \u2502\n\u2502       \u2502         \u2502  \u2502 Convos \u2502 \u2502Artifacts\u2502  \u2502                    \u2502\n\u2502       \u2502         \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502                    \u2502\n\u2502       \u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                    \u2502\n\u2502       \u2502                                                          \u2502\n\u2502       \u25bc                                                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                                \u2502\n\u2502  \u2502 SSE Stream  \u2502 \u25c4\u2500\u2500 StreamManager \u25c4\u2500\u2500 Graph Events            \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                                \u2502\n\u2502       \u2502                                                          \u2502\n\u2502       \u25bc                                                          \u2502\n\u2502    Client                                                        \u2502\n\u2502                                                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"streaming/","title":"\u6d41\u5f0f\u4e8b\u4ef6\u7cfb\u7edf","text":"<p>ArtifactFlow \u4f7f\u7528 Server-Sent Events (SSE) \u5b9e\u73b0\u5b9e\u65f6\u4e8b\u4ef6\u63a8\u9001\uff0c\u8ba9\u524d\u7aef\u80fd\u591f\u5373\u65f6\u5c55\u793a\u6267\u884c\u8fdb\u5ea6\u3002</p>"},{"location":"streaming/#_2","title":"\u67b6\u6784\u6982\u89c8","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      Event Flow                              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502   Graph \u6267\u884c                                                 \u2502\n\u2502       \u2502                                                      \u2502\n\u2502       \u25bc                                                      \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                           \u2502\n\u2502   \u2502   Agent     \u2502\u2500\u2500\u25ba StreamEvent(LLM_CHUNK)                 \u2502\n\u2502   \u2502   Node      \u2502\u2500\u2500\u25ba StreamEvent(AGENT_COMPLETE)            \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                           \u2502\n\u2502       \u2502                                                      \u2502\n\u2502       \u25bc                                                      \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                           \u2502\n\u2502   \u2502    Tool     \u2502\u2500\u2500\u25ba StreamEvent(TOOL_START)                \u2502\n\u2502   \u2502    Node     \u2502\u2500\u2500\u25ba StreamEvent(TOOL_COMPLETE)             \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                           \u2502\n\u2502       \u2502                                                      \u2502\n\u2502       \u25bc                                                      \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502   \u2502 Controller  \u2502\u2500\u2500\u2500\u2500\u25ba\u2502StreamManager\u2502\u2500\u2500\u2500\u2500\u25ba\u2502  SSE \u7aef\u70b9   \u2502  \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                             \u2502                    \u2502          \u2502\n\u2502                             \u2502    Event Queue     \u2502          \u2502\n\u2502                             \u2502    (per thread)    \u2502          \u2502\n\u2502                             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502\n\u2502                                      \u2502                      \u2502\n\u2502                                      \u25bc                      \u2502\n\u2502                                   Client                    \u2502\n\u2502                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"streaming/#_3","title":"\u4e8b\u4ef6\u7c7b\u578b","text":""},{"location":"streaming/#_4","title":"\u5b8c\u6574\u4e8b\u4ef6\u5217\u8868","text":"\u4e8b\u4ef6\u7c7b\u578b \u6765\u6e90 \u8bf4\u660e \u6570\u636e\u7ed3\u6784 <code>metadata</code> Controller \u521d\u59cb\u5143\u6570\u636e <code>{conversation_id, thread_id, message_id}</code> <code>agent_start</code> Agent Agent \u5f00\u59cb\u6267\u884c <code>{agent}</code> <code>llm_chunk</code> Agent LLM \u6d41\u5f0f\u8f93\u51fa\u7247\u6bb5 <code>{content, agent}</code> <code>llm_complete</code> Agent LLM \u8f93\u51fa\u5b8c\u6210 <code>{content, agent, token_usage}</code> <code>agent_complete</code> Agent Agent \u6267\u884c\u5b8c\u6210 <code>{agent, response}</code> <code>tool_start</code> Graph \u5de5\u5177\u5f00\u59cb\u6267\u884c <code>{tool, params}</code> <code>tool_complete</code> Graph \u5de5\u5177\u6267\u884c\u5b8c\u6210 <code>{tool, success, data, error}</code> <code>permission_request</code> Graph \u8bf7\u6c42\u6743\u9650\u786e\u8ba4 <code>{tool, params, permission}</code> <code>permission_result</code> Graph \u6743\u9650\u786e\u8ba4\u7ed3\u679c <code>{tool, approved}</code> <code>complete</code> Controller \u6267\u884c\u5b8c\u6210 <code>{response, metrics}</code> <code>error</code> Controller \u6267\u884c\u9519\u8bef <code>{error, traceback}</code>"},{"location":"streaming/#_5","title":"\u4e8b\u4ef6\u65f6\u5e8f\u793a\u4f8b","text":"<pre><code>\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\n                         \u65f6\u95f4\u8f74\n\nmetadata \u2500\u2510\n          \u2502\nagent_start (lead) \u2500\u2510\n                    \u2502\nllm_chunk \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500 \"\u8ba9\u6211\"\nllm_chunk \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500 \"\u6765\u5206\u6790\"\nllm_chunk \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500 \"\u8fd9\u4e2a\u95ee\u9898\"\nllm_chunk \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500 \"&lt;tool_call&gt;...\"\nllm_complete \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                    \u2502\ntool_start \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500 web_search\ntool_complete \u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                    \u2502\nagent_start (lead) \u2500\u2510    (\u7ee7\u7eed\u5904\u7406\u5de5\u5177\u7ed3\u679c)\nllm_chunk \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500 ...\nagent_complete \u2500\u2500\u2500\u2500\u2500\u2518\n                    \u2502\ncomplete \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"streaming/#streammanager","title":"StreamManager","text":""},{"location":"streaming/#_6","title":"\u6838\u5fc3\u804c\u8d23","text":"<ol> <li>\u4e8b\u4ef6\u7f13\u51b2\uff1aPOST \u8bf7\u6c42\u8fd4\u56de\u540e\uff0cGraph \u7ee7\u7eed\u6267\u884c\u4ea7\u751f\u7684\u4e8b\u4ef6\u9700\u8981\u7f13\u51b2</li> <li>\u961f\u5217\u7ba1\u7406\uff1a\u6bcf\u4e2a <code>thread_id</code> \u5bf9\u5e94\u72ec\u7acb\u7684\u4e8b\u4ef6\u961f\u5217</li> <li>TTL \u6e05\u7406\uff1a\u9632\u6b62\u524d\u7aef\u672a\u8fde\u63a5\u5bfc\u81f4\u7684\u5185\u5b58\u6cc4\u6f0f</li> </ol>"},{"location":"streaming/#_7","title":"\u5b9e\u73b0","text":"<pre><code># src/api/services/stream_manager.py\n\n@dataclass\nclass StreamContext:\n    queue: asyncio.Queue[dict]\n    created_at: datetime\n    status: str  # pending | streaming | closed\n    ttl_task: asyncio.Task | None\n\nclass StreamManager:\n    def __init__(self, ttl_seconds: int = 30):\n        self._streams: dict[str, StreamContext] = {}\n        self._ttl_seconds = ttl_seconds\n\n    async def create_stream(self, thread_id: str) -&gt; StreamContext:\n        \"\"\"\u521b\u5efa\u65b0\u7684\u4e8b\u4ef6\u6d41\"\"\"\n        context = StreamContext(\n            queue=asyncio.Queue(),\n            created_at=datetime.utcnow(),\n            status=\"pending\",\n            ttl_task=None\n        )\n        self._streams[thread_id] = context\n\n        # \u542f\u52a8 TTL \u8ba1\u65f6\u5668\n        context.ttl_task = asyncio.create_task(\n            self._ttl_cleanup(thread_id)\n        )\n\n        return context\n\n    async def push_event(self, thread_id: str, event: dict):\n        \"\"\"\u63a8\u9001\u4e8b\u4ef6\u5230\u961f\u5217\"\"\"\n        if thread_id in self._streams:\n            await self._streams[thread_id].queue.put(event)\n\n    async def consume_stream(\n        self,\n        thread_id: str\n    ) -&gt; AsyncGenerator[dict, None]:\n        \"\"\"\u6d88\u8d39\u4e8b\u4ef6\u6d41\"\"\"\n        context = self._streams.get(thread_id)\n        if not context:\n            return\n\n        # \u53d6\u6d88 TTL \u8ba1\u65f6\u5668\n        if context.ttl_task:\n            context.ttl_task.cancel()\n\n        context.status = \"streaming\"\n\n        while True:\n            event = await context.queue.get()\n            yield event\n\n            # \u68c0\u67e5\u662f\u5426\u7ed3\u675f\n            if event.get(\"type\") in [\"complete\", \"error\"]:\n                break\n\n        context.status = \"closed\"\n        del self._streams[thread_id]\n\n    async def _ttl_cleanup(self, thread_id: str):\n        \"\"\"TTL \u8d85\u65f6\u6e05\u7406\"\"\"\n        await asyncio.sleep(self._ttl_seconds)\n\n        context = self._streams.get(thread_id)\n        if context and context.status == \"pending\":\n            # \u524d\u7aef\u672a\u8fde\u63a5\uff0c\u6e05\u7406\u961f\u5217\n            del self._streams[thread_id]\n</code></pre>"},{"location":"streaming/#_8","title":"\u65f6\u5e8f\u56fe","text":"<pre><code>sequenceDiagram\n    participant Client\n    participant POST /chat\n    participant StreamManager\n    participant Graph\n    participant GET /stream\n\n    Client-&gt;&gt;POST /chat: \u53d1\u9001\u6d88\u606f\n    POST /chat-&gt;&gt;StreamManager: create_stream(thread_id)\n    POST /chat-&gt;&gt;Client: \u8fd4\u56de {thread_id, ...}\n\n    Note over StreamManager: TTL \u8ba1\u65f6\u5668\u542f\u52a8 (30s)\n\n    POST /chat-&gt;&gt;Graph: \u540e\u53f0\u6267\u884c\n    Graph-&gt;&gt;StreamManager: push_event(agent_start)\n    Graph-&gt;&gt;StreamManager: push_event(llm_chunk)\n\n    Client-&gt;&gt;GET /stream: \u8fde\u63a5 SSE\n    GET /stream-&gt;&gt;StreamManager: consume_stream(thread_id)\n    Note over StreamManager: \u53d6\u6d88 TTL \u8ba1\u65f6\u5668\n\n    StreamManager-&gt;&gt;GET /stream: yield agent_start\n    StreamManager-&gt;&gt;GET /stream: yield llm_chunk\n\n    Graph-&gt;&gt;StreamManager: push_event(complete)\n    StreamManager-&gt;&gt;GET /stream: yield complete\n    GET /stream-&gt;&gt;Client: SSE: complete\n    Note over StreamManager: \u6e05\u7406\u961f\u5217</code></pre>"},{"location":"streaming/#sse","title":"SSE \u7aef\u70b9","text":""},{"location":"streaming/#_9","title":"\u5b9e\u73b0","text":"<pre><code># src/api/routers/stream.py\n\n@router.get(\"/{thread_id}\")\nasync def stream_events(\n    thread_id: str,\n    stream_manager: StreamManager = Depends(get_stream_manager)\n):\n    async def event_generator():\n        async for event in stream_manager.consume_stream(thread_id):\n            yield format_sse_event(event)\n\n    return StreamingResponse(\n        event_generator(),\n        media_type=\"text/event-stream\",\n        headers={\n            \"Cache-Control\": \"no-cache\",\n            \"Connection\": \"keep-alive\",\n            \"X-Accel-Buffering\": \"no\"  # \u7981\u7528 nginx \u7f13\u51b2\n        }\n    )\n\ndef format_sse_event(event: dict) -&gt; str:\n    \"\"\"\u683c\u5f0f\u5316\u4e3a SSE \u534f\u8bae\"\"\"\n    event_type = event.get(\"type\", \"message\")\n    data = json.dumps(event.get(\"data\", event))\n    return f\"event: {event_type}\\ndata: {data}\\n\\n\"\n</code></pre>"},{"location":"streaming/#sse_1","title":"SSE \u534f\u8bae\u683c\u5f0f","text":"<pre><code>event: metadata\ndata: {\"conversation_id\":\"abc\",\"thread_id\":\"xyz\",\"message_id\":\"123\"}\n\nevent: agent_start\ndata: {\"agent\":\"lead\"}\n\nevent: llm_chunk\ndata: {\"content\":\"\u8ba9\u6211\",\"agent\":\"lead\"}\n\nevent: llm_chunk\ndata: {\"content\":\"\u6765\u5206\u6790\",\"agent\":\"lead\"}\n\nevent: tool_start\ndata: {\"tool\":\"web_search\",\"params\":{\"query\":\"Python async\"}}\n\nevent: tool_complete\ndata: {\"tool\":\"web_search\",\"success\":true,\"data\":[...]}\n\nevent: complete\ndata: {\"response\":\"...\",\"metrics\":{...}}\n</code></pre>"},{"location":"streaming/#_10","title":"\u524d\u7aef\u96c6\u6210","text":""},{"location":"streaming/#javascript","title":"JavaScript \u793a\u4f8b","text":"<pre><code>async function chat(content) {\n  // 1. \u53d1\u9001\u6d88\u606f\n  const response = await fetch('/api/v1/chat', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ content })\n  });\n  const { thread_id, conversation_id, message_id } = await response.json();\n\n  // 2. \u8fde\u63a5 SSE\n  const eventSource = new EventSource(`/api/v1/stream/${thread_id}`);\n\n  // 3. \u5904\u7406\u5404\u7c7b\u4e8b\u4ef6\n  eventSource.addEventListener('metadata', (e) =&gt; {\n    console.log('Started:', JSON.parse(e.data));\n  });\n\n  eventSource.addEventListener('llm_chunk', (e) =&gt; {\n    const { content } = JSON.parse(e.data);\n    appendToOutput(content);  // \u6d41\u5f0f\u663e\u793a\n  });\n\n  eventSource.addEventListener('tool_start', (e) =&gt; {\n    const { tool, params } = JSON.parse(e.data);\n    showToolIndicator(tool, params);\n  });\n\n  eventSource.addEventListener('tool_complete', (e) =&gt; {\n    const { tool, success, data } = JSON.parse(e.data);\n    hideToolIndicator(tool);\n    if (!success) showError(data.error);\n  });\n\n  eventSource.addEventListener('permission_request', (e) =&gt; {\n    const { tool, params, permission } = JSON.parse(e.data);\n    showPermissionDialog(tool, params, permission);\n  });\n\n  eventSource.addEventListener('complete', (e) =&gt; {\n    const { response, metrics } = JSON.parse(e.data);\n    finalizeOutput(response);\n    showMetrics(metrics);\n    eventSource.close();\n  });\n\n  eventSource.addEventListener('error', (e) =&gt; {\n    if (e.data) {\n      const { error } = JSON.parse(e.data);\n      showError(error);\n    }\n    eventSource.close();\n  });\n}\n</code></pre>"},{"location":"streaming/#react-hook","title":"React Hook \u793a\u4f8b","text":"<pre><code>function useChat() {\n  const [messages, setMessages] = useState&lt;Message[]&gt;([]);\n  const [isStreaming, setIsStreaming] = useState(false);\n  const [currentContent, setCurrentContent] = useState('');\n\n  const sendMessage = async (content: string) =&gt; {\n    setIsStreaming(true);\n    setCurrentContent('');\n\n    // \u6dfb\u52a0\u7528\u6237\u6d88\u606f\n    setMessages(prev =&gt; [...prev, { role: 'user', content }]);\n\n    const res = await fetch('/api/v1/chat', {\n      method: 'POST',\n      body: JSON.stringify({ content })\n    });\n    const { thread_id } = await res.json();\n\n    const eventSource = new EventSource(`/api/v1/stream/${thread_id}`);\n\n    eventSource.addEventListener('llm_chunk', (e) =&gt; {\n      const { content } = JSON.parse(e.data);\n      setCurrentContent(prev =&gt; prev + content);\n    });\n\n    eventSource.addEventListener('complete', (e) =&gt; {\n      const { response } = JSON.parse(e.data);\n      setMessages(prev =&gt; [...prev, { role: 'assistant', content: response }]);\n      setCurrentContent('');\n      setIsStreaming(false);\n      eventSource.close();\n    });\n  };\n\n  return { messages, currentContent, isStreaming, sendMessage };\n}\n</code></pre>"},{"location":"streaming/#_11","title":"\u6743\u9650\u4e2d\u65ad\u5904\u7406","text":"<p>\u5f53\u9047\u5230\u9700\u8981\u786e\u8ba4\u7684\u5de5\u5177\u65f6\uff1a</p>"},{"location":"streaming/#_12","title":"\u540e\u7aef\u6d41\u7a0b","text":"<pre><code># tool_execution_node \u4e2d\nif tool.permission in [ToolPermission.CONFIRM, ToolPermission.RESTRICTED]:\n    # \u53d1\u9001\u6743\u9650\u8bf7\u6c42\u4e8b\u4ef6\n    writer(StreamEvent(\n        type=StreamEventType.PERMISSION_REQUEST,\n        data={\n            \"tool\": tool_name,\n            \"params\": params,\n            \"permission\": tool.permission.value,\n            \"message\": f\"\u5de5\u5177 {tool_name} \u9700\u8981\u60a8\u7684\u786e\u8ba4\u624d\u80fd\u6267\u884c\"\n        }\n    ))\n\n    # \u4e2d\u65ad\u6267\u884c\n    result = interrupt({\n        \"type\": \"permission_request\",\n        \"tool\": tool_name,\n        \"params\": params\n    })\n\n    # \u6062\u590d\u540e\u7ee7\u7eed...\n</code></pre>"},{"location":"streaming/#_13","title":"\u524d\u7aef\u5904\u7406","text":"<pre><code>eventSource.addEventListener('permission_request', async (e) =&gt; {\n  const { tool, params, message } = JSON.parse(e.data);\n\n  // \u663e\u793a\u786e\u8ba4\u5bf9\u8bdd\u6846\n  const approved = await showConfirmDialog({\n    title: `\u786e\u8ba4\u6267\u884c ${tool}`,\n    message,\n    details: params\n  });\n\n  // \u53d1\u9001\u6062\u590d\u8bf7\u6c42\n  await fetch(`/api/v1/chat/${conversationId}/resume`, {\n    method: 'POST',\n    body: JSON.stringify({\n      thread_id: threadId,\n      approved\n    })\n  });\n});\n</code></pre>"},{"location":"streaming/#_14","title":"\u914d\u7f6e\u9009\u9879","text":"<pre><code># src/api/config.py\n\nclass APIConfig:\n    # SSE \u914d\u7f6e\n    SSE_PING_INTERVAL: int = 15      # \u5fc3\u8df3\u95f4\u9694\uff08\u79d2\uff09\n    STREAM_TIMEOUT: int = 300        # \u6d41\u8d85\u65f6\uff08\u79d2\uff09\n    STREAM_TTL: int = 30             # \u961f\u5217 TTL\uff08\u79d2\uff09\n</code></pre>"},{"location":"streaming/#_15","title":"\u9519\u8bef\u5904\u7406","text":""},{"location":"streaming/#_16","title":"\u8fde\u63a5\u65ad\u5f00","text":"<p>\u524d\u7aef\u5e94\u5904\u7406\u8fde\u63a5\u65ad\u5f00\u60c5\u51b5\uff1a</p> <pre><code>eventSource.onerror = (e) =&gt; {\n  if (eventSource.readyState === EventSource.CLOSED) {\n    // \u8fde\u63a5\u5df2\u5173\u95ed\n    handleDisconnect();\n  } else {\n    // \u5c1d\u8bd5\u91cd\u8fde\uff08\u6d4f\u89c8\u5668\u81ea\u52a8\uff09\n    showReconnecting();\n  }\n};\n</code></pre>"},{"location":"streaming/#_17","title":"\u8d85\u65f6\u5904\u7406","text":"<pre><code>const timeout = setTimeout(() =&gt; {\n  eventSource.close();\n  showTimeout();\n}, 5 * 60 * 1000);  // 5 \u5206\u949f\u8d85\u65f6\n\neventSource.addEventListener('complete', () =&gt; {\n  clearTimeout(timeout);\n});\n</code></pre>"},{"location":"_archive/ArtifactFlow%E5%B7%B2%E7%9F%A5%E9%97%AE%E9%A2%98%E6%B8%85%E5%8D%95/","title":"Redis\u8fc1\u79fb\u6e05\u5355","text":""},{"location":"_archive/ArtifactFlow%E5%B7%B2%E7%9F%A5%E9%97%AE%E9%A2%98%E6%B8%85%E5%8D%95/#phase-1-worker","title":"Phase 1 - \u6838\u5fc3\uff08\u591aWorker\u90e8\u7f72\u524d\u5fc5\u987b\u5b8c\u6210\uff09","text":"<ul> <li>[ ] ConversationManager._cache \u2192 Redis Hash</li> <li>[ ] Streaming Events \u2192 Redis Pub/Sub</li> </ul>"},{"location":"_archive/ArtifactFlow%E5%B7%B2%E7%9F%A5%E9%97%AE%E9%A2%98%E6%B8%85%E5%8D%95/#phase-2-","title":"Phase 2 - \u6269\u5c55\uff08\u5e76\u53d1\u91cf\u4e0a\u5347\u540e\uff09","text":"<ul> <li>[ ] AsyncSqliteSaver \u2192 langgraph-checkpoint-redis</li> <li>[ ] Redis Key TTL \u81ea\u52a8\u6e05\u7406</li> </ul>"},{"location":"_archive/ArtifactFlow%E5%B7%B2%E7%9F%A5%E9%97%AE%E9%A2%98%E6%B8%85%E5%8D%95/#phase-3-","title":"Phase 3 - \u53ef\u9009\u4f18\u5316","text":"<ul> <li>[ ] ArtifactManager \u7f13\u5b58\u52a0 TTL\uff08\u6216\u76f4\u63a5\u79fb\u9664\uff09  \u2190 \u4f18\u5148\u7ea7\u4f4e</li> <li>[ ] API Rate Limit / Session / \u5206\u5e03\u5f0f\u9501</li> </ul>"},{"location":"_archive/ArtifactFlow%E5%B7%B2%E7%9F%A5%E9%97%AE%E9%A2%98%E6%B8%85%E5%8D%95/#_1","title":"\u6a21\u578b\u6a21\u5757\u5df2\u77e5\u95ee\u9898\u6e05\u5355","text":""},{"location":"_archive/ArtifactFlow%E5%B7%B2%E7%9F%A5%E9%97%AE%E9%A2%98%E6%B8%85%E5%8D%95/#_2","title":"\u6b21\u8981\u95ee\u9898","text":"<ul> <li>[x] \u5c06langchain\u6a21\u578b\u63a5\u5165\u6539\u4e3a\u4e13\u95e8\u7684\u4e07\u80fd\u63a5\u53e3\u53bb\u9002\u5e94\u4e0d\u540cprovider\uff0c\u4f8b\u5982LiteLLM\u3002\u5c24\u5176\u8981\u6ce8\u610freasoning\u548ctoken usage\u7b49\u5b57\u6bb5\u5982\u4f55\u83b7\u53d6</li> </ul>"},{"location":"_archive/ArtifactFlow%E5%B7%B2%E7%9F%A5%E9%97%AE%E9%A2%98%E6%B8%85%E5%8D%95/#_3","title":"\u5de5\u5177\u6a21\u5757\u5df2\u77e5\u95ee\u9898\u6e05\u5355","text":""},{"location":"_archive/ArtifactFlow%E5%B7%B2%E7%9F%A5%E9%97%AE%E9%A2%98%E6%B8%85%E5%8D%95/#_4","title":"\u6b21\u8981\u95ee\u9898","text":"<ul> <li>[x] \u4f7f\u7528\u6807\u51c6xml\u89e3\u6790\u65b9\u5f0f\uff08xml.etree.ElementTree\uff09\uff0cstring\u5b57\u6bb5\u7edf\u4e00\u7528cdata\u5b57\u6bb5\uff0c\u6240\u6709\u53c2\u6570Tag\u5e73\u94fa\uff0c\u5982\u6709\u4e0b\u7ea7\u6807\u7b7e\u5219\u4e3alist</li> </ul>"},{"location":"_archive/ArtifactFlow%E5%B7%B2%E7%9F%A5%E9%97%AE%E9%A2%98%E6%B8%85%E5%8D%95/#core","title":"Core\u6a21\u5757\u5df2\u77e5\u95ee\u9898\u6e05\u5355","text":""},{"location":"_archive/ArtifactFlow%E5%B7%B2%E7%9F%A5%E9%97%AE%E9%A2%98%E6%B8%85%E5%8D%95/#_5","title":"\u4e3b\u8981\u95ee\u9898","text":"<ul> <li>[x] <code>ExtendableGraph</code>\u548c<code>ExecutionController</code>\u6d41\u5f0f\u8f93\u51fa\u652f\u6301</li> <li>[x] \u786e\u8ba4user_confirmation_node\u5728<code>ExecutionController</code>\u5c42\u9762\u6b63\u786e\u5de5\u4f5c\uff0c\u73b0\u6709\u4ee3\u7801\u5904\u7406\u5f88\u5947\u602a\uff1a \u4e00\u4e2a\u662f<code>handle_permission_confirmation</code>\u6ca1\u6709\u5b9e\u73b0\u5bf9\u5b9e\u9645\u5de5\u5177\u7684\u8c03\u7528\uff0c\u540c\u65f6\u6ca1\u6709\u5730\u65b9\u8c03\u7528\u4e86\u8fd9\u4e2a<code>handle_permission_confirmation</code>\u3002\u53e6\u5916\u89c2\u5bdf<code>ExtendableGraph</code>\u7684\u8def\u7531\u4e5f\u4e0d\u5bf9\uff0c<code>_add_routing_rules</code>\u600e\u4e48\u628a<code>user_confirmation</code>\u8def\u7531\u5230END\u53bb\u4e86\u3002</li> <li>[x] <code>ContextManager</code>\u91cd\u590d\u8bbe\u8ba1\u4e86<code>prepare_context_for_agent</code>\u65b9\u6cd5\u3002\u5e94\u8be5\u4e0e<code>BaseAgent</code>\u4e2d\u5c31\u6709<code>_prepare_context_with_task_plan</code>\u505a\u51fa\u533a\u5206\u3002</li> <li>[x] sub agent\u7684response\u597d\u50cf\u4e0d\u4f1a\u88ablead agent\u89e3\u6790\u3002</li> <li>[x] <code>BaseAgent</code>\u7684messages\u7684\u62fc\u63a5\u65b9\u5f0f\u4fee\u6539\u4e3a\uff1a system prompt + instruction + history(\u5982\u679c\u6709) + tool result</li> <li>[x] \u7531\u4e8e\u6d88\u606f\u62fc\u63a5\u88ab\u79fb\u52a8\u5230\u4e86baseagent\u5916\uff0c\u5bfc\u81f4\u5916\u90e8\u8c03\u7528\u7684\u5de5\u5177\u7ed3\u679c\u6ca1\u6709\u88abgraph\u8bb0\u5f55\u4e0b\u6765</li> <li>[x] conversation history\u53ea\u80fdformat\u4e24\u6761\uff1f\u5df2\u5b9a\u4f4d\u95ee\u9898\uff1a_execute_new_message\u6ca1\u6709\u8f93\u5165parent_message_id\u5e94\u8be5\u81ea\u52a8\u8bbe\u7f6eparent_message_id\u5173\u8054</li> <li>[x] <code>interrupt()</code> \u51fd\u6570\u9700\u8981\u5728\u4e00\u4e2a\u6b63\u786e\u7684 runnable context \u4e2d\u8c03\u7528\uff0c\u4f46\u73b0\u5728\u770b\u8d77\u6765\u4e0a\u4e0b\u6587\u4e0d\u6b63\u786e\u3002\u5df2\u5b9a\u4f4d\u95ee\u9898\uff1a\u5f02\u6b65 interrupt \u529f\u80fd\u9700\u8981 Python 3.11+ \u624d\u80fd\u6b63\u5e38\u5de5\u4f5c,\u56e0\u4e3a Python 3.11 \u4e4b\u524d\u7684\u7248\u672c\u4e2d\u5f02\u6b65\u4efb\u52a1\u65e0\u6cd5\u6b63\u786e\u4f20\u64ad\u4e0a\u4e0b\u6587 Asynchronous Graph with interrupts in Python 3.10 seems to be broken \u00b7 langchain-ai/langgraph \u00b7 Discussion #3200</li> <li>[ ] <code>langgraph</code>\u4f7f\u7528\u7684<code>AsyncSqliteSaver</code>\u9700\u8981\u4e00\u4e2a\u5b9a\u65f6\u6e05\u7406\u811a\u672c\u907f\u514d\u7f13\u5b58\u7ebf\u7a0b\u65e0\u9650\u5806\u79ef/\u6216\u8005\u5207\u6362\u4e3a\u62e5\u6709ttl\u7ba1\u7406\u7684redis\u7ba1\u7406</li> <li>[x] Agent\u57fa\u7c7b\u53bb\u6389\u81ea\u5df1\u7684\u5de5\u5177\u8c03\u7528\u5904\u7406\uff0c\u5c06\u5de5\u5177\u8c03\u7528\u5904\u7406\u5168\u6743\u4ea4\u7ed9graph\u7684\u5de5\u5177\u8282\u70b9<code>user_confirmation_node</code>(\u8fd9\u4e2anode\u53ef\u4ee5\u6539\u4e2a\u540d\u5b57)\u3002\u4f8b\u5982tool permission\u4e3aNOTIFY/PUBLIC\u7684\u65f6\u5019\u4e5f\u4ea4\u7ed9confirmation node\u6267\u884c\uff0c\u4f46\u662f\u81ea\u52a8\u5141\u8bb8\u3002</li> <li>[x] \u53ef\u89c2\u6d4b\u6027\u8bbe\u8ba1\uff1a\u4ed4\u7ec6\u8bbe\u8ba1graph state\u5305\u542b\u53ef\u89c2\u6d4b\u6027\u5b57\u6bb5\uff0c\u8bb0\u5f55token\u4f7f\u7528\u4ee5\u53ca\u5de5\u5177\u8c03\u7528\u7b49\u4fe1\u606f</li> </ul>"},{"location":"_archive/ArtifactFlow%E5%B7%B2%E7%9F%A5%E9%97%AE%E9%A2%98%E6%B8%85%E5%8D%95/#_6","title":"\u6b21\u8981\u95ee\u9898","text":"<ul> <li>[x] \u5404\u7c7bid\u52a0\u4e0a\u7c7b\u578b\u540d</li> <li>[x] controller\u5c42\u7684\u5386\u53f2\u8bb0\u5f55\uff08User \u2194 Graph\uff09\u548cgraph\u5c42\u7684\u5386\u53f2\u8bb0\u5f55\u662f\u4e0d\u662f\u4e5f\u5e94\u8be5\u5206\u5f00\u7ba1\u7406\uff0c\u56e0\u4e3a\u5982\u679c\u90fd\u585e\u5230NodeMemory\u91cc\u9762\u7684\u8bdd\u611f\u89c9\u4e0d\u592a\u5408\u7406\uff0c\u5e94\u8be5\u662f\u4e00\u4e2acontext manager\u7ba1\u7406controller\u5c42\u4e00\u4e2a\u7ba1\u7406graph\u5c42\uff0c\u8fd9\u4e2acontext manager\u53ef\u4ee5\u548c\u524d\u9762\u8bf4\u7684\u662f\u4e00\u4e2a\uff0c\u7136\u540econtroller\u5c42\u7684\u5386\u53f2\u8bb0\u5f55\u4ee5context\u7684\u5f62\u5f0f\u7ed9graph\uff1f</li> <li>[x] \u5f15\u5165python-diff-match-patch\u5347\u7ea7\u4e00\u4e0b\u73b0\u6709\u7684artifact_ops.py\uff0c\u5e76\u589e\u52a0\u7248\u672c\u7ba1\u7406\u529f\u80fd\u4e0econtroller\u4e2d\u7684conversation\u7ba1\u7406\u5bf9\u5e94\u8d77\u6765\uff08\u7b97\u7403\u4e86\uff0c\u592a\u8026\u5408\u4e86\uff09\uff0c\u63d0\u4f9b\u66f4\u5b8c\u5584\u7684\u529f\u80fd\u7ed9\u672a\u6765\u5f00\u53d1\u7684\u524d\u7aef\uff0c\u4f8b\u5982\u80fd\u751f\u6210\u4f8b\u5982git diff\u7684\u5185\u5bb9\u5c55\u793a\u6a21\u578b\u5bf9\u6587\u6863\u7684\u4fee\u6539\u3002</li> <li>[x] lead agent\u63d0\u793a\u8bcd\u63d0\u793aresult artifact \u6e10\u8fdb\u5f0f\u5b8c\u6210</li> <li>[ ] graph level\u8f6e\u6b21\u592a\u591a\u63d0\u793alead agent</li> <li>[x] agent\u5f00\u542f\u5173\u95eddebug\u6a21\u5f0f\u5f88\u8d39\u52b2\uff1a\u5220\u9664agentconfig\u4e2ddebug\u53c2\u6570</li> <li>[x] Typer + Rich\u5b9e\u73b0\u7b80\u6613terminal\u524d\u7aef</li> <li>[ ] agent\u63d0\u793a\u8bcd\u7cbe\u7b80\u4e00\u4e0b</li> <li>[x] ToolPromptGenerator\u4e2dgenerate_tool_instruction\u6700\u540ereturn\u7684instruction\u52a0\u4e0a\u7684tag <li>[x] \u535a\u67e5\u641c\u7d22\u8bed\u6cd5\u786e\u8ba4</li> <li>[x] _execute_new_message\u5728\u8c03\u7528graph\u4e4b\u524d\uff0c\u83b7\u53d6\u4e86session_id\u4e4b\u540e\u6e05\u9664\u5df2\u6709\u7684task_plan</li> <li>[x] fetch tool \u652f\u6301pdf</li> <li>[ ] agent logging \u52a0\u4e0athread id</li> <li>[ ] \u533a\u5206conversation history\u548ctool interactions\u7684compression level</li>"},{"location":"_archive/ArtifactFlow%E5%B7%B2%E7%9F%A5%E9%97%AE%E9%A2%98%E6%B8%85%E5%8D%95/#agent","title":"Agent\u6a21\u5757\u5df2\u77e5\u95ee\u9898\u6e05\u5355","text":""},{"location":"_archive/ArtifactFlow%E5%B7%B2%E7%9F%A5%E9%97%AE%E9%A2%98%E6%B8%85%E5%8D%95/#_7","title":"\u91cd\u8981\u95ee\u9898","text":"<ul> <li>[x] revisit xml\u5de5\u5177\u89e3\u6790\u7cfb\u7edf\uff1a\u53c2\u6570\u7c7b\u578b\u8f6c\u6362\uff08str \u2192 int/List[str]\uff09\u5e94\u7531\u5de5\u5177\u81ea\u884c\u5904\u7406</li> <li>[x] artifact rewrite\u51c6\u786e\u5ea6\uff1aupdate_artifact\u7684old_str\u5339\u914d\u5931\u8d25\uff0c\u9700\u68c0\u67e5read\u540e\u7684\u683c\u5f0f\u6216\u6b63\u5219\u89e3\u6790\uff1aartifact\u63d0\u4f9b\u6a21\u7cca\u5339\u914d\u529f\u80fd</li> <li>[x] \u4f18\u5316agent\u63d0\u793a\u8bcd\u683c\u5f0f\uff1a\u7528xml\u6807\u7b7e\u89c4\u6574\uff08\u5982<code>&lt;task_plan&gt;</code>\uff09\uff0c\u5404agent\u7edf\u4e00</li> <li>[x] crawl agent\u65e0\u6cd5\u6b63\u786e\u8c03\u7528web_fetch\uff1alist\u683c\u5f0f\u89e3\u6790\u95ee\u9898\uff08JSON\u6570\u7ec4 vs \u591a\u884c\u683c\u5f0f\uff09</li> </ul>"},{"location":"_archive/ArtifactFlow%E5%B7%B2%E7%9F%A5%E9%97%AE%E9%A2%98%E6%B8%85%E5%8D%95/#_8","title":"\u6b21\u8981\u95ee\u9898","text":"<ul> <li>[x] agent\u63d0\u793a\u8bcd\u589e\u52a0\u7cfb\u7edf\u65f6\u95f4\u611f\u77e5</li> <li>[x] artifact\u901a\u7528\u5316\u63cf\u8ff0\uff1aresult artifact\u7684id\u5e94\u6839\u636e\u7528\u6237\u9700\u6c42\u52a8\u6001\u786e\u5b9a\uff0ctask_plan\u652f\u6301\u7b14\u8bb0\u529f\u80fd</li> <li>[x] agent node\u5bf9\u8bdd\u5386\u53f2\u5904\u7406\uff1a\u5de5\u5177\u5faa\u73af\u5386\u53f2\u8bb0\u5f55\u9700\u4fdd\u7559\u5e76\u53ef\u9009\u62e9\u6027\u4f20\u9012</li> <li>[x] task_plan artifact\u6ca1\u6709\u53ca\u65f6\u52a0\u8f7d\uff1a\u5de5\u5177\u5faa\u73af\u4e2d\u7684\u64cd\u4f5c\u672a\u53ca\u65f6\u66f4\u65b0\u5230\u7cfb\u7edf\u63d0\u793a\u8bcd</li> <li>[x] search agent\u7ed3\u679c\u8fd4\u56de\u65b9\u5f0f\uff1a\u8003\u8651\u76f4\u63a5\u8fd4\u56de\u5de5\u5177\u7ed3\u679c\u800c\u975e\u590d\u8ff0</li> <li>[x] \u7cbe\u7b80\u63d0\u793a\u8bcd\uff1a\u7b80\u5316\u5408\u5e76\u63d0\u793a\u8bcd\u5185\u5bb9</li> <li>[x] Agent\u6587\u4ef6\uff0c\u4f8b\u5982lead_agent.py\u662f\u4e0d\u662f\u5e94\u8be5\u4ee5@property\u6216\u8005\u522b\u7684\u5f62\u5f0f\u5b9a\u4e49\u5de5\u5177\u5217\u8868\uff0c<code>create_multi_agent_graph</code>\u5728<code>registry.create_agent_toolkit</code>\u7684\u65f6\u5019\u53ef\u4ee5\u76f4\u63a5\u4f20\u5165\u8fd9\u4e2a<code>tool_names</code>\u3002\u7c7b\u4f3c\u7684\u611f\u89c9lead.register_subagent\u4f7f\u7528\u7684\u4fe1\u606f\u5e94\u8be5\u4e5f\u901a\u8fc7search\u548ccrawl\u7684property\u83b7\u53d6\uff0c\u800c\u4e0d\u662f\u7f16\u7801\u5728<code>create_multi_agent_graph</code>\u4e2d</li> </ul>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/","title":"\ud83e\udd16 \u57fa\u4e8eArtifact\u7684Multi-Agent\u7814\u7a76\u7cfb\u7edf\u8bbe\u8ba1\u65b9\u6848","text":""},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#_1","title":"\ud83d\udca1 \u6838\u5fc3\u7406\u5ff5","text":"<p>\u91c7\u7528Collaborative Authoring\u6a21\u5f0f\uff0c\u901a\u8fc7Artifact\u4f5c\u4e3a\u5171\u4eab\u8bb0\u5fc6\u8f7d\u4f53\u3002\u6452\u5f03\u4f20\u7edf\u9ed1\u76d2\u5f0f\u4e00\u6b21\u6027\u751f\u6210\uff0c\u8f6c\u5411\u900f\u660e\u3001\u53ef\u63a7\u3001\u6e10\u8fdb\u5f0f\u7684\u7814\u7a76\u8fc7\u7a0b\u3002\u76f8\u6bd4\u4f20\u7edf\u300c\u4e00\u6b21\u6027\u751f\u6210\u300d\u6216\u300c\u957f\u5bf9\u8bdd\u4e0a\u4e0b\u6587\u300d\uff0cArtifact\u673a\u5236\u80fd\u6301\u7eed\u79ef\u7d2f\u548c\u7ec4\u7ec7\u4fe1\u606f\uff0c\u907f\u514d\u4e0a\u4e0b\u6587\u6df7\u4e71\uff0c\u8ba9\u7528\u6237\u548cAI\u771f\u6b63\u534f\u4f5c\u6784\u5efa\u7814\u7a76\u6210\u679c\u3002</p>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#_2","title":"\ud83c\udfd7\ufe0f \u7cfb\u7edf\u67b6\u6784","text":"<p>\u7cfb\u7edf\u91c7\u7528\u5206\u5c42\u8bbe\u8ba1\uff0c\u4ee5Artifact\u4f5c\u4e3a\u6838\u5fc3\u8bb0\u5fc6\u8f7d\u4f53\uff0cLead Agent\u8d1f\u8d23\u4efb\u52a1\u534f\u8c03\uff0c\u591a\u4e2aSubagent\u4e13\u95e8\u5904\u7406\u5177\u4f53\u4efb\u52a1\u3002\u901a\u8fc7\u660e\u786e\u7684\u6743\u9650\u63a7\u5236\u548c\u5355\u5411\u4fe1\u606f\u6d41\uff0c\u786e\u4fdd\u7cfb\u7edf\u8fd0\u884c\u7684\u7a33\u5b9a\u6027\u548c\u53ef\u63a7\u6027\u3002</p>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#_3","title":"\ud83e\udde9 \u6838\u5fc3\u7ec4\u4ef6","text":"<pre><code> \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n \u2502                       ARTIFACT LAYER                       \u2502\n \u2502                                                            \u2502\n \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n \u2502  \u2502       Task Plan Artifact      \u2502  \u2502    Result Artifact \u2502 \u2502\n \u2502  \u2502  - \u4efb\u52a1\u5206\u89e3 &amp; \u8fdb\u5ea6\u8ddf\u8e2a          \u2502  \u2502  - \u6700\u7ec8\u4ea7\u51fa\u6587\u6863     \u2502 \u2502\n \u2502  \u2502  - \u5171\u4eab\u7ed9\u6240\u6709Agent \u6709\u6743\u9650\u63a7\u5236   \u2502  \u2502   - \u5171\u4eab\u7ed9\u7528\u6237      \u2502 \u2502\n \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n \u2502                                                            \u2502\n \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2191                     \u2191                    \u2191\n           \u2502                     \u2502                    \u2502\n           \u2502 (\u8bfb\u5199)              \u2502 (\u53ea\u8bfb)              \u2502 (\u8bfb\u5199)\n           \u2502                     \u2502                    \u2502\n \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n \u2502   Lead Agent  \u2502      \u2502   Subagents   \u2502      \u2502    User      \u2502\n \u2502  - \u7ba1\u7406\u4efb\u52a1    \u2502      \u2502 - Search Agent\u2502      \u2502 - \u53ef\u6d4f\u89c8\u7f16\u8f91  \u2502\n \u2502  - \u534f\u8c03\u6267\u884c    \u2502      \u2502 - Web Crawl   \u2502      \u2502 - \u53ef\u7ed9\u53cd\u9988    \u2502\n \u2502  - \u6574\u5408\u7ed3\u679c    \u2502      \u2502 - Others...   \u2502      \u2502              \u2502\n \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Lead Agent</p> <ul> <li>\u804c\u8d23: \u4efb\u52a1\u89c4\u5212\u3001\u4fe1\u606f\u6574\u5408\u3001\u7528\u6237\u4ea4\u4e92</li> <li>\u5de5\u5177:</li> <li>Artifact\u64cd\u4f5c (create/update/rewrite)</li> <li>Subagent\u8c03\u7528\u63a5\u53e3</li> <li>\u7279\u70b9: \u4fdd\u6301\u4e0a\u4e0b\u6587\u7b80\u6d01\uff0c\u4e13\u6ce8\u4e8e\u9ad8\u5c42\u51b3\u7b56</li> </ul> <p>Subagents</p> <ul> <li>Search Agent: \u4fe1\u606f\u68c0\u7d22\uff0c\u8fd4\u56de\u7ed3\u6784\u5316\u641c\u7d22\u7ed3\u679c</li> <li>Web Crawl Agent: \u6df1\u5ea6\u5185\u5bb9\u6293\u53d6\uff0c\u63d0\u53d6\u5173\u952e\u4fe1\u606f</li> <li>\u72ec\u7acb\u6027: \u6bcf\u4e2aagent\u72ec\u7acb\u5b8c\u6210\u5206\u914d\u4efb\u52a1\uff0c\u81ea\u4e3b\u5224\u65ad\u5b8c\u6210\u6807\u51c6</li> </ul> <p>\u53ccArtifact\u673a\u5236</p> <ul> <li>Task Plan Artifact:</li> <li>Lead Agent\u6743\u9650: \u8bfb\u5199 (\u66f4\u65b0\u4efb\u52a1\u72b6\u6001\u3001\u6dfb\u52a0\u65b0\u4efb\u52a1\u3001\u4fee\u6539\u4f18\u5148\u7ea7)</li> <li>Subagent\u6743\u9650: \u53ea\u8bfb (\u4e86\u89e3\u4efb\u52a1\u9700\u6c42\u3001\u67e5\u770b\u4e0a\u4e0b\u6587\u4fe1\u606f)</li> <li>\u7528\u6237\u6743\u9650: \u53ea\u8bfb (\u67e5\u770b\u7814\u7a76\u8fdb\u5ea6\u548c\u4efb\u52a1\u72b6\u6001)</li> <li>Result Artifact:</li> <li>Lead Agent\u6743\u9650: \u8bfb\u5199 (\u6574\u5408\u4fe1\u606f\u3001\u66f4\u65b0\u5185\u5bb9\u3001\u8c03\u6574\u7ed3\u6784)</li> <li>Subagent\u6743\u9650: \u65e0\u8bbf\u95ee\u6743\u9650 (\u4fdd\u6301\u804c\u8d23\u6e05\u6670\uff0c\u907f\u514d\u76f4\u63a5\u4fee\u6539\u6700\u7ec8\u7ed3\u679c)</li> <li>\u7528\u6237\u6743\u9650: \u8bfb\u5199 (\u7f16\u8f91\u5185\u5bb9\u3001\u8c03\u6574\u683c\u5f0f\u3001\u6dfb\u52a0\u6279\u6ce8)</li> </ul>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#_4","title":"\ud83d\udd04 \u5de5\u4f5c\u6d41\u7a0b","text":"<pre><code>   \u7528\u6237\u63d0\u51fa\u9700\u6c42\n        \u2502\n        \u2502 (\u5bf9\u8bdd\u4ea4\u4e92)\n        \u2193\n   Lead Agent\u521b\u5efaTask Plan\n        \u2502\n        \u2502 (\u5206\u6790\u5e76\u6d3e\u53d1\u4efb\u52a1)\n        \u2193\n   \u250c\u2500\u2500\u2500 Search Agent \u2190\u2500\u2500 (\u8bfb\u53d6Task Plan\u83b7\u53d6\u5b8c\u6574\u4e0a\u4e0b\u6587)\n   \u2502         \u2502\n   \u2502         \u2514\u2500\u2500\u2192 \u8fd4\u56de\u641c\u7d22\u7ed3\u679c\n   \u2502\n   \u251c\u2500\u2500\u2500 Crawl Agent \u2190\u2500\u2500 (\u8bfb\u53d6Task Plan\u83b7\u53d6\u5b8c\u6574\u4e0a\u4e0b\u6587)  \n   \u2502         \u2502\n   \u2502         \u2514\u2500\u2500\u2192 \u8fd4\u56de\u6293\u53d6\u7ed3\u679c\n   \u2502\n   \u2514\u2500\u2500\u2500 Other Agents...\n        \u2502\n        \u2193\nLead Agent\u6574\u5408\u4fe1\u606f\n        \u2502\n        \u2502 (\u66f4\u65b0Task Plan\u72b6\u6001)\n        \u2502 (\u66f4\u65b0Result Artifact\u5185\u5bb9)\n        \u2193\n   \u7528\u6237\u67e5\u770b\u7ed3\u679c\n        \u2502\n        \u2502 (\u7f16\u8f91Artifact\u6216\u5bf9\u8bdd\u53cd\u9988)\n        \u2193\n   Lead Agent\u6839\u636e\u53cd\u9988\u8c03\u6574\n        \u2502\n        \u2502 (\u5faa\u73af\u6267\u884c\u76f4\u5230\u6ee1\u610f)\n        \u2193\n      \u4efb\u52a1\u5b8c\u6210\n</code></pre>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#1","title":"\u9636\u6bb51: \u7814\u7a76\u89c4\u5212","text":"<ol> <li>\u7528\u6237\u63d0\u51fa\u7814\u7a76\u9700\u6c42</li> <li>Lead Agent\u5206\u6790\u9700\u6c42\uff0c\u521b\u5efaTask Plan Artifact\u548c\u521d\u59cbResult Artifact\u6846\u67b6</li> <li>\u7cfb\u7edf\u8fdb\u5165\u6267\u884c\u9636\u6bb5</li> </ol>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#2","title":"\u9636\u6bb52: \u4fe1\u606f\u6536\u96c6","text":"<ol> <li>Lead Agent\u6839\u636eTask Plan\u6d3e\u53d1\u641c\u7d22\u4efb\u52a1</li> <li>Search Agent\u8bfb\u53d6Task Plan\uff0c\u4e86\u89e3\u5177\u4f53\u641c\u7d22\u9700\u6c42\u548c\u4e0a\u4e0b\u6587</li> <li>Search Agent\u72ec\u7acb\u6267\u884c\u641c\u7d22\uff0c\u8fd4\u56de\u7ed3\u679c\u7ed9Lead Agent\uff08\u4e0d\u76f4\u63a5\u4fee\u6539\u4efb\u4f55Artifact\uff09</li> <li>Lead Agent\u63a5\u6536\u7ed3\u679c\u540e\uff1a</li> <li>\u66f4\u65b0Task Plan\u4e2d\u7684\u4efb\u52a1\u72b6\u6001</li> <li>\u5c06\u4fe1\u606f\u6574\u5408\u5230Result Artifact</li> <li>\u8bc4\u4f30\u662f\u5426\u9700\u8981\u8fdb\u4e00\u6b65\u6293\u53d6</li> <li>\u5fc5\u8981\u65f6\u6d3e\u53d1URL\u7ed9Web Crawl Agent\uff0c\u91cd\u590d\u4e0a\u8ff0\u6d41\u7a0b</li> </ol>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#3","title":"\u9636\u6bb53: \u534f\u4f5c\u4f18\u5316","text":"<ol> <li>\u4efb\u52a1\u5b8c\u6210\u540e\u7684\u4ea4\u4e92\uff1aLead Agent\u5b8c\u6210\u4e00\u8f6e\u4efb\u52a1\u6267\u884c\uff0c\u5411\u7528\u6237\u5c55\u793a\u66f4\u65b0\u540e\u7684Result Artifact</li> <li>\u7528\u6237\u53cd\u9988\u65b9\u5f0f\uff1a</li> <li>\u76f4\u63a5\u7f16\u8f91Result Artifact\uff08\u4fee\u6539\u5185\u5bb9\u3001\u8c03\u6574\u7ed3\u6784\u3001\u6dfb\u52a0\u8981\u6c42\uff09</li> <li>\u901a\u8fc7\u5bf9\u8bdd\u5411Lead Agent\u63d0\u51fa\u6539\u8fdb\u8981\u6c42\uff08\"\u9700\u8981\u66f4\u591a\u4e34\u5e8a\u6570\u636e\"\u3001\"\u589e\u52a0\u5e02\u573a\u5206\u6790\u7ae0\u8282\"\uff09</li> <li>Lead Agent\u54cd\u5e94\uff1a\u6839\u636e\u7528\u6237\u53cd\u9988\u8c03\u6574Task Plan\uff0c\u6d3e\u53d1\u65b0\u7684\u4efb\u52a1\u6216\u4f18\u5316\u73b0\u6709\u5185\u5bb9</li> <li>\u8fed\u4ee3\u5faa\u73af\uff1a\u91cd\u590d\u6267\u884c\u76f4\u5230\u7528\u6237\u6ee1\u610f</li> </ol>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#_5","title":"\ud83d\udcda \u8be6\u7ec6\u793a\u4f8b","text":""},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#1-ai","title":"\u793a\u4f8b1: AI\u533b\u7597\u5e94\u7528\u7814\u7a76\u62a5\u544a","text":"<p>Task Plan Artifact</p> <pre><code># AI\u533b\u7597\u5e94\u7528\u7814\u7a76\u8fdb\u5ea6\n## \u9879\u76ee\u72b6\u6001: \ud83d\udd04 \u8fdb\u884c\u4e2d\n## \u5f53\u524d\u6267\u884c: Search Agent - \u641c\u7d22FDA\u6279\u51c6\u7684AI\u533b\u7597\u8bbe\u5907\n\n### \u7814\u7a76\u5927\u7eb2\n#### 1. AI\u533b\u7597\u5e94\u7528\u6982\u8ff0\n- \u72b6\u6001: \u2705 \u5df2\u5b8c\u6210 (\u4fe1\u606f\u5145\u5206\u5ea6: 85%)\n- \u6765\u6e90: 12\u7bc7\u6743\u5a01\u6587\u732e, 3\u4e2a\u5b98\u65b9\u62a5\u544a\n- \u8d28\u91cf\u8bc4\u4f30: \u9ad8\u8d28\u91cf\uff0c\u6db5\u76d6\u4e3b\u8981\u5e94\u7528\u9886\u57df\n\n#### 2. \u4e34\u5e8a\u8bd5\u9a8c\u73b0\u72b6\n- \u72b6\u6001: \ud83d\udd04 \u8fdb\u884c\u4e2d (60%)\n- \u5f53\u524d\u4efb\u52a1: \u641c\u7d222024\u5e74FDA\u6279\u51c6\u7684AI\u533b\u7597\u8bbe\u5907\u6e05\u5355\n- \u5df2\u6536\u96c6: 15\u4e2a\u6279\u51c6\u8bbe\u5907\uff0c8\u4e2a\u4e34\u5e8a\u8bd5\u9a8c\u6848\u4f8b\n- \u4e0b\u4e00\u6b65: \u6df1\u5ea6\u6293\u53d6\u5177\u4f53\u4ea7\u54c1\u4fe1\u606f\u548c\u4e34\u5e8a\u6570\u636e\n- [\u6682\u505c\u6b64\u4efb\u52a1] [\u8c03\u6574\u641c\u7d22\u7b56\u7565]\n\n#### 3. \u5e02\u573a\u5206\u6790\n- \u72b6\u6001: \u23f3 \u7b49\u5f85\u4e2d\n- \u4f9d\u8d56: \u9700\u8981\u7b2c2\u7ae0\u5b8c\u6210\u540e\u542f\u52a8\n- \u9884\u8ba1\u4fe1\u606f\u9700\u6c42: \u5e02\u573a\u89c4\u6a21\u3001\u4e3b\u8981\u5382\u5546\u3001\u6295\u8d44\u8d8b\u52bf\n\n#### 4. \u672a\u6765\u5c55\u671b\n- \u72b6\u6001: \u23f3 \u8ba1\u5212\u4e2d\n- \u7528\u6237\u5907\u6ce8: \u91cd\u70b9\u5173\u6ce8\u76d1\u7ba1\u653f\u7b56\u53d8\u5316\n</code></pre> <p>\u5bf9\u5e94\u7684Result Artifact (\u90e8\u5206)</p> <pre><code># AI\u533b\u7597\u5e94\u7528\u7814\u7a76\u62a5\u544a\n\n## 1. AI\u533b\u7597\u5e94\u7528\u6982\u8ff0\n\n\u4eba\u5de5\u667a\u80fd\u5728\u533b\u7597\u9886\u57df\u7684\u5e94\u7528\u6b63\u5728\u5feb\u901f\u53d1\u5c55\uff0c\u4e3b\u8981\u96c6\u4e2d\u5728\u533b\u5b66\u5f71\u50cf\u5206\u6790\u3001\u836f\u7269\u53d1\u73b0\u3001\u4e34\u5e8a\u51b3\u7b56\u652f\u6301\u7b49\u9886\u57df\u3002\u6839\u636e\u6700\u65b0\u7edf\u8ba1\uff0c\u622a\u81f32024\u5e74...\n\n### 1.1 \u533b\u5b66\u5f71\u50cfAI\n- **\u5e94\u7528\u9886\u57df**: \u653e\u5c04\u5b66\u3001\u75c5\u7406\u5b66\u3001\u773c\u79d1\u7b49\n- **\u6280\u672f\u6210\u719f\u5ea6**: \u5546\u4e1a\u5316\u7a0b\u5ea6\u8f83\u9ad8\n- **\u4ee3\u8868\u4ea7\u54c1**: [\u5177\u4f53\u4ea7\u54c1\u5217\u8868]\n\n### 1.2 \u4e34\u5e8a\u51b3\u7b56\u652f\u6301\n- **\u5e94\u7528\u573a\u666f**: \u75be\u75c5\u8bca\u65ad\u3001\u6cbb\u7597\u65b9\u6848\u63a8\u8350\n- **\u6280\u672f\u6311\u6218**: \u6570\u636e\u8d28\u91cf\u3001\u6a21\u578b\u53ef\u89e3\u91ca\u6027\n- **\u76d1\u7ba1\u73b0\u72b6**: FDA\u5df2\u6279\u51c6\u591a\u6b3e\u4ea7\u54c1\n\n## 2. \u4e34\u5e8a\u8bd5\u9a8c\u73b0\u72b6 [\u6b63\u5728\u66f4\u65b0\u4e2d...]\n\n### 2.1 FDA\u6279\u51c6\u8bbe\u5907\u7edf\u8ba1\n[\u6b63\u5728\u6536\u96c6\u6700\u65b0\u6570\u636e...]\n\n### 2.2 \u4e34\u5e8a\u8bd5\u9a8c\u5206\u6790\n[\u7b49\u5f85Search Agent\u8fd4\u56de\u7ed3\u679c...]\n\n---\n*\u672c\u62a5\u544a\u7531AI\u7cfb\u7edf\u534f\u52a9\u751f\u6210\uff0c\u7528\u6237\u53ef\u968f\u65f6\u7f16\u8f91\u4fee\u6539*\n</code></pre>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#2_1","title":"\u793a\u4f8b2: \u7528\u6237\u5e72\u9884\u573a\u666f","text":""},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#_6","title":"\u573a\u666f: \u7528\u6237\u60f3\u8981\u6dfb\u52a0\u65b0\u7684\u7814\u7a76\u65b9\u5411","text":"<p>\u7528\u6237\u64cd\u4f5c\u65b9\u5f0f1: \u5728Result Artifact\u4e2d\u6dfb\u52a0\u65b0\u7ae0\u8282\u6846\u67b6</p> <pre><code>## 5. \u6570\u636e\u9690\u79c1\u4e0e\u5b89\u5168 [\u7528\u6237\u65b0\u589e]\n### 5.1 HIPAA\u5408\u89c4\u8981\u6c42\n[\u8bf7\u8865\u5145\u76f8\u5173\u4fe1\u606f]\n### 5.2 \u6570\u636e\u6cc4\u9732\u6848\u4f8b\u5206\u6790\n[\u9700\u8981\u6536\u96c6\u8fd1\u671f\u6848\u4f8b]\n</code></pre> <p>\u7528\u6237\u64cd\u4f5c\u65b9\u5f0f2: \u901a\u8fc7\u5bf9\u8bdd\u5411Lead Agent\u63d0\u51fa\u8981\u6c42</p> <p>\"\u6211\u53d1\u73b0\u6570\u636e\u9690\u79c1\u662fAI\u533b\u7597\u7684\u91cd\u8981\u6311\u6218\uff0c\u9700\u8981\u589e\u52a0\u4e00\u4e2a\u4e13\u95e8\u7ae0\u8282\u6765\u5206\u6790HIPAA\u5408\u89c4\u548c\u5b89\u5168\u6280\u672f\u65b9\u6848\"</p> <p>\u7cfb\u7edf\u54cd\u5e94: Lead Agent\u8bc6\u522b\u7528\u6237\u9700\u6c42\uff0c\u81ea\u52a8\u66f4\u65b0Task Plan\u6dfb\u52a0\u76f8\u5e94\u641c\u7d22\u4efb\u52a1</p>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#_7","title":"\u573a\u666f: \u7528\u6237\u5bf9\u4fe1\u606f\u8d28\u91cf\u4e0d\u6ee1\u610f","text":"<p>\u7528\u6237\u64cd\u4f5c\u65b9\u5f0f1: \u5728Result Artifact\u4e2d\u6dfb\u52a0\u6279\u6ce8</p> <pre><code>## 2. \u4e34\u5e8a\u8bd5\u9a8c\u73b0\u72b6\n[\u5f53\u524d\u5185\u5bb9\u591a\u4e3a\u65b0\u95fb\u62a5\u9053\uff0c\u7f3a\u5c11\u5b66\u672f\u8bba\u6587\u652f\u6491\uff0c\u8bf7\u8865\u5145\u66f4\u6743\u5a01\u7684\u7814\u7a76\u6570\u636e]\n</code></pre> <p>\u7528\u6237\u64cd\u4f5c\u65b9\u5f0f2: \u901a\u8fc7\u5bf9\u8bdd\u63d0\u51fa\u5177\u4f53\u8981\u6c42</p> <p>\"\u7b2c2\u7ae0\u7684\u4fe1\u606f\u8d28\u91cf\u4e0d\u591f\u597d\uff0c\u591a\u662f\u65b0\u95fb\u62a5\u9053\uff0c\u80fd\u4e0d\u80fd\u91cd\u65b0\u641c\u7d22\u4e00\u4e9b\u5b66\u672f\u8bba\u6587\u548cFDA\u7684\u5b98\u65b9\u6570\u636e\uff1f\"</p> <p>\u7cfb\u7edf\u54cd\u5e94: Lead Agent\u7406\u89e3\u53cd\u9988\uff0c\u66f4\u65b0Task Plan\u91cd\u65b0\u6267\u884c\u641c\u7d22\u4efb\u52a1</p>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#_8","title":"\u2699\ufe0f \u529f\u80fd\u8bbe\u8ba1\u8981\u70b9","text":"<p>\u7cfb\u7edf\u91c7\u7528Lead Agent\u7edf\u4e00\u534f\u8c03\u7684\u65b9\u5f0f\uff0c\u901a\u8fc7Task Plan\u5c55\u793a\u8fdb\u5ea6\uff0cSubagent\u72ec\u7acb\u6267\u884c\u5177\u4f53\u4efb\u52a1\u5e76\u8fd4\u56de\u7ed3\u6784\u5316\u7ed3\u679c\u3002Lead Agent\u8d1f\u8d23\u8d28\u91cf\u8bc4\u4f30\u548c\u4fe1\u606f\u6574\u5408\uff0c\u7528\u6237\u901a\u8fc7\u7f16\u8f91Result Artifact\u6216\u5bf9\u8bdd\u6765\u8868\u8fbe\u6539\u8fdb\u9700\u6c42\u3002\u6574\u4e2a\u8fc7\u7a0b\u5b9e\u73b0\u591a\u5c42\u8d28\u91cf\u63a7\u5236\uff0c\u4eceSubagent\u7684\u521d\u6b65\u7b5b\u9009\u5230Lead Agent\u7684\u7efc\u5408\u8bc4\u4f30\uff0c\u6700\u7ec8\u7531\u7528\u6237\u8fdb\u884c\u8d28\u91cf\u628a\u5173\u3002</p>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#_9","title":"\ud83c\udfaf \u7cfb\u7edf\u4f18\u52bf","text":"<p>\u76f8\u6bd4\u4f20\u7edf\u7684\u591a\u5c42\u5d4c\u5957\u67b6\u6784\uff0c\u8fd9\u79cd\u8bbe\u8ba1\u5177\u6709\u66f4\u597d\u7684\u900f\u660e\u5ea6\u548c\u53ef\u63a7\u6027\u3002Task Plan\u63d0\u4f9b\u5b8c\u6574\u7684\u8fdb\u5ea6\u53ef\u89c6\u5316\uff0c\u7528\u6237\u80fd\u6e05\u695a\u4e86\u89e3\u7cfb\u7edf\u5de5\u4f5c\u72b6\u6001\u3002\u901a\u8fc7\u7b80\u5316\u4ea4\u4e92\u6a21\u5f0f\uff0c\u7528\u6237\u53ea\u9700\u8981\u7f16\u8f91\u6587\u6863\u548c\u6b63\u5e38\u5bf9\u8bdd\uff0c\u907f\u514d\u4e86\u590d\u6742\u7684\u4efb\u52a1\u7ba1\u7406\u754c\u9762\u3002\u7cfb\u7edf\u6613\u4e8e\u6269\u5c55\u65b0\u7684Agent\u7c7b\u578b\uff0c\u652f\u6301\u4e0d\u540c\u7814\u7a76\u573a\u666f\u7684\u590d\u7528\u3002</p>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#_10","title":"\ud83d\ude80 \u5b9e\u73b0\u8def\u5f84","text":"<p>\u5efa\u8bae\u5206\u56db\u4e2a\u9636\u6bb5\u5b9e\u65bd\uff1a\u9996\u5148\u5b9e\u73b0Lead Agent\u548c\u57fa\u7840Artifact\u673a\u5236\uff0c\u5f00\u53d1\u6838\u5fc3\u7684Search Agent\u548cWeb Crawl Agent\uff1b\u7136\u540e\u5b8c\u5584\u7528\u6237\u4ea4\u4e92\u754c\u9762\uff0c\u652f\u6301\u5b9e\u65f6\u8fdb\u5ea6\u8ddf\u8e2a\u548c\u7f16\u8f91\u53cd\u9988\uff1b\u63a5\u7740\u589e\u5f3a\u4fe1\u606f\u8d28\u91cf\u8bc4\u4f30\u548c\u667a\u80fd\u4efb\u52a1\u8c03\u5ea6\uff1b\u6700\u540e\u6269\u5c55\u5230\u66f4\u591a\u7814\u7a76\u573a\u666f\uff0c\u5efa\u7acb\u63d0\u793a\u8bcd\u6a21\u677f\u5e93\u548c\u6700\u4f73\u5b9e\u8df5\u3002</p>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#_11","title":"\u2728 \u5173\u952e\u521b\u65b0\u70b9","text":"<ol> <li>Artifact\u4f5c\u4e3a\u8bb0\u5fc6\u8f7d\u4f53: \u89e3\u51b3\u4e86\u4f20\u7edfmulti-agent\u7cfb\u7edf\u7684\u4e0a\u4e0b\u6587\u7ba1\u7406\u95ee\u9898</li> <li>\u5206\u5c42\u6743\u9650\u63a7\u5236: Lead Agent\u5168\u6743\u9650\uff0cSubagent\u53ea\u8bfbTask Plan\uff0c\u7528\u6237\u53ea\u8bfbTask Plan\u4f46\u53ef\u7f16\u8f91Result</li> <li>\u7b80\u5316\u4ea4\u4e92\u6a21\u5f0f: \u907f\u514d\u590d\u6742\u7684\u4efb\u52a1\u7ba1\u7406\u754c\u9762\uff0c\u7528\u6237\u901a\u8fc7\u7f16\u8f91\u6587\u6863\u548c\u5bf9\u8bdd\u6765\u8868\u8fbe\u9700\u6c42</li> <li>\u53ccArtifact\u5206\u79bb: Task Plan\u4e13\u6ce8\u8fdb\u5ea6\u5c55\u793a\uff0cResult Doc\u4e13\u6ce8\u5185\u5bb9\u534f\u4f5c</li> <li>\u6e10\u8fdb\u5f0f\u534f\u4f5c: \u4ece\u4e00\u6b21\u6027\u751f\u6210\u8f6c\u5411\u8fed\u4ee3\u4f18\u5316</li> <li>\u900f\u660e\u5316\u6267\u884c: \u6bcf\u4e2a\u6b65\u9aa4\u90fd\u53ef\u8ffd\u8e2a\u4f46\u4e0d\u5e72\u6270\u6267\u884c</li> <li>\u4fe1\u606f\u6d41\u5355\u5411\u6027: Subagent \u2192 Lead Agent \u2192 Artifact\uff0c\u907f\u514d\u5e76\u53d1\u51b2\u7a81</li> </ol> <p>\u8fd9\u79cd\u8bbe\u8ba1\u8ba9\u7814\u7a76\u8fc7\u7a0b\u53d8\u6210\u4e86\u4e00\u4e2a\u771f\u6b63\u7684\u4eba\u673a\u534f\u4f5c\u8fc7\u7a0b\uff0c\u5145\u5206\u53d1\u6325\u4e86\u4eba\u7c7b\u7684\u521b\u9020\u529b\u548cAI\u7684\u4fe1\u606f\u5904\u7406\u80fd\u529b\u3002</p>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#multi-agent-","title":"Multi-Agent\u7814\u7a76\u7cfb\u7edf - \u540e\u7aef\u5b9e\u65bd\u7ec6\u8282","text":""},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#_12","title":"\ud83c\udfaf \u6838\u5fc3\u529f\u80fd\u6a21\u5757","text":""},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#1-human-in-the-loop","title":"1. Human in the Loop \u673a\u5236","text":"<p>\u539f\u59cb\u9700\u6c42: \u5141\u8bb8\u7528\u6237\u901a\u8fc7\u5bf9\u8bdd\u4ecb\u5165/\u6253\u65adagent\u6267\u884c\u7684\u4efb\u52a1</p> <p>\u5b9e\u65bd\u7ec6\u8282:</p> <ul> <li>\u57fa\u7840\u63a7\u5236\u63a5\u53e3:</li> </ul> <pre><code>class ExecutionController:\n    def __init__(self, graph, checkpointer):\n        self.graph = graph\n        self.checkpointer = checkpointer\n        self.is_paused = False\n        self.additional_context = []\n\n    async def pause(self, thread_id):\n        \"\"\"\u6682\u505c\u6267\u884c\"\"\"\n        self.is_paused = True\n        # LangGraph\u4f1a\u5728\u4e0b\u4e2a\u8282\u70b9\u524d\u81ea\u52a8\u4fdd\u5b58checkpoint\n\n    async def resume(self, thread_id):\n        \"\"\"\u6062\u590d\u6267\u884c\uff0c\u5e26\u5165\u7528\u6237\u8865\u5145\u7684context\"\"\"\n        config = {\"configurable\": {\"thread_id\": thread_id}}\n        state = self.graph.get_state(config)\n\n        # \u5c06\u8865\u5145\u7684context\u52a0\u5165state\n        if self.additional_context:\n            state.values[\"user_context\"] = \"\\n\".join(self.additional_context)\n            self.additional_context = []\n\n        self.is_paused = False\n        return await self.graph.invoke(None, config)\n\n    async def rollback(self, thread_id, checkpoint_id=None):\n        \"\"\"\u56de\u6eda\u5230\u6307\u5b9acheckpoint\"\"\"\n        config = {\"configurable\": {\n            \"thread_id\": thread_id,\n            \"checkpoint_id\": checkpoint_id  # \u5982\u679cNone\u5219\u56de\u6eda\u5230\u4e0a\u4e00\u4e2a\n        }}\n        return self.graph.get_state(config)\n\n    def add_context(self, user_query):\n        \"\"\"\u6682\u505c\u72b6\u6001\u4e0b\uff0c\u7528\u6237\u8f93\u5165\u4f1a\u88ab\u6dfb\u52a0\u4e3a\u8865\u5145context\"\"\"\n        if self.is_paused:\n            self.additional_context.append(user_query)\n</code></pre> <ul> <li>Lead Agent\u5904\u7406\u8865\u5145context:</li> </ul> <pre><code>def lead_agent_node(state):\n    # \u68c0\u67e5\u662f\u5426\u6709\u7528\u6237\u8865\u5145\u7684context\n    user_context = state.get(\"user_context\", \"\")\n\n    # \u6784\u5efaprompt\u65f6\u5305\u542b\u7528\u6237\u8865\u5145\u4fe1\u606f\n    prompt = f\"\"\"\n    \u539f\u59cb\u4efb\u52a1: {state[\"original_task\"]}\n    \u5f53\u524d\u8fdb\u5ea6: {state[\"progress\"]}\n\n    {f\"\u7528\u6237\u8865\u5145\u8981\u6c42: {user_context}\" if user_context else \"\"}\n\n    \u8bf7\u7ee7\u7eed\u6267\u884c\u4efb\u52a1...\n    \"\"\"\n\n    # \u6e05\u7a7a\u5df2\u4f7f\u7528\u7684user_context\n    state[\"user_context\"] = \"\"\n    return state\n</code></pre> <ul> <li>\u4f7f\u7528\u793a\u4f8b:</li> </ul> <pre><code># \u7528\u6237\u53d1\u8d77\u4efb\u52a1\ncontroller = ExecutionController(graph, checkpointer)\ntask = controller.start(\"\u7814\u7a76AI\u533b\u7597\u5e94\u7528\")\n\n# \u7528\u6237\u6682\u505c\nawait controller.pause(\"thread_123\")\n\n# \u7528\u6237\u8865\u5145\u4fe1\u606f\uff08\u5728\u6682\u505c\u72b6\u6001\u4e0b\uff09\ncontroller.add_context(\"\u91cd\u70b9\u5173\u6ce8FDA\u6279\u51c6\u7684\u4ea7\u54c1\")\ncontroller.add_context(\"\u9700\u8981\u5305\u542b2024\u5e74\u7684\u6700\u65b0\u6570\u636e\")\n\n# \u6062\u590d\u6267\u884c\uff08\u81ea\u52a8\u5e26\u5165\u8865\u5145\u7684context\uff09\nawait controller.resume(\"thread_123\")\n\n# \u5982\u9700\u56de\u6eda\nawait controller.rollback(\"thread_123\")\n</code></pre>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#2-context-compression","title":"2. Context Compression \u7b56\u7565","text":"<p>\u539f\u59cb\u9700\u6c42: \u667a\u80fd\u5224\u65ad\u5bf9context\u8fdb\u884c\u538b\u7f29\uff08\u521d\u671f2w\u5b57\u7b26\u622a\u65ad\uff09</p> <p>\u5b9e\u65bd\u7ec6\u8282:</p> <ul> <li>\u5206\u7ea7\u538b\u7f29\u7b56\u7565:</li> </ul> <pre><code># \u4f2a\u4ee3\u7801\u793a\u4f8b\nclass ContextManager:\n    LEVELS = {\n        'full': 50000,      # \u5b8c\u6574\u4e0a\u4e0b\u6587\n        'normal': 20000,    # \u6807\u51c6\u538b\u7f29\n        'compact': 10000,   # \u7d27\u51d1\u6a21\u5f0f\n        'minimal': 5000     # \u6700\u5c0f\u5316\n    }\n</code></pre> <ul> <li> <p>\u667a\u80fd\u538b\u7f29\u7b97\u6cd5:</p> </li> <li> <p>\u4f18\u5148\u7ea7\u4fdd\u7559: \u4fdd\u7559\u6700\u8fd1N\u8f6e\u5bf9\u8bdd + \u5173\u952e\u51b3\u7b56\u70b9</p> </li> <li>\u6458\u8981\u66ff\u6362: \u5c06\u5386\u53f2\u5bf9\u8bdd\u538b\u7f29\u4e3a\u6458\u8981</li> <li>\u7ed3\u6784\u5316\u538b\u7f29: \u4fdd\u7559JSON/XML\u7ed3\u6784\uff0c\u538b\u7f29\u63cf\u8ff0\u6027\u6587\u672c</li> <li> <p>\u76f8\u5173\u6027\u7b5b\u9009: \u57fa\u4e8e\u5f53\u524d\u4efb\u52a1\u7b5b\u9009\u76f8\u5173\u4e0a\u4e0b\u6587</p> </li> <li> <p>\u538b\u7f29\u89e6\u53d1\u6761\u4ef6:</p> </li> <li> <p>Token\u6570\u8d85\u8fc7\u9608\u503c</p> </li> <li>\u5185\u5b58\u4f7f\u7528\u8d85\u9650</li> <li>\u7279\u5b9a\u4efb\u52a1\u7c7b\u578b\uff08\u5982\u7b80\u5355\u641c\u7d22\uff09\u81ea\u52a8\u4f7f\u7528\u7d27\u51d1\u6a21\u5f0f</li> </ul>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#3_1","title":"3. \u975e\u963b\u585e\u5f0f\u54cd\u5e94\u673a\u5236","text":"<p>\u539f\u59cb\u9700\u6c42: Lead Agent\u6d41\u5f0f\u8fd4\u56de\uff0cSubagent\u6279\u91cf\u8fd4\u56de</p> <p>\u5b9e\u65bd\u7ec6\u8282:</p> <ul> <li>\u6d41\u5f0f\u5904\u7406\u67b6\u6784:</li> </ul> <pre><code># Lead Agent \u6d41\u5f0f\u8fd4\u56de\nasync def lead_agent_stream():\n    async for chunk in model.astream():\n        yield chunk\n        await update_artifact_realtime(chunk)\n\n# Subagent \u6279\u91cf\u8fd4\u56de\nasync def subagent_execute():\n    result = await model.ainvoke()\n    return parse_complete_result(result)\n</code></pre> <ul> <li> <p>\u5e76\u53d1\u6267\u884c\u7ba1\u7406:</p> </li> <li> <p>\u4f7f\u7528asyncio\u7ba1\u7406\u591a\u4e2aSubagent\u5e76\u53d1</p> </li> <li>\u5b9e\u73b0\u4efb\u52a1\u961f\u5217\u548c\u7ebf\u7a0b\u6c60</li> <li> <p>\u652f\u6301\u52a8\u6001\u8c03\u6574\u5e76\u53d1\u6570</p> </li> <li> <p>\u7ed3\u679c\u7f13\u51b2\u7b56\u7565:</p> </li> <li> <p>Lead Agent: \u9010\u5b57\u7b26/\u9010\u8bcd\u6d41\u5f0f\u8f93\u51fa</p> </li> <li>Subagent: \u7ed3\u679c\u5b8c\u6210\u540e\u6279\u91cf\u8fd4\u56de</li> <li>\u652f\u6301\u90e8\u5206\u7ed3\u679c\u9884\u89c8\uff08\u5982\u641c\u7d22\u7ed3\u679c\u5b9e\u65f6\u663e\u793a\u524dN\u6761\uff09</li> </ul>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#4-langchainlanggraph","title":"4. LangChain/LangGraph \u96c6\u6210","text":"<p>\u539f\u59cb\u9700\u6c42: \u4f7f\u7528\u6210\u719f\u6846\u67b6\u907f\u514d\u9020\u8f6e\u5b50</p> <p>\u5b9e\u65bd\u7ec6\u8282:</p> <ul> <li>Graph\u8bbe\u8ba1:</li> </ul> <pre><code># \u4f7f\u7528LangGraph\u6784\u5efa\u5de5\u4f5c\u6d41\nfrom langgraph.graph import StateGraph\nfrom langgraph.checkpoint.memory import MemorySaver\n\n# \u914d\u7f6echeckpoint\nmemory = MemorySaver()\n\nworkflow = StateGraph(AgentState)\nworkflow.add_node(\"lead_agent\", lead_agent_node)\nworkflow.add_node(\"search_agent\", search_agent_node)\nworkflow.add_node(\"crawl_agent\", crawl_agent_node)\n\n# \u914d\u7f6e\u6761\u4ef6\u8fb9\nworkflow.add_conditional_edges(\n    \"lead_agent\",\n    route_to_subagent,\n    {\n        \"search\": \"search_agent\",\n        \"crawl\": \"crawl_agent\",\n        \"continue\": \"lead_agent\"\n    }\n)\n\n# \u7f16\u8bd1\u5e26checkpoint\u7684graph\napp = workflow.compile(checkpointer=memory)\n</code></pre> <ul> <li> <p>\u81ea\u5b9a\u4e49\u7ec4\u4ef6:</p> </li> <li> <p>\u7ee7\u627fBaseAgent\u5b9e\u73b0\u81ea\u5b9a\u4e49Agent\u903b\u8f91</p> </li> <li>\u81ea\u5b9a\u4e49Tool\u5305\u88c5\u5668\u652f\u6301\u6743\u9650\u63a7\u5236</li> <li> <p>\u5b9e\u73b0\u81ea\u5b9a\u4e49Memory\u7ec4\u4ef6\u7ba1\u7406Artifact</p> </li> <li> <p>\u72b6\u6001\u7ba1\u7406:</p> </li> <li> <p>\u4f7f\u7528LangGraph\u7684State\u673a\u5236\u7ba1\u7406\u4efb\u52a1\u72b6\u6001</p> </li> <li>\u5229\u7528\u5185\u7f6eCheckpointer\u652f\u6301\u65ad\u70b9\u7eed\u4f20</li> </ul>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#5","title":"5. \u591a\u6a21\u578b\u652f\u6301\u4e0e\u601d\u8003\u6a21\u578b\u96c6\u6210","text":"<p>\u539f\u59cb\u9700\u6c42: \u652f\u6301\u4e0d\u540cagent\u8c03\u7528\u4e0d\u540c\u6a21\u578b\uff0c\u6b63\u786e\u89e3\u6790think\u90e8\u5206</p> <p>\u5b9e\u65bd\u7ec6\u8282:</p> <ul> <li>\u6a21\u578b\u914d\u7f6e\u7ba1\u7406:</li> </ul> <pre><code>models:\n  lead_agent:\n    provider: \"anthropic\"\n    model: \"claude-3-opus\"\n    temperature: 0.7\n    supports_thinking: true\n\n  search_agent:\n    provider: \"openai\"\n    model: \"gpt-4-turbo\"\n    temperature: 0.3\n    supports_thinking: false\n</code></pre> <ul> <li>\u601d\u8003\u6a21\u578b\u5904\u7406:</li> </ul> <pre><code>class ThinkingModelParser:\n    def parse_response(self, response):\n        thinking = extract_thinking_tags(response)\n        answer = extract_answer_tags(response)\n        return {\n            'thinking': thinking,  # \u5185\u90e8\u63a8\u7406\u8fc7\u7a0b\n            'answer': answer,      # \u5b9e\u9645\u54cd\u5e94\n            'metadata': {...}      # \u5176\u4ed6\u5143\u6570\u636e\n        }\n</code></pre> <ul> <li> <p>\u6a21\u578b\u5207\u6362\u7b56\u7565:</p> </li> <li> <p>\u57fa\u4e8e\u4efb\u52a1\u7c7b\u578b\u81ea\u52a8\u9009\u62e9\u6a21\u578b</p> </li> <li>\u652f\u6301fallback\u673a\u5236\uff08\u4e3b\u6a21\u578b\u5931\u8d25\u5207\u6362\u5907\u7528\uff09</li> <li>\u6210\u672c\u4f18\u5316\uff08\u7b80\u5355\u4efb\u52a1\u7528\u5c0f\u6a21\u578b\uff09</li> </ul>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#6-xml","title":"6. XML\u5de5\u5177\u8c03\u7528\u7cfb\u7edf","text":"<p>\u539f\u59cb\u9700\u6c42: \u4e0d\u7528tool call\u63a5\u53e3\uff0c\u81ea\u5df1\u8bbe\u8ba1XML\u5f62\u5f0f\u7684\u51fd\u6570\u8c03\u7528</p> <p>\u5b9e\u65bd\u7ec6\u8282:</p> <ul> <li>\u7edf\u4e00\u7684XML Schema:</li> </ul> <pre><code>&lt;!-- \u5de5\u5177\u5b9a\u4e49 --&gt;\n&lt;tool&gt;\n  &lt;name&gt;web_search&lt;/name&gt;\n  &lt;description&gt;Search the web for information&lt;/description&gt;\n  &lt;parameters&gt;\n    &lt;param name=\"query\" type=\"string\" required=\"true\"/&gt;\n    &lt;param name=\"max_results\" type=\"int\" default=\"10\"/&gt;\n  &lt;/parameters&gt;\n  &lt;permissions&gt;\n    &lt;require_approval&gt;false&lt;/require_approval&gt;\n  &lt;/permissions&gt;\n&lt;/tool&gt;\n\n&lt;!-- \u5de5\u5177\u8c03\u7528 --&gt;\n&lt;tool_call&gt;\n  &lt;name&gt;web_search&lt;/name&gt;\n  &lt;params&gt;\n    &lt;query&gt;AI medical applications FDA approval&lt;/query&gt;\n    &lt;max_results&gt;20&lt;/max_results&gt;\n  &lt;/params&gt;\n&lt;/tool_call&gt;\n</code></pre> <ul> <li>\u63d0\u793a\u8bcd\u751f\u6210\u5668:</li> </ul> <pre><code>class ToolPromptGenerator:\n    def generate_system_prompt(self, tools):\n        # \u81ea\u52a8\u751f\u6210\u5de5\u5177\u4f7f\u7528\u8bf4\u660e\n        return f\"\"\"\n        Available tools:\n        {self.format_tools_xml(tools)}\n\n        To use a tool, wrap your call in &lt;tool_call&gt; tags...\n        \"\"\"\n</code></pre> <ul> <li> <p>\u52a8\u6001\u5de5\u5177\u6ce8\u518c:</p> </li> <li> <p>\u652f\u6301\u8fd0\u884c\u65f6\u6ce8\u518c\u65b0\u5de5\u5177</p> </li> <li>\u81ea\u52a8\u751f\u6210\u5bf9\u5e94\u7684XML schema\u548c\u63d0\u793a\u8bcd</li> <li>\u5de5\u5177\u7248\u672c\u7ba1\u7406</li> </ul>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#7-robust-xml","title":"7. Robust XML\u89e3\u6790","text":"<p>\u539f\u59cb\u9700\u6c42: \u5065\u58ee\u7684XML\u89e3\u6790\u51fd\u6570</p> <p>\u5b9e\u65bd\u7ec6\u8282:</p> <ul> <li>\u591a\u5c42\u89e3\u6790\u7b56\u7565:</li> </ul> <pre><code>class RobustXMLParser:\n    def parse(self, text):\n        # 1. \u5c1d\u8bd5\u6807\u51c6XML\u89e3\u6790\n        try:\n            return self.standard_parse(text)\n        except:\n            pass\n\n        # 2. \u5c1d\u8bd5\u4fee\u590d\u5e38\u89c1\u9519\u8bef\n        fixed = self.fix_common_issues(text)\n        try:\n            return self.standard_parse(fixed)\n        except:\n            pass\n\n        # 3. \u4f7f\u7528\u6b63\u5219\u63d0\u53d6\n        return self.regex_fallback(text)\n\n    def fix_common_issues(self, text):\n        # \u4fee\u590d\u672a\u95ed\u5408\u6807\u7b7e\n        # \u8f6c\u4e49\u7279\u6b8a\u5b57\u7b26\n        # \u5904\u7406\u5d4c\u5957\u9519\u8bef\n        pass\n</code></pre> <ul> <li> <p>\u9519\u8bef\u6062\u590d\u673a\u5236:</p> </li> <li> <p>\u90e8\u5206\u89e3\u6790\u6210\u529f\u65f6\u8fd4\u56de\u53ef\u7528\u90e8\u5206</p> </li> <li>\u8bb0\u5f55\u89e3\u6790\u5931\u8d25\u7684\u8be6\u7ec6\u4fe1\u606f</li> <li> <p>\u63d0\u4f9b\u4fee\u590d\u5efa\u8bae</p> </li> <li> <p>\u9a8c\u8bc1\u5c42:</p> </li> <li> <p>Schema\u9a8c\u8bc1</p> </li> <li>\u4e1a\u52a1\u903b\u8f91\u9a8c\u8bc1</li> <li>\u5b89\u5168\u6027\u68c0\u67e5\uff08\u9632\u6b62\u6ce8\u5165\uff09</li> </ul>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#8-logging","title":"8. \u5b8c\u5584\u7684Logging\u7cfb\u7edf","text":"<p>\u539f\u59cb\u9700\u6c42: \u8ddf\u8e2a\u6240\u6709\u884c\u4e3a\uff1a\u6a21\u578bI/O\u3001token count\u3001\u5de5\u5177\u8c03\u7528</p> <p>\u5b9e\u65bd\u7ec6\u8282:</p> <ul> <li>\u5206\u5c42\u65e5\u5fd7\u67b6\u6784:</li> </ul> <pre><code>class MultiAgentLogger:\n    LEVELS = {\n        'SYSTEM': logging.CRITICAL,     # \u7cfb\u7edf\u7ea7\u4e8b\u4ef6\n        'AGENT': logging.INFO,          # Agent\u51b3\u7b56\n        'TOOL': logging.INFO,           # \u5de5\u5177\u8c03\u7528\n        'MODEL': logging.DEBUG,         # \u6a21\u578b\u4ea4\u4e92\n        'TOKEN': logging.DEBUG          # Token\u7edf\u8ba1\n    }\n</code></pre> <ul> <li>\u7ed3\u6784\u5316\u65e5\u5fd7\u683c\u5f0f:</li> </ul> <pre><code>{\n  \"timestamp\": \"2024-01-20T10:30:00Z\",\n  \"session_id\": \"sess_123\",\n  \"agent\": \"lead_agent\",\n  \"event_type\": \"model_call\",\n  \"model\": \"claude-3-opus\",\n  \"tokens\": {\n    \"input\": 1500,\n    \"output\": 800,\n    \"total\": 2300\n  },\n  \"cost\": 0.023,\n  \"duration_ms\": 2500,\n  \"metadata\": {...}\n}\n</code></pre> <ul> <li> <p>\u76d1\u63a7\u6307\u6807:</p> </li> <li> <p>\u5b9e\u65f6Token\u6d88\u8017\u7edf\u8ba1</p> </li> <li>API\u8c03\u7528\u5ef6\u8fdf\u76d1\u63a7</li> <li>\u9519\u8bef\u7387\u548c\u91cd\u8bd5\u7edf\u8ba1</li> <li> <p>\u4efb\u52a1\u5b8c\u6210\u65f6\u95f4\u5206\u6790</p> </li> <li> <p>\u65e5\u5fd7\u5b58\u50a8\u7b56\u7565:</p> </li> <li> <p>\u4f7f\u7528\u6587\u4ef6\u7cfb\u7edf\u5b58\u50a8\u6240\u6709\u65e5\u5fd7</p> </li> <li>\u6309\u65e5\u671f\u5206\u5272\u65e5\u5fd7\u6587\u4ef6\uff08\u5982\uff1a<code>logs/2024-01-20.json</code>\uff09</li> <li>\u53ef\u9009\u7684\u65e5\u5fd7\u8f6e\u8f6c\uff08\u5982\uff1a\u4fdd\u7559\u6700\u8fd130\u5929\uff09</li> </ul>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#9","title":"9. \u5de5\u5177\u6743\u9650\u63a7\u5236\u7cfb\u7edf","text":"<p>\u539f\u59cb\u9700\u6c42: \u5de5\u5177\u5305\u542b\u53ef\u9009\u7684permission\u63a5\u53e3</p> <p>\u5b9e\u65bd\u7ec6\u8282:</p> <ul> <li>\u6743\u9650\u7ea7\u522b\u5b9a\u4e49:</li> </ul> <pre><code>class PermissionLevel(Enum):\n    PUBLIC = 0      # \u65e0\u9700\u5ba1\u6279\n    NOTIFY = 1      # \u6267\u884c\u540e\u901a\u77e5\n    CONFIRM = 2     # \u6267\u884c\u524d\u786e\u8ba4\n    RESTRICTED = 3  # \u9700\u8981\u7279\u6b8a\u6388\u6743\n</code></pre> <ul> <li>\u5ba1\u6279\u6d41\u7a0b:</li> </ul> <pre><code>class ToolPermissionManager:\n    async def check_permission(self, tool, params, user):\n        level = tool.permission_level\n\n        if level == PermissionLevel.CONFIRM:\n            approval = await self.request_approval(\n                user, tool, params\n            )\n            if not approval:\n                raise PermissionDeniedError()\n\n        # \u8bb0\u5f55\u5ba1\u6279\u65e5\u5fd7\n        self.log_permission_check(...)\n</code></pre> <ul> <li> <p>\u7ec6\u7c92\u5ea6\u63a7\u5236:</p> </li> <li> <p>\u57fa\u4e8e\u7528\u6237\u89d2\u8272\u7684\u6743\u9650</p> </li> <li>\u57fa\u4e8e\u53c2\u6570\u7684\u6743\u9650\uff08\u5982\u6587\u4ef6\u8def\u5f84\u9650\u5236\uff09</li> <li>\u65f6\u95f4\u7a97\u53e3\u9650\u5236\uff08\u5982\u6bcf\u5c0f\u65f6\u6700\u591aN\u6b21\uff09</li> </ul>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#10-checkpoint","title":"10. Checkpoint\u673a\u5236","text":"<p>\u539f\u59cb\u9700\u6c42: \u652f\u6301checkpoint\u65ad\u70b9\u7eed\u4f20</p> <p>\u5b9e\u65bd\u7ec6\u8282:</p> <ul> <li>\u4f7f\u7528LangGraph\u5185\u5b58Checkpoint:</li> </ul> <pre><code>from langgraph.checkpoint.memory import MemorySaver\n\n# \u4f7f\u7528\u5185\u5b58\u5b58\u50a8checkpoint\nmemory = MemorySaver()\n\n# \u7f16\u8bd1\u65f6\u6307\u5b9acheckpointer\napp = workflow.compile(checkpointer=memory)\n\n# \u6062\u590dcheckpoint\nconfig = {\"configurable\": {\"thread_id\": \"session_123\"}}\nstate = app.get_state(config)\n\n# \u4ececheckpoint\u7ee7\u7eed\u6267\u884c\nresult = app.invoke(None, config)\n</code></pre> <ul> <li>\u7b80\u5355\u7684\u72b6\u6001\u7ba1\u7406:</li> </ul> <pre><code>class SimpleCheckpointManager:\n    def __init__(self):\n        self.checkpoints = {}  # \u5185\u5b58\u4e2d\u7684checkpoint\u5b58\u50a8\n\n    def save(self, thread_id, state):\n        \"\"\"\u4fdd\u5b58checkpoint\u5230\u5185\u5b58\"\"\"\n        self.checkpoints[thread_id] = {\n            'timestamp': datetime.now(),\n            'state': state,\n            'version': len(self.checkpoints.get(thread_id, []))\n        }\n\n    def load(self, thread_id):\n        \"\"\"\u4ece\u5185\u5b58\u52a0\u8f7dcheckpoint\"\"\"\n        return self.checkpoints.get(thread_id)\n\n    def clear(self, thread_id=None):\n        \"\"\"\u6e05\u7406checkpoint\"\"\"\n        if thread_id:\n            self.checkpoints.pop(thread_id, None)\n        else:\n            self.checkpoints.clear()\n</code></pre> <ul> <li> <p>\u6ce8\u610f\u4e8b\u9879:</p> </li> <li> <p>\u5185\u5b58\u5b58\u50a8\u9002\u5408\u5f00\u53d1\u548c\u6d4b\u8bd5\u73af\u5883</p> </li> <li>\u91cd\u542f\u670d\u52a1\u4f1a\u4e22\u5931\u6240\u6709checkpoint</li> <li>\u53ef\u6839\u636e\u9700\u8981\u540e\u7eed\u5347\u7ea7\u5230\u6301\u4e45\u5316\u5b58\u50a8</li> </ul>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#11","title":"11. \u9519\u8bef\u5904\u7406\u4e0e\u91cd\u8bd5\u673a\u5236","text":"<ul> <li>\u667a\u80fd\u91cd\u8bd5\u7b56\u7565:</li> </ul> <pre><code>from tenacity import retry, stop_after_attempt, wait_exponential\n\n@retry(\n    stop=stop_after_attempt(3),\n    wait=wait_exponential(multiplier=1, min=4, max=10)\n)\nasync def call_model_with_retry(prompt):\n    return await model.ainvoke(prompt)\n</code></pre> <ul> <li> <p>\u9519\u8bef\u5206\u7c7b\u5904\u7406:</p> </li> <li> <p>API\u9650\u6d41: \u6307\u6570\u9000\u907f\u91cd\u8bd5</p> </li> <li>\u7f51\u7edc\u9519\u8bef: \u5feb\u901f\u91cd\u8bd5</li> <li>\u89e3\u6790\u9519\u8bef: \u964d\u7ea7\u5230\u5907\u7528\u89e3\u6790\u5668</li> <li> <p>\u4e1a\u52a1\u9519\u8bef: \u8bb0\u5f55\u5e76\u8df3\u8fc7</p> </li> <li> <p>\u964d\u7ea7\u65b9\u6848:</p> </li> <li> <p>\u4e3b\u6a21\u578b\u5931\u8d25\u5207\u6362\u5907\u7528\u6a21\u578b</p> </li> <li>\u590d\u6742\u5de5\u5177\u5931\u8d25\u964d\u7ea7\u5230\u7b80\u5355\u7248\u672c</li> <li>\u5b8c\u6574\u641c\u7d22\u5931\u8d25\u964d\u7ea7\u5230\u5feb\u901f\u641c\u7d22</li> </ul>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#multi-agent-_1","title":"Multi-Agent\u7814\u7a76\u7cfb\u7edf - \u9879\u76ee\u6587\u4ef6\u7ed3\u6784","text":""},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#_13","title":"\ud83d\udcc1 \u5b8c\u6574\u76ee\u5f55\u6811","text":"<pre><code>multi-agent-research/\n\u251c\u2500\u2500 \ud83d\udcc4 README.md\n\u251c\u2500\u2500 \ud83d\udcc4 requirements.txt\n\u251c\u2500\u2500 \ud83d\udcc4 .env.example\n\u251c\u2500\u2500 \ud83d\udcc4 .gitignore\n\u251c\u2500\u2500 \ud83d\udcc4 Dockerfile                     # Docker\u955c\u50cf\u5b9a\u4e49\n\u251c\u2500\u2500 \ud83d\udcc4 docker-compose.yml             # Docker Compose\u914d\u7f6e\n\u251c\u2500\u2500 \ud83d\udcc4 config.yaml                    # \u2b50 \u5168\u5c40\u914d\u7f6e\u6587\u4ef6\n\u2502\n\u251c\u2500\u2500 \ud83d\udcc1 src/\n\u2502   \u251c\u2500\u2500 \ud83d\udcc4 __init__.py\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 \ud83d\udcc1 core/                      # \u2b50 \u6838\u5fc3\u6a21\u5757\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 __init__.py\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 graph.py               # LangGraph\u5de5\u4f5c\u6d41\u5b9a\u4e49\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 state.py               # \u72b6\u6001\u7ba1\u7406\u548c\u5b9a\u4e49\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 controller.py          # \u6267\u884c\u63a7\u5236\u5668(pause/resume/rollback)\n\u2502   \u2502   \u2514\u2500\u2500 \ud83d\udcc4 context_manager.py     # Context\u538b\u7f29\u548c\u7ba1\u7406\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 \ud83d\udcc1 agents/                    # \u2b50 Agent\u5b9e\u73b0\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 __init__.py\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 base.py                # BaseAgent\u62bd\u8c61\u7c7b\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 lead_agent.py          # Lead Agent\u5b9e\u73b0\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 search_agent.py        # Search Agent\u5b9e\u73b0\n\u2502   \u2502   \u2514\u2500\u2500 \ud83d\udcc4 crawl_agent.py         # Web Crawl Agent\u5b9e\u73b0\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 \ud83d\udcc1 tools/                     # \u5de5\u5177\u7cfb\u7edf\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 __init__.py\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 base.py                # BaseTool\u62bd\u8c61\u7c7b\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 registry.py            # \u5de5\u5177\u6ce8\u518c\u548c\u7ba1\u7406\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 prompt_generator.py    # XML\u63d0\u793a\u8bcd\u751f\u6210\u5668\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 permissions.py         # \u6743\u9650\u63a7\u5236\n\u2502   \u2502   \u2514\u2500\u2500 \ud83d\udcc1 implementations/       # \u5177\u4f53\u5de5\u5177\u5b9e\u73b0\n\u2502   \u2502       \u251c\u2500\u2500 \ud83d\udcc4 __init__.py\n\u2502   \u2502       \u251c\u2500\u2500 \ud83d\udcc4 web_search.py\n\u2502   \u2502       \u251c\u2500\u2500 \ud83d\udcc4 web_fetch.py\n\u2502   \u2502       \u2514\u2500\u2500 \ud83d\udcc4 artifact_ops.py    # Artifact\u64cd\u4f5c\u5de5\u5177\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 \ud83d\udcc1 models/                    # \u6a21\u578b\u63a5\u53e3\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 __init__.py\n\u2502   \u2502   \u2514\u2500\u2500 \ud83d\udcc4 llm.py                 # \u2b50 \u7edf\u4e00\u7684LLM\u63a5\u53e3(\u57fa\u4e8eLangChain)\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 \ud83d\udcc1 utils/                     # \u5de5\u5177\u51fd\u6570\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 __init__.py\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 xml_parser.py          # \u2b50 Robust XML\u89e3\u6790\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 logger.py              # \u65e5\u5fd7\u7cfb\u7edf\n\u2502   \u2502   \u2514\u2500\u2500 \ud83d\udcc4 retry.py               # \u91cd\u8bd5\u673a\u5236\n\u2502   \u2502\n\u2502   \u2514\u2500\u2500 \ud83d\udcc1 api/                       # API\u63a5\u53e3\u5c42\n\u2502       \u251c\u2500\u2500 \ud83d\udcc4 __init__.py\n\u2502       \u251c\u2500\u2500 \ud83d\udcc4 server.py              # FastAPI/Flask\u670d\u52a1\u5668\n\u2502       \u251c\u2500\u2500 \ud83d\udcc4 websocket.py          # WebSocket\u5904\u7406\n\u2502       \u251c\u2500\u2500 \ud83d\udcc4 routes.py              # API\u8def\u7531\u5b9a\u4e49\n\u2502       \u2514\u2500\u2500 \ud83d\udcc4 schemas.py             # Pydantic\u6a21\u578b\u5b9a\u4e49\n\u2502\n\u251c\u2500\u2500 \ud83d\udcc1 prompts/                       # \u63d0\u793a\u8bcd\u6a21\u677f\n\u2502   \u251c\u2500\u2500 \ud83d\udcc4 lead_agent.xml\n\u2502   \u251c\u2500\u2500 \ud83d\udcc4 search_agent.xml\n\u2502   \u2514\u2500\u2500 \ud83d\udcc4 tools_instruction.xml\n\u2502\n\u251c\u2500\u2500 \ud83d\udcc1 tests/                         # \u6d4b\u8bd5\u6587\u4ef6\n\u2502   \u251c\u2500\u2500 \ud83d\udcc4 __init__.py\n\u2502   \u251c\u2500\u2500 \ud83d\udcc4 conftest.py               # Pytest\u914d\u7f6e\n\u2502   \u251c\u2500\u2500 \ud83d\udcc1 unit/\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 test_xml_parser.py\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 test_context_manager.py\n\u2502   \u2502   \u2514\u2500\u2500 \ud83d\udcc4 test_tools.py\n\u2502   \u251c\u2500\u2500 \ud83d\udcc1 integration/\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 test_workflow.py\n\u2502   \u2502   \u2514\u2500\u2500 \ud83d\udcc4 test_agents.py\n\u2502   \u2514\u2500\u2500 \ud83d\udcc1 fixtures/                  # \u6d4b\u8bd5\u6570\u636e\n\u2502       \u251c\u2500\u2500 \ud83d\udcc4 sample_responses.json\n\u2502       \u2514\u2500\u2500 \ud83d\udcc4 mock_data.yaml\n\u2502\n\u251c\u2500\u2500 \ud83d\udcc1 logs/                          # \u65e5\u5fd7\u76ee\u5f55\n\u2502   \u2514\u2500\u2500 \ud83d\udcc4 .gitkeep\n\u2502\n\u251c\u2500\u2500 \ud83d\udcc1 examples/                      # \u793a\u4f8b\u4ee3\u7801\n\u2502   \u251c\u2500\u2500 \ud83d\udcc4 basic_research.py         # \u57fa\u7840\u7814\u7a76\u4efb\u52a1\u793a\u4f8b\n\u2502   \u251c\u2500\u2500 \ud83d\udcc4 with_interruption.py      # \u5e26\u4e2d\u65ad\u7684\u793a\u4f8b\n\u2502   \u2514\u2500\u2500 \ud83d\udcc4 custom_agent.py            # \u81ea\u5b9a\u4e49Agent\u793a\u4f8b\n\u2502\n\u2514\u2500\u2500 \ud83d\udcc1 docs/                          # \u6587\u6863\n    \u251c\u2500\u2500 \ud83d\udcc4 architecture.md            # \u67b6\u6784\u8bf4\u660e\n    \u251c\u2500\u2500 \ud83d\udcc4 api.md                     # API\u6587\u6863\n    \u2514\u2500\u2500 \ud83d\udcc4 deployment.md              # \u90e8\u7f72\u6307\u5357\n</code></pre>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#_14","title":"\ud83d\udcdd \u6a21\u5757\u8bf4\u660e","text":""},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#srccore","title":"\ud83c\udfaf \u6838\u5fc3\u6a21\u5757 (<code>src/core/</code>)","text":"<p>\u6838\u5fc3\u5de5\u4f5c\u6d41\u548c\u72b6\u6001\u7ba1\u7406\uff0c\u662f\u6574\u4e2a\u7cfb\u7edf\u7684\u9aa8\u67b6\u3002</p> <ul> <li>graph.py: LangGraph\u5de5\u4f5c\u6d41\u5b9a\u4e49\uff0c\u5305\u542b\u8282\u70b9\u3001\u8fb9\u3001\u6761\u4ef6\u8def\u7531\u7684\u914d\u7f6e</li> <li>state.py: \u5b9a\u4e49AgentState\u6570\u636e\u7ed3\u6784\uff0c\u7ba1\u7406\u5168\u5c40\u72b6\u6001</li> <li>controller.py: \u5b9e\u73b0pause/resume/rollback\u7b49\u63a7\u5236\u529f\u80fd</li> <li>context_manager.py: \u8d1f\u8d23context\u538b\u7f29\u3001\u622a\u65ad\u3001\u667a\u80fd\u7b5b\u9009</li> </ul>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#agent-srcagents","title":"\ud83e\udd16 Agent\u6a21\u5757 (<code>src/agents/</code>)","text":"<p>\u6240\u6709Agent\u7684\u5b9e\u73b0\uff0c\u9075\u5faa\u7edf\u4e00\u7684BaseAgent\u63a5\u53e3\u3002</p> <ul> <li>base.py: \u5b9a\u4e49BaseAgent\u62bd\u8c61\u7c7b\uff0c\u89c4\u8303Agent\u63a5\u53e3</li> <li>lead_agent.py: \u534f\u8c03\u8005\uff0c\u8d1f\u8d23\u4efb\u52a1\u5206\u89e3\u3001\u6d3e\u53d1\u3001\u7ed3\u679c\u6574\u5408</li> <li>search_agent.py: \u4fe1\u606f\u641c\u7d22\u4e13\u5bb6\uff0c\u8fd4\u56de\u7ed3\u6784\u5316\u641c\u7d22\u7ed3\u679c</li> <li>crawl_agent.py: \u6df1\u5ea6\u5185\u5bb9\u6293\u53d6\uff0c\u63d0\u53d6\u7f51\u9875\u8be6\u7ec6\u4fe1\u606f</li> </ul>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#srctools","title":"\ud83d\udd27 \u5de5\u5177\u7cfb\u7edf (<code>src/tools/</code>)","text":"<p>\u53ef\u6269\u5c55\u7684\u5de5\u5177\u6ce8\u518c\u548c\u8c03\u7528\u7cfb\u7edf\u3002</p> <ul> <li>registry.py: \u52a8\u6001\u6ce8\u518c\u5de5\u5177\uff0c\u7ba1\u7406\u5de5\u5177\u751f\u547d\u5468\u671f</li> <li>prompt_generator.py: \u6839\u636e\u5de5\u5177\u5b9a\u4e49\u81ea\u52a8\u751f\u6210XML\u683c\u5f0f\u7684\u63d0\u793a\u8bcd</li> <li>permissions.py: \u5b9e\u73b0\u5de5\u5177\u6743\u9650\u63a7\u5236\uff08PUBLIC/NOTIFY/CONFIRM/RESTRICTED\uff09</li> <li>implementations/: \u5177\u4f53\u5de5\u5177\u5b9e\u73b0\uff0c\u6bcf\u4e2a\u5de5\u5177\u90fd\u662f\u72ec\u7acb\u6a21\u5757</li> </ul>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#srcmodels","title":"\ud83e\udde0 \u6a21\u578b\u63a5\u53e3 (<code>src/models/</code>)","text":"<p>\u7edf\u4e00\u7684\u6a21\u578b\u8c03\u7528\u63a5\u53e3\uff0c\u57fa\u4e8eLangChain\u5b9e\u73b0\u3002</p> <ul> <li>llm.py</li> </ul> <p>: \u4f7f\u7528LangChain\u5c01\u88c5\uff0c\u652f\u6301OpenAI\u901a\u7528\u63a5\u53e3\u3001Qwen\u3001DeepSeek\u7b49\u6a21\u578b</p> <pre><code># \u793a\u4f8b\u4ee3\u7801\u7ed3\u6784\nfrom langchain_openai import ChatOpenAI\n\ndef get_model(model_type=\"openai\", **kwargs):\n    if model_type == \"openai\":\n        return ChatOpenAI(**kwargs)\n    elif model_type == \"qwen\":\n        return ChatOpenAI(\n            base_url=\"https://dashscope.aliyuncs.com/compatible-mode/v1\",\n            **kwargs\n        )\n    elif model_type == \"deepseek\":\n        return ChatOpenAI(\n            base_url=\"https://api.deepseek.com/v1\",\n            **kwargs\n        )\n</code></pre>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#srcutils","title":"\ud83d\udee0 \u5de5\u5177\u51fd\u6570 (<code>src/utils/</code>)","text":"<p>\u901a\u7528\u5de5\u5177\u51fd\u6570\uff0c\u88ab\u5176\u4ed6\u6a21\u5757\u590d\u7528\u3002</p> <ul> <li>xml_parser.py: \u4e09\u5c42\u89e3\u6790\u7b56\u7565\uff08\u6807\u51c6\u89e3\u6790\u2192\u4fee\u590d\u5e38\u89c1\u9519\u8bef\u2192\u6b63\u5219\u63d0\u53d6\uff09</li> <li>logger.py: \u7ed3\u6784\u5316\u65e5\u5fd7\uff0c\u652f\u6301\u4e0d\u540c\u7ea7\u522b\u548c\u6a21\u5757\u7684\u65e5\u5fd7\u8bb0\u5f55</li> <li>retry.py: \u667a\u80fd\u91cd\u8bd5\u673a\u5236\uff0c\u652f\u6301\u6307\u6570\u9000\u907f</li> <li>streaming.py: \u5904\u7406\u6d41\u5f0f\u54cd\u5e94\uff0c\u652f\u6301Lead Agent\u7684\u5b9e\u65f6\u8f93\u51fa</li> </ul>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#api-srcapi","title":"\ud83c\udf10 API\u5c42 (<code>src/api/</code>)","text":"<p>\u5bf9\u5916\u63a5\u53e3\uff0c\u652f\u6301REST API\u548cWebSocket\u3002</p> <ul> <li>server.py: \u4e3b\u670d\u52a1\u5668\u5165\u53e3\uff0c\u53ef\u9009FastAPI\u6216Flask</li> <li>websocket.py: \u5b9e\u65f6\u63a8\u9001\u4efb\u52a1\u72b6\u6001\u3001\u652f\u6301\u53cc\u5411\u901a\u4fe1</li> <li>routes.py: \u5b9a\u4e49\u6240\u6709API\u7aef\u70b9</li> <li>schemas.py: \u8bf7\u6c42/\u54cd\u5e94\u7684\u6570\u636e\u6a21\u578b\u9a8c\u8bc1</li> </ul>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#_15","title":"\ud83d\udccb \u914d\u7f6e\u548c\u6a21\u677f","text":"<ul> <li>config.yaml: \u96c6\u4e2d\u7ba1\u7406\u6240\u6709\u914d\u7f6e\uff08\u6a21\u578b\u914d\u7f6e\u3001\u5de5\u5177\u914d\u7f6e\u3001\u65e5\u5fd7\u7ea7\u522b\u7b49\uff09</li> <li>prompts/: XML\u683c\u5f0f\u7684\u63d0\u793a\u8bcd\u6a21\u677f\uff0c\u4fbf\u4e8e\u7ef4\u62a4\u548c\u7248\u672c\u63a7\u5236</li> </ul>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#_16","title":"\ud83d\ude80 \u5feb\u901f\u5f00\u59cb","text":"<pre><code># 1. \u5b89\u88c5\u4f9d\u8d56\npip install -r requirements.txt\n\n# 2. \u914d\u7f6e\u73af\u5883\u53d8\u91cf\ncp .env.example .env\n# \u7f16\u8f91.env\u6dfb\u52a0API keys\n\n# 3. \u4fee\u6539\u914d\u7f6e\n# \u7f16\u8f91config.yaml\u8bbe\u7f6e\u6a21\u578b\u548c\u5de5\u5177\n\n# 4. \u8fd0\u884c\u793a\u4f8b\npython examples/basic_research.py\n\n# 5. \u542f\u52a8API\u670d\u52a1\npython -m src.api.server\n</code></pre>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#_17","title":"\ud83d\udca1 \u8bbe\u8ba1\u539f\u5219","text":"<ol> <li>\u6a21\u5757\u5316: \u6bcf\u4e2a\u6a21\u5757\u804c\u8d23\u5355\u4e00\uff0c\u4fbf\u4e8e\u6d4b\u8bd5\u548c\u7ef4\u62a4</li> <li>\u53ef\u6269\u5c55: \u901a\u8fc7\u7ee7\u627fBaseAgent/BaseTool\u8f7b\u677e\u6dfb\u52a0\u65b0\u529f\u80fd</li> <li>\u914d\u7f6e\u9a71\u52a8: \u4e3b\u8981\u884c\u4e3a\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u63a7\u5236\uff0c\u65e0\u9700\u4fee\u6539\u4ee3\u7801</li> <li>\u7c7b\u578b\u5b89\u5168: \u4f7f\u7528Pydantic\u548c\u7c7b\u578b\u63d0\u793a\u786e\u4fdd\u6570\u636e\u6b63\u786e\u6027</li> <li>\u6613\u4e8e\u6d4b\u8bd5: \u6e05\u6670\u7684\u4f9d\u8d56\u6ce8\u5165\uff0c\u4fbf\u4e8eMock\u548c\u5355\u5143\u6d4b\u8bd5</li> </ol>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#_18","title":"\ud83d\udd11 \u5173\u952e\u6587\u4ef6\u6807\u6ce8\u8bf4\u660e","text":"<ul> <li>\u2b50 \u6807\u8bb0\u7684\u662f\u7cfb\u7edf\u6838\u5fc3\u6587\u4ef6\uff0c\u4f18\u5148\u5b9e\u73b0</li> <li>\u5176\u4ed6\u6587\u4ef6\u6839\u636e\u9700\u8981\u9010\u6b65\u6dfb\u52a0</li> <li>tests/\u548cdocs/\u53ef\u4ee5\u968f\u5f00\u53d1\u8fdb\u5ea6\u5b8c\u5584</li> </ul>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#_19","title":"\ud83d\udcdd \u6587\u4ef6\u521b\u5efa\u6b65\u9aa4","text":""},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#phase-1-1-2","title":"Phase 1: \u57fa\u7840\u8bbe\u65bd (\u7b2c1-2\u5929)","text":"<p>\u76ee\u6807: \u642d\u5efa\u9879\u76ee\u9aa8\u67b6\u548c\u57fa\u7840\u5de5\u5177</p> <ol> <li>\u9879\u76ee\u521d\u59cb\u5316</li> </ol> <pre><code># \u521b\u5efa\u76ee\u5f55\u7ed3\u6784\nmkdir -p src/{core,agents,tools,models,utils,api}\nmkdir -p {tests,logs,examples,docs,prompts}\n\n# \u521d\u59cb\u5316\u6587\u4ef6\ntouch requirements.txt .env.example .gitignore\ntouch Dockerfile docker-compose.yml config.yaml\n</code></pre> <ol> <li> <p>Utils\u6a21\u5757 (\u6700\u5148\u5b8c\u6210)</p> </li> <li> <p><code>utils/logger.py</code> - \u8bbe\u7f6e\u65e5\u5fd7\u683c\u5f0f\u548c\u6587\u4ef6\u8f93\u51fa</p> </li> <li><code>utils/xml_parser.py</code> - \u5b9e\u73b0robust\u7684XML\u89e3\u6790</li> <li><code>utils/retry.py</code> - \u57fa\u4e8etenacity\u7684\u91cd\u8bd5\u88c5\u9970\u5668</li> <li><code>utils/streaming.py</code> - \u5f02\u6b65\u6d41\u5904\u7406\u5de5\u5177</li> </ol>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#phase-2-2-3","title":"Phase 2: \u6a21\u578b\u5c42 (\u7b2c2-3\u5929)","text":"<p>\u76ee\u6807: \u5b9e\u73b0\u7edf\u4e00\u7684LLM\u8c03\u7528\u63a5\u53e3</p> <ol> <li> <p>Models\u6a21\u5757</p> </li> <li> <p><code>models/llm.py</code> - \u57fa\u4e8eLangChain\u5c01\u88c5\u591a\u6a21\u578b\u652f\u6301</p> </li> </ol> <pre><code># \u5173\u952e\u5b9e\u73b0\u70b9\uff1a\n- \u914d\u7f6e\u5316\u7684\u6a21\u578b\u521d\u59cb\u5316\n- \u7edf\u4e00\u7684\u8c03\u7528\u63a5\u53e3 (invoke/stream)\n- \u601d\u8003\u6a21\u578b\u7684\u54cd\u5e94\u89e3\u6790\n- Token\u8ba1\u6570\u548c\u6210\u672c\u7edf\u8ba1\n</code></pre>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#phase-3-3-4","title":"Phase 3: \u5de5\u5177\u7cfb\u7edf (\u7b2c3-4\u5929)","text":"<p>\u76ee\u6807: \u5b9e\u73b0XML\u5de5\u5177\u8c03\u7528\u6846\u67b6</p> <ol> <li>Tools\u57fa\u7840\u6846\u67b6</li> <li><code>tools/base.py</code> - BaseTool\u62bd\u8c61\u7c7b</li> <li><code>tools/registry.py</code> - \u5de5\u5177\u6ce8\u518c\u5668</li> <li><code>tools/prompt_generator.py</code> - XML\u63d0\u793a\u8bcd\u751f\u6210</li> <li><code>tools/permissions.py</code> - \u6743\u9650\u63a7\u5236\u7cfb\u7edf</li> <li>\u5177\u4f53\u5de5\u5177\u5b9e\u73b0</li> <li><code>tools/implementations/web_search.py</code></li> <li><code>tools/implementations/artifact_ops.py</code></li> </ol>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#phase-4-4-5","title":"Phase 4: \u6838\u5fc3\u5de5\u4f5c\u6d41 (\u7b2c4-5\u5929)","text":"<p>\u76ee\u6807: \u642d\u5efaLangGraph\u5de5\u4f5c\u6d41</p> <ol> <li>Core\u6a21\u5757</li> <li><code>core/state.py</code> - \u5b9a\u4e49AgentState</li> <li><code>core/graph.py</code> - LangGraph\u5de5\u4f5c\u6d41\u914d\u7f6e</li> <li><code>core/controller.py</code> - \u6267\u884c\u63a7\u5236\u5668</li> <li><code>core/context_manager.py</code> - Context\u7ba1\u7406</li> </ol>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#phase-5-agent-5-6","title":"Phase 5: Agent\u5b9e\u73b0 (\u7b2c5-6\u5929)","text":"<p>\u76ee\u6807: \u5b9e\u73b0\u5404\u7c7bAgent</p> <ol> <li>Agents\u6a21\u5757</li> <li><code>agents/base.py</code> - BaseAgent\u63a5\u53e3</li> <li><code>agents/lead_agent.py</code> - \u4e3b\u534f\u8c03Agent</li> <li><code>agents/search_agent.py</code> - \u641c\u7d22Agent</li> <li><code>agents/crawl_agent.py</code> - \u6293\u53d6Agent</li> </ol>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#phase-6-api-6-7","title":"Phase 6: API\u63a5\u53e3 (\u7b2c6-7\u5929)","text":"<p>\u76ee\u6807: \u5bf9\u5916\u670d\u52a1\u63a5\u53e3</p> <ol> <li>API\u6a21\u5757</li> <li><code>api/schemas.py</code> - Pydantic\u6570\u636e\u6a21\u578b</li> <li><code>api/server.py</code> - FastAPI\u5e94\u7528</li> <li><code>api/routes.py</code> - \u8def\u7531\u5b9a\u4e49</li> <li><code>api/websocket.py</code> - WebSocket\u652f\u6301</li> </ol>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#phase-7-7-8","title":"Phase 7: \u6d4b\u8bd5\u548c\u6587\u6863 (\u7b2c7-8\u5929)","text":"<p>\u76ee\u6807: \u5b8c\u5584\u6d4b\u8bd5\u548c\u6587\u6863</p> <ol> <li>\u6d4b\u8bd5\u7528\u4f8b</li> <li>\u5355\u5143\u6d4b\u8bd5 (utils, tools)</li> <li>\u96c6\u6210\u6d4b\u8bd5 (workflow, agents)</li> <li>\u8fd0\u884c\u73af\u5883</li> <li>\u5b8c\u5584Dockerfile</li> <li>\u7f16\u5199examples</li> <li>\u66f4\u65b0README</li> </ol>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#_20","title":"\ud83d\ude80 \u5feb\u901f\u9a8c\u8bc1\u6bcf\u4e2a\u9636\u6bb5","text":""},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#phase-1","title":"Phase 1 \u9a8c\u8bc1","text":"<pre><code># \u6d4b\u8bd5logger\nfrom src.utils.logger import get_logger\nlogger = get_logger(\"test\")\nlogger.info(\"Logger working!\")\n\n# \u6d4b\u8bd5XML\u89e3\u6790\nfrom src.utils.xml_parser import parse_xml\nresult = parse_xml(\"&lt;tool&gt;&lt;name&gt;test&lt;/name&gt;&lt;/tool&gt;\")\n</code></pre>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#phase-2","title":"Phase 2 \u9a8c\u8bc1","text":"<pre><code># \u6d4b\u8bd5\u6a21\u578b\u8c03\u7528\nfrom src.models.llm import get_model\nmodel = get_model(\"openai\", model=\"gpt-4\")\nresponse = model.invoke(\"Hello\")\n</code></pre>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#phase-3","title":"Phase 3 \u9a8c\u8bc1","text":"<pre><code># \u6d4b\u8bd5\u5de5\u5177\u6ce8\u518c\u548c\u8c03\u7528\nfrom src.tools.registry import ToolRegistry\nregistry = ToolRegistry()\nregistry.register(my_tool)\nprompt = registry.generate_prompt()\n</code></pre>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#phase-4","title":"Phase 4 \u9a8c\u8bc1","text":"<pre><code># \u6d4b\u8bd5\u57fa\u7840\u5de5\u4f5c\u6d41\nfrom src.core.graph import create_workflow\napp = create_workflow()\nresult = app.invoke({\"task\": \"test\"})\n</code></pre>"},{"location":"_archive/%E5%9F%BA%E4%BA%8EArtifact%E7%9A%84Multi-Agent%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/#phase-5","title":"Phase 5 \u9a8c\u8bc1","text":"<pre><code># \u7aef\u5230\u7aef\u6d4b\u8bd5\nfrom src.agents.lead_agent import LeadAgent\nagent = LeadAgent()\nresult = await agent.execute(\"\u7814\u7a76AI\u533b\u7597\")\n</code></pre>"},{"location":"_archive/frontend/01_persistence_design/","title":"ArtifactFlow \u6301\u4e45\u5316\u6539\u9020\u65b9\u6848","text":"<p>\u7248\u672c: v1.1 | \u4f18\u5148\u7ea7: P0\uff08API\u548c\u524d\u7aef\u7684\u524d\u7f6e\u4f9d\u8d56\uff09</p> <p>\u53d8\u66f4\u8bb0\u5f55\uff1a - v1.1: \u65b0\u589e\u53cc\u5c42\u5b58\u50a8\u7b56\u7565\u3001\u4f9d\u8d56\u6ce8\u5165\u89c4\u8303\u3001\u4e50\u89c2\u9501\u673a\u5236\u3001Checkpointer\u66ff\u6362\u65b9\u6848</p>"},{"location":"_archive/frontend/01_persistence_design/#1","title":"1. \u6539\u9020\u76ee\u6807","text":"<p>\u5c06\u5f53\u524d\u57fa\u4e8e\u5185\u5b58\u7684 <code>ConversationManager</code> \u548c <code>ArtifactStore</code> \u6539\u9020\u4e3a SQLite \u6301\u4e45\u5316\u5b58\u50a8\uff0c\u5b9e\u73b0\uff1a</p> <ol> <li>\u6570\u636e\u6301\u4e45\u5316\uff1a\u670d\u52a1\u91cd\u542f\u540e\u6570\u636e\u4e0d\u4e22\u5931</li> <li>\u89e3\u8026\u5b58\u50a8\uff1aConversation \u548c Artifact \u72ec\u7acb\u5b58\u50a8\uff0c\u901a\u8fc7 ID \u5173\u8054</li> <li>\u53ef\u6269\u5c55\u6027\uff1a\u4e3a\u540e\u7eed PostgreSQL \u8fc1\u79fb\u548c\u7528\u6237\u7cfb\u7edf\u9884\u7559\u63a5\u53e3</li> <li>\u6027\u80fd\u5e73\u8861\uff1a\u70ed\u6570\u636e\u5185\u5b58\u7f13\u5b58 + \u51b7\u6570\u636e\u6570\u636e\u5e93\u5b58\u50a8</li> <li>\ud83c\udd95 \u65e0\u72b6\u6001\u5316\uff1a\u652f\u6301\u5bb9\u5668\u5316\u6c34\u5e73\u6269\u5c55</li> </ol>"},{"location":"_archive/frontend/01_persistence_design/#2-dual-storage-strategy","title":"2. \ud83c\udd95 \u53cc\u5c42\u5b58\u50a8\u7b56\u7565 (Dual Storage Strategy)","text":""},{"location":"_archive/frontend/01_persistence_design/#21","title":"2.1 \u6838\u5fc3\u6982\u5ff5","text":"<p>\u7cfb\u7edf\u91c7\u7528\u53cc\u5c42\u5b58\u50a8\u67b6\u6784\uff0c\u660e\u786e\u533a\u5206\u4e24\u7c7b\u5b58\u50a8\u7684\u804c\u8d23\uff1a</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      \u53cc\u5c42\u5b58\u50a8\u67b6\u6784                                \u2502\n\u2502                                                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502    Application DB       \u2502    \u2502  LangGraph Checkpointer \u2502    \u2502\n\u2502  \u2502    (SQLite/Postgres)    \u2502    \u2502   (AsyncSqliteSaver)    \u2502    \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524    \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524    \u2502\n\u2502  \u2502 \u89d2\u8272: \"\u957f\u671f\u8bb0\u5fc6\"         \u2502    \u2502 \u89d2\u8272: \"\u77ed\u671f\u5de5\u4f5c\u53f0\"       \u2502    \u2502\n\u2502  \u2502 \u771f\u76f8\u6765\u6e90 (Source of Truth)\u2502   \u2502 \u6267\u884c\u72b6\u6001\u6682\u5b58            \u2502    \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524    \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524    \u2502\n\u2502  \u2502 \u804c\u8d23:                   \u2502    \u2502 \u804c\u8d23:                   \u2502    \u2502\n\u2502  \u2502 - UI \u5c55\u793a               \u2502    \u2502 - \u6267\u884c\u6808\u4fdd\u5b58            \u2502    \u2502\n\u2502  \u2502 - \u641c\u7d22\u548c\u5386\u53f2\u56de\u6eaf         \u2502    \u2502 - \u4e2d\u65ad/\u6062\u590d\u72b6\u6001         \u2502    \u2502\n\u2502  \u2502 - \u8de8\u4f1a\u8bdd\u6301\u4e45\u5316          \u2502    \u2502 - Agent \u53d8\u91cf\u72b6\u6001        \u2502    \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524    \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524    \u2502\n\u2502  \u2502 \u6570\u636e:                   \u2502    \u2502 \u6570\u636e:                   \u2502    \u2502\n\u2502  \u2502 - conversations         \u2502    \u2502 - thread states        \u2502    \u2502\n\u2502  \u2502 - messages              \u2502    \u2502 - interrupt values     \u2502    \u2502\n\u2502  \u2502 - artifacts             \u2502    \u2502 - agent memories       \u2502    \u2502\n\u2502  \u2502 - artifact_versions     \u2502    \u2502                         \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502              \u2502                              \u2502                   \u2502\n\u2502              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                   \u2502\n\u2502                         \u2502                                       \u2502\n\u2502              ExecutionController                                \u2502\n\u2502              (\u72b6\u6001\u6ce8\u5165 &amp; \u540c\u6b65)                                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"_archive/frontend/01_persistence_design/#22-state-injection","title":"2.2 \u72b6\u6001\u6ce8\u5165\u673a\u5236 (State Injection)","text":"<p>\u5173\u952e\u539f\u5219\uff1aApp DB \u662f\u771f\u76f8\u6765\u6e90\uff0cLangGraph Checkpointer \u4ec5\u7528\u4e8e\u6267\u884c\u8fc7\u7a0b\u3002</p> <p>\u5b9e\u73b0\u8981\u70b9\uff1a 1. \u6bcf\u6b21\u542f\u52a8\u65b0\u5bf9\u8bdd\u65f6\uff0c\u5f3a\u5236\u4ece App DB \u62c9\u53d6\u6e05\u6d17\u8fc7\u7684\u5386\u53f2\u8bb0\u5f55 2. \u5c06\u5386\u53f2\u8bb0\u5f55\u6ce8\u5165\u5230 Agent State \u7684 <code>conversation_history</code> \u5b57\u6bb5 3. \u8986\u76d6 LangGraph Checkpointer \u53ef\u80fd\u6b8b\u7559\u7684\u65e7\u6570\u636e</p> <pre><code># ExecutionController._execute_new_message() \u4e2d\u7684\u903b\u8f91\nasync def _execute_new_message(self, content, conversation_id, parent_message_id):\n    # 1. \u4ece App DB \u83b7\u53d6\u5bf9\u8bdd\u5386\u53f2\uff08\u771f\u76f8\u6765\u6e90\uff09\n    conversation_history = await self.conversation_manager.format_conversation_history_async(\n        conv_id=conversation_id,\n        to_message_id=parent_message_id\n    )\n\n    # 2. \u521b\u5efa\u65b0\u7684 thread_id\uff08\u6bcf\u6b21\u6267\u884c\u90fd\u662f\u65b0\u7ebf\u7a0b\uff09\n    thread_id = f\"thd-{uuid4().hex}\"\n\n    # 3. \u6784\u5efa\u521d\u59cb\u72b6\u6001\uff0c\u6ce8\u5165\u5386\u53f2\u8bb0\u5f55\n    initial_state = create_initial_state(\n        task=content,\n        conversation_history=conversation_history,  # \u6ce8\u5165\u5386\u53f2\n        thread_id=thread_id,\n        # ...\n    )\n\n    # 4. \u6267\u884c\u56fe\uff08Checkpointer \u53ea\u4fdd\u5b58\u672c\u6b21\u6267\u884c\u72b6\u6001\uff09\n    result = await self.graph.ainvoke(initial_state, config)\n</code></pre>"},{"location":"_archive/frontend/01_persistence_design/#23-thread","title":"2.3 \u5206\u652f\u5bf9\u8bdd\u7684 Thread \u7b56\u7565","text":"<p>\u5f53\u7528\u6237\u521b\u5efa\u5206\u652f\u65f6\uff1a</p> <ol> <li>App DB \u5c42\uff1a\u8bb0\u5f55\u6811\u72b6\u7ed3\u6784\uff08<code>messages.parent_id</code> \u6307\u5411\u5206\u652f\u70b9\uff09</li> <li>LangGraph \u5c42\uff1a\u521b\u5efa\u65b0\u7684 <code>thread_id</code></li> <li>\u72b6\u6001\u6ce8\u5165\uff1a\u5c06\u5206\u652f\u70b9\u4e4b\u524d\u7684\u5386\u53f2\u4f5c\u4e3a\u521d\u59cb\u72b6\u6001\u6ce8\u5165</li> </ol> <pre><code># \u5206\u652f\u521b\u5efa\u6d41\u7a0b\ndef create_branch(self, conv_id, parent_message_id, new_content):\n    # 1. \u83b7\u53d6\u4ece\u6839\u5230\u5206\u652f\u70b9\u7684\u5386\u53f2\n    history = self.conversation_manager.get_message_path(conv_id, parent_message_id)\n\n    # 2. \u521b\u5efa\u65b0\u7684 thread_id\uff08\u4e0d\u590d\u7528\u65e7\u5206\u652f\u7684\uff09\n    new_thread_id = f\"thd-{uuid4().hex}\"\n\n    # 3. \u6ce8\u5165\u5386\u53f2\u5230\u65b0\u6267\u884c\n    # ...\n</code></pre>"},{"location":"_archive/frontend/01_persistence_design/#3","title":"3. \ud83c\udd95 \u5f00\u53d1\u89c4\u8303","text":""},{"location":"_archive/frontend/01_persistence_design/#31","title":"3.1 \u4f9d\u8d56\u6ce8\u5165\u4e0e\u65e0\u72b6\u6001\u5316","text":"<p>\u5f3a\u5236\u8981\u6c42\uff1a\u5e9f\u5f03\u6240\u6709\u6a21\u5757\u7ea7\u5168\u5c40\u5355\u4f8b\u53d8\u91cf\u3002</p> <p>\u5e9f\u5f03\u6a21\u5f0f\uff08\u4e0d\u518d\u4f7f\u7528\uff09\uff1a <pre><code># \u274c \u65e7\u4ee3\u7801 - artifact_ops.py\n_artifact_store = ArtifactStore()\n\ndef get_artifact_store():\n    return _artifact_store\n</code></pre></p> <p>\u65b0\u6a21\u5f0f\uff1a <pre><code># \u2705 \u65b0\u4ee3\u7801 - \u901a\u8fc7\u6784\u9020\u51fd\u6570\u6ce8\u5165\nclass ArtifactManager:\n    def __init__(self, repository: ArtifactRepository):\n        self.repository = repository\n        self._cache = {}  # \u5b9e\u4f8b\u7ea7\u7f13\u5b58\n\n# \u2705 API \u5c42\u4f7f\u7528 FastAPI Depends\nfrom fastapi import Depends\n\ndef get_artifact_manager(\n    db: AsyncSession = Depends(get_db_session)\n) -&gt; ArtifactManager:\n    repo = ArtifactRepository(db)\n    return ArtifactManager(repo)\n</code></pre></p> <p>\u76ee\u7684\uff1a - \u786e\u4fdd\u5185\u5b58\u4e2d\u4e0d\u6b8b\u7559\u7528\u6237\u72b6\u6001 - \u652f\u6301\u5bb9\u5668\u5316\u6c34\u5e73\u6269\u5c55 (Horizontal Scaling) - \u4fbf\u4e8e\u5355\u5143\u6d4b\u8bd5\uff08\u53ef\u6ce8\u5165 Mock\uff09</p>"},{"location":"_archive/frontend/01_persistence_design/#32-orm","title":"3.2 ORM \u89c4\u8303","text":"<p>\u5f3a\u5236\u8981\u6c42\uff1a\u6240\u6709\u6570\u636e\u5e93\u64cd\u4f5c\u5fc5\u987b\u901a\u8fc7 SQLAlchemy ORM \u6a21\u578b\u8fdb\u884c\uff0c\u7981\u6b62\u539f\u751f SQL\u3002</p> <pre><code># \u274c \u7981\u6b62\nresult = await session.execute(text(\"SELECT * FROM conversations WHERE id = :id\"), {\"id\": conv_id})\n\n# \u2705 \u5fc5\u987b\u4f7f\u7528 ORM\nresult = await session.execute(\n    select(Conversation).where(Conversation.id == conv_id)\n)\n</code></pre> <p>\u76ee\u7684\uff1a\u786e\u4fdd\u4ece SQLite \u8fc1\u79fb\u5230 PostgreSQL \u65f6\u53ea\u9700\u66f4\u6539\u8fde\u63a5\u5b57\u7b26\u4e32\uff0c\u65e0\u9700\u91cd\u5199\u67e5\u8be2\u903b\u8f91\u3002</p>"},{"location":"_archive/frontend/01_persistence_design/#4-schema","title":"4. \u6570\u636e\u5e93 Schema \u8bbe\u8ba1","text":""},{"location":"_archive/frontend/01_persistence_design/#41","title":"4.1 \u6838\u5fc3\u539f\u5219","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      \u5173\u7cfb\u8bbe\u8ba1\u539f\u5219                            \u2502\n\u2502                                                             \u2502\n\u2502  Conversation \u25c4\u2500\u25001:1\u2500\u2500\u25ba ArtifactSession                    \u2502\n\u2502       \u2502                        \u2502                            \u2502\n\u2502       \u2502 1:N                    \u2502 1:N                        \u2502\n\u2502       \u25bc                        \u25bc                            \u2502\n\u2502   Messages                 Artifacts                        \u2502\n\u2502       \u2502                        \u2502                            \u2502\n\u2502       \u2502 tree structure         \u2502 1:N                        \u2502\n\u2502       \u25bc                        \u25bc                            \u2502\n\u2502   (parent_id)           ArtifactVersions                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"_archive/frontend/01_persistence_design/#42","title":"4.2 \u8868\u7ed3\u6784\u8bbe\u8ba1","text":""},{"location":"_archive/frontend/01_persistence_design/#1-conversations","title":"\u88681: <code>conversations</code>","text":"\u5b57\u6bb5 \u7c7b\u578b \u8bf4\u660e id TEXT PRIMARY KEY conversation_id\uff0c\u540c\u65f6\u4e5f\u662f\u5173\u8054\u7684 session_id active_branch TEXT \u5f53\u524d\u6d3b\u8dc3\u7684\u53f6\u5b50\u8282\u70b9 message_id created_at TIMESTAMP \u521b\u5efa\u65f6\u95f4 updated_at TIMESTAMP \u6700\u540e\u66f4\u65b0\u65f6\u95f4 user_id TEXT NULLABLE \u9884\u7559\uff1a\u7528\u6237ID\uff08Phase 2\uff09 title TEXT NULLABLE \u5bf9\u8bdd\u6807\u9898\uff08\u53ef\u7531\u9996\u6761\u6d88\u606f\u81ea\u52a8\u751f\u6210\uff09 metadata JSON \u6269\u5c55\u5143\u6570\u636e"},{"location":"_archive/frontend/01_persistence_design/#2-messages","title":"\u88682: <code>messages</code>","text":"\u5b57\u6bb5 \u7c7b\u578b \u8bf4\u660e id TEXT PRIMARY KEY message_id conversation_id TEXT FK \u6240\u5c5e\u5bf9\u8bdd parent_id TEXT NULLABLE \u7236\u6d88\u606fID\uff08\u5b9e\u73b0\u6811\u7ed3\u6784\uff09 content TEXT \u7528\u6237\u6d88\u606f\u5185\u5bb9 thread_id TEXT \u5173\u8054\u7684 LangGraph \u7ebf\u7a0bID graph_response TEXT NULLABLE Graph \u6700\u7ec8\u54cd\u5e94 created_at TIMESTAMP \u521b\u5efa\u65f6\u95f4 metadata JSON \u6269\u5c55\u5143\u6570\u636e\uff08\u53ef\u5b58\u50a8\u7b80\u5316\u7684\u6267\u884c\u6458\u8981\uff09"},{"location":"_archive/frontend/01_persistence_design/#3-artifact_sessions","title":"\u88683: <code>artifact_sessions</code>","text":"\u5b57\u6bb5 \u7c7b\u578b \u8bf4\u660e id TEXT PRIMARY KEY session_id\uff08\u4e0e conversation_id \u76f8\u540c\uff09 created_at TIMESTAMP \u521b\u5efa\u65f6\u95f4 updated_at TIMESTAMP \u6700\u540e\u66f4\u65b0\u65f6\u95f4"},{"location":"_archive/frontend/01_persistence_design/#4-artifacts","title":"\u88684: <code>artifacts</code> \ud83c\udd95 \u589e\u52a0\u4e50\u89c2\u9501\u5b57\u6bb5","text":"\u5b57\u6bb5 \u7c7b\u578b \u8bf4\u660e id TEXT artifact_id session_id TEXT FK \u6240\u5c5e\u4f1a\u8bdd content_type TEXT \u5185\u5bb9\u7c7b\u578b (markdown/python/etc) title TEXT \u6807\u9898 content TEXT \ud83c\udd95 \u5f53\u524d\u5185\u5bb9\uff08\u5197\u4f59\u5b58\u50a8\uff0c\u907f\u514d\u6bcf\u6b21\u67e5\u7248\u672c\u8868\uff09 current_version INTEGER \u5f53\u524d\u7248\u672c\u53f7 lock_version INTEGER DEFAULT 1 \ud83c\udd95 \u4e50\u89c2\u9501\u7248\u672c\u53f7 created_at TIMESTAMP \u521b\u5efa\u65f6\u95f4 updated_at TIMESTAMP \u6700\u540e\u66f4\u65b0\u65f6\u95f4 metadata JSON \u6269\u5c55\u5143\u6570\u636e PRIMARY KEY (id, session_id) \u590d\u5408\u4e3b\u952e"},{"location":"_archive/frontend/01_persistence_design/#5-artifact_versions","title":"\u88685: <code>artifact_versions</code>","text":"\u5b57\u6bb5 \u7c7b\u578b \u8bf4\u660e id INTEGER PRIMARY KEY AUTOINCREMENT \u81ea\u589eID artifact_id TEXT \u6240\u5c5e artifact session_id TEXT \u6240\u5c5e\u4f1a\u8bdd version INTEGER \u7248\u672c\u53f7 content TEXT \u7248\u672c\u5185\u5bb9 update_type TEXT \u66f4\u65b0\u7c7b\u578b (create/update/rewrite) changes JSON NULLABLE \u53d8\u66f4\u8bb0\u5f55 [(old, new), ...] created_at TIMESTAMP \u521b\u5efa\u65f6\u95f4 UNIQUE (artifact_id, session_id, version) \u552f\u4e00\u7ea6\u675f"},{"location":"_archive/frontend/01_persistence_design/#43","title":"4.3 \ud83c\udd95 \u4e50\u89c2\u9501\u673a\u5236","text":"<p>\u5b9e\u73b0\u65b9\u5f0f\uff1a <pre><code>class ArtifactRepository:\n    async def update_artifact(\n        self, \n        session_id: str, \n        artifact_id: str, \n        content: str,\n        expected_lock_version: int\n    ) -&gt; Artifact:\n        \"\"\"\n        \u66f4\u65b0 Artifact \u5185\u5bb9\uff08\u5e26\u4e50\u89c2\u9501\uff09\n\n        Raises:\n            VersionConflictError: \u7248\u672c\u51b2\u7a81\u65f6\u629b\u51fa\n        \"\"\"\n        result = await self.session.execute(\n            update(Artifact)\n            .where(\n                Artifact.id == artifact_id,\n                Artifact.session_id == session_id,\n                Artifact.lock_version == expected_lock_version  # \u4e50\u89c2\u9501\u68c0\u67e5\n            )\n            .values(\n                content=content,\n                current_version=Artifact.current_version + 1,\n                lock_version=Artifact.lock_version + 1,  # \u9012\u589e\u9501\u7248\u672c\n                updated_at=datetime.now()\n            )\n        )\n\n        if result.rowcount == 0:\n            raise VersionConflictError(\n                f\"Artifact {artifact_id} has been modified by another process\"\n            )\n\n        await self.session.commit()\n        return await self.get_artifact(session_id, artifact_id)\n</code></pre></p> <p>\u51b2\u7a81\u5904\u7406\u7b56\u7565\uff1a - Agent \u5de5\u5177\u8c03\u7528\u5931\u8d25\u65f6\uff0c\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\u8ba9 Agent \u51b3\u5b9a\u91cd\u8bd5\u6216\u8bfb\u53d6\u6700\u65b0\u7248 - \u524d\u7aef\u53ef\u5c55\u793a\u51b2\u7a81\u63d0\u793a\uff0c\u8ba9\u7528\u6237\u9009\u62e9\u4fdd\u7559\u54ea\u4e2a\u7248\u672c</p>"},{"location":"_archive/frontend/01_persistence_design/#5-langgraph-checkpointer","title":"5. \ud83c\udd95 LangGraph Checkpointer \u914d\u7f6e","text":""},{"location":"_archive/frontend/01_persistence_design/#51-memorysaver","title":"5.1 \u66ff\u6362 MemorySaver","text":"<p>\u5f53\u524d\u4ee3\u7801\uff08\u9700\u8981\u4fee\u6539\uff09\uff1a <pre><code># graph.py\nfrom langgraph.checkpoint.memory import MemorySaver\n\ndef compile(self, ...):\n    if checkpointer is None:\n        checkpointer = MemorySaver()  # \u274c \u5185\u5b58\u5b58\u50a8\uff0c\u91cd\u542f\u4e22\u5931\n</code></pre></p> <p>\u6539\u9020\u540e\uff1a <pre><code># graph.py\nfrom langgraph.checkpoint.sqlite.aio import AsyncSqliteSaver\n\nasync def compile(self, db_path: str = \"data/artifactflow.db\", ...):\n    if checkpointer is None:\n        # \u2705 \u4f7f\u7528 SQLite \u6301\u4e45\u5316\uff0c\u4e0e App DB \u5171\u4eab\u540c\u4e00\u6587\u4ef6\n        checkpointer = AsyncSqliteSaver.from_conn_string(\n            f\"sqlite+aiosqlite:///{db_path}\"\n        )\n</code></pre></p>"},{"location":"_archive/frontend/01_persistence_design/#52","title":"5.2 \u914d\u7f6e\u5efa\u8bae","text":"\u914d\u7f6e\u9879 \u63a8\u8350\u503c \u8bf4\u660e \u6570\u636e\u5e93\u6587\u4ef6 <code>data/artifactflow.db</code> \u4e0e App DB \u5171\u4eab\uff0c\u7b80\u5316\u90e8\u7f72 \u8fde\u63a5\u6c60\u5927\u5c0f 5 SQLite \u6709\u5199\u9501\u9650\u5236\uff0c\u4e0d\u5b9c\u8fc7\u5927 WAL \u6a21\u5f0f \u542f\u7528 \u63d0\u9ad8\u5e76\u53d1\u8bfb\u6027\u80fd <pre><code># database.py\nfrom sqlalchemy.ext.asyncio import create_async_engine\n\nengine = create_async_engine(\n    \"sqlite+aiosqlite:///data/artifactflow.db\",\n    echo=False,\n    pool_size=5,\n    connect_args={\"check_same_thread\": False}\n)\n\n# \u542f\u7528 WAL \u6a21\u5f0f\n@event.listens_for(engine.sync_engine, \"connect\")\ndef set_sqlite_pragma(dbapi_connection, connection_record):\n    cursor = dbapi_connection.cursor()\n    cursor.execute(\"PRAGMA journal_mode=WAL\")\n    cursor.close()\n</code></pre>"},{"location":"_archive/frontend/01_persistence_design/#6","title":"6. \u67b6\u6784\u8bbe\u8ba1","text":""},{"location":"_archive/frontend/01_persistence_design/#61","title":"6.1 \u5206\u5c42\u67b6\u6784","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     Application Layer                        \u2502\n\u2502         (ExecutionController, Agents, Tools)                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     Manager Layer (\u6539\u9020\u91cd\u70b9)                 \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502   \u2502 ConversationManager \u2502   \u2502    ArtifactManager      \u2502    \u2502\n\u2502   \u2502  - \u5185\u5b58\u7f13\u5b58\u70ed\u6570\u636e     \u2502   \u2502  - \u5185\u5b58\u7f13\u5b58\u70ed\u6570\u636e        \u2502    \u2502\n\u2502   \u2502  - \u8c03\u7528 Repository    \u2502   \u2502  - \u8c03\u7528 Repository       \u2502    \u2502\n\u2502   \u2502  - \ud83c\udd95 \u4f9d\u8d56\u6ce8\u5165        \u2502   \u2502  - \ud83c\udd95 \u4f9d\u8d56\u6ce8\u5165           \u2502    \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Repository Layer (\u65b0\u589e)                   \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502   \u2502ConversationRepository\u2502   \u2502  ArtifactRepository    \u2502    \u2502\n\u2502   \u2502  - CRUD \u64cd\u4f5c         \u2502   \u2502  - CRUD \u64cd\u4f5c            \u2502    \u2502\n\u2502   \u2502  - \u6811\u7ed3\u6784\u67e5\u8be2        \u2502   \u2502  - \u7248\u672c\u7ba1\u7406             \u2502    \u2502\n\u2502   \u2502  - \ud83c\udd95 ORM Only       \u2502   \u2502  - \ud83c\udd95 \u4e50\u89c2\u9501            \u2502    \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     Database Layer (\u65b0\u589e)                    \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502   \u2502                   DatabaseManager                    \u2502  \u2502\n\u2502   \u2502  - \u8fde\u63a5\u6c60\u7ba1\u7406                                        \u2502  \u2502\n\u2502   \u2502  - \u4e8b\u52a1\u7ba1\u7406                                          \u2502  \u2502\n\u2502   \u2502  - \ud83c\udd95 WAL \u6a21\u5f0f                                       \u2502  \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                           \u2502                                  \u2502\n\u2502              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                    \u2502\n\u2502              \u25bc                         \u25bc                    \u2502\n\u2502     App DB (SQLite)          LangGraph Checkpointer        \u2502\n\u2502     (conversations,          (AsyncSqliteSaver)            \u2502\n\u2502      messages, artifacts)    (thread states)               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"_archive/frontend/01_persistence_design/#62","title":"6.2 \u7f13\u5b58\u7b56\u7565","text":"<p>\u70ed\u6570\u636e\u5b9a\u4e49\uff1a - \u5f53\u524d\u6d3b\u8dc3\u7684 Conversation\uff08\u6700\u8fd1\u8bbf\u95ee\u7684 N \u4e2a\uff09 - \u5f53\u524d\u6d3b\u8dc3\u7684 ArtifactSession - \u6700\u8fd1\u4fee\u6539\u7684 Artifact \u5185\u5bb9</p> <p>\u7f13\u5b58\u5931\u6548\u7b56\u7565\uff1a - LRU \u6dd8\u6c70\uff1a\u7f13\u5b58\u5bb9\u91cf\u8fbe\u5230\u9608\u503c\u65f6\u6dd8\u6c70\u6700\u4e45\u672a\u4f7f\u7528\u7684\u6570\u636e - \u5199\u7a7f\u900f\uff1a\u5199\u64cd\u4f5c\u540c\u65f6\u66f4\u65b0\u7f13\u5b58\u548c\u6570\u636e\u5e93 - \u5ef6\u8fdf\u52a0\u8f7d\uff1a\u9996\u6b21\u8bbf\u95ee\u65f6\u4ece\u6570\u636e\u5e93\u52a0\u8f7d\u5230\u7f13\u5b58</p>"},{"location":"_archive/frontend/01_persistence_design/#7","title":"7. \u6587\u4ef6\u7ed3\u6784\u89c4\u5212","text":""},{"location":"_archive/frontend/01_persistence_design/#71","title":"7.1 \u65b0\u589e\u6587\u4ef6","text":"<pre><code>src/\n\u251c\u2500\u2500 db/                          # \u65b0\u589e\uff1a\u6570\u636e\u5e93\u5c42\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 database.py              # DatabaseManager\uff1a\u8fde\u63a5\u6c60\u3001\u4e8b\u52a1\u7ba1\u7406\n\u2502   \u251c\u2500\u2500 models.py                # SQLAlchemy ORM \u6a21\u578b\u5b9a\u4e49\n\u2502   \u2514\u2500\u2500 migrations/              # \u6570\u636e\u5e93\u8fc1\u79fb\u811a\u672c\n\u2502       \u251c\u2500\u2500 __init__.py\n\u2502       \u2514\u2500\u2500 versions/\n\u2502           \u2514\u2500\u2500 001_initial_schema.py\n\u2502\n\u251c\u2500\u2500 repositories/                # \u65b0\u589e\uff1a\u6570\u636e\u8bbf\u95ee\u5c42\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 base.py                  # BaseRepository \u62bd\u8c61\u7c7b\n\u2502   \u251c\u2500\u2500 conversation_repo.py     # ConversationRepository\n\u2502   \u2514\u2500\u2500 artifact_repo.py         # ArtifactRepository\n\u2502\n\u251c\u2500\u2500 core/\n\u2502   \u251c\u2500\u2500 conversation_manager.py  # \u6539\u9020\uff1a\u4ece controller.py \u5206\u79bb\n\u2502   \u2514\u2500\u2500 ... (\u5176\u4ed6\u6587\u4ef6)\n\u2502\n\u2514\u2500\u2500 tools/implementations/\n    \u2514\u2500\u2500 artifact_ops.py          # \u6539\u9020\uff1aArtifactStore \u2192 ArtifactManager\n</code></pre>"},{"location":"_archive/frontend/01_persistence_design/#72","title":"7.2 \u6539\u9020\u6587\u4ef6","text":"\u6587\u4ef6 \u6539\u9020\u5185\u5bb9 <code>controller.py</code> \u5c06 <code>ConversationManager</code> \u7c7b\u79fb\u51fa\u5230\u72ec\u7acb\u6587\u4ef6\uff0c\u6539\u4e3a\u4f7f\u7528 Repository <code>artifact_ops.py</code> \u5c06 <code>ArtifactStore</code> \u6539\u9020\u4e3a <code>ArtifactManager</code>\uff0c\u5e95\u5c42\u4f7f\u7528 Repository\uff0c\ud83c\udd95 \u79fb\u9664\u5168\u5c40\u5355\u4f8b <code>graph.py</code> \ud83c\udd95 \u66f4\u65b0 Checkpointer \u4e3a AsyncSqliteSaver <code>requirements.txt</code> \u6dfb\u52a0 <code>sqlalchemy&gt;=2.0</code>, <code>aiosqlite</code>"},{"location":"_archive/frontend/01_persistence_design/#8","title":"8. \u6838\u5fc3\u7c7b\u8bbe\u8ba1\u8981\u70b9","text":""},{"location":"_archive/frontend/01_persistence_design/#81-databasemanager","title":"8.1 DatabaseManager","text":"<p>\u804c\u8d23\uff1a - \u7ba1\u7406\u6570\u636e\u5e93\u8fde\u63a5\uff08\u652f\u6301\u5f02\u6b65\uff09 - \u63d0\u4f9b\u4e8b\u52a1\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668 - \u521d\u59cb\u5316\u6570\u636e\u5e93 schema - \ud83c\udd95 \u914d\u7f6e WAL \u6a21\u5f0f</p> <p>\u8bbe\u8ba1\u8981\u70b9\uff1a - \u4f7f\u7528 <code>aiosqlite</code> \u5b9e\u73b0\u5f02\u6b65 SQLite \u8bbf\u95ee - \u63d0\u4f9b\u540c\u6b65\u548c\u5f02\u6b65\u4e24\u79cd\u63a5\u53e3\uff08\u517c\u5bb9\u73b0\u6709\u4ee3\u7801\uff09 - \u6570\u636e\u5e93\u8def\u5f84\u53ef\u914d\u7f6e\uff08\u9ed8\u8ba4 <code>data/artifactflow.db</code>\uff09</p>"},{"location":"_archive/frontend/01_persistence_design/#82-conversationrepository","title":"8.2 ConversationRepository","text":"<p>\u804c\u8d23\uff1a - Conversation CRUD - Message CRUD - \u6811\u7ed3\u6784\u67e5\u8be2\uff08\u83b7\u53d6\u4ece\u6839\u5230\u6307\u5b9a\u8282\u70b9\u7684\u8def\u5f84\uff09</p> <p>\u5173\u952e\u65b9\u6cd5\uff1a <pre><code>- create_conversation(conv_id) \u2192 Conversation\n- get_conversation(conv_id) \u2192 Optional[Conversation]\n- add_message(conv_id, message) \u2192 Message\n- get_message_path(conv_id, to_message_id) \u2192 List[Message]\n- update_response(conv_id, message_id, response)\n- list_conversations(user_id=None, limit, offset) \u2192 List[Conversation]\n</code></pre></p>"},{"location":"_archive/frontend/01_persistence_design/#83-artifactrepository","title":"8.3 ArtifactRepository","text":"<p>\u804c\u8d23\uff1a - ArtifactSession CRUD - Artifact CRUD - \u7248\u672c\u7ba1\u7406 - \ud83c\udd95 \u4e50\u89c2\u9501\u5e76\u53d1\u63a7\u5236</p> <p>\u5173\u952e\u65b9\u6cd5\uff1a <pre><code>- create_session(session_id) \u2192 ArtifactSession\n- get_session(session_id) \u2192 Optional[ArtifactSession]\n- create_artifact(session_id, artifact_data) \u2192 Artifact\n- get_artifact(session_id, artifact_id) \u2192 Optional[Artifact]\n- update_artifact(session_id, artifact_id, content, expected_lock_version) \u2192 Artifact  # \ud83c\udd95 \u4e50\u89c2\u9501\n- save_version(session_id, artifact_id, version_data) \u2192 ArtifactVersion\n- get_version(session_id, artifact_id, version) \u2192 Optional[ArtifactVersion]\n- list_artifacts(session_id) \u2192 List[Artifact]\n</code></pre></p>"},{"location":"_archive/frontend/01_persistence_design/#84-conversationmanager","title":"8.4 ConversationManager\uff08\u6539\u9020\uff09","text":"<p>\u6539\u9020\u8981\u70b9\uff1a - \u4fdd\u6301\u73b0\u6709 API \u4e0d\u53d8\uff08\u5411\u540e\u517c\u5bb9\uff09 - \u5185\u90e8\u589e\u52a0 <code>ConversationRepository</code> \u4f9d\u8d56 - \u589e\u52a0\u5185\u5b58\u7f13\u5b58\u5c42\uff08<code>Dict[str, Conversation]</code>\uff09 - \u5199\u64cd\u4f5c\uff1a\u540c\u65f6\u66f4\u65b0\u7f13\u5b58\u548c\u6570\u636e\u5e93 - \u8bfb\u64cd\u4f5c\uff1a\u4f18\u5148\u4ece\u7f13\u5b58\u8bfb\u53d6\uff0cmiss \u65f6\u4ece\u6570\u636e\u5e93\u52a0\u8f7d - \ud83c\udd95 \u901a\u8fc7\u6784\u9020\u51fd\u6570\u6ce8\u5165\u4f9d\u8d56\uff0c\u4e0d\u4f7f\u7528\u5168\u5c40\u5355\u4f8b</p> <p>\u7f13\u5b58\u7ba1\u7406\uff1a <pre><code>- \u6700\u5927\u7f13\u5b58 conversation \u6570\u91cf\uff1a100\uff08\u53ef\u914d\u7f6e\uff09\n- \u6dd8\u6c70\u7b56\u7565\uff1aLRU\n- \u63d0\u4f9b `load_conversation(conv_id)` \u65b9\u6cd5\u663e\u5f0f\u52a0\u8f7d\u5230\u7f13\u5b58\n- \u63d0\u4f9b `evict_conversation(conv_id)` \u65b9\u6cd5\u624b\u52a8\u6dd8\u6c70\n</code></pre></p>"},{"location":"_archive/frontend/01_persistence_design/#85-artifactmanager-artifactstore","title":"8.5 ArtifactManager\uff08\u539f ArtifactStore \u6539\u9020\uff09","text":"<p>\u6539\u9020\u8981\u70b9\uff1a - \u4fdd\u6301\u73b0\u6709\u5de5\u5177\u8c03\u7528 API \u4e0d\u53d8 - \u5185\u90e8\u589e\u52a0 <code>ArtifactRepository</code> \u4f9d\u8d56 - \u589e\u52a0\u5185\u5b58\u7f13\u5b58\uff08\u5f53\u524d\u6d3b\u8dc3 session \u7684 artifacts\uff09 - <code>Artifact.update()</code> \u4e2d\u7684 diff-match-patch \u903b\u8f91\u4fdd\u6301\u4e0d\u53d8 - \u7248\u672c\u4fdd\u5b58\u65f6\u540c\u6b65\u5199\u5165\u6570\u636e\u5e93 - \ud83c\udd95 \u901a\u8fc7\u6784\u9020\u51fd\u6570\u6ce8\u5165\u4f9d\u8d56\uff0c\u4e0d\u4f7f\u7528\u5168\u5c40\u5355\u4f8b - \ud83c\udd95 \u66f4\u65b0\u64cd\u4f5c\u4f7f\u7528\u4e50\u89c2\u9501</p>"},{"location":"_archive/frontend/01_persistence_design/#9","title":"9. \u5b9e\u65bd\u6b65\u9aa4","text":""},{"location":"_archive/frontend/01_persistence_design/#phase-1-2-3","title":"Phase 1: \u57fa\u7840\u8bbe\u65bd\uff08\u9884\u8ba1 2-3 \u5929\uff09","text":"<ol> <li>\u521b\u5efa <code>db/</code> \u6a21\u5757</li> <li>\u5b9e\u73b0 <code>DatabaseManager</code>\uff08\u542b WAL \u914d\u7f6e\uff09</li> <li>\u7f16\u5199 SQLAlchemy ORM \u6a21\u578b\uff08\u542b <code>lock_version</code> \u5b57\u6bb5\uff09</li> <li>\u7f16\u5199\u521d\u59cb\u5316 migration</li> <li> <p>\ud83c\udd95 \u914d\u7f6e AsyncSqliteSaver \u4e0e App DB \u5171\u4eab</p> </li> <li> <p>\u521b\u5efa <code>repositories/</code> \u6a21\u5757</p> </li> <li>\u5b9e\u73b0 <code>BaseRepository</code></li> <li>\u5b9e\u73b0 <code>ConversationRepository</code></li> <li> <p>\u5b9e\u73b0 <code>ArtifactRepository</code>\uff08\u542b\u4e50\u89c2\u9501\uff09</p> </li> <li> <p>\u7f16\u5199\u5355\u5143\u6d4b\u8bd5</p> </li> <li>Repository \u5c42\u7684 CRUD \u6d4b\u8bd5</li> <li>\u6811\u7ed3\u6784\u67e5\u8be2\u6d4b\u8bd5</li> <li>\ud83c\udd95 \u4e50\u89c2\u9501\u51b2\u7a81\u6d4b\u8bd5</li> </ol>"},{"location":"_archive/frontend/01_persistence_design/#phase-2-manager-2-3","title":"Phase 2: Manager \u5c42\u6539\u9020\uff08\u9884\u8ba1 2-3 \u5929\uff09","text":"<ol> <li>\u5206\u79bb ConversationManager</li> <li>\u4ece <code>controller.py</code> \u79fb\u51fa\u5230\u72ec\u7acb\u6587\u4ef6</li> <li>\u6dfb\u52a0 Repository \u4f9d\u8d56\u6ce8\u5165</li> <li>\u5b9e\u73b0\u7f13\u5b58\u903b\u8f91</li> <li> <p>\ud83c\udd95 \u79fb\u9664\u5168\u5c40\u5355\u4f8b\u6a21\u5f0f</p> </li> <li> <p>\u6539\u9020 ArtifactStore \u2192 ArtifactManager</p> </li> <li>\u91cd\u6784\u4e3a\u4f7f\u7528 Repository</li> <li>\u4fdd\u6301 <code>Artifact</code> \u7c7b\u7684\u6838\u5fc3\u903b\u8f91\u4e0d\u53d8</li> <li>\u5b9e\u73b0\u7f13\u5b58\u903b\u8f91</li> <li>\ud83c\udd95 \u79fb\u9664\u5168\u5c40\u5355\u4f8b <code>_artifact_store</code></li> <li> <p>\ud83c\udd95 \u96c6\u6210\u4e50\u89c2\u9501</p> </li> <li> <p>\u66f4\u65b0\u4f9d\u8d56\u65b9</p> </li> <li><code>controller.py</code> \u4f7f\u7528\u65b0\u7684 ConversationManager</li> <li><code>graph.py</code> \u4f7f\u7528\u65b0\u7684 ArtifactManager</li> <li> <p>\ud83c\udd95 <code>graph.py</code> \u66ff\u6362 MemorySaver \u4e3a AsyncSqliteSaver</p> </li> <li> <p>\u96c6\u6210\u6d4b\u8bd5</p> </li> <li>\u8fd0\u884c\u73b0\u6709\u7684 <code>core_graph_test.py</code> \u786e\u4fdd\u529f\u80fd\u6b63\u5e38</li> <li>\u6dfb\u52a0\u6301\u4e45\u5316\u76f8\u5173\u7684\u6d4b\u8bd5\u7528\u4f8b</li> </ol>"},{"location":"_archive/frontend/01_persistence_design/#phase-3-1-2","title":"Phase 3: \u4f18\u5316\u548c\u6e05\u7406\uff08\u9884\u8ba1 1-2 \u5929\uff09","text":"<ol> <li>\u6027\u80fd\u4f18\u5316</li> <li>\u6dfb\u52a0\u6570\u636e\u5e93\u7d22\u5f15</li> <li> <p>\u4f18\u5316\u6279\u91cf\u67e5\u8be2</p> </li> <li> <p>\u914d\u7f6e\u5916\u90e8\u5316</p> </li> <li>\u6570\u636e\u5e93\u8def\u5f84\u914d\u7f6e</li> <li> <p>\u7f13\u5b58\u5927\u5c0f\u914d\u7f6e</p> </li> <li> <p>\u6e05\u7406\u5de5\u4f5c</p> </li> <li>\u79fb\u9664\u65e7\u7684\u5185\u5b58\u5b58\u50a8\u4ee3\u7801</li> <li>\u66f4\u65b0\u6587\u6863</li> </ol>"},{"location":"_archive/frontend/01_persistence_design/#10","title":"10. \u540e\u7eed\u6269\u5c55\u9884\u7559","text":""},{"location":"_archive/frontend/01_persistence_design/#101-phase-2","title":"10.1 \u7528\u6237\u7cfb\u7edf\uff08Phase 2\uff09","text":"<p>\u9884\u7559\u8bbe\u8ba1\uff1a - <code>conversations</code> \u8868\u7684 <code>user_id</code> \u5b57\u6bb5 - <code>artifact_sessions</code> \u8868\u6dfb\u52a0 <code>user_id</code> \u5b57\u6bb5 - Repository \u65b9\u6cd5\u652f\u6301 <code>user_id</code> \u8fc7\u6ee4</p> <p>\u8fc1\u79fb\u8def\u5f84\uff1a 1. \u6dfb\u52a0 <code>users</code> \u8868 2. \u4e3a\u73b0\u6709\u6570\u636e\u6dfb\u52a0\u9ed8\u8ba4 user_id 3. \u66f4\u65b0 Repository \u67e5\u8be2\u65b9\u6cd5 4. \u66f4\u65b0 Manager \u5c42\u4f20\u9012 user_id</p>"},{"location":"_archive/frontend/01_persistence_design/#102-postgresql","title":"10.2 PostgreSQL \u8fc1\u79fb","text":"<p>\u9884\u7559\u8bbe\u8ba1\uff1a - \u4f7f\u7528 SQLAlchemy ORM\uff08\u6570\u636e\u5e93\u65e0\u5173\uff09 - Repository \u5c42\u62bd\u8c61\u6570\u636e\u5e93\u64cd\u4f5c - \u4f7f\u7528 Alembic \u7ba1\u7406 migrations - \ud83c\udd95 ORM Only \u89c4\u8303\u786e\u4fdd\u8fc1\u79fb\u65e0\u75db</p> <p>\u8fc1\u79fb\u8def\u5f84\uff1a 1. \u4fee\u6539 <code>DatabaseManager</code> \u8fde\u63a5\u5b57\u7b26\u4e32 2. \u8fd0\u884c migration 3. \u6570\u636e\u8fc1\u79fb\u811a\u672c</p>"},{"location":"_archive/frontend/01_persistence_design/#11","title":"11. \u6ce8\u610f\u4e8b\u9879","text":""},{"location":"_archive/frontend/01_persistence_design/#111","title":"11.1 \u5e76\u53d1\u5b89\u5168","text":"<ul> <li>SQLite \u5728\u5199\u5165\u65f6\u6709\u9501\uff0c\u9700\u8981\u6ce8\u610f\u5e76\u53d1\u573a\u666f</li> <li>\u5efa\u8bae\u4f7f\u7528 WAL \u6a21\u5f0f\u63d0\u9ad8\u5e76\u53d1\u6027\u80fd</li> <li>\ud83c\udd95 \u4f7f\u7528\u4e50\u89c2\u9501\u5904\u7406 Artifact \u5e76\u53d1\u66f4\u65b0</li> <li>\u5bf9\u4e8e\u9ad8\u5e76\u53d1\u573a\u666f\uff0c\u8003\u8651\u76f4\u63a5\u4f7f\u7528 PostgreSQL</li> </ul>"},{"location":"_archive/frontend/01_persistence_design/#112","title":"11.2 \u6570\u636e\u4e00\u81f4\u6027","text":"<ul> <li>\u7f13\u5b58\u548c\u6570\u636e\u5e93\u53ef\u80fd\u51fa\u73b0\u4e0d\u4e00\u81f4</li> <li>\u5173\u952e\u5199\u64cd\u4f5c\u4f7f\u7528\u4e8b\u52a1</li> <li>\u63d0\u4f9b\u5f3a\u5236\u5237\u65b0\u7f13\u5b58\u7684\u63a5\u53e3</li> <li>\ud83c\udd95 App DB \u662f\u771f\u76f8\u6765\u6e90\uff0cLangGraph Checkpointer \u4ec5\u7528\u4e8e\u6267\u884c</li> </ul>"},{"location":"_archive/frontend/01_persistence_design/#113","title":"11.3 \u5411\u540e\u517c\u5bb9","text":"<ul> <li>\u6240\u6709 public API \u4fdd\u6301\u4e0d\u53d8</li> <li>\u73b0\u6709\u6d4b\u8bd5\u5e94\u8be5\u5168\u90e8\u901a\u8fc7</li> <li>\u901a\u8fc7\u4f9d\u8d56\u6ce8\u5165\u652f\u6301\u6d4b\u8bd5\u65f6\u4f7f\u7528\u5185\u5b58\u6570\u636e\u5e93</li> </ul>"},{"location":"_archive/frontend/01_persistence_design/#12","title":"12. \u4f9d\u8d56\u6e05\u5355","text":"<pre><code># \u65b0\u589e\u4f9d\u8d56\nsqlalchemy&gt;=2.0.0\naiosqlite&gt;=0.19.0\nalembic&gt;=1.12.0  # \u53ef\u9009\uff1a\u7528\u4e8e\u751f\u4ea7\u73af\u5883\u7684\u6570\u636e\u5e93\u8fc1\u79fb\u7ba1\u7406\nlanggraph-checkpoint-sqlite&gt;=1.0.0  # \ud83c\udd95 LangGraph SQLite Checkpointer\n</code></pre>"},{"location":"_archive/frontend/01_persistence_design/#_1","title":"\u9644\u5f55\uff1a\u67b6\u6784\u6f14\u8fdb\u8def\u7ebf\u56fe","text":"<ol> <li>Phase 1 (\u5f53\u524d\u76ee\u6807)\uff1a\u5355\u673a Docker + SQLite</li> <li>\u5b9e\u73b0\u53cc\u5c42\u5b58\u50a8\uff0c\u786e\u4fdd\u6570\u636e\u4e0d\u4e22\u5931</li> <li>\u5b9e\u73b0\u4e50\u89c2\u9501\uff0c\u786e\u4fdd Artifact \u6570\u636e\u4e00\u81f4</li> <li> <p>\u4ee3\u7801\u5168\u5f02\u6b65\u5316\uff0c\u4f7f\u7528\u4f9d\u8d56\u6ce8\u5165</p> </li> <li> <p>Phase 2 (\u5c11\u91cf\u5e76\u53d1)\uff1a\u5206\u79bb\u6570\u636e\u5e93</p> </li> <li>SQLite \u2192 PostgreSQL \u5bb9\u5668</li> <li> <p>\u5229\u7528 ORM \u4f18\u52bf\u5e73\u6ed1\u8fc1\u79fb</p> </li> <li> <p>Phase 3 (\u751f\u4ea7\u5e76\u53d1)\uff1a\u6c34\u5e73\u6269\u5c55</p> </li> <li>Nginx \u8d1f\u8f7d\u5747\u8861 + \u591a\u5b9e\u4f8b API \u5bb9\u5668</li> <li>\u5f15\u5165 Redis \u505a\u5206\u5e03\u5f0f\u7f13\u5b58\u548c\u9501</li> </ol>"},{"location":"_archive/frontend/02_api_design/","title":"ArtifactFlow API \u5c42\u5b9e\u73b0\u65b9\u6848","text":"<p>\u7248\u672c: v1.5 | \u4f9d\u8d56: \u6301\u4e45\u5316\u6539\u9020\u5b8c\u6210</p> <p>v1.5 \u66f4\u65b0\uff1a - \u65b0\u589e Section 4.4\uff1a\u7edf\u4e00\u7684 StreamEventType \u4e8b\u4ef6\u7c7b\u578b\u8bbe\u8ba1 - \u65b0\u589e Section 4.5\uff1aExecutionMetrics \u53ef\u89c2\u6d4b\u6027\u6307\u6807\u8bbe\u8ba1 - \u66f4\u65b0 Section 4.3\uff1a\u6d41\u5f0f\u63a5\u53e3\u4e8b\u4ef6\u683c\u5f0f\u66f4\u65b0</p> <p>v1.4 \u66f4\u65b0\uff1a - \u66f4\u65b0 Section 6.2\uff1aCheckpointer \u4ece MemorySaver \u6539\u4e3a AsyncSqliteSaver - \u66f4\u65b0 Section 6.5\uff1a\u5e76\u53d1\u5b89\u5168\u8868\u66f4\u65b0 Checkpointer \u8bf4\u660e - <code>create_multi_agent_graph</code> \u6539\u4e3a async \u51fd\u6570</p> <p>v1.3 \u66f4\u65b0\uff1a - \u66f4\u65b0 Section 4.1\uff1aResume \u63a5\u53e3\u6539\u4e3a\u65e0\u72b6\u6001\u8bbe\u8ba1\uff08\u9700\u8981\u4f20\u5165 <code>message_id</code>\uff09</p> <p>v1.2 \u66f4\u65b0\uff1a - \u65b0\u589e Section 6.5\uff1a\u6570\u636e\u5e93\u4f1a\u8bdd\u4e0e\u4e8b\u52a1\u7ba1\u7406\uff08\u5e76\u53d1\u5b89\u5168\u8bbe\u8ba1\uff09 - \u66f4\u65b0 Section 6.2\uff1a\u5b8c\u6574\u7684\u4f9d\u8d56\u6ce8\u5165\u793a\u4f8b\uff08\u542b\u8bf7\u6c42\u7ea7\u522b session \u9694\u79bb\uff09</p> <p>v1.1 \u66f4\u65b0\uff1a - \u65b0\u589e Section 2.1\uff1a\u5168\u94fe\u8def\u5f02\u6b65 I/O \u5f00\u53d1\u6807\u51c6 - \u65b0\u589e Section 6.4\uff1a\u4e8b\u4ef6\u7f13\u51b2\u961f\u5217\u8bbe\u8ba1\uff08\u542b TTL \u673a\u5236\uff09 - \u66f4\u65b0 Section 7.2\uff1a\u660e\u786e SSE \u8fde\u63a5\u751f\u547d\u5468\u671f\u7ba1\u7406</p>"},{"location":"_archive/frontend/02_api_design/#1","title":"1. \u8bbe\u8ba1\u76ee\u6807","text":"<p>\u4e3a\u524d\u7aef\u63d0\u4f9b\u5b8c\u6574\u7684 API \u63a5\u53e3\uff0c\u652f\u6301\uff1a</p> <ol> <li>\u6d41\u5f0f\u8f93\u51fa\uff1a\u5b9e\u65f6\u63a8\u9001 Agent \u6267\u884c\u8fc7\u7a0b\uff08LLM \u8f93\u51fa\u3001\u5de5\u5177\u8c03\u7528\u3001\u6743\u9650\u8bf7\u6c42\uff09</li> <li>CRUD \u64cd\u4f5c\uff1a\u5bf9\u8bdd\u7ba1\u7406\u3001Artifact \u7ba1\u7406</li> <li>\u72b6\u6001\u540c\u6b65\uff1aArtifact \u7248\u672c\u83b7\u53d6\u3001\u5bf9\u8bdd\u6811\u67e5\u8be2</li> <li>\u6269\u5c55\u9884\u7559\uff1a\u7528\u6237\u8ba4\u8bc1\u63a5\u53e3\u9884\u7559</li> </ol>"},{"location":"_archive/frontend/02_api_design/#2","title":"2. \u6280\u672f\u9009\u578b","text":"\u7ec4\u4ef6 \u9009\u578b \u7406\u7531 Web \u6846\u67b6 FastAPI \u539f\u751f\u5f02\u6b65\u3001\u81ea\u52a8 OpenAPI \u6587\u6863\u3001\u7c7b\u578b\u5b89\u5168 \u6d41\u5f0f\u4f20\u8f93 SSE (Server-Sent Events) \u5355\u5411\u63a8\u9001\u8db3\u591f\u3001\u6bd4 WebSocket \u7b80\u5355\u3001\u81ea\u52a8\u91cd\u8fde \u5e8f\u5217\u5316 Pydantic v2 \u4e0e FastAPI \u6df1\u5ea6\u96c6\u6210\u3001\u6027\u80fd\u4f18\u79c0 CORS fastapi.middleware.cors \u652f\u6301\u524d\u7aef\u8de8\u57df\u8bbf\u95ee <p>\u4e3a\u4ec0\u4e48\u9009 SSE \u800c\u4e0d\u662f WebSocket\uff1a - \u5f53\u524d\u9700\u6c42\u662f\u5355\u5411\u63a8\u9001\uff08Server \u2192 Client\uff09 - SSE \u66f4\u8f7b\u91cf\uff0c\u81ea\u5e26\u91cd\u8fde\u673a\u5236 - \u6d4f\u89c8\u5668\u539f\u751f\u652f\u6301 EventSource API - \u5982\u679c\u540e\u7eed\u9700\u8981\u53cc\u5411\u901a\u4fe1\uff08\u5982\u534f\u4f5c\u7f16\u8f91\uff09\uff0c\u518d\u5f15\u5165 WebSocket</p>"},{"location":"_archive/frontend/02_api_design/#21-io","title":"2.1 \u5168\u94fe\u8def\u5f02\u6b65 I/O \u5f00\u53d1\u6807\u51c6 \ud83c\udd95","text":"<p>\u6838\u5fc3\u539f\u5219\uff1a\u9632\u6b62\u5355\u4e2a\u8017\u65f6\u64cd\u4f5c\uff08\u5982 LLM \u63a8\u7406\u3001\u7f51\u9875\u722c\u53d6\uff09\u963b\u585e Worker \u8fdb\u7a0b\uff0c\u5bfc\u81f4\u9ad8\u5e76\u53d1\u4e0b\u7cfb\u7edf\u5047\u6b7b\u3002</p> <p>\u5f3a\u5236\u8981\u6c42\uff1a</p> \u64cd\u4f5c\u7c7b\u578b \u2705 \u5fc5\u987b\u4f7f\u7528 \u274c \u7981\u6b62\u4f7f\u7528 HTTP \u8bf7\u6c42 <code>httpx.AsyncClient</code> <code>requests</code> \u6570\u636e\u5e93 <code>aiosqlite</code> / <code>asyncpg</code> <code>sqlite3</code> / <code>psycopg2</code> \u6587\u4ef6\u64cd\u4f5c <code>aiofiles</code> \u5185\u7f6e <code>open()</code> (\u5927\u6587\u4ef6) \u8fdb\u7a0b/\u7ebf\u7a0b <code>asyncio.to_thread()</code> <code>threading.Thread</code> \u76f4\u63a5\u8c03\u7528 <p>\u4ee3\u7801\u793a\u4f8b\uff1a</p> <pre><code># \u2705 \u6b63\u786e\uff1a\u5f02\u6b65 HTTP \u8bf7\u6c42\nasync def fetch_external_api():\n    async with httpx.AsyncClient() as client:\n        response = await client.get(\"https://api.example.com/data\")\n        return response.json()\n\n# \u274c \u9519\u8bef\uff1a\u540c\u6b65\u963b\u585e\ndef fetch_external_api_wrong():\n    response = requests.get(\"https://api.example.com/data\")  # \u4f1a\u963b\u585e\u6574\u4e2a Worker\n    return response.json()\n\n# \u2705 \u6b63\u786e\uff1aCPU \u5bc6\u96c6\u578b\u4efb\u52a1\u5305\u88c5\nasync def cpu_intensive_task(data):\n    result = await asyncio.to_thread(heavy_computation, data)\n    return result\n</code></pre> <p>Lint \u68c0\u67e5\u5efa\u8bae\uff1a - \u5728 CI \u4e2d\u6dfb\u52a0 <code>flake8-async</code> \u6216\u81ea\u5b9a\u4e49\u89c4\u5219\uff0c\u68c0\u6d4b\u540c\u6b65\u963b\u585e\u8c03\u7528</p>"},{"location":"_archive/frontend/02_api_design/#3-api","title":"3. API \u67b6\u6784\u8bbe\u8ba1","text":""},{"location":"_archive/frontend/02_api_design/#31","title":"3.1 \u6574\u4f53\u67b6\u6784","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        Frontend                              \u2502\n\u2502                   (Next.js Application)                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n              \u2502               \u2502               \u2502\n              \u25bc               \u25bc               \u25bc\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502   SSE   \u2502    \u2502  REST API \u2502    \u2502  (\u9884\u7559)  \u2502\n        \u2502 /stream \u2502    \u2502  /api/v1  \u2502    \u2502  Auth   \u2502\n        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n              \u2502               \u2502               \u2502\n              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      API Layer (FastAPI)                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502   Routers   \u2502  \u2502   Schemas   \u2502  \u2502    Dependencies     \u2502 \u2502\n\u2502  \u2502 - chat      \u2502  \u2502 - request   \u2502  \u2502 - get_controller    \u2502 \u2502\n\u2502  \u2502 - artifact  \u2502  \u2502 - response  \u2502  \u2502 - get_artifact_mgr  \u2502 \u2502\n\u2502  \u2502 - stream    \u2502  \u2502 - event     \u2502  \u2502 - (get_current_user)\u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502              StreamManager (\u65b0\u589e)                    \u2502   \u2502\n\u2502  \u2502  - \u4e8b\u4ef6\u7f13\u51b2\u961f\u5217 (asyncio.Queue)                      \u2502   \u2502\n\u2502  \u2502  - TTL \u7ba1\u7406 (\u9632\u6b62\u5185\u5b58\u6cc4\u6f0f)                           \u2502   \u2502\n\u2502  \u2502  - \u8fde\u63a5\u72b6\u6001\u8ffd\u8e2a                                      \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      Core Layer (\u73b0\u6709)                       \u2502\n\u2502         ExecutionController, ArtifactManager, etc.          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"_archive/frontend/02_api_design/#32-url","title":"3.2 URL \u7ed3\u6784\u8bbe\u8ba1","text":"<pre><code>/api/v1/\n\u251c\u2500\u2500 chat/                           # \u5bf9\u8bdd\u76f8\u5173\n\u2502   \u251c\u2500\u2500 POST   /                    # \u53d1\u9001\u6d88\u606f\uff08\u8fd4\u56de stream URL\uff09\n\u2502   \u251c\u2500\u2500 GET    /                    # \u5217\u51fa\u6240\u6709\u5bf9\u8bdd\n\u2502   \u251c\u2500\u2500 GET    /{conv_id}           # \u83b7\u53d6\u5bf9\u8bdd\u8be6\u60c5\uff08\u542b\u6d88\u606f\u6811\uff09\n\u2502   \u251c\u2500\u2500 DELETE /{conv_id}           # \u5220\u9664\u5bf9\u8bdd\n\u2502   \u2514\u2500\u2500 POST   /{conv_id}/resume    # \u6062\u590d\u4e2d\u65ad\u7684\u6267\u884c\n\u2502\n\u251c\u2500\u2500 artifacts/                      # Artifact \u76f8\u5173\n\u2502   \u251c\u2500\u2500 GET    /{session_id}        # \u5217\u51fa session \u4e0b\u6240\u6709 artifacts\n\u2502   \u251c\u2500\u2500 GET    /{session_id}/{artifact_id}           # \u83b7\u53d6 artifact \u8be6\u60c5\n\u2502   \u251c\u2500\u2500 GET    /{session_id}/{artifact_id}/versions  # \u83b7\u53d6\u7248\u672c\u5217\u8868\n\u2502   \u251c\u2500\u2500 GET    /{session_id}/{artifact_id}/versions/{version}  # \u83b7\u53d6\u7279\u5b9a\u7248\u672c\n\u2502   \u2514\u2500\u2500 GET    /{session_id}/{artifact_id}/diff      # \u83b7\u53d6\u7248\u672c\u95f4\u5dee\u5f02\uff08\u53ef\u9009\uff09\n\u2502\n\u2514\u2500\u2500 stream/                         # \u6d41\u5f0f\u8f93\u51fa\n    \u2514\u2500\u2500 GET    /{thread_id}         # SSE \u7aef\u70b9\uff0c\u8ba2\u9605\u6267\u884c\u8fc7\u7a0b\n</code></pre>"},{"location":"_archive/frontend/02_api_design/#4","title":"4. \u63a5\u53e3\u8be6\u7ec6\u8bbe\u8ba1","text":""},{"location":"_archive/frontend/02_api_design/#41","title":"4.1 \u5bf9\u8bdd\u63a5\u53e3","text":""},{"location":"_archive/frontend/02_api_design/#post-apiv1chat","title":"POST /api/v1/chat","text":"<p>\u53d1\u9001\u65b0\u6d88\u606f\uff0c\u542f\u52a8 Graph \u6267\u884c\u3002</p> <p>Request Body: <pre><code>{\n  \"content\": \"string\",                    // \u7528\u6237\u6d88\u606f\n  \"conversation_id\": \"string | null\",     // \u53ef\u9009\uff1a\u7ee7\u7eed\u73b0\u6709\u5bf9\u8bdd\n  \"parent_message_id\": \"string | null\"    // \u53ef\u9009\uff1a\u5206\u652f\u5bf9\u8bdd\u7684\u7236\u6d88\u606f\n}\n</code></pre></p> <p>Response: <pre><code>{\n  \"conversation_id\": \"conv-xxx\",\n  \"message_id\": \"msg-xxx\",\n  \"thread_id\": \"thd-xxx\",\n  \"stream_url\": \"/api/v1/stream/thd-xxx\"  // \u524d\u7aef\u8ba2\u9605\u6b64 URL \u83b7\u53d6\u6d41\u5f0f\u8f93\u51fa\n}\n</code></pre></p> <p>\u8bbe\u8ba1\u8981\u70b9\uff1a - \u4e0d\u76f4\u63a5\u8fd4\u56de\u7ed3\u679c\uff0c\u800c\u662f\u8fd4\u56de <code>stream_url</code> - \u524d\u7aef\u901a\u8fc7 SSE \u8ba2\u9605\u83b7\u53d6\u5b9e\u65f6\u66f4\u65b0 - \u652f\u6301\u4e50\u89c2 UI\uff08\u5148\u663e\u793a\u7528\u6237\u6d88\u606f\uff0c\u518d\u7b49\u5f85\u54cd\u5e94\uff09</p>"},{"location":"_archive/frontend/02_api_design/#post-apiv1chatconv_idresume","title":"POST /api/v1/chat/{conv_id}/resume","text":"<p>\u6062\u590d\u4e2d\u65ad\u7684\u6267\u884c\uff08\u6743\u9650\u786e\u8ba4\u540e\uff09\u3002</p> <p>Request Body: <pre><code>{\n  \"thread_id\": \"thd-xxx\",\n  \"message_id\": \"msg-xxx\",\n  \"approved\": true\n}\n</code></pre></p> <p>Response: <pre><code>{\n  \"stream_url\": \"/api/v1/stream/thd-xxx\"  // \u65b0\u7684 stream URL\n}\n</code></pre></p> <p>\u91cd\u8981\u8bf4\u660e\uff1a - \u5fc5\u987b\u53c2\u6570\uff1a<code>thread_id</code>\u3001<code>message_id</code>\u3001<code>approved</code>\uff08\u8fd9\u4e09\u4e2a\u53c2\u6570\u90fd\u53ef\u4ee5\u4ece\u4e2d\u65ad\u4e8b\u4ef6\u7684\u8fd4\u56de\u6570\u636e\u4e2d\u83b7\u53d6\uff09 - \u65e0\u72b6\u6001\u8bbe\u8ba1\uff1aController \u4e0d\u4fdd\u5b58\u4e2d\u65ad\u72b6\u6001\uff0cresume \u65f6\u5fc5\u987b\u4f20\u5165\u5b8c\u6574\u53c2\u6570 - \u6bcf\u6b21 resume \u8fd4\u56de\u7684 <code>stream_url</code> \u53ef\u80fd\u76f8\u540c\uff0c\u4f46\u524d\u7aef\u5e94\u9500\u6bc1\u65e7\u7684 EventSource \u5b9e\u4f8b\u540e\u518d\u5efa\u7acb\u65b0\u8fde\u63a5 - \u8fd9\u786e\u4fdd\u4e86\u8fde\u63a5\u72b6\u6001\u7684\u5e72\u51c0\u5207\u6362</p>"},{"location":"_archive/frontend/02_api_design/#get-apiv1chat","title":"GET /api/v1/chat","text":"<p>\u5217\u51fa\u5bf9\u8bdd\u5217\u8868\u3002</p> <p>Query Parameters: - <code>limit</code>: \u6570\u91cf\u9650\u5236\uff08\u9ed8\u8ba4 20\uff09 - <code>offset</code>: \u504f\u79fb\u91cf\uff08\u5206\u9875\uff09 - <code>user_id</code>: \u9884\u7559\uff0c\u7528\u6237 ID \u8fc7\u6ee4</p> <p>Response: <pre><code>{\n  \"conversations\": [\n    {\n      \"id\": \"conv-xxx\",\n      \"title\": \"\u5173\u4e8e\u91cf\u5b50\u8ba1\u7b97\u7684\u8ba8\u8bba\",\n      \"message_count\": 5,\n      \"created_at\": \"2024-01-01T00:00:00Z\",\n      \"updated_at\": \"2024-01-01T01:00:00Z\"\n    }\n  ],\n  \"total\": 100,\n  \"has_more\": true\n}\n</code></pre></p>"},{"location":"_archive/frontend/02_api_design/#get-apiv1chatconv_id","title":"GET /api/v1/chat/{conv_id}","text":"<p>\u83b7\u53d6\u5bf9\u8bdd\u8be6\u60c5\uff0c\u5305\u542b\u5b8c\u6574\u7684\u6d88\u606f\u6811\u3002</p> <p>Response: <pre><code>{\n  \"id\": \"conv-xxx\",\n  \"title\": \"\u5173\u4e8e\u91cf\u5b50\u8ba1\u7b97\u7684\u8ba8\u8bba\",\n  \"active_branch\": \"msg-latest\",\n  \"messages\": [\n    {\n      \"id\": \"msg-1\",\n      \"parent_id\": null,\n      \"content\": \"\u4ec0\u4e48\u662f\u91cf\u5b50\u8ba1\u7b97\uff1f\",\n      \"response\": \"\u91cf\u5b50\u8ba1\u7b97\u662f...\",\n      \"created_at\": \"...\",\n      \"children\": [\"msg-2\", \"msg-3\"]  // \u5b50\u6d88\u606f ID \u5217\u8868\uff08\u7528\u4e8e\u6e32\u67d3\u6811\uff09\n    }\n  ],\n  \"session_id\": \"sess-conv-xxx\",  // \u5173\u8054\u7684 artifact session\n  \"created_at\": \"...\",\n  \"updated_at\": \"...\"\n}\n</code></pre></p> <p>\u8bbe\u8ba1\u8981\u70b9\uff1a - <code>messages</code> \u662f\u6241\u5e73\u6570\u7ec4\uff0c\u901a\u8fc7 <code>parent_id</code> \u548c <code>children</code> \u8868\u8fbe\u6811\u7ed3\u6784 - \u524d\u7aef\u53ef\u4ee5\u9009\u62e9\u53ea\u6e32\u67d3\u5f53\u524d\u5206\u652f\u8def\u5f84\uff0c\u6216\u5c55\u793a\u5b8c\u6574\u6811</p>"},{"location":"_archive/frontend/02_api_design/#42-artifact","title":"4.2 Artifact \u63a5\u53e3","text":""},{"location":"_archive/frontend/02_api_design/#get-apiv1artifactssession_id","title":"GET /api/v1/artifacts/{session_id}","text":"<p>\u5217\u51fa session \u4e0b\u6240\u6709 artifacts\u3002</p> <p>Response: <pre><code>{\n  \"session_id\": \"sess-xxx\",\n  \"artifacts\": [\n    {\n      \"id\": \"research_report\",\n      \"content_type\": \"markdown\",\n      \"title\": \"AI Research Report\",\n      \"current_version\": 3,\n      \"created_at\": \"...\",\n      \"updated_at\": \"...\"\n    }\n  ]\n}\n</code></pre></p>"},{"location":"_archive/frontend/02_api_design/#get-apiv1artifactssession_idartifact_id","title":"GET /api/v1/artifacts/{session_id}/{artifact_id}","text":"<p>\u83b7\u53d6 artifact \u8be6\u60c5\uff08\u5305\u542b\u5f53\u524d\u7248\u672c\u5185\u5bb9\uff09\u3002</p> <p>Response: <pre><code>{\n  \"id\": \"research_report\",\n  \"session_id\": \"sess-xxx\",\n  \"content_type\": \"markdown\",\n  \"title\": \"AI Research Report\",\n  \"content\": \"# Report\\n\\n...\",  // \u5f53\u524d\u7248\u672c\u5185\u5bb9\n  \"current_version\": 3,\n  \"created_at\": \"...\",\n  \"updated_at\": \"...\"\n}\n</code></pre></p>"},{"location":"_archive/frontend/02_api_design/#get-apiv1artifactssession_idartifact_idversions","title":"GET /api/v1/artifacts/{session_id}/{artifact_id}/versions","text":"<p>\u83b7\u53d6\u7248\u672c\u5386\u53f2\u5217\u8868\u3002</p> <p>Response: <pre><code>{\n  \"versions\": [\n    {\n      \"version\": 1,\n      \"update_type\": \"create\",\n      \"created_at\": \"...\"\n    },\n    {\n      \"version\": 2,\n      \"update_type\": \"update\",\n      \"created_at\": \"...\"\n    }\n  ]\n}\n</code></pre></p>"},{"location":"_archive/frontend/02_api_design/#get-apiv1artifactssession_idartifact_idversionsversion","title":"GET /api/v1/artifacts/{session_id}/{artifact_id}/versions/{version}","text":"<p>\u83b7\u53d6\u7279\u5b9a\u7248\u672c\u7684\u5b8c\u6574\u5185\u5bb9\u3002</p> <p>Response: <pre><code>{\n  \"version\": 2,\n  \"content\": \"...\",\n  \"update_type\": \"update\",\n  \"changes\": [[\"old text\", \"new text\"]],  // \u5982\u679c\u6709\u8bb0\u5f55\n  \"created_at\": \"...\"\n}\n</code></pre></p>"},{"location":"_archive/frontend/02_api_design/#43-sse","title":"4.3 \u6d41\u5f0f\u63a5\u53e3\uff08SSE\uff09","text":""},{"location":"_archive/frontend/02_api_design/#get-apiv1streamthread_id","title":"GET /api/v1/stream/{thread_id}","text":"<p>SSE \u7aef\u70b9\uff0c\u63a8\u9001 Graph \u6267\u884c\u8fc7\u7a0b\u3002</p> <p>Event Format\uff08\u7edf\u4e00\u683c\u5f0f\uff09:</p> <p>\u6240\u6709\u4e8b\u4ef6\u4f7f\u7528\u7edf\u4e00\u7684 <code>StreamEventType</code> \u683c\u5f0f\uff1a</p> <pre><code>{\n  \"type\": \"agent_start | llm_chunk | llm_complete | agent_complete | tool_start | tool_complete | permission_request | permission_result | metadata | complete | error\",\n  \"timestamp\": \"2024-01-19T10:00:00.000Z\",\n  \"agent\": \"lead_agent\",       // \u53ef\u9009\uff0cagent \u76f8\u5173\u4e8b\u4ef6\n  \"tool\": \"web_search\",        // \u53ef\u9009\uff0ctool \u76f8\u5173\u4e8b\u4ef6\n  \"data\": {...}                // \u4e8b\u4ef6\u6570\u636e\n}\n</code></pre> <p>\u5b8c\u6574\u4e8b\u4ef6\u6d41\u793a\u4f8b:</p> <pre><code>// 1. \u4f1a\u8bdd\u5f00\u59cb\uff08Controller \u5c42\uff09\ndata: {\"type\": \"metadata\", \"timestamp\": \"...\", \"data\": {\"conversation_id\": \"conv-xxx\", \"message_id\": \"msg-xxx\", \"thread_id\": \"thd-xxx\"}}\n\n// 2. Agent \u5f00\u59cb\u6267\u884c\uff08Agent \u5c42\uff09\ndata: {\"type\": \"agent_start\", \"timestamp\": \"...\", \"agent\": \"lead_agent\", \"data\": {...}}\n\n// 3. LLM \u6d41\u5f0f\u8f93\u51fa\uff08Agent \u5c42\uff09\ndata: {\"type\": \"llm_chunk\", \"timestamp\": \"...\", \"agent\": \"lead_agent\", \"data\": {\"content\": \"\u6211\u9700\u8981\", \"reasoning_content\": \"...\"}}\ndata: {\"type\": \"llm_chunk\", \"timestamp\": \"...\", \"agent\": \"lead_agent\", \"data\": {\"content\": \"\u6211\u9700\u8981\u641c\u7d22\", \"reasoning_content\": \"...\"}}\n\n// 4. LLM \u5b8c\u6210\uff08Agent \u5c42\uff09\ndata: {\"type\": \"llm_complete\", \"timestamp\": \"...\", \"agent\": \"lead_agent\", \"data\": {\"token_usage\": {\"input_tokens\": 100, \"output_tokens\": 50}}}\n\n// 5. Agent \u5b8c\u6210\uff08\u53ef\u80fd\u5e26 routing\uff09\uff08Agent \u5c42\uff09\ndata: {\"type\": \"agent_complete\", \"timestamp\": \"...\", \"agent\": \"lead_agent\", \"data\": {\"routing\": {\"type\": \"subagent\", \"target\": \"search_agent\"}}}\n\n// 6. \u5de5\u5177\u5f00\u59cb\u6267\u884c\uff08Graph \u5c42\uff09\ndata: {\"type\": \"tool_start\", \"timestamp\": \"...\", \"agent\": \"search_agent\", \"tool\": \"web_search\", \"data\": {\"params\": {...}}}\n\n// 7. \u5de5\u5177\u6267\u884c\u5b8c\u6210\uff08Graph \u5c42\uff09\ndata: {\"type\": \"tool_complete\", \"timestamp\": \"...\", \"agent\": \"search_agent\", \"tool\": \"web_search\", \"data\": {\"success\": true, \"duration_ms\": 450}}\n\n// 8. \u6743\u9650\u8bf7\u6c42\uff08Graph \u5c42\uff0c\u5982\u679c\u9700\u8981\uff09\ndata: {\"type\": \"permission_request\", \"timestamp\": \"...\", \"agent\": \"crawl_agent\", \"tool\": \"web_fetch\", \"data\": {\"permission_level\": \"confirm\", \"params\": {...}}}\n\n// 9. \u6700\u7ec8\u5b8c\u6210\uff08Controller \u5c42\uff0c\u5305\u542b execution_metrics\uff09\ndata: {\"type\": \"complete\", \"timestamp\": \"...\", \"data\": {\"success\": true, \"interrupted\": false, \"response\": \"...\", \"execution_metrics\": {...}}}\n</code></pre> <p>\ud83c\udd95 SSE \u8fde\u63a5\u751f\u547d\u5468\u671f\uff1a</p> \u4e8b\u4ef6\u7c7b\u578b \u8fde\u63a5\u72b6\u6001 \u4ea7\u751f\u4f4d\u7f6e \u8bf4\u660e <code>metadata</code> \u4fdd\u6301 Controller \u9996\u4e2a\u4e8b\u4ef6\uff0c\u786e\u8ba4\u8fde\u63a5\u6210\u529f <code>agent_start</code> \u4fdd\u6301 Agent Agent \u5f00\u59cb\u6267\u884c <code>llm_chunk</code> \u4fdd\u6301 Agent LLM \u6d41\u5f0f\u8f93\u51fa <code>llm_complete</code> \u4fdd\u6301 Agent LLM \u5355\u6b21\u8c03\u7528\u5b8c\u6210 <code>agent_complete</code> \u4fdd\u6301 Agent Agent \u672c\u8f6e\u5b8c\u6210\uff08\u53ef\u80fd\u5e26 routing\uff09 <code>tool_start</code> \u4fdd\u6301 Graph \u5de5\u5177\u5f00\u59cb\u6267\u884c <code>tool_complete</code> \u4fdd\u6301 Graph \u5de5\u5177\u6267\u884c\u5b8c\u6210 <code>permission_request</code> \u4fdd\u6301 Graph \u8bf7\u6c42\u6743\u9650\u786e\u8ba4 <code>permission_result</code> \u4fdd\u6301 Graph \u6743\u9650\u786e\u8ba4\u7ed3\u679c <code>complete</code> \u5173\u95ed Controller \u6b63\u5e38\u5b8c\u6210/\u4e2d\u65ad\uff0c\u670d\u52a1\u7aef\u4e3b\u52a8\u5173\u95ed\u8fde\u63a5 <code>error</code> \u5173\u95ed Controller \u53d1\u751f\u9519\u8bef\uff0c\u670d\u52a1\u7aef\u4e3b\u52a8\u5173\u95ed\u8fde\u63a5 <p>\u8bbe\u8ba1\u8981\u70b9\uff1a - \u4f7f\u7528\u7edf\u4e00\u7684 <code>StreamEventType</code>\uff0c\u5404\u5c42\uff08Agent/Graph/Controller\uff09\u5171\u7528 - \u4e8b\u4ef6\u76f4\u63a5\u900f\u4f20\uff0c\u4e0d\u518d\u5305\u88c5\u4e3a <code>stream</code> \u4e8b\u4ef6 - <code>complete</code> / <code>error</code> \u4e8b\u4ef6\u540e\uff0c\u670d\u52a1\u7aef\u4e3b\u52a8\u5173\u95ed SSE \u8fde\u63a5 - <code>complete</code> \u4e8b\u4ef6\u5305\u542b\u5b8c\u6574\u7684 <code>execution_metrics</code> \u53ef\u89c2\u6d4b\u6027\u6570\u636e</p>"},{"location":"_archive/frontend/02_api_design/#44-streameventtype","title":"4.4 \u7edf\u4e00\u4e8b\u4ef6\u7c7b\u578b\uff08StreamEventType\uff09\ud83c\udd95","text":"<p>\u6240\u6709\u5c42\u4f7f\u7528\u7edf\u4e00\u7684\u4e8b\u4ef6\u7c7b\u578b\u679a\u4e3e\uff1a</p> <pre><code>class StreamEventType(Enum):\n    \"\"\"\n    \u7edf\u4e00\u7684\u6267\u884c\u4e8b\u4ef6\u7c7b\u578b\n\n    \u4ea7\u751f\u4f4d\u7f6e\uff1a\n    - [Controller] \u4f1a\u8bdd\u7ea7\u522b\u5143\u6570\u636e\u548c\u6700\u7ec8\u7ed3\u679c\n    - [Agent]      LLM \u6267\u884c\u76f8\u5173\u4e8b\u4ef6\n    - [Graph]      \u5de5\u5177\u6267\u884c\u548c\u6743\u9650\u76f8\u5173\u4e8b\u4ef6\n    \"\"\"\n\n    # ========== Controller \u5c42 ==========\n    METADATA = \"metadata\"                # \u4f1a\u8bdd\u5143\u6570\u636e\n    COMPLETE = \"complete\"                # \u6574\u4f53\u5b8c\u6210\uff08\u542b execution_metrics\uff09\n    ERROR = \"error\"                      # \u9519\u8bef\n\n    # ========== Agent \u5c42 ==========\n    AGENT_START = \"agent_start\"          # agent \u5f00\u59cb\u6267\u884c\n    LLM_CHUNK = \"llm_chunk\"              # LLM token \u6d41\n    LLM_COMPLETE = \"llm_complete\"        # LLM \u5355\u6b21\u8c03\u7528\u5b8c\u6210\n    AGENT_COMPLETE = \"agent_complete\"    # agent \u672c\u8f6e\u5b8c\u6210\n\n    # ========== Graph \u5c42 ==========\n    TOOL_START = \"tool_start\"            # \u5de5\u5177\u5f00\u59cb\u6267\u884c\n    TOOL_COMPLETE = \"tool_complete\"      # \u5de5\u5177\u6267\u884c\u5b8c\u6210\n    PERMISSION_REQUEST = \"permission_request\"  # \u8bf7\u6c42\u6743\u9650\u786e\u8ba4\n    PERMISSION_RESULT = \"permission_result\"    # \u6743\u9650\u786e\u8ba4\u7ed3\u679c\n</code></pre> <p>\u524d\u7aef\u72b6\u6001\u63a8\u65ad\uff1a</p> \u6536\u5230\u4e8b\u4ef6 \u524d\u7aef\u663e\u793a <code>agent_start</code> \"Agent X \u6b63\u5728\u601d\u8003...\" <code>llm_chunk</code> \u6d41\u5f0f\u663e\u793a LLM \u8f93\u51fa\u5185\u5bb9 <code>tool_start</code> \"\u6b63\u5728\u6267\u884c web_search...\" <code>tool_complete</code> \u663e\u793a\u5de5\u5177\u6267\u884c\u7ed3\u679c <code>permission_request</code> \u5f39\u51fa\u6743\u9650\u786e\u8ba4\u5bf9\u8bdd\u6846 <code>complete</code> \u663e\u793a\u6700\u7ec8\u7ed3\u679c\u548c metrics"},{"location":"_archive/frontend/02_api_design/#45-executionmetrics","title":"4.5 ExecutionMetrics \u53ef\u89c2\u6d4b\u6027\u6307\u6807 \ud83c\udd95","text":"<p><code>complete</code> \u4e8b\u4ef6\u5305\u542b\u5b8c\u6574\u7684\u6267\u884c\u6307\u6807\uff0c\u7528\u4e8e\u524d\u7aef\u5c55\u793a\u6267\u884c\u7edf\u8ba1\u4fe1\u606f\u3002</p> <p>\u6570\u636e\u7ed3\u6784\uff1a</p> <pre><code>interface ExecutionMetrics {\n  started_at: string;                    // ISO timestamp\n  completed_at: string;                  // ISO timestamp\n  total_duration_ms: number;             // \u603b\u8017\u65f6\uff08\u6beb\u79d2\uff09\n\n  agent_executions: AgentExecutionRecord[];  // Agent \u6267\u884c\u8bb0\u5f55\u5217\u8868\n  tool_calls: ToolCallRecord[];              // \u5de5\u5177\u8c03\u7528\u8bb0\u5f55\u5217\u8868\n}\n\ninterface AgentExecutionRecord {\n  agent_name: string;                    // Agent \u540d\u79f0\n  model: string;                         // \u4f7f\u7528\u7684\u6a21\u578b\n  token_usage: {\n    input_tokens: number;\n    output_tokens: number;\n    total_tokens: number;\n  };\n  llm_duration_ms: number;               // LLM \u54cd\u5e94\u8017\u65f6\n  started_at: string;\n  completed_at: string;\n}\n\ninterface ToolCallRecord {\n  tool_name: string;                     // \u5de5\u5177\u540d\u79f0\n  success: boolean;                      // \u662f\u5426\u6210\u529f\n  duration_ms: number;                   // \u6267\u884c\u8017\u65f6\n  called_at: string;\n  completed_at: string;\n  agent: string;                         // \u8c03\u7528\u65b9 Agent\n}\n</code></pre> <p>\u793a\u4f8b\u6570\u636e\uff1a</p> <pre><code>{\n  \"execution_metrics\": {\n    \"started_at\": \"2024-01-19T10:00:00.000Z\",\n    \"completed_at\": \"2024-01-19T10:00:03.500Z\",\n    \"total_duration_ms\": 3500,\n\n    \"agent_executions\": [\n      {\n        \"agent_name\": \"lead_agent\",\n        \"model\": \"qwen-plus\",\n        \"token_usage\": {\"input_tokens\": 1200, \"output_tokens\": 350, \"total_tokens\": 1550},\n        \"llm_duration_ms\": 1200,\n        \"started_at\": \"2024-01-19T10:00:00.100Z\",\n        \"completed_at\": \"2024-01-19T10:00:01.300Z\"\n      },\n      {\n        \"agent_name\": \"search_agent\",\n        \"model\": \"qwen-plus\",\n        \"token_usage\": {\"input_tokens\": 800, \"output_tokens\": 200, \"total_tokens\": 1000},\n        \"llm_duration_ms\": 900,\n        \"started_at\": \"2024-01-19T10:00:01.400Z\",\n        \"completed_at\": \"2024-01-19T10:00:02.300Z\"\n      },\n      {\n        \"agent_name\": \"lead_agent\",\n        \"model\": \"qwen-plus\",\n        \"token_usage\": {\"input_tokens\": 1500, \"output_tokens\": 400, \"total_tokens\": 1900},\n        \"llm_duration_ms\": 600,\n        \"started_at\": \"2024-01-19T10:00:02.800Z\",\n        \"completed_at\": \"2024-01-19T10:00:03.400Z\"\n      }\n    ],\n\n    \"tool_calls\": [\n      {\n        \"tool_name\": \"web_search\",\n        \"success\": true,\n        \"duration_ms\": 450,\n        \"called_at\": \"2024-01-19T10:00:02.350Z\",\n        \"completed_at\": \"2024-01-19T10:00:02.800Z\",\n        \"agent\": \"search_agent\"\n      }\n    ]\n  }\n}\n</code></pre> <p>\u524d\u7aef\u4f7f\u7528\u5efa\u8bae\uff1a</p> <ol> <li>Token \u7edf\u8ba1\uff1a\u904d\u5386 <code>agent_executions</code> \u805a\u5408\u5404 Agent \u7684 token \u4f7f\u7528\u91cf</li> <li>\u8017\u65f6\u5206\u6790\uff1a\u5c55\u793a <code>total_duration_ms</code> \u548c\u5404\u6b65\u9aa4\u8017\u65f6</li> <li>\u5de5\u5177\u8c03\u7528\uff1a\u5c55\u793a <code>tool_calls</code> \u4e2d\u7684\u6210\u529f/\u5931\u8d25\u72b6\u6001</li> </ol>"},{"location":"_archive/frontend/02_api_design/#5","title":"5. \u6587\u4ef6\u7ed3\u6784\u89c4\u5212","text":""},{"location":"_archive/frontend/02_api_design/#51","title":"5.1 \u65b0\u589e\u6587\u4ef6","text":"<pre><code>src/\n\u251c\u2500\u2500 api/                             # API \u5c42\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 main.py                      # FastAPI \u5e94\u7528\u5165\u53e3\n\u2502   \u251c\u2500\u2500 config.py                    # API \u914d\u7f6e\n\u2502   \u251c\u2500\u2500 dependencies.py              # \u4f9d\u8d56\u6ce8\u5165\uff08Controller\u3001Manager \u7b49\uff09\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 routers/                     # \u8def\u7531\u6a21\u5757\n\u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u251c\u2500\u2500 chat.py                  # /api/v1/chat\n\u2502   \u2502   \u251c\u2500\u2500 artifacts.py             # /api/v1/artifacts\n\u2502   \u2502   \u2514\u2500\u2500 stream.py                # /api/v1/stream (SSE)\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 schemas/                     # Pydantic \u6a21\u578b\n\u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u251c\u2500\u2500 chat.py                  # \u5bf9\u8bdd\u76f8\u5173 schema\n\u2502   \u2502   \u251c\u2500\u2500 artifact.py              # Artifact \u76f8\u5173 schema\n\u2502   \u2502   \u2514\u2500\u2500 events.py                # SSE \u4e8b\u4ef6 schema\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 services/                    # \ud83c\udd95 \u670d\u52a1\u5c42\n\u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u2514\u2500\u2500 stream_manager.py        # \u4e8b\u4ef6\u7f13\u51b2\u961f\u5217\u7ba1\u7406\n\u2502   \u2502\n\u2502   \u2514\u2500\u2500 utils/                       # API \u5de5\u5177\u51fd\u6570\n\u2502       \u251c\u2500\u2500 __init__.py\n\u2502       \u2514\u2500\u2500 sse.py                   # SSE \u54cd\u5e94\u6784\u5efa\u5668\n\u2502\n\u2514\u2500\u2500 run_server.py                    # \u670d\u52a1\u5668\u542f\u52a8\u811a\u672c\n</code></pre>"},{"location":"_archive/frontend/02_api_design/#52","title":"5.2 \u6539\u9020\u6587\u4ef6","text":"\u6587\u4ef6 \u6539\u9020\u5185\u5bb9 <code>controller.py</code> \u6dfb\u52a0\u83b7\u53d6\u6267\u884c\u72b6\u6001\u7684\u65b9\u6cd5\uff08\u7528\u4e8e SSE \u91cd\u8fde\uff09 <code>requirements.txt</code> \u6dfb\u52a0 <code>fastapi</code>, <code>uvicorn</code>, <code>sse-starlette</code>, <code>aiofiles</code>"},{"location":"_archive/frontend/02_api_design/#6","title":"6. \u6838\u5fc3\u7ec4\u4ef6\u8bbe\u8ba1","text":""},{"location":"_archive/frontend/02_api_design/#61-fastapi-mainpy","title":"6.1 FastAPI \u5e94\u7528 (main.py)","text":"<p>\u804c\u8d23\uff1a - \u521b\u5efa FastAPI \u5e94\u7528\u5b9e\u4f8b - \u914d\u7f6e CORS \u4e2d\u95f4\u4ef6 - \u6ce8\u518c\u8def\u7531 - \u914d\u7f6e\u5f02\u5e38\u5904\u7406</p> <p>\u8bbe\u8ba1\u8981\u70b9\uff1a - \u542f\u52a8\u65f6\u521d\u59cb\u5316\u6570\u636e\u5e93\u8fde\u63a5 - \u4f7f\u7528 lifespan context manager \u7ba1\u7406\u8d44\u6e90 - \u914d\u7f6e CORS \u5141\u8bb8\u524d\u7aef\u57df\u540d</p>"},{"location":"_archive/frontend/02_api_design/#62-dependenciespy","title":"6.2 \u4f9d\u8d56\u6ce8\u5165 (dependencies.py)","text":"<p>\u804c\u8d23\uff1a - \u63d0\u4f9b <code>get_db_session()</code> \u4f9d\u8d56\uff08\u8bf7\u6c42\u7ea7\u522b\u7684\u6570\u636e\u5e93\u4f1a\u8bdd\uff09\ud83c\udd95 - \u63d0\u4f9b <code>get_controller()</code> \u4f9d\u8d56 - \u63d0\u4f9b <code>get_artifact_manager()</code> \u4f9d\u8d56 - \u63d0\u4f9b <code>get_stream_manager()</code> \u4f9d\u8d56 - \u9884\u7559 <code>get_current_user()</code> \u4f9d\u8d56</p> <p>\u8bbe\u8ba1\u8981\u70b9\uff1a - \u4f7f\u7528 FastAPI \u7684 <code>Depends</code> \u7cfb\u7edf - \u6bcf\u4e2a\u8bf7\u6c42\u83b7\u5f97\u72ec\u7acb\u7684\u6570\u636e\u5e93 session\uff08\u8bf7\u6c42\u7ed3\u675f\u65f6\u81ea\u52a8 commit/rollback\uff09\ud83c\udd95 - Controller \u548c Manager \u901a\u8fc7\u6784\u9020\u51fd\u6570\u6ce8\u5165\uff0c\u7ed1\u5b9a\u5230\u8bf7\u6c42\u7684 session - \u7528\u6237\u4f9d\u8d56\u9884\u7559\u4e3a\u8fd4\u56de <code>None</code>\uff08\u65e0\u8ba4\u8bc1\u65f6\uff09</p> <p>\u793a\u4f8b\u4ee3\u7801\uff1a <pre><code># dependencies.py\nfrom functools import lru_cache\nfrom typing import AsyncGenerator, Any\nfrom fastapi import Depends\nfrom sqlalchemy.ext.asyncio import AsyncSession\n\nfrom core.controller import ExecutionController\nfrom core.conversation_manager import ConversationManager\nfrom core.graph import create_multi_agent_graph, create_async_sqlite_checkpointer\nfrom tools.implementations.artifact_ops import ArtifactManager\nfrom db.database import DatabaseManager\nfrom repositories.artifact_repo import ArtifactRepository\nfrom repositories.conversation_repo import ConversationRepository\nfrom api.services.stream_manager import StreamManager\n\n# ============================================================\n# \u5168\u5c40\u5355\u4f8b\uff08\u8de8\u8bf7\u6c42\u5171\u4eab\uff09\n# ============================================================\n\n_db_manager: DatabaseManager = None\n_checkpointer: Any = None  # AsyncSqliteSaver\uff0cLangGraph \u72b6\u6001\u6301\u4e45\u5316\n\nasync def init_globals():\n    \"\"\"\u5e94\u7528\u542f\u52a8\u65f6\u521d\u59cb\u5316\"\"\"\n    global _db_manager, _checkpointer\n    _db_manager = DatabaseManager()\n    await _db_manager.initialize()\n    # \u521b\u5efa\u5171\u4eab\u7684 checkpointer\uff08\u7528\u4e8e interrupt/resume\uff09\n    # \u4f7f\u7528 AsyncSqliteSaver \u6301\u4e45\u5316\u5230 SQLite\n    _checkpointer = await create_async_sqlite_checkpointer(\"data/langgraph.db\")\n\nasync def close_globals():\n    \"\"\"\u5e94\u7528\u5173\u95ed\u65f6\u6e05\u7406\"\"\"\n    global _db_manager, _checkpointer\n    # \u5173\u95ed checkpointer \u7684 aiosqlite \u8fde\u63a5\n    if _checkpointer and hasattr(_checkpointer, 'conn'):\n        await _checkpointer.conn.close()\n    if _db_manager:\n        await _db_manager.close()\n\n@lru_cache()\ndef get_stream_manager() -&gt; StreamManager:\n    return StreamManager(ttl_seconds=30)\n\ndef get_checkpointer() -&gt; Any:\n    return _checkpointer\n\n# ============================================================\n# \u8bf7\u6c42\u7ea7\u522b\u4f9d\u8d56\uff08\u6bcf\u4e2a\u8bf7\u6c42\u72ec\u7acb\uff09\n# ============================================================\n\nasync def get_db_session() -&gt; AsyncGenerator[AsyncSession, None]:\n    \"\"\"\n    \u6bcf\u4e2a\u8bf7\u6c42\u83b7\u5f97\u72ec\u7acb\u7684\u6570\u636e\u5e93 session\n\n    \u8bf7\u6c42\u6210\u529f \u2192 \u81ea\u52a8 commit\n    \u8bf7\u6c42\u5931\u8d25 \u2192 \u81ea\u52a8 rollback\n    \"\"\"\n    async with _db_manager.session() as session:\n        yield session\n\nasync def get_artifact_manager(\n    session: AsyncSession = Depends(get_db_session)\n) -&gt; ArtifactManager:\n    \"\"\"\u6bcf\u4e2a\u8bf7\u6c42\u83b7\u5f97\u72ec\u7acb\u7684 ArtifactManager\uff08\u7ed1\u5b9a\u5230\u8bf7\u6c42\u7684 session\uff09\"\"\"\n    repo = ArtifactRepository(session)\n    return ArtifactManager(repo)\n\nasync def get_conversation_manager(\n    session: AsyncSession = Depends(get_db_session)\n) -&gt; ConversationManager:\n    \"\"\"\u6bcf\u4e2a\u8bf7\u6c42\u83b7\u5f97\u72ec\u7acb\u7684 ConversationManager\uff08\u7ed1\u5b9a\u5230\u8bf7\u6c42\u7684 session\uff09\"\"\"\n    repo = ConversationRepository(session)\n    return ConversationManager(repo)\n\nasync def get_controller(\n    artifact_manager: ArtifactManager = Depends(get_artifact_manager),\n    conversation_manager: ConversationManager = Depends(get_conversation_manager),\n) -&gt; ExecutionController:\n    \"\"\"\n    \u6bcf\u4e2a\u8bf7\u6c42\u83b7\u5f97\u72ec\u7acb\u7684 Controller\n\n    \u6ce8\u610f\uff1a\n    - Graph \u6bcf\u6b21\u521b\u5efa\u65b0\u5b9e\u4f8b\uff0c\u56e0\u4e3a\u5b83\u6301\u6709 artifact_manager \u5f15\u7528\n    - \u4f46 checkpointer \u662f\u5171\u4eab\u7684\uff0c\u4ee5\u652f\u6301\u8de8\u8bf7\u6c42\u7684 interrupt/resume\n    - create_multi_agent_graph \u662f async \u51fd\u6570\n    \"\"\"\n    compiled_graph = await create_multi_agent_graph(\n        artifact_manager=artifact_manager,\n        checkpointer=get_checkpointer()  # \u4f7f\u7528\u5171\u4eab\u7684 checkpointer\n    )\n    return ExecutionController(\n        compiled_graph,\n        artifact_manager=artifact_manager,\n        conversation_manager=conversation_manager\n    )\n</code></pre></p>"},{"location":"_archive/frontend/02_api_design/#63-sse-streampy","title":"6.3 SSE \u8def\u7531 (stream.py)","text":"<p>\u804c\u8d23\uff1a - \u8ba2\u9605 Graph \u6267\u884c\u8fc7\u7a0b - \u8f6c\u53d1 <code>stream_execute</code> \u7684\u4e8b\u4ef6 - \u5904\u7406\u8fde\u63a5\u65ad\u5f00</p> <p>\u8bbe\u8ba1\u8981\u70b9\uff1a <pre><code>\u6d41\u7a0b\uff1a\n1. \u524d\u7aef POST /chat \u83b7\u53d6 thread_id\n2. POST \u5904\u7406\u5668\u542f\u52a8\u4efb\u52a1\uff0c\u4e8b\u4ef6\u5199\u5165 StreamManager \u961f\u5217\n3. \u524d\u7aef EventSource \u8fde\u63a5 /stream/{thread_id}\n4. GET \u5904\u7406\u5668\u4ece\u961f\u5217\u6d88\u8d39\u4e8b\u4ef6\uff0c\u901a\u8fc7 SSE \u63a8\u9001\n5. \u6536\u5230 complete/interrupt/error \u4e8b\u4ef6\u540e\u5173\u95ed\u8fde\u63a5\n</code></pre></p>"},{"location":"_archive/frontend/02_api_design/#64-streammanager","title":"6.4 \u4e8b\u4ef6\u7f13\u51b2\u961f\u5217\u8bbe\u8ba1\uff08StreamManager\uff09\ud83c\udd95","text":"<p>\u89e3\u51b3\u7684\u95ee\u9898\uff1aPOST /chat \u542f\u52a8\u4efb\u52a1\u540e\uff0cGraph \u53ef\u80fd\u5728\u524d\u7aef SSE \u8fde\u63a5\u5efa\u7acb\u4e4b\u524d\u5c31\u5df2\u7ecf\u5f00\u59cb\u4ea7\u751f\u4e8b\u4ef6\uff0c\u5bfc\u81f4 <code>metadata</code> / <code>start</code> \u7b49\u65e9\u671f\u4e8b\u4ef6\u4e22\u5931\u3002</p> <p>\u67b6\u6784\u8bbe\u8ba1\uff1a</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      StreamManager                           \u2502\n\u2502                                                             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502  streams: Dict[thread_id, StreamContext]               \u2502 \u2502\n\u2502  \u2502                                                        \u2502 \u2502\n\u2502  \u2502  StreamContext:                                        \u2502 \u2502\n\u2502  \u2502    - queue: asyncio.Queue[SSEEvent]                   \u2502 \u2502\n\u2502  \u2502    - created_at: datetime                             \u2502 \u2502\n\u2502  \u2502    - status: pending | streaming | closed             \u2502 \u2502\n\u2502  \u2502    - ttl_task: asyncio.Task (\u81ea\u52a8\u6e05\u7406)                 \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                             \u2502\n\u2502  \u65b9\u6cd5:                                                       \u2502\n\u2502    - create_stream(thread_id) \u2192 StreamContext               \u2502\n\u2502    - push_event(thread_id, event)                          \u2502\n\u2502    - consume_events(thread_id) \u2192 AsyncGenerator[SSEEvent]  \u2502\n\u2502    - close_stream(thread_id)                               \u2502\n\u2502    - cleanup_expired()  # \u5b9a\u671f\u6e05\u7406\u8fc7\u671f\u961f\u5217                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>TTL \u673a\u5236\uff1a</p> <pre><code># stream_manager.py\n\nclass StreamContext:\n    queue: asyncio.Queue\n    created_at: datetime\n    status: Literal[\"pending\", \"streaming\", \"closed\"]\n    ttl_task: Optional[asyncio.Task]\n\nclass StreamManager:\n    def __init__(self, ttl_seconds: int = 30):\n        self.streams: Dict[str, StreamContext] = {}\n        self.ttl_seconds = ttl_seconds\n\n    def create_stream(self, thread_id: str) -&gt; StreamContext:\n        \"\"\"\u521b\u5efa\u4e8b\u4ef6\u961f\u5217\uff0c\u5e76\u542f\u52a8 TTL \u5b9a\u65f6\u5668\"\"\"\n        context = StreamContext(\n            queue=asyncio.Queue(),\n            created_at=datetime.now(),\n            status=\"pending\",\n            ttl_task=None\n        )\n        self.streams[thread_id] = context\n\n        # \u542f\u52a8 TTL \u5b9a\u65f6\u5668\n        context.ttl_task = asyncio.create_task(\n            self._ttl_cleanup(thread_id)\n        )\n        return context\n\n    async def _ttl_cleanup(self, thread_id: str):\n        \"\"\"TTL \u5230\u671f\u540e\u81ea\u52a8\u6e05\u7406\u961f\u5217\uff08\u9632\u6b62\u5185\u5b58\u6cc4\u6f0f\uff09\"\"\"\n        await asyncio.sleep(self.ttl_seconds)\n\n        context = self.streams.get(thread_id)\n        if context and context.status == \"pending\":\n            # \u524d\u7aef\u672a\u8fde\u63a5\uff0c\u6e05\u7406\u961f\u5217\n            logger.warning(f\"Stream {thread_id} expired (TTL={self.ttl_seconds}s)\")\n            self.close_stream(thread_id)\n\n    async def consume_events(self, thread_id: str):\n        \"\"\"\u6d88\u8d39\u4e8b\u4ef6\uff08\u524d\u7aef SSE \u8fde\u63a5\u65f6\u8c03\u7528\uff09\"\"\"\n        context = self.streams.get(thread_id)\n        if not context:\n            raise StreamNotFoundError(thread_id)\n\n        # \u53d6\u6d88 TTL \u5b9a\u65f6\u5668\uff08\u524d\u7aef\u5df2\u8fde\u63a5\uff09\n        if context.ttl_task:\n            context.ttl_task.cancel()\n            context.ttl_task = None\n\n        context.status = \"streaming\"\n\n        while True:\n            event = await context.queue.get()\n            yield event\n\n            # \u7ec8\u7ed3\u4e8b\u4ef6\u540e\u9000\u51fa\n            if event.type in (\"complete\", \"interrupt\", \"error\"):\n                break\n\n        self.close_stream(thread_id)\n</code></pre> <p>\u4ea4\u4e92\u65f6\u5e8f\uff1a</p> <pre><code>\u65f6\u95f4\u8f74 \u2192\n\nPOST /chat                          GET /stream/{thread_id}\n    \u2502                                      \u2502\n    \u25bc                                      \u2502\n[\u521b\u5efa StreamContext]                       \u2502\n[\u542f\u52a8 TTL \u5b9a\u65f6\u5668 (30s)]                    \u2502\n    \u2502                                      \u2502\n    \u25bc                                      \u2502\n[\u542f\u52a8 graph.astream()]                     \u2502\n    \u2502                                      \u2502\n    \u25bc                                      \u25bc\n[push metadata \u4e8b\u4ef6\u5230\u961f\u5217]         [\u8fde\u63a5\u5efa\u7acb, \u53d6\u6d88 TTL \u5b9a\u65f6\u5668]\n    \u2502                                      \u2502\n    \u25bc                                      \u25bc\n[push stream \u4e8b\u4ef6\u5230\u961f\u5217]  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba [\u6d88\u8d39\u5e76\u63a8\u9001 SSE]\n    \u2502                                      \u2502\n    \u25bc                                      \u25bc\n[push complete \u4e8b\u4ef6]      \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba [\u63a8\u9001\u540e\u5173\u95ed\u8fde\u63a5]\n    \u2502                                      \u2502\n    \u25bc                                      \u2502\n[close_stream()]                           \u2502\n</code></pre>"},{"location":"_archive/frontend/02_api_design/#65","title":"6.5 \u6570\u636e\u5e93\u4f1a\u8bdd\u4e0e\u4e8b\u52a1\u7ba1\u7406 \ud83c\udd95","text":"<p>\u6838\u5fc3\u539f\u5219\uff1a\u6bcf\u4e2a HTTP \u8bf7\u6c42\u4f7f\u7528\u72ec\u7acb\u7684\u6570\u636e\u5e93 session\uff0c\u8bf7\u6c42\u7ed3\u675f\u65f6\u81ea\u52a8 commit \u6216 rollback\u3002</p> <p>\u4e3a\u4ec0\u4e48\u9700\u8981\u8bf7\u6c42\u7ea7\u522b\u7684 Session \u9694\u79bb\uff1a</p> <ol> <li>\u5e76\u53d1\u5b89\u5168\uff1a\u591a\u4e2a\u5e76\u53d1\u8bf7\u6c42\u4e0d\u4f1a\u5171\u4eab session\uff0c\u907f\u514d\u6570\u636e\u7ade\u4e89</li> <li>\u4e8b\u52a1\u8fb9\u754c\u6e05\u6670\uff1a\u4e00\u4e2a\u8bf7\u6c42 = \u4e00\u4e2a\u4e8b\u52a1\uff0c\u8981\u4e48\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u56de\u6eda</li> <li>\u8d44\u6e90\u53ca\u65f6\u91ca\u653e\uff1a\u8bf7\u6c42\u7ed3\u675f\u540e session \u81ea\u52a8\u5173\u95ed\uff0c\u907f\u514d\u8fde\u63a5\u6cc4\u6f0f</li> </ol> <p>\u4f9d\u8d56\u6ce8\u5165\u94fe\u8def\uff1a</p> <pre><code>HTTP Request\n    \u2502\n    \u25bc\nget_db_session()        # \u521b\u5efa\u72ec\u7acb\u7684 AsyncSession\n    \u2502\n    \u251c\u2500\u2500\u25ba get_artifact_manager()     # \u521b\u5efa ArtifactRepository \u2192 ArtifactManager\n    \u2502\n    \u251c\u2500\u2500\u25ba get_conversation_manager() # \u521b\u5efa ConversationRepository \u2192 ConversationManager\n    \u2502\n    \u2514\u2500\u2500\u25ba get_controller()           # \u521b\u5efa Graph \u2192 ExecutionController\n             \u2502\n             \u25bc\n        \u6267\u884c\u8bf7\u6c42\u5904\u7406\n             \u2502\n             \u25bc\n        \u8bf7\u6c42\u6210\u529f \u2192 session.commit()\n        \u8bf7\u6c42\u5931\u8d25 \u2192 session.rollback()\n             \u2502\n             \u25bc\n        session.close()\n</code></pre> <p>\u5e76\u53d1\u5b89\u5168\u4fdd\u8bc1\uff1a</p> \u7ec4\u4ef6 \u5171\u4eab\u65b9\u5f0f \u8bf4\u660e <code>DatabaseManager</code> \u5168\u5c40\u5355\u4f8b \u53ea\u7ba1\u7406\u8fde\u63a5\u6c60\uff0c\u4e0d\u6301\u6709 session \u72b6\u6001 <code>Checkpointer</code> \u5168\u5c40\u5355\u4f8b AsyncSqliteSaver\uff0cLangGraph \u72b6\u6001\u6301\u4e45\u5316\uff0c\u652f\u6301 interrupt/resume <code>AsyncSession</code> \u8bf7\u6c42\u72ec\u7acb \u6bcf\u4e2a\u8bf7\u6c42\u521b\u5efa\u65b0\u7684\u6570\u636e\u5e93\u4f1a\u8bdd <code>Repository</code> \u8bf7\u6c42\u72ec\u7acb \u7ed1\u5b9a\u5230\u8bf7\u6c42\u7684 session <code>Manager</code> \u8bf7\u6c42\u72ec\u7acb \u7ed1\u5b9a\u5230\u8bf7\u6c42\u7684 repository <code>Graph</code> \u8bf7\u6c42\u72ec\u7acb \u6301\u6709 manager \u5f15\u7528\uff0c\u6bcf\u4e2a\u8bf7\u6c42\u521b\u5efa\u65b0\u5b9e\u4f8b\uff08\u4f46\u5171\u4eab checkpointer\uff09 <code>Controller</code> \u8bf7\u6c42\u72ec\u7acb \u7ed1\u5b9a\u5230\u8bf7\u6c42\u7684 managers <code>StreamManager</code> \u5168\u5c40\u5355\u4f8b \u65e0\u6570\u636e\u5e93\u64cd\u4f5c\uff0c\u53ef\u5b89\u5168\u5171\u4eab <p>\u6ce8\u610f\u4e8b\u9879\uff1a</p> <ol> <li>Graph \u6bcf\u6b21\u8bf7\u6c42\u521b\u5efa\u65b0\u5b9e\u4f8b\uff1a\u56e0\u4e3a Graph \u5185\u7684\u5de5\u5177\u6301\u6709 <code>artifact_manager</code> \u5f15\u7528\uff0c\u5982\u679c\u5171\u4eab Graph \u5b9e\u4f8b\uff0c\u5e76\u53d1\u8bf7\u6c42\u4f1a\u4e92\u76f8\u8986\u76d6 manager \u7684 repository</li> <li>Graph \u521b\u5efa\u5f00\u9500\uff1a\u6bcf\u6b21\u8bf7\u6c42\u521b\u5efa Graph \u6709\u4e00\u5b9a\u5f00\u9500\uff0c\u4f46\u76f8\u6bd4 LLM \u63a8\u7406\u65f6\u95f4\u53ef\u4ee5\u5ffd\u7565</li> <li>\u5982\u9700\u4f18\u5316\uff1a\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 <code>contextvars</code> \u5b9e\u73b0\u8bf7\u6c42\u4e0a\u4e0b\u6587\u9694\u79bb\uff0c\u4f46\u4f1a\u589e\u52a0\u590d\u6742\u5ea6</li> </ol>"},{"location":"_archive/frontend/02_api_design/#7","title":"7. \u6267\u884c\u6d41\u7a0b","text":""},{"location":"_archive/frontend/02_api_design/#71","title":"7.1 \u53d1\u9001\u6d88\u606f\u6d41\u7a0b","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Frontend  \u2502     \u2502  API Layer \u2502     \u2502 StreamManager\u2502     \u2502 Controller \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n      \u2502                  \u2502                   \u2502                   \u2502\n      \u2502  POST /chat      \u2502                   \u2502                   \u2502\n      \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502                   \u2502                   \u2502\n      \u2502                  \u2502                   \u2502                   \u2502\n      \u2502                  \u2502  create_stream    \u2502                   \u2502\n      \u2502                  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502                   \u2502\n      \u2502                  \u2502                   \u2502                   \u2502\n      \u2502                  \u2502  \u542f\u52a8\u540e\u53f0\u4efb\u52a1      \u2502                   \u2502\n      \u2502                  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n      \u2502                  \u2502                   \u2502                   \u2502\n      \u2502  \u8fd4\u56de stream_url \u2502                   \u2502                   \u2502\n      \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502                   \u2502                   \u2502\n      \u2502                  \u2502                   \u2502                   \u2502\n      \u2502  GET /stream     \u2502                   \u2502                   \u2502\n      \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502                   \u2502                   \u2502\n      \u2502                  \u2502                   \u2502                   \u2502\n      \u2502                  \u2502  consume_events   \u2502                   \u2502\n      \u2502                  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502                   \u2502\n      \u2502                  \u2502                   \u2502                   \u2502\n      \u2502                  \u2502                   \u2502  \u4e8b\u4ef6\u63a8\u9001         \u2502\n      \u2502                  \u2502                   \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n      \u2502                  \u2502                   \u2502                   \u2502\n      \u2502  SSE events      \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502                   \u2502\n      \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502                   \u2502                   \u2502\n      \u2502                  \u2502                   \u2502                   \u2502\n</code></pre>"},{"location":"_archive/frontend/02_api_design/#72-sse","title":"7.2 \u6743\u9650\u786e\u8ba4\u6d41\u7a0b\uff08\u542b SSE \u751f\u547d\u5468\u671f\uff09\ud83c\udd95","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Frontend  \u2502     \u2502  API Layer \u2502     \u2502 StreamManager\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n      \u2502                  \u2502                   \u2502\n      \u2502  SSE \u8fde\u63a5\u4e2d...    \u2502                   \u2502\n      \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502                   \u2502\n      \u2502                  \u2502                   \u2502\n      \u2502  \u6536\u5230 interrupt \u4e8b\u4ef6                  \u2502\n      \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502                   \u2502\n      \u2502                  \u2502                   \u2502\n      \u2502                  \u2502  close_stream     \u2502\n      \u2502                  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n      \u2502                  \u2502                   \u2502\n      \u2502  SSE \u8fde\u63a5\u5173\u95ed \u2702\ufe0f  \u2502                   \u2502\n      \u2502\u25c4 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500 \u2500\u2502                   \u2502\n      \u2502                  \u2502                   \u2502\n      \u2502  [\u663e\u793a\u786e\u8ba4\u5bf9\u8bdd\u6846] \u2502                   \u2502\n      \u2502                  \u2502                   \u2502\n      \u2502  \u7528\u6237\u70b9\u51fb\u786e\u8ba4/\u62d2\u7edd\u2502                   \u2502\n      \u2502                  \u2502                   \u2502\n      \u2502  POST /resume    \u2502                   \u2502\n      \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502                   \u2502\n      \u2502                  \u2502                   \u2502\n      \u2502                  \u2502  create_stream    \u2502\n      \u2502                  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n      \u2502                  \u2502                   \u2502\n      \u2502  \u8fd4\u56de\u65b0 stream_url                    \u2502\n      \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502                   \u2502\n      \u2502                  \u2502                   \u2502\n      \u2502  \u9500\u6bc1\u65e7 EventSource                   \u2502\n      \u2502  \u5efa\u7acb\u65b0 EventSource                   \u2502\n      \u2502                  \u2502                   \u2502\n      \u2502  GET /stream (\u65b0\u8fde\u63a5)                 \u2502\n      \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502                   \u2502\n      \u2502                  \u2502                   \u2502\n      \u2502  \u7ee7\u7eed\u63a5\u6536\u540e\u7eed\u4e8b\u4ef6 \u2502                   \u2502\n      \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502                   \u2502\n</code></pre> <p>\u5173\u952e\u70b9\uff1a 1. \u6536\u5230 <code>interrupt</code> \u4e8b\u4ef6\u540e\uff0c\u670d\u52a1\u7aef\u4e3b\u52a8\u5173\u95ed SSE \u8fde\u63a5 2. \u524d\u7aef\u8c03\u7528 <code>/resume</code> \u540e\u83b7\u5f97\u65b0\u7684 <code>stream_url</code> 3. \u524d\u7aef\u5fc5\u987b\u9500\u6bc1\u65e7\u7684 EventSource \u5b9e\u4f8b\u540e\u518d\u5efa\u7acb\u65b0\u8fde\u63a5 4. \u8fd9\u907f\u514d\u4e86 SSE \u8fde\u63a5\u5728\u7b49\u5f85\u7528\u6237\u64cd\u4f5c\u671f\u95f4\u957f\u65f6\u95f4\u6302\u8d77</p>"},{"location":"_archive/frontend/02_api_design/#8","title":"8. \u5b9e\u65bd\u6b65\u9aa4","text":""},{"location":"_archive/frontend/02_api_design/#phase-1-1-2","title":"Phase 1: \u57fa\u7840\u6846\u67b6\uff08\u9884\u8ba1 1-2 \u5929\uff09","text":"<ol> <li>\u642d\u5efa FastAPI \u5e94\u7528</li> <li>\u521b\u5efa <code>api/main.py</code></li> <li>\u914d\u7f6e CORS</li> <li> <p>\u521b\u5efa\u57fa\u7840\u8def\u7531\u7ed3\u6784</p> </li> <li> <p>\u5b9e\u73b0\u4f9d\u8d56\u6ce8\u5165</p> </li> <li><code>get_controller()</code></li> <li><code>get_artifact_manager()</code></li> <li> <p><code>get_stream_manager()</code> \ud83c\udd95</p> </li> <li> <p>\u5b9a\u4e49 Schemas</p> </li> <li>\u8bf7\u6c42\u6a21\u578b</li> <li>\u54cd\u5e94\u6a21\u578b</li> </ol>"},{"location":"_archive/frontend/02_api_design/#phase-2-rest-api-2-3","title":"Phase 2: REST API\uff08\u9884\u8ba1 2-3 \u5929\uff09","text":"<ol> <li>\u5b9e\u73b0 Chat \u8def\u7531</li> <li>POST /chat</li> <li>GET /chat</li> <li>GET /chat/{id}</li> <li>DELETE /chat/{id}</li> <li> <p>POST /chat/{id}/resume</p> </li> <li> <p>\u5b9e\u73b0 Artifact \u8def\u7531</p> </li> <li>GET /artifacts/{session_id}</li> <li>GET /artifacts/{session_id}/{id}</li> <li>GET /artifacts/{session_id}/{id}/versions</li> <li> <p>GET /artifacts/{session_id}/{id}/versions/{v}</p> </li> <li> <p>\u7f16\u5199 API \u6d4b\u8bd5</p> </li> <li>\u4f7f\u7528 pytest + httpx (AsyncClient)</li> </ol>"},{"location":"_archive/frontend/02_api_design/#phase-3-sse-2-3","title":"Phase 3: SSE \u6d41\u5f0f\uff08\u9884\u8ba1 2-3 \u5929\uff09","text":"<ol> <li>\u5b9e\u73b0 StreamManager \ud83c\udd95</li> <li>\u4e8b\u4ef6\u7f13\u51b2\u961f\u5217</li> <li>TTL \u673a\u5236</li> <li> <p>\u8fde\u63a5\u72b6\u6001\u8ffd\u8e2a</p> </li> <li> <p>\u5b9e\u73b0 Stream \u8def\u7531</p> </li> <li>GET /stream/{thread_id}</li> <li>\u4e0e Controller \u96c6\u6210</li> <li> <p>\u7ec8\u7ed3\u4e8b\u4ef6\u540e\u4e3b\u52a8\u5173\u95ed\u8fde\u63a5 \ud83c\udd95</p> </li> <li> <p>\u5904\u7406\u8fb9\u7f18\u60c5\u51b5</p> </li> <li>\u8fde\u63a5\u65ad\u5f00\u91cd\u8fde</li> <li>\u8d85\u65f6\u5904\u7406</li> <li>TTL \u8fc7\u671f\u6e05\u7406 \ud83c\udd95</li> </ol>"},{"location":"_archive/frontend/02_api_design/#phase-4-1-2","title":"Phase 4: \u96c6\u6210\u6d4b\u8bd5\uff08\u9884\u8ba1 1-2 \u5929\uff09","text":"<ol> <li>\u7aef\u5230\u7aef\u6d4b\u8bd5</li> <li>\u5b8c\u6574\u7684\u5bf9\u8bdd\u6d41\u7a0b</li> <li>\u6743\u9650\u786e\u8ba4\u6d41\u7a0b\uff08\u542b\u8fde\u63a5\u5173\u95ed/\u91cd\u5efa\uff09\ud83c\udd95</li> <li> <p>\u5206\u652f\u5bf9\u8bdd\u6d41\u7a0b</p> </li> <li> <p>\u6027\u80fd\u6d4b\u8bd5</p> </li> <li>\u5e76\u53d1\u8fde\u63a5\u6570</li> <li>SSE \u63a8\u9001\u5ef6\u8fdf</li> <li>\u5185\u5b58\u6cc4\u6f0f\u68c0\u6d4b\uff08TTL \u673a\u5236\u9a8c\u8bc1\uff09\ud83c\udd95</li> </ol>"},{"location":"_archive/frontend/02_api_design/#9","title":"9. \u540e\u7eed\u6269\u5c55\u9884\u7559","text":""},{"location":"_archive/frontend/02_api_design/#91-phase-2","title":"9.1 \u7528\u6237\u8ba4\u8bc1\uff08Phase 2\uff09","text":"<p>\u9884\u7559\u4f4d\u7f6e\uff1a - <code>dependencies.py</code> \u4e2d\u7684 <code>get_current_user()</code> - \u6240\u6709\u8def\u7531\u7684 <code>user_id</code> \u53c2\u6570</p> <p>\u5b9e\u73b0\u65b9\u5f0f\uff08\u5efa\u8bae\uff09\uff1a - JWT Token \u8ba4\u8bc1 - \u53ef\u9009\uff1aOAuth2 (Google/GitHub \u767b\u5f55)</p> <p>\u8fc1\u79fb\u8def\u5f84\uff1a 1. \u6dfb\u52a0 <code>users</code> \u8868\u548c Repository 2. \u5b9e\u73b0 JWT \u751f\u6210/\u9a8c\u8bc1 3. \u5b9e\u73b0 <code>get_current_user()</code> \u4f9d\u8d56 4. \u6dfb\u52a0 <code>/auth</code> \u8def\u7531</p>"},{"location":"_archive/frontend/02_api_design/#92-websocket","title":"9.2 WebSocket\uff08\u5982\u9700\u53cc\u5411\u901a\u4fe1\uff09","text":"<p>\u9884\u7559\u4f4d\u7f6e\uff1a - <code>api/routers/ws.py</code></p> <p>\u4f7f\u7528\u573a\u666f\uff1a - \u534f\u4f5c\u7f16\u8f91 - \u5b9e\u65f6\u901a\u77e5 - \u53cc\u5411\u63a7\u5236\uff08\u5982\u53d6\u6d88\u6267\u884c\uff09</p>"},{"location":"_archive/frontend/02_api_design/#10","title":"10. \u4f9d\u8d56\u6e05\u5355","text":"<pre><code># API \u4f9d\u8d56\nfastapi&gt;=0.109.0\nuvicorn[standard]&gt;=0.27.0\nsse-starlette&gt;=1.8.0\npydantic&gt;=2.5.0\npython-multipart&gt;=0.0.6  # \u6587\u4ef6\u4e0a\u4f20\u652f\u6301\uff08\u9884\u7559\uff09\naiofiles&gt;=23.2.0         # \ud83c\udd95 \u5f02\u6b65\u6587\u4ef6\u64cd\u4f5c\n\n# \u6d4b\u8bd5\u4f9d\u8d56\nhttpx&gt;=0.26.0\npytest-asyncio&gt;=0.23.0\n</code></pre>"},{"location":"_archive/frontend/02_api_design/#11","title":"11. \u914d\u7f6e\u9879","text":"<pre><code># api/config.py\n\nclass APIConfig:\n    # \u670d\u52a1\u5668\u914d\u7f6e\n    HOST: str = \"0.0.0.0\"\n    PORT: int = 8000\n    DEBUG: bool = True\n\n    # CORS \u914d\u7f6e\n    CORS_ORIGINS: list = [\"http://localhost:3000\"]  # Next.js \u5f00\u53d1\u670d\u52a1\u5668\n\n    # SSE \u914d\u7f6e\n    SSE_PING_INTERVAL: int = 15  # \u79d2\uff0c\u4fdd\u6301\u8fde\u63a5\u6d3b\u8dc3\n    STREAM_TIMEOUT: int = 300    # \u79d2\uff0c\u6700\u5927\u6267\u884c\u65f6\u95f4\n    STREAM_TTL: int = 30         # \ud83c\udd95 \u79d2\uff0c\u961f\u5217 TTL\uff08\u524d\u7aef\u672a\u8fde\u63a5\u65f6\u81ea\u52a8\u6e05\u7406\uff09\n\n    # \u5206\u9875\u9ed8\u8ba4\u503c\n    DEFAULT_PAGE_SIZE: int = 20\n    MAX_PAGE_SIZE: int = 100\n</code></pre>"},{"location":"_archive/frontend/02_api_design/#v14-v15","title":"\u9644\u5f55\uff1av1.4 \u2192 v1.5 \u53d8\u66f4\u6458\u8981","text":"\u7ae0\u8282 \u53d8\u66f4\u7c7b\u578b \u8bf4\u660e 4.3 \ud83d\udd04 \u66f4\u65b0 \u6d41\u5f0f\u63a5\u53e3\u4e8b\u4ef6\u683c\u5f0f\u66f4\u65b0\u4e3a\u7edf\u4e00\u7684 StreamEventType 4.4 \ud83c\udd95 \u65b0\u589e \u7edf\u4e00\u4e8b\u4ef6\u7c7b\u578b\uff08StreamEventType\uff09\u8bbe\u8ba1 4.5 \ud83c\udd95 \u65b0\u589e ExecutionMetrics \u53ef\u89c2\u6d4b\u6027\u6307\u6807\u8bbe\u8ba1 <p>\u5173\u952e\u53d8\u66f4\u8bf4\u660e\uff1a</p> <ol> <li>\u7edf\u4e00\u4e8b\u4ef6\u7c7b\u578b\uff1a\u79fb\u9664 <code>ControllerEventType</code>\uff0c\u6240\u6709\u5c42\uff08Agent/Graph/Controller\uff09\u4f7f\u7528\u7edf\u4e00\u7684 <code>StreamEventType</code></li> <li>\u4e8b\u4ef6\u76f4\u63a5\u900f\u4f20\uff1aController \u4e0d\u518d\u5c06\u4e8b\u4ef6\u5305\u88c5\u4e3a <code>stream</code> \u7c7b\u578b\uff0c\u76f4\u63a5\u900f\u4f20 graph \u7684\u4e8b\u4ef6</li> <li>ExecutionMetrics\uff1a\u65b0\u589e\u53ef\u89c2\u6d4b\u6027\u6307\u6807\uff0c\u5728 <code>complete</code> \u4e8b\u4ef6\u4e2d\u8fd4\u56de\u5b8c\u6574\u7684\u6267\u884c\u7edf\u8ba1\u4fe1\u606f</li> <li>\u4e8b\u4ef6\u547d\u540d\u53d8\u66f4\uff1a</li> <li><code>start</code> \u2192 <code>agent_start</code></li> <li><code>complete</code>\uff08Agent \u5c42\uff09\u2192 <code>agent_complete</code></li> <li><code>tool_result</code> \u2192 <code>tool_complete</code></li> <li><code>permission_required</code> \u2192 <code>permission_request</code></li> <li>\u65b0\u589e\u4e8b\u4ef6\uff1a<code>tool_start</code>\uff08\u5de5\u5177\u5f00\u59cb\u6267\u884c\uff09\u3001<code>permission_result</code>\uff08\u6743\u9650\u786e\u8ba4\u7ed3\u679c\uff09</li> </ol>"},{"location":"_archive/frontend/02_api_design/#v13-v14","title":"\u9644\u5f55\uff1av1.3 \u2192 v1.4 \u53d8\u66f4\u6458\u8981","text":"\u7ae0\u8282 \u53d8\u66f4\u7c7b\u578b \u8bf4\u660e 6.2 \ud83d\udd04 \u66f4\u65b0 Checkpointer \u4ece MemorySaver \u6539\u4e3a AsyncSqliteSaver 6.5 \ud83d\udd04 \u66f4\u65b0 \u5e76\u53d1\u5b89\u5168\u8868\u66f4\u65b0 Checkpointer \u8bf4\u660e <p>\u5173\u952e\u53d8\u66f4\u8bf4\u660e\uff1a</p> <ol> <li>Checkpointer \u6301\u4e45\u5316\uff1a\u4ece\u5185\u5b58\u5b58\u50a8 (<code>MemorySaver</code>) \u6539\u4e3a SQLite \u6301\u4e45\u5316 (<code>AsyncSqliteSaver</code>)\uff0c\u670d\u52a1\u91cd\u542f\u540e interrupt/resume \u72b6\u6001\u4e0d\u4e22\u5931</li> <li><code>create_multi_agent_graph</code> \u6539\u4e3a async\uff1a\u56e0\u4e3a\u521b\u5efa checkpointer \u9700\u8981\u5f02\u6b65\u521d\u59cb\u5316</li> <li>\u8fde\u63a5\u6e05\u7406\uff1a<code>close_globals()</code> \u9700\u8981\u5173\u95ed checkpointer \u7684 aiosqlite \u8fde\u63a5\uff0c\u907f\u514d\u7a0b\u5e8f\u65e0\u6cd5\u6b63\u5e38\u9000\u51fa</li> </ol>"},{"location":"_archive/frontend/02_api_design/#v12-v13","title":"\u9644\u5f55\uff1av1.2 \u2192 v1.3 \u53d8\u66f4\u6458\u8981","text":"\u7ae0\u8282 \u53d8\u66f4\u7c7b\u578b \u8bf4\u660e 4.1 \ud83d\udd04 \u66f4\u65b0 Resume \u63a5\u53e3\u589e\u52a0 <code>message_id</code> \u53c2\u6570\uff0c\u6539\u4e3a\u65e0\u72b6\u6001\u8bbe\u8ba1 6.2 \ud83d\udd04 \u66f4\u65b0 \u4f9d\u8d56\u6ce8\u5165\u793a\u4f8b\u589e\u52a0\u5171\u4eab checkpointer 6.5 \ud83d\udd04 \u66f4\u65b0 \u5e76\u53d1\u5b89\u5168\u8868\u589e\u52a0 Checkpointer \u7ec4\u4ef6 <p>\u5173\u952e\u53d8\u66f4\u8bf4\u660e\uff1a</p> <ol> <li>Controller \u65e0\u72b6\u6001\u8bbe\u8ba1\uff1aController \u4e0d\u518d\u4fdd\u5b58 <code>interrupted_threads</code> \u72b6\u6001</li> <li>Resume \u63a5\u53e3\u53d8\u66f4\uff1a\u5fc5\u987b\u4f20\u5165 <code>thread_id</code>\u3001<code>message_id</code>\u3001<code>approved</code> \u4e09\u4e2a\u53c2\u6570</li> <li>\u53c2\u6570\u6765\u6e90\uff1a\u6240\u6709 resume \u6240\u9700\u53c2\u6570\u90fd\u53ef\u4ee5\u4ece\u4e2d\u65ad\u4e8b\u4ef6\uff08<code>interrupt</code>\uff09\u7684\u8fd4\u56de\u6570\u636e\u4e2d\u83b7\u53d6</li> <li>Checkpointer \u5171\u4eab\uff1aLangGraph \u7684 checkpointer \u5fc5\u987b\u8de8\u8bf7\u6c42\u5171\u4eab\uff0c\u5426\u5219 interrupt/resume \u65e0\u6cd5\u6b63\u5e38\u5de5\u4f5c</li> </ol>"},{"location":"_archive/frontend/02_api_design/#v11-v12","title":"\u9644\u5f55\uff1av1.1 \u2192 v1.2 \u53d8\u66f4\u6458\u8981","text":"\u7ae0\u8282 \u53d8\u66f4\u7c7b\u578b \u8bf4\u660e 6.2 \ud83d\udd04 \u91cd\u5199 \u5b8c\u6574\u7684\u4f9d\u8d56\u6ce8\u5165\u793a\u4f8b\uff0c\u5305\u542b\u8bf7\u6c42\u7ea7\u522b session \u9694\u79bb 6.5 \ud83c\udd95 \u65b0\u589e \u6570\u636e\u5e93\u4f1a\u8bdd\u4e0e\u4e8b\u52a1\u7ba1\u7406\uff08\u5e76\u53d1\u5b89\u5168\u8bbe\u8ba1\uff09 <p>\u5173\u952e\u53d8\u66f4\u8bf4\u660e\uff1a</p> <ol> <li>Controller \u4e0d\u518d\u7ba1\u7406\u4e8b\u52a1\uff1a\u4e8b\u52a1\u8fb9\u754c\u7531 API \u5c42\u7684\u4f9d\u8d56\u6ce8\u5165\u7ba1\u7406</li> <li>\u6bcf\u4e2a\u8bf7\u6c42\u72ec\u7acb\u7684\u7ec4\u4ef6\u94fe\uff1aSession \u2192 Repository \u2192 Manager \u2192 Graph \u2192 Controller</li> <li>Graph \u6bcf\u6b21\u8bf7\u6c42\u521b\u5efa\u65b0\u5b9e\u4f8b\uff1a\u56e0\u4e3a Graph \u6301\u6709 artifact_manager \u5f15\u7528\uff0c\u5171\u4eab\u4f1a\u5bfc\u81f4\u5e76\u53d1\u95ee\u9898</li> </ol>"},{"location":"_archive/frontend/02_api_design/#v10-v11","title":"\u9644\u5f55\uff1av1.0 \u2192 v1.1 \u53d8\u66f4\u6458\u8981","text":"\u7ae0\u8282 \u53d8\u66f4\u7c7b\u578b \u8bf4\u660e 2.1 \ud83c\udd95 \u65b0\u589e \u5168\u94fe\u8def\u5f02\u6b65 I/O \u5f00\u53d1\u6807\u51c6 3.1 \u66f4\u65b0 \u67b6\u6784\u56fe\u589e\u52a0 StreamManager 4.1 \u66f4\u65b0 resume \u63a5\u53e3\u8bf4\u660e\u589e\u5f3a 4.3 \u66f4\u65b0 SSE \u8fde\u63a5\u751f\u547d\u5468\u671f\u8868 5.1 \u66f4\u65b0 \u65b0\u589e services/stream_manager.py 6.2 \u66f4\u65b0 \u4f9d\u8d56\u6ce8\u5165\u793a\u4f8b\u4ee3\u7801 6.4 \ud83c\udd95 \u65b0\u589e StreamManager \u8be6\u7ec6\u8bbe\u8ba1 7.2 \ud83c\udd95 \u91cd\u5199 \u6743\u9650\u786e\u8ba4\u6d41\u7a0b\u542b SSE \u751f\u547d\u5468\u671f 8 \u66f4\u65b0 \u5b9e\u65bd\u6b65\u9aa4\u589e\u52a0 StreamManager \u76f8\u5173\u4efb\u52a1 10 \u66f4\u65b0 \u4f9d\u8d56\u589e\u52a0 aiofiles 11 \u66f4\u65b0 \u914d\u7f6e\u589e\u52a0 STREAM_TTL"},{"location":"_archive/frontend/03_frontend_design/","title":"ArtifactFlow \u524d\u7aef\u5b9e\u73b0\u65b9\u6848","text":"<p>\u7248\u672c: v1.1 | \u4f9d\u8d56: API \u5c42\u5b8c\u6210</p> <p>v1.1 \u53d8\u66f4\uff1a\u6574\u5408\u67b6\u6784\u4f18\u5316\u5efa\u8bae\uff0c\u589e\u5f3a\u72b6\u6001\u7ba1\u7406\u3001\u660e\u786e\u6e32\u67d3\u7b56\u7565\u3001\u89c4\u8303 SSE \u751f\u547d\u5468\u671f</p>"},{"location":"_archive/frontend/03_frontend_design/#1","title":"1. \u8bbe\u8ba1\u76ee\u6807","text":"<p>\u6784\u5efa\u7c7b\u4f3c Claude Web UI \u7684\u53cc\u9762\u677f\u4ea4\u4e92\u754c\u9762\uff1a</p> <ol> <li>\u5de6\u4fa7\u5bf9\u8bdd\u9762\u677f\uff1a\u6d88\u606f\u5217\u8868\u3001\u5b9e\u65f6\u6d41\u5f0f\u8f93\u51fa\u3001\u5206\u652f\u5bf9\u8bdd\u652f\u6301</li> <li>\u53f3\u4fa7 Artifact \u9762\u677f\uff1aArtifact \u5c55\u793a\u3001\u7248\u672c\u5207\u6362\u3001Diff \u5bf9\u6bd4</li> <li>\u6d41\u5f0f\u4f53\u9a8c\uff1a\u5b9e\u65f6\u6e32\u67d3 Agent \u601d\u8003\u8fc7\u7a0b\u3001\u5de5\u5177\u8c03\u7528\u72b6\u6001</li> <li>\u5386\u53f2\u52a0\u8f7d\uff1a\u52a0\u8f7d\u5386\u53f2\u5bf9\u8bdd\u65f6\u53ea\u663e\u793a\u6700\u7ec8\u7ed3\u679c\uff0c\u4e0d\u6e32\u67d3\u4e2d\u95f4\u8fc7\u7a0b</li> </ol>"},{"location":"_archive/frontend/03_frontend_design/#2","title":"2. \u6280\u672f\u9009\u578b","text":"\u7ec4\u4ef6 \u9009\u578b \u7406\u7531 \u6846\u67b6 Next.js 14 (App Router) React \u751f\u6001\u3001SSR/SSG \u652f\u6301\u3001API Routes \u72b6\u6001\u7ba1\u7406 Zustand \u8f7b\u91cf\u3001\u7b80\u5355\u3001TypeScript \u53cb\u597d UI \u7ec4\u4ef6\u5e93 shadcn/ui \u9ad8\u8d28\u91cf\u3001\u53ef\u5b9a\u5236\u3001\u57fa\u4e8e Radix \u6837\u5f0f Tailwind CSS \u4e0e shadcn/ui \u914d\u5957\u3001\u5feb\u901f\u5f00\u53d1 \u4ee3\u7801\u7f16\u8f91\u5668 Monaco Editor VS Code \u540c\u6b3e\u3001\u539f\u751f\u652f\u6301 Diff Markdown \u6e32\u67d3 react-markdown + remark-gfm \u8f7b\u91cf\u3001\u63d2\u4ef6\u4e30\u5bcc SSE \u5ba2\u6237\u7aef \u539f\u751f EventSource \u6d4f\u89c8\u5668\u5185\u7f6e\u3001\u7b80\u5355\u53ef\u9760"},{"location":"_archive/frontend/03_frontend_design/#3","title":"3. \u6574\u4f53\u67b6\u6784","text":""},{"location":"_archive/frontend/03_frontend_design/#31","title":"3.1 \u9875\u9762\u7ed3\u6784","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         Header                               \u2502\n\u2502  [Logo]  [New Chat]                    [Settings] [User]    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502           \u2502                                                  \u2502\n\u2502  Sidebar  \u2502                   Main Content                   \u2502\n\u2502           \u2502                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2510  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502Conv \u2502  \u2502  \u2502                  \u2502                      \u2502   \u2502\n\u2502  \u2502List \u2502  \u2502  \u2502   Chat Panel     \u2502   Artifact Panel     \u2502   \u2502\n\u2502  \u2502     \u2502  \u2502  \u2502                  \u2502                      \u2502   \u2502\n\u2502  \u2502     \u2502  \u2502  \u2502  - Messages      \u2502  - Tabs (artifacts)  \u2502   \u2502\n\u2502  \u2502     \u2502  \u2502  \u2502  - Input         \u2502  - Content View      \u2502   \u2502\n\u2502  \u2502     \u2502  \u2502  \u2502  - Stream UI     \u2502  - Version Selector  \u2502   \u2502\n\u2502  \u2502     \u2502  \u2502  \u2502                  \u2502  - Monaco/Markdown   \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2518  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502           \u2502                                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"_archive/frontend/03_frontend_design/#32","title":"3.2 \u8def\u7531\u8bbe\u8ba1","text":"<pre><code>/                           \u2192 \u91cd\u5b9a\u5411\u5230 /chat\n/chat                       \u2192 \u65b0\u5bf9\u8bdd\u9875\u9762\n/chat/[conversationId]      \u2192 \u5bf9\u8bdd\u8be6\u60c5\u9875\u9762\n/settings                   \u2192 \u8bbe\u7f6e\u9875\u9762\uff08\u9884\u7559\uff09\n/login                      \u2192 \u767b\u5f55\u9875\u9762\uff08\u9884\u7559\uff09\n</code></pre>"},{"location":"_archive/frontend/03_frontend_design/#33","title":"3.3 \u7ec4\u4ef6\u5c42\u6b21","text":"<pre><code>app/\n\u251c\u2500\u2500 layout.tsx              # \u6839\u5e03\u5c40\uff08Header + Sidebar\uff09\n\u251c\u2500\u2500 page.tsx                # \u9996\u9875\u91cd\u5b9a\u5411\n\u2502\n\u251c\u2500\u2500 chat/\n\u2502   \u251c\u2500\u2500 layout.tsx          # Chat \u5e03\u5c40\uff08\u53cc\u9762\u677f\uff09\n\u2502   \u251c\u2500\u2500 page.tsx            # \u65b0\u5bf9\u8bdd\n\u2502   \u2514\u2500\u2500 [id]/\n\u2502       \u2514\u2500\u2500 page.tsx        # \u5bf9\u8bdd\u8be6\u60c5\n\u2502\n\u2514\u2500\u2500 (auth)/                 # \u9884\u7559\uff1a\u8ba4\u8bc1\u76f8\u5173\n    \u251c\u2500\u2500 login/\n    \u2502   \u2514\u2500\u2500 page.tsx\n    \u2514\u2500\u2500 register/\n        \u2514\u2500\u2500 page.tsx\n</code></pre>"},{"location":"_archive/frontend/03_frontend_design/#4","title":"4. \u6838\u5fc3\u7ec4\u4ef6\u8bbe\u8ba1","text":""},{"location":"_archive/frontend/03_frontend_design/#41-chat-panel","title":"4.1 Chat Panel \u7ec4\u4ef6\u6811","text":"<pre><code>ChatPanel/\n\u251c\u2500\u2500 MessageList/\n\u2502   \u251c\u2500\u2500 MessageItem/\n\u2502   \u2502   \u251c\u2500\u2500 UserMessage         # \u7528\u6237\u6d88\u606f\u6c14\u6ce1\n\u2502   \u2502   \u251c\u2500\u2500 AssistantMessage    # AI \u54cd\u5e94\u6c14\u6ce1\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 StreamingContent    # \u6d41\u5f0f\u5185\u5bb9\uff08\u6253\u5b57\u673a\u6548\u679c\uff09\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 ReasoningBlock      # \u601d\u8003\u8fc7\u7a0b\u6298\u53e0\u5757\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 ToolCallIndicator   # \u5de5\u5177\u8c03\u7528\u6307\u793a\u5668\n\u2502   \u2502   \u2514\u2500\u2500 BranchIndicator     # \u5206\u652f\u6807\u8bb0\n\u2502   \u2514\u2500\u2500 StreamingMessage        # \u6b63\u5728\u751f\u6210\u7684\u6d88\u606f\n\u2502\n\u251c\u2500\u2500 ChatInput/\n\u2502   \u251c\u2500\u2500 TextArea               # \u8f93\u5165\u6846\n\u2502   \u251c\u2500\u2500 SendButton             # \u53d1\u9001\u6309\u94ae\n\u2502   \u2514\u2500\u2500 AttachButton           # \u9644\u4ef6\u6309\u94ae\uff08\u9884\u7559\uff09\n\u2502\n\u2514\u2500\u2500 PermissionDialog/          # \u6743\u9650\u786e\u8ba4\u5bf9\u8bdd\u6846\n    \u251c\u2500\u2500 ToolInfo               # \u5de5\u5177\u4fe1\u606f\u5c55\u793a\n    \u2514\u2500\u2500 ActionButtons          # \u786e\u8ba4/\u62d2\u7edd\u6309\u94ae\n</code></pre>"},{"location":"_archive/frontend/03_frontend_design/#42-artifact-panel","title":"4.2 Artifact Panel \u7ec4\u4ef6\u6811","text":"<pre><code>ArtifactPanel/\n\u251c\u2500\u2500 ArtifactTabs/\n\u2502   \u251c\u2500\u2500 TabItem                # \u5355\u4e2a Artifact Tab\n\u2502   \u2514\u2500\u2500 AddTabButton           # \u9884\u7559\uff1a\u624b\u52a8\u521b\u5efa Artifact\n\u2502\n\u251c\u2500\u2500 ArtifactViewer/\n\u2502   \u251c\u2500\u2500 ViewModeToggle         # \u5207\u6362 Raw/Rendered \u6a21\u5f0f\n\u2502   \u251c\u2500\u2500 VersionSelector        # \u7248\u672c\u9009\u62e9\u4e0b\u62c9\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 MonacoViewer/          # Raw \u6a21\u5f0f\n\u2502   \u2502   \u251c\u2500\u2500 SingleView         # \u5355\u7248\u672c\u67e5\u770b\n\u2502   \u2502   \u2514\u2500\u2500 DiffView           # Diff \u5bf9\u6bd4\n\u2502   \u2502\n\u2502   \u2514\u2500\u2500 RenderedViewer/        # \u6e32\u67d3\u6a21\u5f0f\n\u2502       \u251c\u2500\u2500 MarkdownRenderer   # Markdown \u6e32\u67d3\n\u2502       \u251c\u2500\u2500 CodeHighlighter    # \u4ee3\u7801\u9ad8\u4eae\n\u2502       \u2514\u2500\u2500 HtmlPreview        # HTML \u9884\u89c8\uff08iframe sandbox\uff09\n\u2502\n\u2514\u2500\u2500 ArtifactMeta/\n    \u251c\u2500\u2500 Title                  # \u6807\u9898\n    \u251c\u2500\u2500 UpdateTime             # \u66f4\u65b0\u65f6\u95f4\n    \u2514\u2500\u2500 VersionInfo            # \u7248\u672c\u4fe1\u606f\n</code></pre>"},{"location":"_archive/frontend/03_frontend_design/#43-sidebar","title":"4.3 Sidebar \u7ec4\u4ef6\u6811","text":"<pre><code>Sidebar/\n\u251c\u2500\u2500 NewChatButton              # \u65b0\u5efa\u5bf9\u8bdd\u6309\u94ae\n\u2502\n\u251c\u2500\u2500 ConversationList/\n\u2502   \u251c\u2500\u2500 ConversationItem/\n\u2502   \u2502   \u251c\u2500\u2500 Title              # \u5bf9\u8bdd\u6807\u9898\n\u2502   \u2502   \u251c\u2500\u2500 Preview            # \u6700\u540e\u6d88\u606f\u9884\u89c8\n\u2502   \u2502   \u251c\u2500\u2500 Timestamp          # \u65f6\u95f4\u6233\n\u2502   \u2502   \u2514\u2500\u2500 ActionMenu         # \u5220\u9664\u3001\u91cd\u547d\u540d\u7b49\n\u2502   \u2514\u2500\u2500 LoadMoreButton         # \u52a0\u8f7d\u66f4\u591a\n\u2502\n\u2514\u2500\u2500 BottomSection/\n    \u251c\u2500\u2500 SettingsButton         # \u8bbe\u7f6e\u6309\u94ae\n    \u2514\u2500\u2500 UserInfo               # \u7528\u6237\u4fe1\u606f\uff08\u9884\u7559\uff09\n</code></pre>"},{"location":"_archive/frontend/03_frontend_design/#5","title":"5. \u72b6\u6001\u7ba1\u7406\u8bbe\u8ba1","text":""},{"location":"_archive/frontend/03_frontend_design/#51-store","title":"5.1 Store \u5212\u5206","text":"<pre><code>stores/\n\u251c\u2500\u2500 conversationStore.ts      # \u5bf9\u8bdd\u72b6\u6001\n\u251c\u2500\u2500 artifactStore.ts          # Artifact \u72b6\u6001\n\u251c\u2500\u2500 streamStore.ts            # \u6d41\u5f0f\u72b6\u6001\n\u2514\u2500\u2500 uiStore.ts                # UI \u72b6\u6001\n</code></pre>"},{"location":"_archive/frontend/03_frontend_design/#52-conversationstore","title":"5.2 conversationStore","text":"<p>\u72b6\u6001\u5b57\u6bb5\uff1a <pre><code>// [v1.1 \u65b0\u589e] \u6d88\u606f\u72b6\u6001\u679a\u4e3e\ntype MessageStatus = 'sending' | 'sent' | 'error';\n\n// [v1.1 \u65b0\u589e] \u589e\u5f3a\u7684\u6d88\u606f\u7c7b\u578b\ninterface Message {\n  id: string;\n  conversationId: string;\n  parentId: string | null;\n  content: string;\n  role: 'user' | 'assistant';\n  response?: string;          // assistant \u7684\u54cd\u5e94\u5185\u5bb9\n  createdAt: string;\n\n  // [v1.1 \u65b0\u589e] \u72b6\u6001\u5b57\u6bb5 - \u7528\u4e8e\u4e50\u89c2\u66f4\u65b0\u7684\u5b89\u5168\u56de\u6eda\n  status: MessageStatus;\n\n  // [v1.1 \u65b0\u589e] \u9519\u8bef\u4fe1\u606f - \u5f53 status === 'error' \u65f6\u5b58\u5728\n  error?: string;\n}\n\ninterface ConversationStore {\n  // \u5bf9\u8bdd\u5217\u8868\n  conversations: ConversationSummary[]\n  isLoadingList: boolean\n  hasMore: boolean\n\n  // \u5f53\u524d\u5bf9\u8bdd\n  currentConversation: ConversationDetail | null\n  isLoadingConversation: boolean\n\n  // \u6d88\u606f\u5206\u652f\u8def\u5f84\n  currentBranchPath: string[]  // \u4ece\u6839\u5230\u5f53\u524d\u8282\u70b9\u7684 message IDs\n\n  // Actions\n  fetchConversations(): Promise&lt;void&gt;\n  fetchConversation(id: string): Promise&lt;void&gt;\n  createConversation(): string\n  deleteConversation(id: string): Promise&lt;void&gt;\n  switchBranch(messageId: string): void\n\n  // [v1.1 \u65b0\u589e] \u4e50\u89c2\u66f4\u65b0\u76f8\u5173 Actions\n  addOptimisticMessage(message: Omit&lt;Message, 'status'&gt;): string  // \u8fd4\u56de\u4e34\u65f6 ID\n  confirmMessage(tempId: string, realId: string): void            // \u786e\u8ba4\u6210\u529f\n  failMessage(tempId: string, error: string): void                // \u6807\u8bb0\u5931\u8d25\n  retryMessage(messageId: string): Promise&lt;void&gt;                  // \u91cd\u8bd5\u53d1\u9001\n  removeMessage(messageId: string): void                          // \u79fb\u9664\u5931\u8d25\u6d88\u606f\n}\n</code></pre></p> <p>[v1.1 \u65b0\u589e] \u4e50\u89c2\u66f4\u65b0\u5b89\u5168\u56de\u6eda\u673a\u5236\uff1a</p> <pre><code>// \u53d1\u9001\u6d88\u606f\u65f6\u7684\u4e50\u89c2\u66f4\u65b0\u6d41\u7a0b\nasync function sendMessage(content: string, parentId?: string) {\n  // 1. \u7acb\u5373\u6dfb\u52a0\u6d88\u606f\u5230 UI\uff08status: 'sending'\uff09\n  const tempId = addOptimisticMessage({\n    id: `temp-${Date.now()}`,\n    content,\n    role: 'user',\n    parentId,\n    // ...\n  });\n\n  try {\n    // 2. \u8c03\u7528 API\n    const response = await api.sendMessage(content, parentId);\n\n    // 3. \u6210\u529f\uff1a\u786e\u8ba4\u6d88\u606f\uff08status: 'sent'\uff0c\u66ff\u6362 ID\uff09\n    confirmMessage(tempId, response.messageId);\n\n  } catch (error) {\n    // 4. \u5931\u8d25\uff1a\u6807\u8bb0\u9519\u8bef\uff08status: 'error'\uff09\n    failMessage(tempId, error.message);\n    // UI \u663e\u793a\u91cd\u8bd5\u6309\u94ae\uff0c\u7528\u6237\u53ef\u9009\u62e9\u91cd\u8bd5\u6216\u5220\u9664\n  }\n}\n</code></pre>"},{"location":"_archive/frontend/03_frontend_design/#53-artifactstore","title":"5.3 artifactStore","text":"<p>\u72b6\u6001\u5b57\u6bb5\uff1a <pre><code>interface ArtifactStore {\n  // \u5f53\u524d session \u7684 artifacts\n  artifacts: ArtifactSummary[]\n  isLoading: boolean\n\n  // \u5f53\u524d\u9009\u4e2d\u7684 artifact\n  currentArtifact: ArtifactDetail | null\n  currentVersion: number | null\n  compareVersion: number | null  // Diff \u5bf9\u6bd4\u7684\u7248\u672c\n\n  // \u7248\u672c\u7f13\u5b58\n  versionCache: Map&lt;string, ArtifactVersion&gt;  // `${artifactId}-${version}` -&gt; content\n\n  // [v1.1 \u65b0\u589e] \u66f4\u65b0\u6307\u793a\n  pendingUpdates: Set&lt;string&gt;  // \u6709\u5f85\u5237\u65b0\u7684 artifact IDs\n\n  // Actions\n  fetchArtifacts(sessionId: string): Promise&lt;void&gt;\n  fetchArtifact(sessionId: string, artifactId: string): Promise&lt;void&gt;\n  fetchVersion(sessionId: string, artifactId: string, version: number): Promise&lt;void&gt;\n  selectArtifact(artifactId: string): void\n  selectVersion(version: number): void\n  enableDiffMode(baseVersion: number): void\n  disableDiffMode(): void\n\n  // [v1.1 \u65b0\u589e] \u6807\u8bb0\u66f4\u65b0\n  markPendingUpdate(artifactId: string): void\n  clearPendingUpdates(): void\n}\n</code></pre></p>"},{"location":"_archive/frontend/03_frontend_design/#54-streamstore","title":"5.4 streamStore","text":"<p>\u72b6\u6001\u5b57\u6bb5\uff1a <pre><code>interface StreamStore {\n  // \u5f53\u524d\u6d41\u5f0f\u72b6\u6001\n  isStreaming: boolean\n  currentThreadId: string | null\n\n  // \u6d41\u5f0f\u5185\u5bb9\u7d2f\u79ef\n  streamContent: string\n  reasoningContent: string\n\n  // Agent \u6267\u884c\u72b6\u6001\n  currentAgent: string | null\n  toolCalls: ToolCallInfo[]\n\n  // \u6743\u9650\u8bf7\u6c42\n  pendingPermission: PermissionRequest | null\n\n  // [v1.1 \u65b0\u589e] EventSource \u5b9e\u4f8b\u5f15\u7528\uff08\u7528\u4e8e\u751f\u547d\u5468\u671f\u7ba1\u7406\uff09\n  eventSourceRef: EventSource | null\n\n  // Actions\n  startStream(threadId: string): void\n  appendContent(content: string): void\n  appendReasoning(reasoning: string): void\n  addToolCall(toolCall: ToolCallInfo): void\n  requestPermission(request: PermissionRequest): void\n  resolvePermission(approved: boolean): Promise&lt;void&gt;\n  endStream(): void\n  reset(): void\n\n  // [v1.1 \u65b0\u589e] EventSource \u751f\u547d\u5468\u671f\u7ba1\u7406\n  setEventSource(es: EventSource | null): void\n  destroyEventSource(): void  // \u663e\u5f0f\u9500\u6bc1\n}\n</code></pre></p>"},{"location":"_archive/frontend/03_frontend_design/#55-uistore","title":"5.5 uiStore","text":"<p>\u72b6\u6001\u5b57\u6bb5\uff1a <pre><code>interface UIStore {\n  // \u9762\u677f\u72b6\u6001\n  sidebarCollapsed: boolean\n  artifactPanelVisible: boolean\n  artifactPanelWidth: number  // \u53ef\u62d6\u62fd\u8c03\u6574\n\n  // \u89c6\u56fe\u6a21\u5f0f\n  artifactViewMode: 'raw' | 'rendered'\n  diffModeEnabled: boolean\n\n  // Actions\n  toggleSidebar(): void\n  toggleArtifactPanel(): void\n  setArtifactPanelWidth(width: number): void\n  setArtifactViewMode(mode: 'raw' | 'rendered'): void\n}\n</code></pre></p>"},{"location":"_archive/frontend/03_frontend_design/#6","title":"6. \u6570\u636e\u6d41\u8bbe\u8ba1","text":""},{"location":"_archive/frontend/03_frontend_design/#61","title":"6.1 \u53d1\u9001\u6d88\u606f\u6d41\u7a0b","text":"<pre><code>\u7528\u6237\u8f93\u5165 \u2192 ChatInput\n              \u2502\n              \u25bc\n        streamStore.reset()\n        conversationStore.addOptimisticMessage() [v1.1: status='sending']\n              \u2502\n              \u25bc\n        POST /api/v1/chat\n              \u2502\n              \u251c\u2500\u2500\u2500 \u5931\u8d25 \u2500\u2500\u2500\u2192 conversationStore.failMessage() [v1.1: status='error']\n              \u2502                     \u2502\n              \u2502                     \u25bc\n              \u2502              \u663e\u793a\u9519\u8bef\u72b6\u6001 + \u91cd\u8bd5\u6309\u94ae\n              \u2502\n              \u25bc \u6210\u529f\n        conversationStore.confirmMessage() [v1.1: status='sent']\n        \u83b7\u53d6 thread_id, stream_url\n              \u2502\n              \u25bc\n        streamStore.startStream(threadId)\n        [v1.1] streamStore.destroyEventSource() // \u786e\u4fdd\u6e05\u7406\u65e7\u8fde\u63a5\n        EventSource \u8fde\u63a5 stream_url\n        [v1.1] streamStore.setEventSource(es)\n              \u2502\n              \u25bc\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502         SSE \u4e8b\u4ef6\u5904\u7406\u5faa\u73af             \u2502\n        \u2502                                     \u2502\n        \u2502  metadata \u2192 \u66f4\u65b0 conversation state \u2502\n        \u2502  llm_chunk \u2192 streamStore.append*   \u2502\n        \u2502  tool_* \u2192 streamStore.addToolCall  \u2502\n        \u2502  permission \u2192 streamStore.request  \u2502\n        \u2502  complete \u2192 \u5b8c\u6210\u5904\u7406               \u2502\n        \u2502  error \u2192 \u9519\u8bef\u5904\u7406                  \u2502\n        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n              \u2502\n              \u25bc\n        [v1.1] \u6536\u5230\u7ec8\u6b62\u4e8b\u4ef6\u540e\uff0c\u670d\u52a1\u7aef\u5173\u95ed\u8fde\u63a5\n        streamStore.endStream()\n        streamStore.destroyEventSource()\n        conversationStore.updateMessage()\n        artifactStore.fetchArtifacts() (\u5982\u6709\u66f4\u65b0)\n</code></pre>"},{"location":"_archive/frontend/03_frontend_design/#62","title":"6.2 \u52a0\u8f7d\u5386\u53f2\u5bf9\u8bdd\u6d41\u7a0b","text":"<pre><code>\u8def\u7531\u8df3\u8f6c /chat/[id]\n              \u2502\n              \u25bc\n        conversationStore.fetchConversation(id)\n              \u2502\n              \u25bc\n        API \u8fd4\u56de\u5bf9\u8bdd\u8be6\u60c5 (messages \u6570\u7ec4)\n              \u2502\n              \u25bc\n        \u6784\u5efa\u6d88\u606f\u6811\uff0c\u786e\u5b9a\u5f53\u524d\u5206\u652f\u8def\u5f84\n              \u2502\n              \u25bc\n        \u6e32\u67d3 MessageList\n        \uff08\u53ea\u663e\u793a response\uff0c\u4e0d\u663e\u793a\u4e2d\u95f4\u8fc7\u7a0b\uff09\n              \u2502\n              \u25bc\n        artifactStore.fetchArtifacts(sessionId)\n              \u2502\n              \u25bc\n        \u6e32\u67d3 ArtifactPanel\n</code></pre>"},{"location":"_archive/frontend/03_frontend_design/#63","title":"6.3 \u6743\u9650\u786e\u8ba4\u6d41\u7a0b","text":"<p>[v1.1 \u91cd\u8981\u6539\u8fdb] SSE \u8fde\u63a5\u751f\u547d\u5468\u671f\u7ba1\u7406\uff1a</p> <pre><code>\u6536\u5230 permission_required \u4e8b\u4ef6\n              \u2502\n              \u25bc\n        [v1.1] \u670d\u52a1\u7aef\u4e3b\u52a8\u5173\u95ed SSE \u8fde\u63a5\n              \u2502\n              \u25bc\n        streamStore.requestPermission(data)\n        streamStore.destroyEventSource()  // [v1.1] \u663e\u5f0f\u9500\u6bc1\u65e7\u5b9e\u4f8b\n              \u2502\n              \u25bc\n        \u663e\u793a PermissionDialog\n        \uff08\u6b64\u65f6\u65e0 SSE \u8fde\u63a5\uff0c\u907f\u514d\u957f\u65f6\u95f4\u6302\u8d77\uff09\n              \u2502\n              \u25bc\n        \u7528\u6237\u70b9\u51fb \u786e\u8ba4/\u62d2\u7edd\n              \u2502\n              \u25bc\n        POST /api/v1/chat/{id}/resume\n              \u2502\n              \u25bc\n        \u83b7\u53d6\u65b0\u7684 stream_url\n              \u2502\n              \u25bc\n        [v1.1] \u786e\u4fdd\u65e7 EventSource \u5df2\u9500\u6bc1\n        \u521b\u5efa\u65b0 EventSource \u8fde\u63a5\n        streamStore.setEventSource(newEs)\n              \u2502\n              \u25bc\n        \u7ee7\u7eed\u6d41\u5f0f\u5904\u7406\n</code></pre> <p>[v1.1 \u5173\u952e\u4ee3\u7801\u793a\u4f8b]\uff1a</p> <pre><code>// hooks/useSSE.ts\n\nfunction useSSE(options: SSEOptions) {\n  const { setEventSource, destroyEventSource } = useStreamStore();\n\n  useEffect(() =&gt; {\n    if (!options.url) return;\n\n    // [v1.1] \u521b\u5efa\u65b0\u8fde\u63a5\u524d\uff0c\u786e\u4fdd\u9500\u6bc1\u65e7\u8fde\u63a5\n    destroyEventSource();\n\n    const es = new EventSource(options.url);\n    setEventSource(es);\n\n    es.onmessage = (event) =&gt; {\n      const data = JSON.parse(event.data);\n\n      switch (data.event_type) {\n        case 'complete':\n        case 'interrupt':\n        case 'error':\n          // [v1.1] \u7ec8\u6b62\u4e8b\u4ef6\uff1a\u670d\u52a1\u7aef\u4f1a\u5173\u95ed\u8fde\u63a5\uff0c\u524d\u7aef\u4e5f\u663e\u5f0f\u6e05\u7406\n          destroyEventSource();\n          break;\n        // ... \u5176\u4ed6\u4e8b\u4ef6\u5904\u7406\n      }\n    };\n\n    es.onerror = () =&gt; {\n      destroyEventSource();\n    };\n\n    // [v1.1] \u7ec4\u4ef6\u5378\u8f7d\u65f6\u6e05\u7406\n    return () =&gt; {\n      destroyEventSource();\n    };\n  }, [options.url]);\n}\n\n// stores/streamStore.ts\n\nconst useStreamStore = create&lt;StreamStore&gt;((set, get) =&gt; ({\n  eventSourceRef: null,\n\n  setEventSource: (es) =&gt; set({ eventSourceRef: es }),\n\n  destroyEventSource: () =&gt; {\n    const { eventSourceRef } = get();\n    if (eventSourceRef) {\n      eventSourceRef.close();  // [v1.1] \u663e\u5f0f\u5173\u95ed\n      set({ eventSourceRef: null });\n    }\n  },\n\n  // ... \u5176\u4ed6 actions\n}));\n</code></pre>"},{"location":"_archive/frontend/03_frontend_design/#7","title":"7. \u5173\u952e\u4ea4\u4e92\u7ec6\u8282","text":""},{"location":"_archive/frontend/03_frontend_design/#71","title":"7.1 \u6d41\u5f0f\u6d88\u606f\u6e32\u67d3","text":"<p>\u8bbe\u8ba1\u8981\u70b9\uff1a - \u4f7f\u7528 CSS \u52a8\u753b\u5b9e\u73b0\u5149\u6807\u95ea\u70c1\u6548\u679c - \u601d\u8003\u5185\u5bb9 (<code>reasoning_content</code>) \u9ed8\u8ba4\u6298\u53e0\uff0c\u70b9\u51fb\u5c55\u5f00 - \u5de5\u5177\u8c03\u7528\u663e\u793a\u4e3a\u5185\u8054\u6307\u793a\u5668\uff08\u56fe\u6807 + \u540d\u79f0 + \u72b6\u6001\uff09 - Agent \u5207\u6362\u65f6\u663e\u793a\u5206\u9694\u6807\u8bb0</p> <p>\u6e32\u67d3\u7b56\u7565\uff1a <pre><code>if (isStreaming) {\n  // \u5b9e\u65f6\u6e32\u67d3\u6a21\u5f0f\n  \u663e\u793a StreamingMessage \u7ec4\u4ef6\n  - \u663e\u793a Agent \u540d\u79f0\n  - \u663e\u793a\u601d\u8003\u8fc7\u7a0b\uff08\u53ef\u6298\u53e0\uff09\n  - \u663e\u793a\u5de5\u5177\u8c03\u7528\u72b6\u6001\n  - \u663e\u793a\u5b9e\u65f6\u8f93\u51fa\uff08\u6253\u5b57\u673a\u6548\u679c\uff09\n} else {\n  // \u5386\u53f2\u6a21\u5f0f\n  \u663e\u793a AssistantMessage \u7ec4\u4ef6\n  - \u53ea\u663e\u793a\u6700\u7ec8 response\n  - \u4e0d\u663e\u793a\u4e2d\u95f4\u8fc7\u7a0b\n}\n</code></pre></p> <p>[v1.1 \u65b0\u589e] \u6d88\u606f\u72b6\u6001\u6e32\u67d3\uff1a <pre><code>// \u6839\u636e\u6d88\u606f\u72b6\u6001\u6e32\u67d3\u4e0d\u540c UI\nfunction MessageItem({ message }: { message: Message }) {\n  if (message.status === 'sending') {\n    return (\n      &lt;div className=\"opacity-70\"&gt;\n        {/* \u6d88\u606f\u5185\u5bb9 + \u53d1\u9001\u4e2d\u6307\u793a\u5668 */}\n        &lt;Spinner size=\"sm\" /&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  if (message.status === 'error') {\n    return (\n      &lt;div className=\"border-red-500\"&gt;\n        {/* \u6d88\u606f\u5185\u5bb9 + \u9519\u8bef\u63d0\u793a */}\n        &lt;span className=\"text-red-500\"&gt;{message.error}&lt;/span&gt;\n        &lt;Button onClick={() =&gt; retryMessage(message.id)}&gt;\u91cd\u8bd5&lt;/Button&gt;\n        &lt;Button variant=\"ghost\" onClick={() =&gt; removeMessage(message.id)}&gt;\u5220\u9664&lt;/Button&gt;\n      &lt;/div&gt;\n    );\n  }\n\n  // status === 'sent'\n  return &lt;NormalMessage message={message} /&gt;;\n}\n</code></pre></p>"},{"location":"_archive/frontend/03_frontend_design/#72","title":"7.2 \u5206\u652f\u5bf9\u8bdd\u4ea4\u4e92","text":"<p>UI \u8bbe\u8ba1\uff1a - \u6709\u5206\u652f\u7684\u6d88\u606f\u663e\u793a\u5206\u652f\u56fe\u6807 - \u70b9\u51fb\u5206\u652f\u56fe\u6807\u5c55\u5f00\u5206\u652f\u9009\u62e9\u5668 - \u9009\u62e9\u5206\u652f\u540e\u5207\u6362\u663e\u793a\u8be5\u5206\u652f\u7684\u6d88\u606f</p> <p>\u4ea4\u4e92\u6d41\u7a0b\uff1a 1. \u7528\u6237\u70b9\u51fb\u5386\u53f2\u6d88\u606f\u7684\u300c\u7f16\u8f91\u300d\u6309\u94ae 2. \u663e\u793a\u7f16\u8f91\u8f93\u5165\u6846 3. \u7528\u6237\u63d0\u4ea4\u65b0\u6d88\u606f 4. \u8c03\u7528 API\uff0c<code>parent_message_id</code> \u8bbe\u4e3a\u88ab\u7f16\u8f91\u6d88\u606f\u7684 ID 5. \u521b\u5efa\u65b0\u5206\u652f\uff0c\u81ea\u52a8\u5207\u6362\u5230\u65b0\u5206\u652f</p>"},{"location":"_archive/frontend/03_frontend_design/#73-artifact","title":"7.3 Artifact \u7248\u672c\u5bf9\u6bd4","text":"<p>Monaco Diff View \u96c6\u6210\uff1a - \u4f7f\u7528 <code>monaco-editor</code> \u7684 <code>DiffEditor</code> \u7ec4\u4ef6 - \u5de6\u4fa7\u663e\u793a\u65e7\u7248\u672c\uff0c\u53f3\u4fa7\u663e\u793a\u65b0\u7248\u672c - \u9ad8\u4eae\u5dee\u5f02\u533a\u57df - \u7248\u672c\u9009\u62e9\u5668\u63a7\u5236\u5bf9\u6bd4\u7684\u4e24\u4e2a\u7248\u672c</p> <p>\u4ea4\u4e92\u6d41\u7a0b\uff1a 1. \u7528\u6237\u70b9\u51fb\u300c\u5bf9\u6bd4\u300d\u6309\u94ae 2. \u8fdb\u5165 Diff \u6a21\u5f0f 3. \u9ed8\u8ba4\u5bf9\u6bd4\u5f53\u524d\u7248\u672c\u548c\u4e0a\u4e00\u7248\u672c 4. \u53ef\u901a\u8fc7\u9009\u62e9\u5668\u8c03\u6574\u5bf9\u6bd4\u7684\u7248\u672c 5. \u70b9\u51fb\u300c\u9000\u51fa\u5bf9\u6bd4\u300d\u8fd4\u56de\u5355\u7248\u672c\u89c6\u56fe</p>"},{"location":"_archive/frontend/03_frontend_design/#74-artifact","title":"7.4 Artifact \u66f4\u65b0\u7b56\u7565","text":"<p>[v1.1 \u66f4\u65b0] \u5206\u9636\u6bb5\u6e32\u67d3\u7b56\u7565\uff1a</p> \u9636\u6bb5 \u89e6\u53d1\u65f6\u673a \u884c\u4e3a \u8bf4\u660e Phase 1 (MVP) \u76d1\u542c <code>tool_result</code> \u4e8b\u4ef6 \u5de5\u5177\u6267\u884c\u5b8c\u6210\u540e\uff0c\u6807\u8bb0 artifact \u6709\u66f4\u65b0\uff1b\u6d41\u5f0f\u7ed3\u675f\u540e\u7edf\u4e00\u5237\u65b0 \u7b80\u5355\u53ef\u9760\uff0c\u907f\u514d\u9891\u7e41\u8bf7\u6c42 Phase 2 (\u8fdb\u9636) \u76d1\u542c\u6d41\u4e2d\u7684\u5185\u5bb9\u5757 \u5b9e\u65f6\u66f4\u65b0 Artifact \u5185\u5bb9\uff0c\u5b9e\u73b0\u6253\u5b57\u673a\u6548\u679c \u9700\u8981\u540e\u7aef\u652f\u6301\u589e\u91cf\u63a8\u9001 <p>Phase 1 \u5b9e\u73b0\uff08\u5f53\u524d\u76ee\u6807\uff09\uff1a <pre><code>// SSE \u4e8b\u4ef6\u5904\u7406\nfunction handleStreamEvent(event: StreamEvent) {\n  if (event.type === 'tool_result') {\n    const { tool_name, result } = event.data;\n\n    // \u68c0\u67e5\u662f\u5426\u662f Artifact \u64cd\u4f5c\u5de5\u5177\n    if (['create_artifact', 'update_artifact', 'rewrite_artifact'].includes(tool_name)) {\n      if (result.success) {\n        // \u6807\u8bb0\u8be5 artifact \u6709\u66f4\u65b0\uff08Tab \u663e\u793a\u5c0f\u5706\u70b9\uff09\n        artifactStore.markPendingUpdate(result.data.artifact_id);\n      }\n    }\n  }\n\n  if (event.type === 'complete') {\n    // \u6d41\u5f0f\u7ed3\u675f\u540e\uff0c\u5237\u65b0\u6709\u66f4\u65b0\u7684 artifacts\n    if (artifactStore.pendingUpdates.size &gt; 0) {\n      artifactStore.fetchArtifacts(sessionId);\n      artifactStore.clearPendingUpdates();\n    }\n  }\n}\n</code></pre></p> <p>Phase 2 \u9884\u7559\u8bbe\u8ba1\uff1a <pre><code>// \u672a\u6765\uff1a\u540e\u7aef\u63a8\u9001 artifact \u5185\u5bb9\u5757\ninterface ArtifactContentChunk {\n  artifact_id: string;\n  content_delta: string;  // \u589e\u91cf\u5185\u5bb9\n  version: number;\n}\n\n// \u524d\u7aef\u5b9e\u65f6\u62fc\u63a5\nfunction handleArtifactChunk(chunk: ArtifactContentChunk) {\n  artifactStore.appendContent(chunk.artifact_id, chunk.content_delta);\n  // Monaco Editor \u81ea\u52a8\u6eda\u52a8\u5230\u6700\u65b0\u4f4d\u7f6e\n}\n</code></pre></p>"},{"location":"_archive/frontend/03_frontend_design/#8","title":"8. \u6587\u4ef6\u7ed3\u6784\u89c4\u5212","text":"<pre><code>frontend/\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 next.config.js\n\u251c\u2500\u2500 tailwind.config.js\n\u251c\u2500\u2500 tsconfig.json\n\u2502\n\u251c\u2500\u2500 public/\n\u2502   \u2514\u2500\u2500 favicon.ico\n\u2502\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 app/                          # Next.js App Router\n\u2502   \u2502   \u251c\u2500\u2500 layout.tsx                # \u6839\u5e03\u5c40\n\u2502   \u2502   \u251c\u2500\u2500 page.tsx                  # \u9996\u9875\n\u2502   \u2502   \u251c\u2500\u2500 globals.css               # \u5168\u5c40\u6837\u5f0f\n\u2502   \u2502   \u2502\n\u2502   \u2502   \u251c\u2500\u2500 chat/\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 layout.tsx            # Chat \u5e03\u5c40\uff08\u53cc\u9762\u677f\uff09\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 page.tsx              # \u65b0\u5bf9\u8bdd\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 [id]/\n\u2502   \u2502   \u2502       \u2514\u2500\u2500 page.tsx          # \u5bf9\u8bdd\u8be6\u60c5\n\u2502   \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500 (auth)/                   # \u9884\u7559\uff1a\u8ba4\u8bc1\n\u2502   \u2502       \u251c\u2500\u2500 login/page.tsx\n\u2502   \u2502       \u2514\u2500\u2500 register/page.tsx\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 components/                   # \u7ec4\u4ef6\n\u2502   \u2502   \u251c\u2500\u2500 ui/                       # shadcn/ui \u7ec4\u4ef6\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 button.tsx\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 dialog.tsx\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 dropdown-menu.tsx\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 ...\n\u2502   \u2502   \u2502\n\u2502   \u2502   \u251c\u2500\u2500 layout/                   # \u5e03\u5c40\u7ec4\u4ef6\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 Header.tsx\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 Sidebar.tsx\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 ResizablePanel.tsx\n\u2502   \u2502   \u2502\n\u2502   \u2502   \u251c\u2500\u2500 chat/                     # \u5bf9\u8bdd\u76f8\u5173\u7ec4\u4ef6\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 ChatPanel.tsx\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 MessageList.tsx\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 MessageItem.tsx\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 UserMessage.tsx\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 AssistantMessage.tsx\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 StreamingMessage.tsx\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 ReasoningBlock.tsx\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 ToolCallIndicator.tsx\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 ChatInput.tsx\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 PermissionDialog.tsx\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 MessageStatusIndicator.tsx  # [v1.1 \u65b0\u589e]\n\u2502   \u2502   \u2502\n\u2502   \u2502   \u251c\u2500\u2500 artifact/                 # Artifact \u76f8\u5173\u7ec4\u4ef6\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 ArtifactPanel.tsx\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 ArtifactTabs.tsx\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 ArtifactViewer.tsx\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 MonacoViewer.tsx\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 DiffViewer.tsx\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 MarkdownRenderer.tsx\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 VersionSelector.tsx\n\u2502   \u2502   \u2502\n\u2502   \u2502   \u2514\u2500\u2500 conversation/             # \u5bf9\u8bdd\u5217\u8868\u7ec4\u4ef6\n\u2502   \u2502       \u251c\u2500\u2500 ConversationList.tsx\n\u2502   \u2502       \u2514\u2500\u2500 ConversationItem.tsx\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 stores/                       # Zustand stores\n\u2502   \u2502   \u251c\u2500\u2500 conversationStore.ts\n\u2502   \u2502   \u251c\u2500\u2500 artifactStore.ts\n\u2502   \u2502   \u251c\u2500\u2500 streamStore.ts\n\u2502   \u2502   \u2514\u2500\u2500 uiStore.ts\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 hooks/                        # \u81ea\u5b9a\u4e49 hooks\n\u2502   \u2502   \u251c\u2500\u2500 useSSE.ts                 # SSE \u8fde\u63a5 hook [v1.1 \u589e\u5f3a]\n\u2502   \u2502   \u251c\u2500\u2500 useConversation.ts        # \u5bf9\u8bdd\u76f8\u5173 hook\n\u2502   \u2502   \u2514\u2500\u2500 useArtifact.ts            # Artifact \u76f8\u5173 hook\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 lib/                          # \u5de5\u5177\u5e93\n\u2502   \u2502   \u251c\u2500\u2500 api.ts                    # API \u5ba2\u6237\u7aef\n\u2502   \u2502   \u251c\u2500\u2500 sse.ts                    # SSE \u5ba2\u6237\u7aef [v1.1 \u589e\u5f3a]\n\u2502   \u2502   \u2514\u2500\u2500 utils.ts                  # \u901a\u7528\u5de5\u5177\u51fd\u6570\n\u2502   \u2502\n\u2502   \u2514\u2500\u2500 types/                        # TypeScript \u7c7b\u578b\u5b9a\u4e49\n\u2502       \u251c\u2500\u2500 conversation.ts           # [v1.1 \u66f4\u65b0: \u589e\u52a0 MessageStatus]\n\u2502       \u251c\u2500\u2500 artifact.ts\n\u2502       \u251c\u2500\u2500 stream.ts\n\u2502       \u2514\u2500\u2500 api.ts\n\u2502\n\u2514\u2500\u2500 README.md\n</code></pre>"},{"location":"_archive/frontend/03_frontend_design/#9-hooks","title":"9. \u6838\u5fc3 Hooks \u8bbe\u8ba1","text":""},{"location":"_archive/frontend/03_frontend_design/#91-usesse","title":"9.1 useSSE","text":"<p>[v1.1 \u589e\u5f3a] \u804c\u8d23\uff1a - \u7ba1\u7406 EventSource \u8fde\u63a5 - \u89e3\u6790 SSE \u4e8b\u4ef6 - \u663e\u5f0f\u7ba1\u7406\u8fde\u63a5\u751f\u547d\u5468\u671f - \u5904\u7406\u91cd\u8fde\u903b\u8f91</p> <p>\u63a5\u53e3\uff1a <pre><code>function useSSE(options: {\n  url: string | null\n  onMetadata?: (data: any) =&gt; void\n  onStream?: (data: any) =&gt; void\n  onComplete?: (data: any) =&gt; void\n  onInterrupt?: (data: any) =&gt; void  // [v1.1 \u65b0\u589e]\n  onError?: (error: any) =&gt; void\n}): {\n  isConnected: boolean\n  error: Error | null\n  disconnect: () =&gt; void  // [v1.1] \u663e\u5f0f\u65ad\u5f00\u65b9\u6cd5\n}\n</code></pre></p> <p>[v1.1] \u5b9e\u73b0\u8981\u70b9\uff1a <pre><code>function useSSE(options: SSEOptions) {\n  const [isConnected, setIsConnected] = useState(false);\n  const eventSourceRef = useRef&lt;EventSource | null&gt;(null);\n\n  const disconnect = useCallback(() =&gt; {\n    if (eventSourceRef.current) {\n      eventSourceRef.current.close();\n      eventSourceRef.current = null;\n      setIsConnected(false);\n    }\n  }, []);\n\n  useEffect(() =&gt; {\n    if (!options.url) {\n      disconnect();  // URL \u53d8\u4e3a null \u65f6\u65ad\u5f00\n      return;\n    }\n\n    // [v1.1] \u521b\u5efa\u65b0\u8fde\u63a5\u524d\u5148\u65ad\u5f00\u65e7\u8fde\u63a5\n    disconnect();\n\n    const es = new EventSource(options.url);\n    eventSourceRef.current = es;\n\n    es.onopen = () =&gt; setIsConnected(true);\n\n    es.onmessage = (event) =&gt; {\n      const data = JSON.parse(event.data);\n\n      // \u5206\u53d1\u4e8b\u4ef6\n      switch (data.event_type) {\n        case 'metadata':\n          options.onMetadata?.(data.data);\n          break;\n        case 'stream':\n          options.onStream?.(data.data);\n          break;\n        case 'complete':\n          options.onComplete?.(data.data);\n          disconnect();  // [v1.1] \u5b8c\u6210\u540e\u65ad\u5f00\n          break;\n        case 'interrupt':\n          options.onInterrupt?.(data.data);\n          disconnect();  // [v1.1] \u4e2d\u65ad\u540e\u65ad\u5f00\n          break;\n        case 'error':\n          options.onError?.(data.data);\n          disconnect();  // [v1.1] \u9519\u8bef\u540e\u65ad\u5f00\n          break;\n      }\n    };\n\n    es.onerror = (error) =&gt; {\n      options.onError?.(error);\n      disconnect();\n    };\n\n    return () =&gt; disconnect();  // [v1.1] \u7ec4\u4ef6\u5378\u8f7d\u65f6\u6e05\u7406\n  }, [options.url]);\n\n  return { isConnected, error: null, disconnect };\n}\n</code></pre></p>"},{"location":"_archive/frontend/03_frontend_design/#92-useconversation","title":"9.2 useConversation","text":"<p>\u804c\u8d23\uff1a - \u5c01\u88c5\u5bf9\u8bdd\u76f8\u5173\u7684\u72b6\u6001\u548c\u64cd\u4f5c - \u63d0\u4f9b\u53d1\u9001\u6d88\u606f\u3001\u5207\u6362\u5206\u652f\u7b49\u65b9\u6cd5</p> <p>\u63a5\u53e3\uff1a <pre><code>function useConversation(conversationId?: string): {\n  // \u72b6\u6001\n  conversation: ConversationDetail | null\n  messages: Message[]\n  isLoading: boolean\n  error: Error | null\n\n  // \u6d41\u5f0f\u72b6\u6001\n  isStreaming: boolean\n  streamContent: string\n\n  // \u64cd\u4f5c\n  sendMessage: (content: string, parentId?: string) =&gt; Promise&lt;void&gt;\n  switchBranch: (messageId: string) =&gt; void\n  deleteConversation: () =&gt; Promise&lt;void&gt;\n\n  // [v1.1 \u65b0\u589e] \u6d88\u606f\u72b6\u6001\u64cd\u4f5c\n  retryMessage: (messageId: string) =&gt; Promise&lt;void&gt;\n  removeFailedMessage: (messageId: string) =&gt; void\n}\n</code></pre></p>"},{"location":"_archive/frontend/03_frontend_design/#93-useartifact","title":"9.3 useArtifact","text":"<p>\u804c\u8d23\uff1a - \u5c01\u88c5 Artifact \u76f8\u5173\u7684\u72b6\u6001\u548c\u64cd\u4f5c - \u63d0\u4f9b\u7248\u672c\u5207\u6362\u3001Diff \u5bf9\u6bd4\u7b49\u65b9\u6cd5</p> <p>\u63a5\u53e3\uff1a <pre><code>function useArtifact(sessionId: string): {\n  // \u72b6\u6001\n  artifacts: ArtifactSummary[]\n  currentArtifact: ArtifactDetail | null\n  currentVersion: number\n  isLoading: boolean\n\n  // [v1.1 \u65b0\u589e] \u66f4\u65b0\u6307\u793a\n  hasPendingUpdates: boolean\n\n  // Diff \u72b6\u6001\n  diffMode: boolean\n  compareVersion: number | null\n\n  // \u64cd\u4f5c\n  selectArtifact: (artifactId: string) =&gt; void\n  selectVersion: (version: number) =&gt; Promise&lt;void&gt;\n  enableDiff: (baseVersion: number) =&gt; void\n  disableDiff: () =&gt; void\n  refreshArtifacts: () =&gt; Promise&lt;void&gt;  // [v1.1 \u65b0\u589e]\n}\n</code></pre></p>"},{"location":"_archive/frontend/03_frontend_design/#10","title":"10. \u5b9e\u65bd\u6b65\u9aa4","text":""},{"location":"_archive/frontend/03_frontend_design/#phase-1-1-2","title":"Phase 1: \u9879\u76ee\u642d\u5efa\uff08\u9884\u8ba1 1-2 \u5929\uff09","text":"<ol> <li>\u521d\u59cb\u5316\u9879\u76ee</li> <li>\u521b\u5efa Next.js 14 \u9879\u76ee</li> <li>\u914d\u7f6e Tailwind CSS</li> <li> <p>\u5b89\u88c5 shadcn/ui</p> </li> <li> <p>\u642d\u5efa\u57fa\u7840\u5e03\u5c40</p> </li> <li>Header \u7ec4\u4ef6</li> <li>Sidebar \u7ec4\u4ef6</li> <li> <p>\u53cc\u9762\u677f\u5e03\u5c40</p> </li> <li> <p>\u914d\u7f6e Zustand</p> </li> <li>\u521b\u5efa\u57fa\u7840 stores</li> <li>[v1.1] \u5b9e\u73b0\u6d88\u606f\u72b6\u6001\u7ba1\u7406\uff08status \u5b57\u6bb5\uff09</li> <li>\u914d\u7f6e\u6301\u4e45\u5316\uff08localStorage\uff09</li> </ol>"},{"location":"_archive/frontend/03_frontend_design/#phase-2-3-4","title":"Phase 2: \u5bf9\u8bdd\u529f\u80fd\uff08\u9884\u8ba1 3-4 \u5929\uff09","text":"<ol> <li>\u5bf9\u8bdd\u5217\u8868</li> <li>ConversationList \u7ec4\u4ef6</li> <li>\u5206\u9875\u52a0\u8f7d</li> <li> <p>\u5220\u9664\u529f\u80fd</p> </li> <li> <p>\u6d88\u606f\u5c55\u793a</p> </li> <li>MessageList \u7ec4\u4ef6</li> <li>UserMessage / AssistantMessage \u7ec4\u4ef6</li> <li>[v1.1] MessageStatusIndicator \u7ec4\u4ef6\uff08\u53d1\u9001\u4e2d/\u9519\u8bef\u72b6\u6001\uff09</li> <li> <p>\u6d88\u606f\u6811\u6e32\u67d3\u903b\u8f91</p> </li> <li> <p>\u6d88\u606f\u53d1\u9001</p> </li> <li>ChatInput \u7ec4\u4ef6</li> <li>API \u96c6\u6210</li> <li> <p>[v1.1] \u4e50\u89c2\u66f4\u65b0 + \u5b89\u5168\u56de\u6eda\u673a\u5236</p> </li> <li> <p>SSE \u6d41\u5f0f</p> </li> <li>useSSE hook</li> <li>[v1.1] EventSource \u751f\u547d\u5468\u671f\u7ba1\u7406</li> <li>StreamingMessage \u7ec4\u4ef6</li> <li>\u6253\u5b57\u673a\u6548\u679c</li> </ol>"},{"location":"_archive/frontend/03_frontend_design/#phase-3-artifact-2-3","title":"Phase 3: Artifact \u529f\u80fd\uff08\u9884\u8ba1 2-3 \u5929\uff09","text":"<ol> <li>Artifact \u5c55\u793a</li> <li>ArtifactPanel \u7ec4\u4ef6</li> <li>ArtifactTabs \u7ec4\u4ef6</li> <li>\u7248\u672c\u9009\u62e9\u5668</li> <li> <p>[v1.1] \u66f4\u65b0\u6307\u793a\u5668\uff08\u5c0f\u5706\u70b9\uff09</p> </li> <li> <p>Monaco Editor \u96c6\u6210</p> </li> <li>MonacoViewer \u7ec4\u4ef6</li> <li> <p>DiffViewer \u7ec4\u4ef6</p> </li> <li> <p>Markdown \u6e32\u67d3</p> </li> <li>MarkdownRenderer \u7ec4\u4ef6</li> <li>\u4ee3\u7801\u9ad8\u4eae</li> </ol>"},{"location":"_archive/frontend/03_frontend_design/#phase-4-2-3","title":"Phase 4: \u9ad8\u7ea7\u529f\u80fd\uff08\u9884\u8ba1 2-3 \u5929\uff09","text":"<ol> <li>\u5206\u652f\u5bf9\u8bdd</li> <li>\u5206\u652f UI \u6307\u793a\u5668</li> <li>\u5206\u652f\u5207\u6362\u903b\u8f91</li> <li> <p>\u4ece\u5386\u53f2\u6d88\u606f\u521b\u5efa\u5206\u652f</p> </li> <li> <p>\u6743\u9650\u786e\u8ba4</p> </li> <li>PermissionDialog \u7ec4\u4ef6</li> <li>[v1.1] SSE \u8fde\u63a5\u751f\u547d\u5468\u671f\u7ba1\u7406\uff08\u9500\u6bc1\u65e7\u5b9e\u4f8b\u2192\u521b\u5efa\u65b0\u5b9e\u4f8b\uff09</li> <li> <p>\u6062\u590d\u6267\u884c\u6d41\u7a0b</p> </li> <li> <p>\u5de5\u5177\u8c03\u7528\u5c55\u793a</p> </li> <li>ToolCallIndicator \u7ec4\u4ef6</li> <li>ReasoningBlock \u7ec4\u4ef6</li> </ol>"},{"location":"_archive/frontend/03_frontend_design/#phase-5-2-3","title":"Phase 5: \u4f18\u5316\u548c\u6d4b\u8bd5\uff08\u9884\u8ba1 2-3 \u5929\uff09","text":"<ol> <li>\u6027\u80fd\u4f18\u5316</li> <li>\u865a\u62df\u6eda\u52a8\uff08\u957f\u5bf9\u8bdd\uff09</li> <li>\u4ee3\u7801\u5206\u5272</li> <li> <p>\u56fe\u7247\u61d2\u52a0\u8f7d\uff08\u9884\u7559\uff09</p> </li> <li> <p>\u54cd\u5e94\u5f0f\u9002\u914d</p> </li> <li>\u79fb\u52a8\u7aef\u5e03\u5c40</li> <li> <p>\u9762\u677f\u6298\u53e0\u903b\u8f91</p> </li> <li> <p>\u6d4b\u8bd5</p> </li> <li>\u7ec4\u4ef6\u5355\u5143\u6d4b\u8bd5</li> <li>[v1.1] SSE \u8fde\u63a5\u751f\u547d\u5468\u671f\u6d4b\u8bd5</li> <li>[v1.1] \u4e50\u89c2\u66f4\u65b0\u56de\u6eda\u6d4b\u8bd5</li> <li>E2E \u6d4b\u8bd5\uff08Playwright\uff09</li> </ol>"},{"location":"_archive/frontend/03_frontend_design/#11","title":"11. \u540e\u7eed\u6269\u5c55\u9884\u7559","text":""},{"location":"_archive/frontend/03_frontend_design/#111-phase-2","title":"11.1 \u7528\u6237\u8ba4\u8bc1\uff08Phase 2\uff09","text":"<p>\u9884\u7559\u4f4d\u7f6e\uff1a - <code>app/(auth)/</code> \u8def\u7531\u7ec4 - <code>stores/authStore.ts</code> - <code>middleware.ts</code> \u8def\u7531\u4fdd\u62a4</p> <p>\u5b9e\u73b0\u8981\u70b9\uff1a - JWT Token \u5b58\u50a8\uff08httpOnly cookie \u6216 localStorage\uff09 - \u767b\u5f55/\u6ce8\u518c\u9875\u9762 - \u8def\u7531\u4e2d\u95f4\u4ef6\u4fdd\u62a4</p>"},{"location":"_archive/frontend/03_frontend_design/#112","title":"11.2 \u66f4\u591a\u529f\u80fd\u9884\u7559","text":"<p>\u6587\u4ef6\u4e0a\u4f20\uff1a - ChatInput \u6dfb\u52a0 AttachButton - \u652f\u6301\u56fe\u7247\u3001\u6587\u6863\u4e0a\u4f20 - \u9884\u89c8\u7ec4\u4ef6</p> <p>Artifact \u5bfc\u51fa\uff1a - \u5bfc\u51fa\u4e3a\u672c\u5730\u6587\u4ef6 - \u590d\u5236\u5230\u526a\u8d34\u677f</p> <p>\u4e3b\u9898\u5207\u6362\uff1a - \u6df1\u8272/\u6d45\u8272\u4e3b\u9898 - \u4f7f\u7528 CSS \u53d8\u91cf + Tailwind \u5b9e\u73b0</p>"},{"location":"_archive/frontend/03_frontend_design/#12","title":"12. \u4f9d\u8d56\u6e05\u5355","text":"<pre><code>{\n  \"dependencies\": {\n    \"next\": \"^14.1.0\",\n    \"react\": \"^18.2.0\",\n    \"react-dom\": \"^18.2.0\",\n\n    \"zustand\": \"^4.5.0\",\n\n    \"@radix-ui/react-dialog\": \"^1.0.5\",\n    \"@radix-ui/react-dropdown-menu\": \"^2.0.6\",\n    \"@radix-ui/react-tabs\": \"^1.0.4\",\n\n    \"@monaco-editor/react\": \"^4.6.0\",\n    \"react-markdown\": \"^9.0.1\",\n    \"remark-gfm\": \"^4.0.0\",\n    \"react-syntax-highlighter\": \"^15.5.0\",\n\n    \"tailwindcss\": \"^3.4.1\",\n    \"class-variance-authority\": \"^0.7.0\",\n    \"clsx\": \"^2.1.0\",\n    \"tailwind-merge\": \"^2.2.1\",\n\n    \"lucide-react\": \"^0.330.0\"\n  },\n  \"devDependencies\": {\n    \"typescript\": \"^5.3.3\",\n    \"@types/node\": \"^20.11.0\",\n    \"@types/react\": \"^18.2.48\",\n    \"eslint\": \"^8.56.0\",\n    \"eslint-config-next\": \"^14.1.0\",\n\n    \"playwright\": \"^1.41.0\"\n  }\n}\n</code></pre>"},{"location":"_archive/frontend/03_frontend_design/#13","title":"13. \u5f00\u53d1\u73af\u5883\u914d\u7f6e","text":"<pre><code>// next.config.js\nmodule.exports = {\n  async rewrites() {\n    return [\n      {\n        source: '/api/:path*',\n        destination: 'http://localhost:8000/api/:path*', // \u5f00\u53d1\u65f6\u4ee3\u7406\u5230\u540e\u7aef\n      },\n    ]\n  },\n}\n</code></pre> <pre><code># .env.local\nNEXT_PUBLIC_API_URL=http://localhost:8000\n</code></pre>"},{"location":"_archive/frontend/03_frontend_design/#v10-v11","title":"\u9644\u5f55\uff1av1.0 \u2192 v1.1 \u53d8\u66f4\u6458\u8981","text":"Section \u53d8\u66f4\u5185\u5bb9 \u7c7b\u578b 5.2 conversationStore \u65b0\u589e <code>MessageStatus</code> \u7c7b\u578b\u548c <code>status</code> \u5b57\u6bb5 \u65b0\u589e 5.2 conversationStore \u65b0\u589e\u4e50\u89c2\u66f4\u65b0\u76f8\u5173 Actions \u65b0\u589e 5.3 artifactStore \u65b0\u589e <code>pendingUpdates</code> \u72b6\u6001 \u65b0\u589e 5.4 streamStore \u65b0\u589e <code>eventSourceRef</code> \u548c\u751f\u547d\u5468\u671f\u7ba1\u7406\u65b9\u6cd5 \u65b0\u589e 6.1 \u53d1\u9001\u6d88\u606f\u6d41\u7a0b \u66f4\u65b0\u6d41\u7a0b\u56fe\uff0c\u52a0\u5165\u72b6\u6001\u7ba1\u7406\u548c\u8fde\u63a5\u751f\u547d\u5468\u671f \u66f4\u65b0 6.3 \u6743\u9650\u786e\u8ba4\u6d41\u7a0b \u91cd\u5199\u6d41\u7a0b\uff0c\u660e\u786e SSE \u8fde\u63a5\u9500\u6bc1\u548c\u91cd\u5efa \u66f4\u65b0 7.1 \u6d41\u5f0f\u6d88\u606f\u6e32\u67d3 \u65b0\u589e\u6d88\u606f\u72b6\u6001\u6e32\u67d3\u903b\u8f91 \u65b0\u589e 7.4 Artifact \u66f4\u65b0\u7b56\u7565 \u660e\u786e\u5206\u9636\u6bb5\u6e32\u67d3\u7b56\u7565\uff08Phase 1/2\uff09 \u66f4\u65b0 8. \u6587\u4ef6\u7ed3\u6784 \u65b0\u589e <code>MessageStatusIndicator.tsx</code> \u66f4\u65b0 9.1 useSSE \u589e\u5f3a\u63a5\u53e3\uff0c\u65b0\u589e <code>onInterrupt</code> \u548c <code>disconnect</code> \u66f4\u65b0 9.1 useSSE \u6dfb\u52a0\u5b8c\u6574\u5b9e\u73b0\u793a\u4f8b \u65b0\u589e 10. \u5b9e\u65bd\u6b65\u9aa4 \u5404\u9636\u6bb5\u52a0\u5165 v1.1 \u76f8\u5173\u4efb\u52a1 \u66f4\u65b0"},{"location":"architecture/agents/","title":"Agent \u7cfb\u7edf","text":"<p>Agent \u662f ArtifactFlow \u4e2d\u7684\u667a\u80fd\u6267\u884c\u5355\u5143\uff0c\u6bcf\u4e2a Agent \u4e13\u6ce8\u4e8e\u7279\u5b9a\u7c7b\u578b\u7684\u4efb\u52a1\u3002</p>"},{"location":"architecture/agents/#_1","title":"\u6a21\u5757\u7ed3\u6784","text":"<pre><code>src/agents/\n\u251c\u2500\u2500 base.py          # Agent \u57fa\u7c7b\u548c\u6838\u5fc3\u6570\u636e\u7ed3\u6784\n\u251c\u2500\u2500 lead_agent.py    # Lead Agent\uff08\u4efb\u52a1\u534f\u8c03\uff09\n\u251c\u2500\u2500 search_agent.py  # Search Agent\uff08\u4fe1\u606f\u68c0\u7d22\uff09\n\u2514\u2500\u2500 crawl_agent.py   # Crawl Agent\uff08\u5185\u5bb9\u91c7\u96c6\uff09\n</code></pre>"},{"location":"architecture/agents/#basepy","title":"\u6838\u5fc3\u6570\u636e\u7ed3\u6784 (base.py)","text":""},{"location":"architecture/agents/#agentconfig","title":"AgentConfig","text":"<p>Agent \u914d\u7f6e\uff1a</p> <pre><code>@dataclass\nclass AgentConfig:\n    name: str                    # Agent \u540d\u79f0\uff08\u552f\u4e00\u6807\u8bc6\uff09\n    description: str             # Agent \u63cf\u8ff0\n    capabilities: list[str]      # \u80fd\u529b\u5217\u8868\n    required_tools: list[str]    # \u6240\u9700\u5de5\u5177\u540d\u79f0\u5217\u8868\n    model: str                   # LLM \u6a21\u578b\n    temperature: float = 0.7     # \u751f\u6210\u6e29\u5ea6\n    max_tool_rounds: int = 3     # \u5355\u6b21\u6267\u884c\u6700\u5927\u5de5\u5177\u8c03\u7528\u8f6e\u6570\n    llm_max_retries: int = 3     # LLM \u8c03\u7528\u91cd\u8bd5\u6b21\u6570\n</code></pre>"},{"location":"architecture/agents/#agentresponse","title":"AgentResponse","text":"<p>Agent \u5355\u8f6e\u6267\u884c\u7684\u54cd\u5e94\uff1a</p> <pre><code>@dataclass\nclass AgentResponse:\n    success: bool                    # \u6267\u884c\u662f\u5426\u6210\u529f\n    content: str                     # \u56de\u590d\u5185\u5bb9\n    tool_calls: list[dict]           # \u672c\u8f6e\u5de5\u5177\u8c03\u7528\u8bb0\u5f55\n    tool_interactions: list[dict]    # assistant-tool \u4ea4\u4e92\u5386\u53f2\n    reasoning_content: str | None    # \u601d\u8003\u8fc7\u7a0b\uff08\u652f\u6301 reasoning model\uff09\n    routing: dict | None             # \u8def\u7531\u4fe1\u606f\n    token_usage: dict | None         # Token \u7edf\u8ba1\n</code></pre> <p>routing \u5b57\u6bb5\u7ed3\u6784\uff1a</p> <pre><code># \u5de5\u5177\u8c03\u7528\nrouting = {\n    \"type\": \"tool\",\n    \"tool_name\": \"web_search\",\n    \"params\": {\"query\": \"...\"}\n}\n\n# \u8c03\u7528 SubAgent\nrouting = {\n    \"type\": \"subagent\",\n    \"target\": \"search\",\n    \"instruction\": \"\u641c\u7d22\u76f8\u5173\u4fe1\u606f...\"\n}\n\n# \u4efb\u52a1\u5b8c\u6210\nrouting = {\n    \"type\": \"complete\",\n    \"response\": \"\u6700\u7ec8\u56de\u590d\u5185\u5bb9\"\n}\n\n# \u7ee7\u7eed\u6267\u884c\uff08\u5904\u7406\u5de5\u5177\u7ed3\u679c\u540e\u7ee7\u7eed\uff09\nrouting = {\n    \"type\": \"continue\"\n}\n</code></pre>"},{"location":"architecture/agents/#baseagent","title":"BaseAgent \u57fa\u7c7b","text":""},{"location":"architecture/agents/#_2","title":"\u6838\u5fc3\u804c\u8d23","text":"<ol> <li>\u5355\u8f6e LLM \u8c03\u7528\uff1a\u6bcf\u6b21\u6267\u884c\u53ea\u8c03\u7528\u4e00\u6b21 LLM</li> <li>\u54cd\u5e94\u89e3\u6790\uff1a\u89e3\u6790 XML \u683c\u5f0f\u7684\u5de5\u5177\u8c03\u7528</li> <li>\u6d41\u5f0f\u8f93\u51fa\uff1a\u652f\u6301 LLM token \u7ea7\u522b\u7684\u6d41\u5f0f</li> <li>\u9519\u8bef\u91cd\u8bd5\uff1aLLM \u8c03\u7528\u5931\u8d25\u81ea\u52a8\u91cd\u8bd5</li> </ol>"},{"location":"architecture/agents/#_3","title":"\u62bd\u8c61\u65b9\u6cd5","text":"<p>\u5b50\u7c7b\u5fc5\u987b\u5b9e\u73b0\uff1a</p> <pre><code>class BaseAgent(ABC):\n    @abstractmethod\n    def build_system_prompt(self, toolkit: AgentToolkit) -&gt; str:\n        \"\"\"\u6784\u5efa\u7cfb\u7edf\u63d0\u793a\u8bcd\"\"\"\n        pass\n\n    @abstractmethod\n    def format_final_response(self, content: str, state: AgentState) -&gt; str:\n        \"\"\"\u683c\u5f0f\u5316\u6700\u7ec8\u54cd\u5e94\"\"\"\n        pass\n</code></pre>"},{"location":"architecture/agents/#_4","title":"\u6267\u884c\u6d41\u7a0b","text":"<pre><code>async def stream(self, context: AgentContext) -&gt; AsyncGenerator[StreamEvent, None]:\n    \"\"\"\u6d41\u5f0f\u6267\u884c Agent\"\"\"\n\n    # 1. \u53d1\u9001 Agent \u5f00\u59cb\u4e8b\u4ef6\n    yield StreamEvent(type=AGENT_START, data={\"agent\": self.name})\n\n    # 2. \u6784\u5efa messages\n    messages = self._build_messages(context)\n\n    # 3. \u6d41\u5f0f\u8c03\u7528 LLM\n    full_content = \"\"\n    async for chunk in self._call_llm_with_retry(messages):\n        full_content += chunk.content\n        yield StreamEvent(type=LLM_CHUNK, data={\"content\": chunk.content})\n\n    yield StreamEvent(type=LLM_COMPLETE, data={\"content\": full_content})\n\n    # 4. \u89e3\u6790\u54cd\u5e94\n    response = self._parse_response(full_content, context)\n\n    # 5. \u53d1\u9001 Agent \u5b8c\u6210\u4e8b\u4ef6\n    yield StreamEvent(type=AGENT_COMPLETE, data={\"response\": response})\n\n    return response\n</code></pre>"},{"location":"architecture/agents/#_5","title":"\u54cd\u5e94\u89e3\u6790","text":"<pre><code>def _parse_response(self, content: str, context: AgentContext) -&gt; AgentResponse:\n    # \u5c1d\u8bd5\u89e3\u6790\u5de5\u5177\u8c03\u7528\n    tool_calls = XMLToolCallParser.parse(content)\n\n    if tool_calls:\n        tool_call = tool_calls[0]  # \u6bcf\u8f6e\u53ea\u5904\u7406\u4e00\u4e2a\u5de5\u5177\u8c03\u7528\n\n        # \u5224\u65ad\u662f subagent \u8c03\u7528\u8fd8\u662f\u666e\u901a\u5de5\u5177\n        if tool_call[\"name\"] == \"call_subagent\":\n            return AgentResponse(\n                success=True,\n                content=content,\n                routing={\n                    \"type\": \"subagent\",\n                    \"target\": tool_call[\"params\"][\"target\"],\n                    \"instruction\": tool_call[\"params\"][\"instruction\"]\n                }\n            )\n        else:\n            return AgentResponse(\n                success=True,\n                content=content,\n                routing={\n                    \"type\": \"tool\",\n                    \"tool_name\": tool_call[\"name\"],\n                    \"params\": tool_call[\"params\"]\n                }\n            )\n\n    # \u68c0\u67e5\u662f\u5426\u8fbe\u5230\u6700\u5927\u5de5\u5177\u8f6e\u6570\n    if context.tool_round_count &gt;= self.config.max_tool_rounds:\n        return AgentResponse(\n            success=True,\n            content=content,\n            routing={\"type\": \"complete\", \"response\": content}\n        )\n\n    # \u65e0\u5de5\u5177\u8c03\u7528\uff0c\u4efb\u52a1\u5b8c\u6210\n    return AgentResponse(\n        success=True,\n        content=content,\n        routing={\"type\": \"complete\", \"response\": self.format_final_response(content)}\n    )\n</code></pre>"},{"location":"architecture/agents/#lead-agent","title":"Lead Agent","text":""},{"location":"architecture/agents/#_6","title":"\u89d2\u8272\u5b9a\u4f4d","text":"<p>Lead Agent \u662f\u4efb\u52a1\u7684\u603b\u534f\u8c03\u8005\uff1a</p> <ul> <li>\u7406\u89e3\u7528\u6237\u610f\u56fe\uff0c\u5236\u5b9a\u4efb\u52a1\u8ba1\u5212</li> <li>\u7ba1\u7406 Task Plan Artifact</li> <li>\u8c03\u5ea6 SubAgent \u6267\u884c\u5177\u4f53\u4efb\u52a1</li> <li>\u6574\u5408\u7ed3\u679c\u5230 Result Artifact</li> <li>\u4e0e\u7528\u6237\u4ea4\u4e92\uff0c\u54cd\u5e94\u53cd\u9988</li> </ul>"},{"location":"architecture/agents/#_7","title":"\u914d\u7f6e","text":"<pre><code>class LeadAgent(BaseAgent):\n    def __init__(self):\n        super().__init__(AgentConfig(\n            name=\"lead\",\n            description=\"\u4efb\u52a1\u89c4\u5212\u4e0e\u534f\u8c03\",\n            capabilities=[\n                \"\u4efb\u52a1\u5206\u89e3\u4e0e\u89c4\u5212\",\n                \"SubAgent \u8c03\u5ea6\",\n                \"\u7ed3\u679c\u6574\u5408\",\n                \"\u7528\u6237\u4ea4\u4e92\"\n            ],\n            required_tools=[\n                \"create_artifact\",\n                \"update_artifact\",\n                \"rewrite_artifact\",\n                \"read_artifact\",\n                \"call_subagent\"\n            ],\n            model=\"qwen3-next-80b-thinking\",  # \u4f7f\u7528\u601d\u8003\u6a21\u578b\n            temperature=0.7,\n            max_tool_rounds=5  # \u9700\u8981\u66f4\u591a\u8f6e\u6b21\u534f\u8c03\n        ))\n</code></pre>"},{"location":"architecture/agents/#_8","title":"\u7cfb\u7edf\u63d0\u793a\u8bcd\u7ed3\u6784","text":"<pre><code>def build_system_prompt(self, toolkit: AgentToolkit) -&gt; str:\n    return f\"\"\"\n# \u89d2\u8272\n\u4f60\u662f ArtifactFlow \u7684 Lead Agent\uff0c\u8d1f\u8d23\u7406\u89e3\u7528\u6237\u9700\u6c42\u3001\u89c4\u5212\u4efb\u52a1\u3001\u534f\u8c03\u6267\u884c\u3002\n\n# \u6838\u5fc3\u804c\u8d23\n1. **\u4efb\u52a1\u89c4\u5212**\uff1a\u5c06\u590d\u6742\u4efb\u52a1\u5206\u89e3\u4e3a\u53ef\u6267\u884c\u6b65\u9aa4\uff0c\u8bb0\u5f55\u5230 Task Plan Artifact\n2. **\u8fdb\u5ea6\u7ba1\u7406**\uff1a\u8ddf\u8e2a\u4efb\u52a1\u8fdb\u5ea6\uff0c\u66f4\u65b0\u8ba1\u5212\u72b6\u6001\n3. **Agent \u8c03\u5ea6**\uff1a\u6839\u636e\u4efb\u52a1\u7c7b\u578b\u8c03\u7528\u5408\u9002\u7684 SubAgent\n4. **\u7ed3\u679c\u6574\u5408**\uff1a\u5c06 SubAgent \u7ed3\u679c\u6574\u5408\u5230 Result Artifact\n5. **\u7528\u6237\u4ea4\u4e92**\uff1a\u54cd\u5e94\u7528\u6237\u53cd\u9988\uff0c\u8c03\u6574\u6267\u884c\u65b9\u5411\n\n# \u53ef\u7528\u5de5\u5177\n{toolkit.generate_tool_docs()}\n\n# \u5de5\u4f5c\u6d41\u7a0b\n1. \u6536\u5230\u65b0\u4efb\u52a1 \u2192 \u521b\u5efa Task Plan Artifact\n2. \u5206\u6790\u4efb\u52a1 \u2192 \u786e\u5b9a\u9700\u8981\u54ea\u4e9b SubAgent\n3. \u9010\u6b65\u6267\u884c \u2192 \u8c03\u7528 SubAgent\uff0c\u6536\u96c6\u7ed3\u679c\n4. \u6574\u5408\u7ed3\u679c \u2192 \u66f4\u65b0 Result Artifact\n5. \u5b8c\u6210/\u7ee7\u7eed \u2192 \u6839\u636e\u8fdb\u5ea6\u51b3\u5b9a\u4e0b\u4e00\u6b65\n\n# \u8f93\u51fa\u683c\u5f0f\n- \u601d\u8003\u8fc7\u7a0b\u7528\u81ea\u7136\u8bed\u8a00\u63cf\u8ff0\n- \u5de5\u5177\u8c03\u7528\u4f7f\u7528 XML \u683c\u5f0f\n- \u6700\u7ec8\u56de\u590d\u7b80\u6d01\u660e\u4e86\n\"\"\"\n</code></pre>"},{"location":"architecture/agents/#search-agent","title":"Search Agent","text":""},{"location":"architecture/agents/#_9","title":"\u89d2\u8272\u5b9a\u4f4d","text":"<p>\u4e13\u6ce8\u4e8e\u4fe1\u606f\u68c0\u7d22\uff1a</p> <ul> <li>\u4f18\u5316\u641c\u7d22\u67e5\u8be2</li> <li>\u591a\u8f6e\u8fed\u4ee3\u641c\u7d22</li> <li>\u7ed3\u679c\u7b5b\u9009\u4e0e\u7ed3\u6784\u5316</li> </ul>"},{"location":"architecture/agents/#_10","title":"\u914d\u7f6e","text":"<pre><code>class SearchAgent(BaseAgent):\n    def __init__(self):\n        super().__init__(AgentConfig(\n            name=\"search\",\n            description=\"\u4fe1\u606f\u68c0\u7d22\u4e0e\u641c\u7d22\",\n            capabilities=[\n                \"\u641c\u7d22\u67e5\u8be2\u4f18\u5316\",\n                \"\u591a\u8f6e\u8fed\u4ee3\u641c\u7d22\",\n                \"\u7ed3\u679c\u7b5b\u9009\"\n            ],\n            required_tools=[\"web_search\"],\n            model=\"qwen3-next-80b-instruct\",\n            temperature=0.5,  # \u7cbe\u786e\u641c\u7d22\n            max_tool_rounds=3\n        ))\n</code></pre>"},{"location":"architecture/agents/#_11","title":"\u5de5\u4f5c\u6a21\u5f0f","text":"<pre><code>flowchart TD\n    A[\u6536\u5230\u641c\u7d22\u6307\u4ee4] --&gt; B[\u5206\u6790\u641c\u7d22\u610f\u56fe]\n    B --&gt; C[\u6784\u9020\u641c\u7d22\u67e5\u8be2]\n    C --&gt; D[\u6267\u884c web_search]\n    D --&gt; E{\u7ed3\u679c\u662f\u5426\u5145\u5206?}\n    E --&gt;|\u5426| F[\u4f18\u5316\u67e5\u8be2]\n    F --&gt; C\n    E --&gt;|\u662f| G[\u6574\u7406\u7ed3\u6784\u5316\u7ed3\u679c]\n    G --&gt; H[\u8fd4\u56de\u7ed9 Lead Agent]</code></pre>"},{"location":"architecture/agents/#crawl-agent","title":"Crawl Agent","text":""},{"location":"architecture/agents/#_12","title":"\u89d2\u8272\u5b9a\u4f4d","text":"<p>\u4e13\u6ce8\u4e8e\u5185\u5bb9\u91c7\u96c6\uff1a</p> <ul> <li>\u7f51\u9875\u5185\u5bb9\u6293\u53d6</li> <li>\u5185\u5bb9\u89e3\u6790\u4e0e\u63d0\u53d6</li> <li>\u5904\u7406\u5f02\u5e38\u60c5\u51b5</li> </ul>"},{"location":"architecture/agents/#_13","title":"\u914d\u7f6e","text":"<pre><code>class CrawlAgent(BaseAgent):\n    def __init__(self):\n        super().__init__(AgentConfig(\n            name=\"crawl\",\n            description=\"\u5185\u5bb9\u91c7\u96c6\u4e0e\u89e3\u6790\",\n            capabilities=[\n                \"\u7f51\u9875\u5185\u5bb9\u6293\u53d6\",\n                \"\u5185\u5bb9\u63d0\u53d6\",\n                \"\u683c\u5f0f\u8f6c\u6362\"\n            ],\n            required_tools=[\"web_fetch\"],\n            model=\"qwen3-next-80b-instruct\",\n            temperature=0.3,  # \u7cbe\u786e\u63d0\u53d6\n            max_tool_rounds=3\n        ))\n</code></pre>"},{"location":"architecture/agents/#agent_1","title":"Agent \u534f\u4f5c\u6a21\u5f0f","text":"<pre><code>sequenceDiagram\n    participant User\n    participant Lead\n    participant Search\n    participant Crawl\n    participant Artifact\n\n    User-&gt;&gt;Lead: \u5206\u6790 Python \u5f02\u6b65\u7f16\u7a0b\u6700\u4f73\u5b9e\u8df5\n    Lead-&gt;&gt;Artifact: \u521b\u5efa Task Plan\n    Lead-&gt;&gt;Search: \u641c\u7d22\u76f8\u5173\u8d44\u6599\n    Search-&gt;&gt;Search: web_search x N\n    Search-&gt;&gt;Lead: \u8fd4\u56de\u641c\u7d22\u7ed3\u679c\n\n    Lead-&gt;&gt;Crawl: \u6293\u53d6\u91cd\u70b9\u6587\u7ae0\n    Crawl-&gt;&gt;Crawl: web_fetch x N\n    Crawl-&gt;&gt;Lead: \u8fd4\u56de\u6587\u7ae0\u5185\u5bb9\n\n    Lead-&gt;&gt;Artifact: \u66f4\u65b0 Result\n    Lead-&gt;&gt;User: \u8fd4\u56de\u5206\u6790\u62a5\u544a</code></pre>"},{"location":"architecture/agents/#agent_2","title":"Agent \u8bb0\u5fc6\u7cfb\u7edf","text":"<p>\u6bcf\u4e2a Agent \u7ef4\u62a4\u72ec\u7acb\u7684\u8bb0\u5fc6\uff0c\u7528\u4e8e\u8de8\u8f6e\u6b21\u4fdd\u6301\u4e0a\u4e0b\u6587\uff1a</p> <pre><code># state[\"agent_memories\"] \u7ed3\u6784\n{\n    \"lead\": \"\u5df2\u5b8c\u6210\u641c\u7d22\u9636\u6bb5\uff0c\u6536\u96c6\u5230 5 \u7bc7\u76f8\u5173\u6587\u7ae0...\",\n    \"search\": \"\u4e0a\u6b21\u641c\u7d22\u5173\u952e\u8bcd\uff1aPython async, asyncio tutorial...\",\n    \"crawl\": \"\u5df2\u6293\u53d6 3 \u4e2a URL\uff1a...\"\n}\n</code></pre> <p>\u8bb0\u5fc6\u5728 <code>merge_agent_response_to_state()</code> \u4e2d\u81ea\u52a8\u66f4\u65b0\uff1a</p> <pre><code># Agent \u53ef\u4ee5\u5728\u54cd\u5e94\u4e2d\u5305\u542b\u8bb0\u5fc6\u66f4\u65b0\nif response.memory_update:\n    state[\"agent_memories\"][agent_name] = response.memory_update\n</code></pre>"},{"location":"architecture/agents/#agent_3","title":"\u6dfb\u52a0\u65b0 Agent","text":"<p>\u53c2\u89c1 Extension Guide\u3002</p>"},{"location":"architecture/core/","title":"Core \u6a21\u5757","text":"<p>Core \u6a21\u5757\u662f ArtifactFlow \u7684\u6838\u5fc3\u5f15\u64ce\uff0c\u8d1f\u8d23\u72b6\u6001\u7ba1\u7406\u3001\u5de5\u4f5c\u6d41\u7f16\u6392\u548c\u6267\u884c\u63a7\u5236\u3002</p>"},{"location":"architecture/core/#_1","title":"\u6a21\u5757\u7ed3\u6784","text":"<pre><code>src/core/\n\u251c\u2500\u2500 state.py              # \u72b6\u6001\u5b9a\u4e49\u4e0e\u8f6c\u6362\n\u251c\u2500\u2500 events.py             # \u4e8b\u4ef6\u7c7b\u578b\u4e0e\u6307\u6807\n\u251c\u2500\u2500 graph.py              # LangGraph \u5de5\u4f5c\u6d41\n\u251c\u2500\u2500 controller.py         # \u6267\u884c\u63a7\u5236\u5668\n\u251c\u2500\u2500 context_manager.py    # \u4e0a\u4e0b\u6587\u7ba1\u7406\n\u2514\u2500\u2500 conversation_manager.py # \u5bf9\u8bdd\u7ba1\u7406\n</code></pre>"},{"location":"architecture/core/#statepy","title":"\u72b6\u6001\u7cfb\u7edf (state.py)","text":""},{"location":"architecture/core/#executionphase","title":"ExecutionPhase","text":"<p>\u6267\u884c\u9636\u6bb5\u679a\u4e3e\uff0c\u63a7\u5236\u5de5\u4f5c\u6d41\u8def\u7531\uff1a</p> <pre><code>class ExecutionPhase(Enum):\n    LEAD_EXECUTING = \"lead_executing\"       # Lead Agent \u6267\u884c\u4e2d\n    SUBAGENT_EXECUTING = \"subagent_executing\"  # SubAgent \u6267\u884c\u4e2d\n    TOOL_EXECUTING = \"tool_executing\"       # \u5de5\u5177\u6267\u884c\u4e2d\n    WAITING_PERMISSION = \"waiting_permission\"  # \u7b49\u5f85\u6743\u9650\u786e\u8ba4\n    COMPLETED = \"completed\"                 # \u4efb\u52a1\u5b8c\u6210\n</code></pre>"},{"location":"architecture/core/#agentstate","title":"AgentState","text":"<p>LangGraph \u5168\u5c40\u72b6\u6001\uff0c\u8d2f\u7a7f\u6574\u4e2a\u6267\u884c\u6d41\u7a0b\uff1a</p> <pre><code>class AgentState(TypedDict):\n    # \u4efb\u52a1\u76f8\u5173\n    current_task: str              # \u5f53\u524d\u4efb\u52a1\u63cf\u8ff0\n    session_id: str                # Artifact \u4f1a\u8bdd ID\n    thread_id: str                 # LangGraph \u7ebf\u7a0b ID\n    conversation_history: str      # \u683c\u5f0f\u5316\u7684\u5bf9\u8bdd\u5386\u53f2\n\n    # \u6267\u884c\u63a7\u5236\n    phase: ExecutionPhase          # \u5f53\u524d\u6267\u884c\u9636\u6bb5\n    current_agent: str             # \u5f53\u524d Agent \u540d\u79f0\n    tool_round_count: int          # \u5de5\u5177\u8c03\u7528\u8f6e\u6570\u8ba1\u6570\n\n    # \u8def\u7531\u4fe1\u606f\n    subagent_pending: dict | None  # \u5f85\u6267\u884c\u7684 subagent \u4fe1\u606f\n    pending_tool_call: dict | None # \u5f85\u6267\u884c\u7684\u5de5\u5177\u8c03\u7528\n\n    # \u8bb0\u5fc6\u7cfb\u7edf\n    agent_memories: dict[str, str] # \u5404 Agent \u7684\u8bb0\u5fc6\n\n    # \u53ef\u89c2\u6d4b\u6027\n    execution_metrics: ExecutionMetrics\n</code></pre>"},{"location":"architecture/core/#_2","title":"\u72b6\u6001\u8f6c\u6362\u51fd\u6570","text":"<p><code>merge_agent_response_to_state()</code> \u662f\u72b6\u6001\u66f4\u65b0\u7684\u7edf\u4e00\u5165\u53e3\uff1a</p> <pre><code>def merge_agent_response_to_state(\n    state: AgentState,\n    response: AgentResponse,\n    agent_name: str\n) -&gt; AgentState:\n    \"\"\"\n    \u5904\u7406 Agent \u54cd\u5e94\uff0c\u66f4\u65b0\u72b6\u6001\n    - \u89e3\u6790 routing \u4fe1\u606f\n    - \u66f4\u65b0\u6267\u884c\u9636\u6bb5\n    - \u4fdd\u5b58 Agent \u8bb0\u5fc6\n    - \u8bb0\u5f55\u6267\u884c\u6307\u6807\n    \"\"\"\n</code></pre> <p>\u8def\u7531\u903b\u8f91\uff1a</p> <pre><code>flowchart TD\n    A[Agent \u8fd4\u56de Response] --&gt; B{\u68c0\u67e5 routing.type}\n    B --&gt;|tool| C[phase = TOOL_EXECUTING]\n    B --&gt;|subagent| D[phase = SUBAGENT_EXECUTING]\n    B --&gt;|complete| E[phase = COMPLETED]\n    B --&gt;|continue| F[phase \u4e0d\u53d8\uff0c\u7ee7\u7eed\u5f53\u524d Agent]\n    C --&gt; G[\u8bbe\u7f6e pending_tool_call]\n    D --&gt; H[\u8bbe\u7f6e subagent_pending]</code></pre>"},{"location":"architecture/core/#eventspy","title":"\u4e8b\u4ef6\u7cfb\u7edf (events.py)","text":""},{"location":"architecture/core/#streameventtype","title":"StreamEventType","text":"<p>\u7edf\u4e00\u7684\u4e8b\u4ef6\u7c7b\u578b\u5b9a\u4e49\uff0c\u8d2f\u7a7f Agent\u3001Graph\u3001Controller \u4e09\u5c42\uff1a</p> <pre><code>class StreamEventType(Enum):\n    # Controller \u5c42\u4e8b\u4ef6\n    METADATA = \"metadata\"          # \u521d\u59cb\u5143\u6570\u636e\n    COMPLETE = \"complete\"          # \u6267\u884c\u5b8c\u6210\n    ERROR = \"error\"                # \u6267\u884c\u9519\u8bef\n\n    # Agent \u5c42\u4e8b\u4ef6\n    AGENT_START = \"agent_start\"    # Agent \u5f00\u59cb\u6267\u884c\n    LLM_CHUNK = \"llm_chunk\"        # LLM \u6d41\u5f0f\u8f93\u51fa\u7247\u6bb5\n    LLM_COMPLETE = \"llm_complete\"  # LLM \u8f93\u51fa\u5b8c\u6210\n    AGENT_COMPLETE = \"agent_complete\"  # Agent \u6267\u884c\u5b8c\u6210\n\n    # Graph \u5c42\u4e8b\u4ef6\n    TOOL_START = \"tool_start\"      # \u5de5\u5177\u5f00\u59cb\u6267\u884c\n    TOOL_COMPLETE = \"tool_complete\"  # \u5de5\u5177\u6267\u884c\u5b8c\u6210\n    PERMISSION_REQUEST = \"permission_request\"  # \u8bf7\u6c42\u6743\u9650\u786e\u8ba4\n    PERMISSION_RESULT = \"permission_result\"    # \u6743\u9650\u786e\u8ba4\u7ed3\u679c\n</code></pre>"},{"location":"architecture/core/#executionmetrics","title":"ExecutionMetrics","text":"<p>\u53ef\u89c2\u6d4b\u6027\u6307\u6807\uff0c\u8bb0\u5f55\u6267\u884c\u8fc7\u7a0b\uff1a</p> <pre><code>@dataclass\nclass ExecutionMetrics:\n    agent_executions: list[AgentExecutionRecord]  # Agent \u6267\u884c\u8bb0\u5f55\n    tool_calls: list[ToolCallRecord]              # \u5de5\u5177\u8c03\u7528\u8bb0\u5f55\n    started_at: datetime | None\n    completed_at: datetime | None\n    total_duration_ms: int | None\n</code></pre> <p>\u4f7f\u7528\u793a\u4f8b\uff1a</p> <pre><code># \u8bb0\u5f55 Agent \u6267\u884c\nappend_agent_execution(state, AgentExecutionRecord(\n    agent=\"lead\",\n    started_at=start_time,\n    completed_at=end_time,\n    token_usage={\"input\": 1000, \"output\": 500}\n))\n\n# \u8bb0\u5f55\u5de5\u5177\u8c03\u7528\nappend_tool_call(state, ToolCallRecord(\n    tool=\"web_search\",\n    params={\"query\": \"...\"},\n    success=True,\n    duration_ms=1500\n))\n</code></pre>"},{"location":"architecture/core/#graphpy","title":"\u5de5\u4f5c\u6d41\u5f15\u64ce (graph.py)","text":""},{"location":"architecture/core/#extendablegraph","title":"ExtendableGraph","text":"<p>\u57fa\u4e8e LangGraph \u7684\u53ef\u6269\u5c55\u5de5\u4f5c\u6d41\uff1a</p> <pre><code>class ExtendableGraph:\n    def __init__(self):\n        self.builder = StateGraph(AgentState)\n        self.agents: dict[str, BaseAgent] = {}\n        self.tool_registry: ToolRegistry = None\n\n    def register_agent(self, agent: BaseAgent):\n        \"\"\"\u6ce8\u518c Agent \u5e76\u521b\u5efa\u5bf9\u5e94\u8282\u70b9\"\"\"\n\n    def compile(self, checkpointer) -&gt; CompiledGraph:\n        \"\"\"\u7f16\u8bd1 Graph\uff0c\u6ce8\u5165 Checkpointer\"\"\"\n</code></pre>"},{"location":"architecture/core/#_3","title":"\u8282\u70b9\u7c7b\u578b","text":"<p>Agent \u8282\u70b9\uff1a\u6267\u884c\u5355\u8f6e LLM \u8c03\u7528</p> <pre><code>async def _create_agent_node(self, agent: BaseAgent):\n    async def node(state: AgentState, writer: StreamWriter):\n        # \u51c6\u5907\u4e0a\u4e0b\u6587\n        context = ContextManager.prepare_agent_context(state, agent.name)\n\n        # \u6d41\u5f0f\u6267\u884c Agent\n        async for event in agent.stream(context):\n            writer(event)\n\n        # \u66f4\u65b0\u72b6\u6001\n        return merge_agent_response_to_state(state, response, agent.name)\n\n    return node\n</code></pre> <p>\u5de5\u5177\u6267\u884c\u8282\u70b9\uff1a\u7edf\u4e00\u5904\u7406\u5de5\u5177\u8c03\u7528</p> <pre><code>async def tool_execution_node(state: AgentState, writer: StreamWriter):\n    tool_call = state[\"pending_tool_call\"]\n    tool = self.tool_registry.get_tool(tool_call[\"name\"])\n\n    # \u6743\u9650\u68c0\u67e5\n    if tool.permission in [ToolPermission.CONFIRM, ToolPermission.RESTRICTED]:\n        writer(StreamEvent(type=PERMISSION_REQUEST, ...))\n        result = interrupt({\"tool\": tool_call[\"name\"], ...})\n        if not result:\n            return state  # \u7528\u6237\u62d2\u7edd\n\n    # \u6267\u884c\u5de5\u5177\n    writer(StreamEvent(type=TOOL_START, ...))\n    result = await tool.execute(**tool_call[\"params\"])\n    writer(StreamEvent(type=TOOL_COMPLETE, ...))\n\n    # \u8fd4\u56de\u539f Agent\n    return {**state, \"pending_tool_result\": result, \"phase\": ..., \"pending_tool_call\": None}\n</code></pre>"},{"location":"architecture/core/#_4","title":"\u8def\u7531\u89c4\u5219","text":"<pre><code>def _add_routing_rules(self):\n    # Agent \u8282\u70b9\u540e\u7684\u8def\u7531\n    self.builder.add_conditional_edges(\n        \"lead\",\n        self._route_after_agent,\n        {\n            \"tool_execution\": \"tool_execution\",\n            \"search\": \"search\",\n            \"crawl\": \"crawl\",\n            END: END\n        }\n    )\n\n    # \u5de5\u5177\u6267\u884c\u540e\u8fd4\u56de\u539f Agent\n    self.builder.add_conditional_edges(\n        \"tool_execution\",\n        lambda s: s[\"current_agent\"],\n        {\"lead\": \"lead\", \"search\": \"search\", \"crawl\": \"crawl\"}\n    )\n</code></pre>"},{"location":"architecture/core/#_5","title":"\u72b6\u6001\u673a\u56fe\u793a","text":"<pre><code>stateDiagram-v2\n    [*] --&gt; lead: START\n\n    lead --&gt; tool_execution: TOOL_EXECUTING\n    lead --&gt; search: SUBAGENT (search)\n    lead --&gt; crawl: SUBAGENT (crawl)\n    lead --&gt; [*]: COMPLETED\n\n    search --&gt; tool_execution: TOOL_EXECUTING\n    search --&gt; lead: \u8fd4\u56de Lead\n\n    crawl --&gt; tool_execution: TOOL_EXECUTING\n    crawl --&gt; lead: \u8fd4\u56de Lead\n\n    tool_execution --&gt; lead: \u8fd4\u56de\u539f Agent\n    tool_execution --&gt; search: \u8fd4\u56de\u539f Agent\n    tool_execution --&gt; crawl: \u8fd4\u56de\u539f Agent</code></pre>"},{"location":"architecture/core/#controllerpy","title":"\u6267\u884c\u63a7\u5236\u5668 (controller.py)","text":""},{"location":"architecture/core/#executioncontroller","title":"ExecutionController","text":"<p>\u534f\u8c03\u6574\u4e2a\u6267\u884c\u6d41\u7a0b\u7684\u5165\u53e3\uff1a</p> <pre><code>class ExecutionController:\n    def __init__(\n        self,\n        graph: CompiledGraph,\n        conversation_manager: ConversationManager,\n        artifact_manager: ArtifactManager,\n        stream_manager: StreamManager\n    ):\n        ...\n\n    async def stream_execute(\n        self,\n        content: str,\n        conversation_id: str | None,\n        parent_message_id: str | None\n    ) -&gt; AsyncGenerator[StreamEvent, None]:\n        \"\"\"\u6d41\u5f0f\u6267\u884c\uff0cyield \u4e8b\u4ef6\"\"\"\n\n    async def execute(self, ...) -&gt; ExecutionResult:\n        \"\"\"\u6279\u91cf\u6267\u884c\uff0c\u7b49\u5f85\u5b8c\u6210\"\"\"\n</code></pre>"},{"location":"architecture/core/#_6","title":"\u6267\u884c\u6d41\u7a0b","text":"<pre><code>async def stream_execute(self, content, conversation_id, parent_message_id):\n    # 1. \u786e\u4fdd conversation \u5b58\u5728\n    conversation_id = await self._ensure_conversation(conversation_id)\n\n    # 2. \u81ea\u52a8\u8bbe\u7f6e parent_message_id\uff08\u5982\u679c\u672a\u6307\u5b9a\uff09\n    if not parent_message_id:\n        parent_message_id = await self._get_latest_message_id(conversation_id)\n\n    # 3. \u683c\u5f0f\u5316\u5bf9\u8bdd\u5386\u53f2\n    history = await self.conversation_manager.format_conversation_history_async(\n        conversation_id, parent_message_id\n    )\n\n    # 4. \u751f\u6210 ID\n    message_id = str(uuid.uuid4())\n    thread_id = str(uuid.uuid4())\n    session_id = conversation_id  # Artifact session \u4e0e conversation \u5bf9\u5e94\n\n    # 5. \u521b\u5efa\u521d\u59cb\u72b6\u6001\n    initial_state = create_initial_state(\n        current_task=content,\n        session_id=session_id,\n        thread_id=thread_id,\n        conversation_history=history\n    )\n\n    # 6. \u6dfb\u52a0\u6d88\u606f\u5230 conversation\n    await self.conversation_manager.add_message_async(\n        conversation_id, message_id, content, parent_message_id, thread_id\n    )\n\n    # 7. \u53d1\u9001\u5143\u6570\u636e\u4e8b\u4ef6\n    yield StreamEvent(type=METADATA, data={\n        \"conversation_id\": conversation_id,\n        \"thread_id\": thread_id,\n        \"message_id\": message_id\n    })\n\n    # 8. \u6267\u884c Graph\n    async for event in self.graph.astream(\n        initial_state,\n        config={\"configurable\": {\"thread_id\": thread_id}},\n        stream_mode=\"custom\"\n    ):\n        yield event\n\n    # 9. \u4fdd\u5b58\u54cd\u5e94\n    await self.conversation_manager.update_response_async(\n        conversation_id, message_id, final_response\n    )\n\n    # 10. \u53d1\u9001\u5b8c\u6210\u4e8b\u4ef6\n    yield StreamEvent(type=COMPLETE, data={...})\n</code></pre>"},{"location":"architecture/core/#context_managerpy","title":"\u4e0a\u4e0b\u6587\u7ba1\u7406 (context_manager.py)","text":""},{"location":"architecture/core/#contextmanager","title":"ContextManager","text":"<p>\u4e3a Agent \u51c6\u5907\u6267\u884c\u4e0a\u4e0b\u6587\uff1a</p> <pre><code>class ContextManager:\n    @staticmethod\n    def prepare_agent_context(state: AgentState, agent_name: str) -&gt; AgentContext:\n        \"\"\"\n        \u6784\u5efa Agent \u6267\u884c\u6240\u9700\u7684\u4e0a\u4e0b\u6587\uff1a\n        - \u5bf9\u8bdd\u5386\u53f2\n        - \u5f53\u524d\u4efb\u52a1\n        - Agent \u8bb0\u5fc6\n        - \u5de5\u5177\u4ea4\u4e92\u5386\u53f2\n        - \u5f85\u5904\u7406\u7684\u5de5\u5177\u7ed3\u679c\n        \"\"\"\n\n    @staticmethod\n    def build_agent_messages(context: AgentContext) -&gt; list[dict]:\n        \"\"\"\n        \u6784\u5efa LLM \u8c03\u7528\u7684 messages \u5217\u8868\uff1a\n        - system: Agent \u7cfb\u7edf\u63d0\u793a\n        - user: \u5bf9\u8bdd\u5386\u53f2 + \u4efb\u52a1 + \u8bb0\u5fc6\n        - assistant/tool: \u5de5\u5177\u4ea4\u4e92\u5386\u53f2\uff08\u5982\u679c\u6709\uff09\n        \"\"\"\n</code></pre>"},{"location":"architecture/core/#_7","title":"\u6d88\u606f\u538b\u7f29","text":"<p>\u5f53\u6d88\u606f\u5386\u53f2\u8fc7\u957f\u65f6\u81ea\u52a8\u538b\u7f29\uff1a</p> <pre><code>@staticmethod\ndef should_compress(messages: list, threshold: int = 50000) -&gt; bool:\n    \"\"\"\u5224\u65ad\u662f\u5426\u9700\u8981\u538b\u7f29\"\"\"\n\n@staticmethod\nasync def compress_messages(messages: list, llm) -&gt; list:\n    \"\"\"\u4f7f\u7528 LLM \u538b\u7f29\u6d88\u606f\u5386\u53f2\"\"\"\n</code></pre>"},{"location":"architecture/core/#conversation_managerpy","title":"\u5bf9\u8bdd\u7ba1\u7406 (conversation_manager.py)","text":""},{"location":"architecture/core/#conversationmanager","title":"ConversationManager","text":"<p>\u7ba1\u7406\u5bf9\u8bdd\u6811\u7ed3\u6784\uff1a</p> <pre><code>class ConversationManager:\n    def __init__(self, repo: ConversationRepository):\n        self._cache: dict[str, ConversationCache] = {}\n\n    async def start_conversation_async(self, conversation_id: str):\n        \"\"\"\u521b\u5efa\u65b0\u5bf9\u8bdd\"\"\"\n\n    async def add_message_async(\n        self,\n        conversation_id: str,\n        message_id: str,\n        content: str,\n        parent_id: str | None,\n        thread_id: str\n    ):\n        \"\"\"\u6dfb\u52a0\u6d88\u606f\u5230\u5bf9\u8bdd\u6811\"\"\"\n\n    async def format_conversation_history_async(\n        self,\n        conversation_id: str,\n        leaf_message_id: str\n    ) -&gt; str:\n        \"\"\"\u683c\u5f0f\u5316\u4ece root \u5230\u6307\u5b9a\u6d88\u606f\u7684\u5bf9\u8bdd\u5386\u53f2\"\"\"\n</code></pre>"},{"location":"architecture/core/#_8","title":"\u6811\u72b6\u6d88\u606f\u7ed3\u6784","text":"<pre><code>Conversation\n    \u2502\n    \u2514\u2500\u2500 Message (root, parent_id=None)\n            \u2502\n            \u251c\u2500\u2500 Message (branch 1)\n            \u2502       \u2502\n            \u2502       \u2514\u2500\u2500 Message (leaf)\n            \u2502\n            \u2514\u2500\u2500 Message (branch 2)\n                    \u2502\n                    \u2514\u2500\u2500 Message (leaf)\n</code></pre> <p>\u652f\u6301\u4ece\u4efb\u610f\u6d88\u606f\u8282\u70b9\u521b\u5efa\u5206\u652f\uff0c\u5b9e\u73b0\u5bf9\u8bdd\u7248\u672c\u63a7\u5236\u3002</p>"},{"location":"architecture/data-layer/","title":"\u6570\u636e\u5c42","text":"<p>\u6570\u636e\u5c42\u8d1f\u8d23\u6301\u4e45\u5316\u5b58\u50a8\uff0c\u5305\u62ec\u5bf9\u8bdd\u5386\u53f2\u3001\u6d88\u606f\u3001Artifact \u7b49\u3002</p>"},{"location":"architecture/data-layer/#_2","title":"\u6a21\u5757\u7ed3\u6784","text":"<pre><code>src/\n\u251c\u2500\u2500 db/\n\u2502   \u251c\u2500\u2500 models.py      # SQLAlchemy ORM \u6a21\u578b\n\u2502   \u2514\u2500\u2500 database.py    # \u6570\u636e\u5e93\u7ba1\u7406\u5668\n\u2514\u2500\u2500 repositories/\n    \u251c\u2500\u2500 base.py        # Repository \u57fa\u7c7b\n    \u251c\u2500\u2500 conversation_repo.py\n    \u2514\u2500\u2500 artifact_repo.py\n</code></pre>"},{"location":"architecture/data-layer/#modelspy","title":"\u6570\u636e\u6a21\u578b (models.py)","text":""},{"location":"architecture/data-layer/#er","title":"ER \u56fe","text":"<pre><code>erDiagram\n    Conversation ||--o{ Message : contains\n    Conversation ||--o| ArtifactSession : has\n    ArtifactSession ||--o{ Artifact : contains\n    Artifact ||--o{ ArtifactVersion : versions\n\n    Conversation {\n        string id PK\n        string active_branch\n        string title\n        string user_id\n        datetime created_at\n        datetime updated_at\n        json metadata_\n    }\n\n    Message {\n        string id PK\n        string conversation_id FK\n        string parent_id\n        text content\n        string thread_id\n        datetime timestamp\n        text graph_response\n        json metadata\n    }\n\n    ArtifactSession {\n        string id PK\n        string conversation_id FK\n    }\n\n    Artifact {\n        string id PK\n        string session_id FK\n        string type\n        string title\n        text content\n        int version\n        datetime created_at\n        datetime updated_at\n    }\n\n    ArtifactVersion {\n        string id PK\n        string artifact_id FK\n        int version\n        text content\n        datetime created_at\n    }</code></pre>"},{"location":"architecture/data-layer/#conversation","title":"Conversation","text":"<p>\u5bf9\u8bdd\u5b9e\u4f53\uff1a</p> <pre><code>class Conversation(Base):\n    __tablename__ = \"conversations\"\n\n    id = Column(String(64), primary_key=True)\n    active_branch = Column(String(64))  # \u5f53\u524d\u6d3b\u8dc3\u5206\u652f\u7684\u53f6\u5b50 message_id\n    title = Column(String(256))\n    user_id = Column(String(64))        # \u9884\u7559\u5b57\u6bb5\n    created_at = Column(DateTime, default=datetime.utcnow)\n    updated_at = Column(DateTime, onupdate=datetime.utcnow)\n    metadata_ = Column(JSON)\n\n    # \u5173\u7cfb\n    messages = relationship(\"Message\", back_populates=\"conversation\")\n    artifact_session = relationship(\"ArtifactSession\", uselist=False)\n</code></pre>"},{"location":"architecture/data-layer/#message","title":"Message","text":"<p>\u6d88\u606f\u5b9e\u4f53\uff08\u6811\u72b6\u7ed3\u6784\uff09\uff1a</p> <pre><code>class Message(Base):\n    __tablename__ = \"messages\"\n\n    id = Column(String(64), primary_key=True)\n    conversation_id = Column(String(64), ForeignKey(\"conversations.id\"))\n    parent_id = Column(String(64), nullable=True)  # None = \u6839\u6d88\u606f\n    content = Column(Text)                          # \u7528\u6237\u6d88\u606f\n    thread_id = Column(String(64))                  # LangGraph \u7ebf\u7a0b ID\n    timestamp = Column(DateTime, default=datetime.utcnow)\n    graph_response = Column(Text)                   # Agent \u56de\u590d\n    metadata = Column(JSON)\n\n    conversation = relationship(\"Conversation\", back_populates=\"messages\")\n</code></pre> <p>\u6811\u72b6\u7ed3\u6784\u8bf4\u660e\uff1a</p> <pre><code>parent_id \u5b9e\u73b0\u6d88\u606f\u6811\uff1a\n\nmsg_1 (parent_id=None)     \u2190 \u6839\u6d88\u606f\n  \u251c\u2500\u2500 msg_2 (parent_id=msg_1)\n  \u2502     \u2514\u2500\u2500 msg_4 (parent_id=msg_2)\n  \u2514\u2500\u2500 msg_3 (parent_id=msg_1)    \u2190 \u5206\u652f\n        \u2514\u2500\u2500 msg_5 (parent_id=msg_3)\n</code></pre>"},{"location":"architecture/data-layer/#artifact","title":"Artifact","text":"<p>\u5de5\u4ef6\u5b9e\u4f53\uff08\u5e26\u4e50\u89c2\u9501\uff09\uff1a</p> <pre><code>class Artifact(Base):\n    __tablename__ = \"artifacts\"\n\n    id = Column(String(128), primary_key=True)\n    session_id = Column(String(64), ForeignKey(\"artifact_sessions.id\"))\n    type = Column(String(32))       # task_plan, result, etc.\n    title = Column(String(256))\n    content = Column(Text)\n    version = Column(Integer, default=1)  # \u4e50\u89c2\u9501\u7248\u672c\u53f7\n    created_at = Column(DateTime, default=datetime.utcnow)\n    updated_at = Column(DateTime, onupdate=datetime.utcnow)\n\n    versions = relationship(\"ArtifactVersion\", back_populates=\"artifact\")\n</code></pre>"},{"location":"architecture/data-layer/#artifactversion","title":"ArtifactVersion","text":"<p>\u7248\u672c\u5386\u53f2\uff1a</p> <pre><code>class ArtifactVersion(Base):\n    __tablename__ = \"artifact_versions\"\n\n    id = Column(String(128), primary_key=True)\n    artifact_id = Column(String(128), ForeignKey(\"artifacts.id\"))\n    version = Column(Integer)\n    content = Column(Text)\n    created_at = Column(DateTime, default=datetime.utcnow)\n\n    artifact = relationship(\"Artifact\", back_populates=\"versions\")\n</code></pre>"},{"location":"architecture/data-layer/#databasepy","title":"\u6570\u636e\u5e93\u7ba1\u7406 (database.py)","text":""},{"location":"architecture/data-layer/#databasemanager","title":"DatabaseManager","text":"<pre><code>class DatabaseManager:\n    def __init__(self, database_url: str):\n        self._engine = create_async_engine(database_url)\n        self._session_factory = async_sessionmaker(self._engine)\n\n    async def initialize(self):\n        \"\"\"\u521d\u59cb\u5316\u6570\u636e\u5e93\uff08\u521b\u5efa\u8868\uff09\"\"\"\n        async with self._engine.begin() as conn:\n            await conn.run_sync(Base.metadata.create_all)\n\n    @asynccontextmanager\n    async def session(self) -&gt; AsyncGenerator[AsyncSession, None]:\n        \"\"\"\u83b7\u53d6\u6570\u636e\u5e93\u4f1a\u8bdd\"\"\"\n        async with self._session_factory() as session:\n            try:\n                yield session\n                await session.commit()\n            except Exception:\n                await session.rollback()\n                raise\n\n    async def close(self):\n        \"\"\"\u5173\u95ed\u6570\u636e\u5e93\u8fde\u63a5\"\"\"\n        await self._engine.dispose()\n</code></pre> <p>\u4f7f\u7528\u793a\u4f8b\uff1a</p> <pre><code>db_manager = DatabaseManager(\"sqlite+aiosqlite:///data/app.db\")\nawait db_manager.initialize()\n\nasync with db_manager.session() as session:\n    repo = ConversationRepository(session)\n    conversation = await repo.get_by_id(\"xxx\")\n</code></pre>"},{"location":"architecture/data-layer/#repository","title":"Repository \u6a21\u5f0f","text":""},{"location":"architecture/data-layer/#baserepository","title":"BaseRepository","text":"<p>\u901a\u7528 CRUD \u64cd\u4f5c\uff1a</p> <pre><code>class BaseRepository(Generic[T]):\n    def __init__(self, session: AsyncSession, model_class: Type[T]):\n        self.session = session\n        self.model_class = model_class\n\n    async def get_by_id(self, id: str) -&gt; T | None:\n        return await self.session.get(self.model_class, id)\n\n    async def get_all(self, limit: int = 100, offset: int = 0) -&gt; list[T]:\n        stmt = select(self.model_class).limit(limit).offset(offset)\n        result = await self.session.execute(stmt)\n        return list(result.scalars().all())\n\n    async def create(self, obj: T) -&gt; T:\n        self.session.add(obj)\n        await self.session.flush()\n        return obj\n\n    async def update(self, obj: T) -&gt; T:\n        await self.session.flush()\n        return obj\n\n    async def delete(self, id: str) -&gt; bool:\n        obj = await self.get_by_id(id)\n        if obj:\n            await self.session.delete(obj)\n            return True\n        return False\n</code></pre>"},{"location":"architecture/data-layer/#conversationrepository","title":"ConversationRepository","text":"<p>\u5bf9\u8bdd\u76f8\u5173\u64cd\u4f5c\uff1a</p> <pre><code>class ConversationRepository(BaseRepository[Conversation]):\n    def __init__(self, session: AsyncSession):\n        super().__init__(session, Conversation)\n\n    async def get_with_messages(self, id: str) -&gt; Conversation | None:\n        \"\"\"\u83b7\u53d6\u5bf9\u8bdd\u53ca\u5176\u6240\u6709\u6d88\u606f\"\"\"\n        stmt = (\n            select(Conversation)\n            .options(selectinload(Conversation.messages))\n            .where(Conversation.id == id)\n        )\n        result = await self.session.execute(stmt)\n        return result.scalar_one_or_none()\n\n    async def add_message(self, conversation_id: str, message: Message) -&gt; Message:\n        \"\"\"\u6dfb\u52a0\u6d88\u606f\u5230\u5bf9\u8bdd\"\"\"\n        message.conversation_id = conversation_id\n        self.session.add(message)\n        await self.session.flush()\n        return message\n\n    async def get_message_path(\n        self,\n        conversation_id: str,\n        leaf_message_id: str\n    ) -&gt; list[Message]:\n        \"\"\"\u83b7\u53d6\u4ece\u6839\u5230\u6307\u5b9a\u6d88\u606f\u7684\u8def\u5f84\"\"\"\n        # \u9012\u5f52\u67e5\u8be2\u5b9e\u73b0\n        ...\n</code></pre>"},{"location":"architecture/data-layer/#artifactrepository","title":"ArtifactRepository","text":"<p>Artifact \u64cd\u4f5c\uff08\u542b\u4e50\u89c2\u9501\uff09\uff1a</p> <pre><code>class ArtifactRepository(BaseRepository[Artifact]):\n    def __init__(self, session: AsyncSession):\n        super().__init__(session, Artifact)\n\n    async def update_with_version_check(\n        self,\n        artifact_id: str,\n        new_content: str,\n        expected_version: int\n    ) -&gt; Artifact:\n        \"\"\"\n        \u4e50\u89c2\u9501\u66f4\u65b0\n\n        \u5982\u679c expected_version \u4e0e\u6570\u636e\u5e93\u4e2d\u7684 version \u4e0d\u5339\u914d\uff0c\n        \u629b\u51fa OptimisticLockError\n        \"\"\"\n        artifact = await self.get_by_id(artifact_id)\n\n        if artifact.version != expected_version:\n            raise OptimisticLockError(\n                f\"Version mismatch: expected {expected_version}, \"\n                f\"got {artifact.version}\"\n            )\n\n        # \u4fdd\u5b58\u65e7\u7248\u672c\n        version_record = ArtifactVersion(\n            id=f\"{artifact_id}_v{artifact.version}\",\n            artifact_id=artifact_id,\n            version=artifact.version,\n            content=artifact.content\n        )\n        self.session.add(version_record)\n\n        # \u66f4\u65b0 artifact\n        artifact.content = new_content\n        artifact.version += 1\n\n        await self.session.flush()\n        return artifact\n\n    async def get_versions(self, artifact_id: str) -&gt; list[ArtifactVersion]:\n        \"\"\"\u83b7\u53d6\u7248\u672c\u5386\u53f2\"\"\"\n        stmt = (\n            select(ArtifactVersion)\n            .where(ArtifactVersion.artifact_id == artifact_id)\n            .order_by(ArtifactVersion.version.desc())\n        )\n        result = await self.session.execute(stmt)\n        return list(result.scalars().all())\n</code></pre>"},{"location":"architecture/data-layer/#_3","title":"\u4e50\u89c2\u9501\u673a\u5236","text":""},{"location":"architecture/data-layer/#_4","title":"\u4e3a\u4ec0\u4e48\u9700\u8981\u4e50\u89c2\u9501\uff1f","text":"<p>\u591a Agent \u5e76\u53d1\u573a\u666f\u4e0b\uff0c\u53ef\u80fd\u540c\u65f6\u66f4\u65b0\u540c\u4e00\u4e2a Artifact\uff1a</p> <pre><code>Agent A: \u8bfb\u53d6 Artifact (version=1)\nAgent B: \u8bfb\u53d6 Artifact (version=1)\nAgent A: \u66f4\u65b0 Artifact \u2192 version=2\nAgent B: \u66f4\u65b0 Artifact \u2192 \u51b2\u7a81\uff01\n</code></pre>"},{"location":"architecture/data-layer/#_5","title":"\u5904\u7406\u6d41\u7a0b","text":"<pre><code>sequenceDiagram\n    participant Agent\n    participant Tool\n    participant Repo\n    participant DB\n\n    Agent-&gt;&gt;Tool: update_artifact(id, content, version=1)\n    Tool-&gt;&gt;Repo: update_with_version_check()\n    Repo-&gt;&gt;DB: SELECT version FROM artifacts WHERE id=?\n    DB-&gt;&gt;Repo: version=1\n\n    alt \u7248\u672c\u5339\u914d\n        Repo-&gt;&gt;DB: \u4fdd\u5b58\u65e7\u7248\u672c\u5230 artifact_versions\n        Repo-&gt;&gt;DB: UPDATE SET content=?, version=2\n        Repo-&gt;&gt;Tool: \u6210\u529f\n        Tool-&gt;&gt;Agent: ToolResult(success=True)\n    else \u7248\u672c\u4e0d\u5339\u914d\n        Repo-&gt;&gt;Tool: OptimisticLockError\n        Tool-&gt;&gt;Agent: ToolResult(success=False, error=\"Version conflict\")\n    end</code></pre>"},{"location":"architecture/data-layer/#agent","title":"Agent \u5904\u7406\u51b2\u7a81","text":"<p>\u5f53\u6536\u5230\u7248\u672c\u51b2\u7a81\u9519\u8bef\u65f6\uff0cAgent \u5e94\u8be5\uff1a</p> <ol> <li>\u91cd\u65b0\u8bfb\u53d6\u6700\u65b0\u7248\u672c</li> <li>\u5408\u5e76\u53d8\u66f4</li> <li>\u91cd\u8bd5\u66f4\u65b0</li> </ol>"},{"location":"architecture/data-layer/#langgraph-checkpointer","title":"LangGraph Checkpointer","text":"<p>\u9664\u4e86\u4e1a\u52a1\u6570\u636e\uff0cLangGraph \u72b6\u6001\u4e5f\u9700\u8981\u6301\u4e45\u5316\uff1a</p> <pre><code># src/core/graph.py\nasync def create_async_sqlite_checkpointer(db_path: str):\n    \"\"\"\u521b\u5efa LangGraph \u72b6\u6001\u68c0\u67e5\u70b9\"\"\"\n    from langgraph.checkpoint.sqlite.aio import AsyncSqliteSaver\n\n    checkpointer = AsyncSqliteSaver.from_conn_string(db_path)\n    await checkpointer.setup()\n    return checkpointer\n</code></pre> <p>Checkpointer \u5b58\u50a8\uff1a</p> <ul> <li>\u6bcf\u4e2a <code>thread_id</code> \u7684\u5b8c\u6574\u72b6\u6001\u5386\u53f2</li> <li>\u652f\u6301 <code>interrupt()</code> \u540e\u6062\u590d\u6267\u884c</li> <li>\u5b58\u50a8\u5728\u72ec\u7acb\u7684 SQLite \u6587\u4ef6\uff08<code>data/langgraph.db</code>\uff09</li> </ul>"},{"location":"architecture/tools/","title":"Tool \u7cfb\u7edf","text":"<p>Tool \u7cfb\u7edf\u4e3a Agent \u63d0\u4f9b\u4e0e\u5916\u90e8\u4e16\u754c\u4ea4\u4e92\u7684\u80fd\u529b\uff0c\u5305\u62ec\u641c\u7d22\u3001\u6293\u53d6\u3001Artifact \u64cd\u4f5c\u7b49\u3002</p>"},{"location":"architecture/tools/#_1","title":"\u6a21\u5757\u7ed3\u6784","text":"<pre><code>src/tools/\n\u251c\u2500\u2500 base.py              # \u5de5\u5177\u57fa\u7c7b\u548c\u6743\u9650\u5b9a\u4e49\n\u251c\u2500\u2500 registry.py          # \u5de5\u5177\u6ce8\u518c\u4e2d\u5fc3\n\u251c\u2500\u2500 xml_parser.py        # XML \u5de5\u5177\u8c03\u7528\u89e3\u6790\n\u251c\u2500\u2500 prompt_generator.py  # \u5de5\u5177\u63d0\u793a\u8bcd\u751f\u6210\n\u2514\u2500\u2500 implementations/     # \u5177\u4f53\u5de5\u5177\u5b9e\u73b0\n    \u251c\u2500\u2500 call_subagent.py\n    \u251c\u2500\u2500 web_search.py\n    \u251c\u2500\u2500 web_fetch.py\n    \u2514\u2500\u2500 artifact_ops.py\n</code></pre>"},{"location":"architecture/tools/#basepy","title":"\u6743\u9650\u7cfb\u7edf (base.py)","text":""},{"location":"architecture/tools/#toolpermission","title":"ToolPermission","text":"<p>\u56db\u7ea7\u6743\u9650\u6a21\u578b\uff1a</p> <pre><code>class ToolPermission(Enum):\n    PUBLIC = \"public\"          # \u76f4\u63a5\u6267\u884c\uff0c\u65e0\u9700\u786e\u8ba4\n    NOTIFY = \"notify\"          # \u6267\u884c\u540e\u901a\u77e5\u7528\u6237\n    CONFIRM = \"confirm\"        # \u6267\u884c\u524d\u9700\u7528\u6237\u786e\u8ba4\n    RESTRICTED = \"restricted\"  # \u9700\u7279\u6b8a\u6388\u6743\n</code></pre> <p>\u6743\u9650\u5904\u7406\u6d41\u7a0b\uff08\u5728 <code>graph.py</code> \u7684 <code>tool_execution_node</code> \u4e2d\uff09\uff1a</p> <pre><code>flowchart TD\n    A[\u83b7\u53d6\u5de5\u5177\u6743\u9650] --&gt; B{\u6743\u9650\u7ea7\u522b}\n    B --&gt;|PUBLIC| C[\u76f4\u63a5\u6267\u884c]\n    B --&gt;|NOTIFY| D[\u6267\u884c\u540e\u53d1\u9001\u901a\u77e5\u4e8b\u4ef6]\n    B --&gt;|CONFIRM| E[\u53d1\u9001 PERMISSION_REQUEST]\n    B --&gt;|RESTRICTED| E\n    E --&gt; F[interrupt \u6682\u505c]\n    F --&gt; G{\u7528\u6237\u54cd\u5e94}\n    G --&gt;|approved| C\n    G --&gt;|denied| H[\u8fd4\u56de\u62d2\u7edd\u7ed3\u679c]\n    C --&gt; I[\u53d1\u9001 TOOL_COMPLETE]\n    D --&gt; I</code></pre>"},{"location":"architecture/tools/#toolparameter","title":"ToolParameter","text":"<p>\u5de5\u5177\u53c2\u6570\u5b9a\u4e49\uff1a</p> <pre><code>@dataclass\nclass ToolParameter:\n    name: str                    # \u53c2\u6570\u540d\n    type: str                    # \u7c7b\u578b\uff1astring, integer, boolean, array, object\n    description: str             # \u53c2\u6570\u63cf\u8ff0\n    required: bool = True        # \u662f\u5426\u5fc5\u9700\n    default: Any = None          # \u9ed8\u8ba4\u503c\n</code></pre>"},{"location":"architecture/tools/#toolresult","title":"ToolResult","text":"<p>\u5de5\u5177\u6267\u884c\u7ed3\u679c\uff1a</p> <pre><code>@dataclass\nclass ToolResult:\n    success: bool                # \u6267\u884c\u662f\u5426\u6210\u529f\n    data: Any                    # \u7ed3\u679c\u6570\u636e\n    error: str | None = None     # \u9519\u8bef\u4fe1\u606f\n    metadata: dict | None = None # \u5143\u6570\u636e\n</code></pre>"},{"location":"architecture/tools/#basetool","title":"BaseTool \u57fa\u7c7b","text":""},{"location":"architecture/tools/#_2","title":"\u5b9a\u4e49\u5de5\u5177","text":"<pre><code>class BaseTool(ABC):\n    name: str                    # \u5de5\u5177\u540d\u79f0\uff08\u552f\u4e00\u6807\u8bc6\uff09\n    description: str             # \u5de5\u5177\u63cf\u8ff0\n    permission: ToolPermission   # \u6743\u9650\u7ea7\u522b\n\n    @abstractmethod\n    def get_parameters(self) -&gt; list[ToolParameter]:\n        \"\"\"\u8fd4\u56de\u53c2\u6570\u5b9a\u4e49\u5217\u8868\"\"\"\n        pass\n\n    @abstractmethod\n    async def execute(self, **params) -&gt; ToolResult:\n        \"\"\"\u6267\u884c\u5de5\u5177\"\"\"\n        pass\n\n    def validate_params(self, params: dict) -&gt; tuple[bool, str]:\n        \"\"\"\u9a8c\u8bc1\u53c2\u6570\uff08\u53ef\u9009\u8986\u76d6\uff09\"\"\"\n        # \u9ed8\u8ba4\u5b9e\u73b0\uff1a\u68c0\u67e5\u5fc5\u9700\u53c2\u6570\n        ...\n</code></pre>"},{"location":"architecture/tools/#websearchtool","title":"\u793a\u4f8b\uff1aWebSearchTool","text":"<pre><code>class WebSearchTool(BaseTool):\n    name = \"web_search\"\n    description = \"\u641c\u7d22\u4e92\u8054\u7f51\u83b7\u53d6\u4fe1\u606f\"\n    permission = ToolPermission.PUBLIC\n\n    def get_parameters(self) -&gt; list[ToolParameter]:\n        return [\n            ToolParameter(\n                name=\"query\",\n                type=\"string\",\n                description=\"\u641c\u7d22\u67e5\u8be2\u8bcd\",\n                required=True\n            ),\n            ToolParameter(\n                name=\"max_results\",\n                type=\"integer\",\n                description=\"\u6700\u5927\u7ed3\u679c\u6570\u91cf\",\n                required=False,\n                default=10\n            )\n        ]\n\n    async def execute(self, query: str, max_results: int = 10) -&gt; ToolResult:\n        try:\n            results = await self._do_search(query, max_results)\n            return ToolResult(success=True, data=results)\n        except Exception as e:\n            return ToolResult(success=False, error=str(e))\n</code></pre>"},{"location":"architecture/tools/#registrypy","title":"\u5de5\u5177\u6ce8\u518c\u4e2d\u5fc3 (registry.py)","text":""},{"location":"architecture/tools/#toolregistry","title":"ToolRegistry","text":"<p>\u5168\u5c40\u5de5\u5177\u5e93\u7ba1\u7406\uff1a</p> <pre><code>class ToolRegistry:\n    def __init__(self):\n        self._library: dict[str, BaseTool] = {}\n        self._agent_toolkits: dict[str, AgentToolkit] = {}\n\n    def register_tool_to_library(self, tool: BaseTool):\n        \"\"\"\u6ce8\u518c\u5de5\u5177\u5230\u5168\u5c40\u5e93\"\"\"\n        self._library[tool.name] = tool\n\n    def create_agent_toolkit(\n        self,\n        agent_name: str,\n        tool_names: list[str]\n    ) -&gt; AgentToolkit:\n        \"\"\"\u4e3a Agent \u521b\u5efa\u4e13\u5c5e\u5de5\u5177\u96c6\"\"\"\n        tools = [self._library[name] for name in tool_names]\n        toolkit = AgentToolkit(agent_name, tools)\n        self._agent_toolkits[agent_name] = toolkit\n        return toolkit\n\n    def get_tool(self, tool_name: str) -&gt; BaseTool:\n        \"\"\"\u83b7\u53d6\u5de5\u5177\u5b9e\u4f8b\"\"\"\n        return self._library[tool_name]\n</code></pre>"},{"location":"architecture/tools/#agenttoolkit","title":"AgentToolkit","text":"<p>Agent \u4e13\u5c5e\u5de5\u5177\u96c6\uff1a</p> <pre><code>class AgentToolkit:\n    def __init__(self, agent_name: str, tools: list[BaseTool]):\n        self.agent_name = agent_name\n        self._tools: dict[str, BaseTool] = {t.name: t for t in tools}\n\n    def get_tool(self, name: str) -&gt; BaseTool | None:\n        return self._tools.get(name)\n\n    def list_tools(self) -&gt; list[str]:\n        return list(self._tools.keys())\n\n    async def execute_tool(self, name: str, params: dict) -&gt; ToolResult:\n        \"\"\"\u6267\u884c\u5de5\u5177\uff08\u6743\u9650\u68c0\u67e5\u7531 Graph \u5c42\u8d1f\u8d23\uff09\"\"\"\n        tool = self.get_tool(name)\n        if not tool:\n            return ToolResult(success=False, error=f\"Tool not found: {name}\")\n\n        valid, error = tool.validate_params(params)\n        if not valid:\n            return ToolResult(success=False, error=error)\n\n        return await tool.execute(**params)\n</code></pre>"},{"location":"architecture/tools/#_3","title":"\u521d\u59cb\u5316\u6d41\u7a0b","text":"<pre><code># \u5728\u5e94\u7528\u542f\u52a8\u65f6\ndef create_tool_registry() -&gt; ToolRegistry:\n    registry = ToolRegistry()\n\n    # \u6ce8\u518c\u6240\u6709\u5de5\u5177\u5230\u5e93\n    registry.register_tool_to_library(WebSearchTool())\n    registry.register_tool_to_library(WebFetchTool())\n    registry.register_tool_to_library(CreateArtifactTool())\n    # ...\n\n    return registry\n\n# \u4e3a\u6bcf\u4e2a Agent \u521b\u5efa Toolkit\ndef setup_agent_toolkits(registry: ToolRegistry, agents: list[BaseAgent]):\n    for agent in agents:\n        registry.create_agent_toolkit(\n            agent.name,\n            agent.config.required_tools\n        )\n</code></pre>"},{"location":"architecture/tools/#xml-xml_parserpy","title":"XML \u89e3\u6790\u5668 (xml_parser.py)","text":""},{"location":"architecture/tools/#_4","title":"\u5de5\u5177\u8c03\u7528\u683c\u5f0f","text":"<p>Agent \u4f7f\u7528 XML \u683c\u5f0f\u53d1\u8d77\u5de5\u5177\u8c03\u7528\uff0c\u6240\u6709\u53c2\u6570\u503c\u4f7f\u7528 CDATA \u5305\u88f9\uff1a</p> <pre><code>&lt;tool_call&gt;\n  &lt;name&gt;web_search&lt;/name&gt;\n  &lt;params&gt;\n    &lt;query&gt;&lt;![CDATA[Python async best practices]]&gt;&lt;/query&gt;\n    &lt;max_results&gt;&lt;![CDATA[10]]&gt;&lt;/max_results&gt;\n  &lt;/params&gt;\n&lt;/tool_call&gt;\n</code></pre> <p>\u4e3a\u4ec0\u4e48\u4f7f\u7528 CDATA\uff1f</p> <ul> <li>\u907f\u514d\u7279\u6b8a\u5b57\u7b26\uff08<code>&lt;</code>, <code>&gt;</code>, <code>&amp;</code>\uff09\u5bfc\u81f4\u89e3\u6790\u5931\u8d25</li> <li>\u652f\u6301\u591a\u884c\u5185\u5bb9\uff08\u5982\u4ee3\u7801\u7247\u6bb5\uff09</li> <li>\u4fdd\u6301\u5185\u5bb9\u539f\u6837\uff0c\u65e0\u9700\u8f6c\u4e49</li> </ul>"},{"location":"architecture/tools/#xmltoolcallparser","title":"XMLToolCallParser","text":"<pre><code>class XMLToolCallParser:\n    @staticmethod\n    def parse(content: str) -&gt; list[dict]:\n        \"\"\"\n        \u89e3\u6790 XML \u5de5\u5177\u8c03\u7528\n\n        Returns:\n            [{\"name\": \"tool_name\", \"params\": {...}}, ...]\n        \"\"\"\n        # \u4f7f\u7528 xml.etree.ElementTree \u89e3\u6790\n        # \u81ea\u52a8\u5904\u7406 CDATA\n        # \u81ea\u52a8\u7c7b\u578b\u8f6c\u6362\uff08bool, int, float, string\uff09\n</code></pre> <p>\u7c7b\u578b\u8f6c\u6362\u89c4\u5219\uff1a</p> \u539f\u59cb\u503c \u8f6c\u6362\u7ed3\u679c <code>\"true\"</code> / <code>\"false\"</code> <code>bool</code> <code>\"123\"</code> <code>int</code> <code>\"3.14\"</code> <code>float</code> \u5176\u4ed6 <code>str</code>"},{"location":"architecture/tools/#prompt_generatorpy","title":"\u63d0\u793a\u8bcd\u751f\u6210\u5668 (prompt_generator.py)","text":""},{"location":"architecture/tools/#toolpromptgenerator","title":"ToolPromptGenerator","text":"<p>\u4e3a Agent \u751f\u6210\u5de5\u5177\u4f7f\u7528\u8bf4\u660e\uff1a</p> <pre><code>class ToolPromptGenerator:\n    @staticmethod\n    def generate_tool_instruction(toolkit: AgentToolkit) -&gt; str:\n        \"\"\"\n        \u751f\u6210\u5b8c\u6574\u7684\u5de5\u5177\u4f7f\u7528\u8bf4\u660e\n\n        \u5305\u542b\uff1a\n        - \u53ef\u7528\u5de5\u5177\u5217\u8868\n        - \u6bcf\u4e2a\u5de5\u5177\u7684\u53c2\u6570\u8bf4\u660e\n        - XML \u8c03\u7528\u683c\u5f0f\u793a\u4f8b\n        - \u6ce8\u610f\u4e8b\u9879\n        \"\"\"\n</code></pre> <p>\u751f\u6210\u793a\u4f8b\uff1a</p> <pre><code># \u53ef\u7528\u5de5\u5177\n\n## web_search\n\u641c\u7d22\u4e92\u8054\u7f51\u83b7\u53d6\u4fe1\u606f\n\n**\u53c2\u6570\uff1a**\n- `query` (string, \u5fc5\u9700): \u641c\u7d22\u67e5\u8be2\u8bcd\n- `max_results` (integer, \u53ef\u9009, \u9ed8\u8ba4: 10): \u6700\u5927\u7ed3\u679c\u6570\u91cf\n\n**\u8c03\u7528\u793a\u4f8b\uff1a**\n\\`\\`\\`xml\n&lt;tool_call&gt;\n  &lt;name&gt;web_search&lt;/name&gt;\n  &lt;params&gt;\n    &lt;query&gt;&lt;![CDATA[your search query]]&gt;&lt;/query&gt;\n  &lt;/params&gt;\n&lt;/tool_call&gt;\n\\`\\`\\`\n\n## create_artifact\n\u521b\u5efa\u65b0\u7684 Artifact\n\n...\n</code></pre>"},{"location":"architecture/tools/#_5","title":"\u5185\u7f6e\u5de5\u5177","text":""},{"location":"architecture/tools/#call_subagent","title":"call_subagent","text":"<p>Lead Agent \u8c03\u7528 SubAgent\uff1a</p> <pre><code>class CallSubagentTool(BaseTool):\n    name = \"call_subagent\"\n    description = \"\u8c03\u7528\u5176\u4ed6 Agent \u6267\u884c\u4efb\u52a1\"\n    permission = ToolPermission.PUBLIC\n\n    def get_parameters(self):\n        return [\n            ToolParameter(\"target\", \"string\", \"\u76ee\u6807 Agent \u540d\u79f0\"),\n            ToolParameter(\"instruction\", \"string\", \"\u6267\u884c\u6307\u4ee4\")\n        ]\n</code></pre>"},{"location":"architecture/tools/#web_search","title":"web_search","text":"<p>\u4e92\u8054\u7f51\u641c\u7d22\uff1a</p> <pre><code>class WebSearchTool(BaseTool):\n    name = \"web_search\"\n    description = \"\u641c\u7d22\u4e92\u8054\u7f51\"\n    permission = ToolPermission.PUBLIC\n</code></pre>"},{"location":"architecture/tools/#web_fetch","title":"web_fetch","text":"<p>\u7f51\u9875\u5185\u5bb9\u6293\u53d6\uff1a</p> <pre><code>class WebFetchTool(BaseTool):\n    name = \"web_fetch\"\n    description = \"\u83b7\u53d6\u7f51\u9875\u5185\u5bb9\"\n    permission = ToolPermission.PUBLIC\n</code></pre>"},{"location":"architecture/tools/#artifact","title":"Artifact \u64cd\u4f5c","text":"<pre><code># \u521b\u5efa\nCreateArtifactTool   # create_artifact\n# \u8bfb\u53d6\nReadArtifactTool     # read_artifact\n# \u66f4\u65b0\uff08\u589e\u91cf\uff09\nUpdateArtifactTool   # update_artifact\n# \u91cd\u5199\uff08\u5b8c\u5168\u8986\u76d6\uff09\nRewriteArtifactTool  # rewrite_artifact\n# \u5220\u9664\nDeleteArtifactTool   # delete_artifact\n# \u5217\u8868\nListArtifactsTool    # list_artifacts\n</code></pre>"},{"location":"architecture/tools/#_6","title":"\u6dfb\u52a0\u65b0\u5de5\u5177","text":"<p>\u53c2\u89c1 Extension Guide\u3002</p>"}]}